<!DOCTYPE html>
<html lang="es" prefix="og: https://ogp.me/ns#">

<head>
 <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" sizes="32x32" href="/favicon.ico">
<meta name="theme-color" content="#039623">
<link rel="manifest" href="/site.webmanifest">
<script src="/lib/js/muestra-codigo.js"></script>
 <title>F. paho.javascript-1.0.3 / paho-mqtt.js - GilPG DM</title>
 <meta name="description" content="Código de «paho.javascript-1.0.3/paho-mqtt.js».">
 <meta name="og:image" content="https://gilpgdm.github.io/img/icono/icono2048.png">
 <style>
 /* https://paletton.com/#uid=74W0u0kllllaFw0g0qFqFg0w0aF */
 :root {
  --marginTop: 0.25rem;
  --padTop: 0;
  --h1PadTop: 2.5rem;
  --introDuracion: 2s;
  --introFuncion: ease-out;
  --padCont: 0.5rem;
  --padNav: 0.75rem 0.5rem;
  --anchoNav: 300px;
  --anchoLectura: 900px;
  --colLetra: black;
  --colFondo: white;
  --colPush: var(--colFondo);
  --colPushHover: var(--colFondo);
  --colPushFocus: var(--colFondo);
  --colPushActive: #bae397;
  --colFondoPush: #609732;
  --colFondoPushHover: #8abd5f;
  --colFondoPushFocus: #3e7213;
  --colFondoPushActive: #224c00;
  --paddingPush: 0.2rem 0.3rem;
  --borderPush: none;
  --borderRadiusPush: 0.6em;
  --colA: #6a7b15;
  --colAVisited: #6f256f;
  --colAActive: #e498af;
  --colAPush: var(--colFondo);
  --colAVisitedPush: var(--colFondo);
  --colAPushHover: var(--colFondo);
  --colAVisitedPushHover: var(--colFondo);
  --colAPushFocus: var(--colFondo);
  --colAVisitedPushFocus: var(--colFondo);
  --colAPushActive: var(--colFondo);
  --colAVisitedPushActive: var(--colFondo);
  --colFondoAPush: #6a7b15;
  --colFondoAVisitedPush: #6f256f;
  --colFondoAPushHover: #91a437;
  --colFondoAVisitedPushHover: #a66fa6;
  --colFondoAPushFocus: #445200;
  --colFondoAVisitedPushFocus: #530e53;
  --colFondoAPushActive: #e498af;
  --colFondoAVisitedPushActive: #e498af;
  --colSombra: #49494980;
  --navSombra: 0.5rem 0 0.5rem var(--colSombra);
  --shadowTitulo: 3px 1px 2px black;
  /* --colTitulo: #bae397; */
  --colTitulo: #609732;
  /* --colTituloFondo: #609732; */
  --colPrincipalTituloStrong: #6E256E;
  --colAStrong: var(--colLetra);
  /* --colNavH1Sel: #b35f7c; */
  --colFondoNav: var(--colFondo);
  --colFondoNavSel: #e498af;
  --colScrollbar: #CFD8DC;
  --colThumb: #90a4ae;
  --colThumbActivo: #3f3f3f;
  --colResaltado: #e9c8d2;
  --colResaltado2: #bae397;
  --colResaltado3: #cfcfcf;
  --colLetraResaltado: black;
  --colLetraCodeComment: #224c00;
  --colLetraCodeString: #903357;
  --colLetraCodeReserved: #445200;
  --colSecundario: #e498af;
  --colTarget: #cef4ff;
  --colStack1: black;
  --colStack2: #224ba5;
  --colStack3: #92731f;
  --anchoThumb: 7px;
  --borderRadiusThumb: 3.5px;
  --gap: 0.5rem;
  --fontMono: 'Xanh Mono', monospace;
  --fontSans: 'Patrick Hand', sans-serif;
  /* --fontSerif: 'Purple Purse', serif; */
  --fontSerif: Georgia, 'Times New Roman', Times, serif;
  font-family: var(--fontSerif);
  color: var(--colLetra);
  background-color: var(--colFondo);
  scrollbar-width: thin;
  scrollbar-color: var(--colThumb) var(--colScrollbar);
 }

 @media (prefers-color-scheme: light) {
  :root {
   --colLetra: black;
   --colFondo: white;
  }
 }

 /* https://paletton.com/#uid=74W0u0kaVz84jP27qHbeJtFiHpX */
 @media (prefers-color-scheme: dark) {

  :root {
   --colLetra: white;
   /* --colFondo: #272727; */
   --colFondo: black;
   --colPushActive: #e3f5d4;
   --colFondoPush: #bbe697;
   --colFondoPushHover: #d0eeb7;
   --colFondoPushFocus: #9ed372;
   --colFondoPushActive: #7db84d;
   --colA: #e9f7a3;
   --colAVisited: #c89ac8;
   --colAActive: #983351;
   --colFondoAPush: #e9f7a3;
   --colFondoAVisitedPush: #c89ac8;
   --colFondoAPushHover: #f6fcda;
   --colFondoAVisitedPushHover: #dec0de;
   --colFondoAPushFocus: #b4c853;
   --colFondoAVisitedPushFocus: #9a539a;
   --colFondoAPushActive: #983351;
   --colFondoAVisitedPushActive: #983351;
   --colSombra: #00000080;
   --colTitulo: #e3f5d4;
   --colPrincipalTituloStrong: #C899C8;
   /* --colTituloFondo: #7db84d; */
   /* --colNavH1Sel: #d37290; */
   --colFondoNavSel: #7a3059;
   --colScrollbar: #616161;
   --colThumb: #ffffff;
   --colResaltado: #7a3059;
   --colResaltado2: #5c922f;
   --colResaltado3: #4e4e4e;
   --colLetraResaltado: white;
   --colLetraCodeComment: #d0eeb7;
   --colLetraCodeString: #eeb7c8;
   --colLetraCodeReserved: #f0fac0;
  }
 }

 /* xanh-mono-regular - latin_latin-ext */
 @font-face {
  /* Check https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-display for other options. */
  font-display: swap;
  font-family: 'Xanh Mono';
  font-style: normal;
  font-weight: 400;
  /* Chrome 36+, Opera 23+, Firefox 39+, Safari 12+, iOS 10+ */
  src: url('/fonts/xanh-mono-v18-latin_latin-ext-regular.woff2') format('woff2');
 }

 /* xanh-mono-italic - latin_latin-ext */
 @font-face {
  /* Check https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-display for other options. */
  font-display: swap;
  font-family: 'Xanh Mono';
  font-style: italic;
  font-weight: 400;
  /* Chrome 36+, Opera 23+, Firefox 39+, Safari 12+, iOS 10+ */
  src: url('/fonts/xanh-mono-v18-latin_latin-ext-italic.woff2') format('woff2');
 }

 /* patrick-hand-regular - latin_latin-ext */
 @font-face {
  /* Check https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-display for other options. */
  font-display: swap;
  font-family: 'Patrick Hand';
  font-style: normal;
  font-weight: 400;
  /* Chrome 36+, Opera 23+, Firefox 39+, Safari 12+, iOS 10+ */
  src: url('/fonts/patrick-hand-v23-latin_latin-ext-regular.woff2') format('woff2');
 }

 /* purple-purse-regular - latin_latin-ext */
 @font-face {
  /* Check https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-display for other options. */
  font-display: swap;
  font-family: 'Purple Purse';
  font-style: normal;
  font-weight: 400;
  /* Chrome 36+, Opera 23+, Firefox 39+, Safari 12+, iOS 10+ */
  src: url('/fonts/purple-purse-v23-latin_latin-ext-regular.woff2') format('woff2');
 }

 @font-face {
  font-family: 'Material Symbols Outlined';
  font-style: normal;
  src:
   url(/fonts/MaterialSymbolsOutlined[FILL\,GRAD\,opsz\,wght].woff2) format('woff2'),
   url(/fonts/MaterialSymbolsOutlined[FILL\,GRAD\,opsz\,wght].ttf) format('truetype');
 }

 .material-symbols-outlined {
  font-family: 'Material Symbols Outlined';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  width: 24px;
  height: 24px;
  /* Preferred icon size */
  display: inline-block;
  line-height: 1;
  text-transform: none;
  letter-spacing: normal;
  word-wrap: normal;
  white-space: nowrap;
  direction: ltr;
 }

 body::-webkit-scrollbar {
  width: var(--anchoThumb);
  height: var(--anchoThumb);
 }

 body::-webkit-scrollbar-track {
  background: var(--colScrollbar);
 }

 body::-webkit-scrollbar-thumb {
  background-color: var(--colThumb);
  border-radius: var(--borderRadiusThumb);
 }

 body::-webkit-scrollbar-thumb:active {
  background-color: var(--colThumbActivo);
 }

 body {
  margin-top: 0;
 }

 h1 {
  font-size: 3rem;
 }

 section h1,
 nav h1 {
  font-size: 2.5rem;
  font-style: oblique;
 }

 section section h1 {
  font-size: 2rem;
  font-style: normal;
 }

 section section section h1 {
  font-size: 2rem;
  font-style: normal;
 }

 section section section section h1 {
  font-size: 1.5rem;
  font-style: oblique;
 }

 section section section section section h1 {
  font-size: 1.5rem;
  font-style: normal;
 }

 a {
  color: var(--colA);
 }

 a:visited {
  color: var(--colAVisited);
 }

 a:active {
  color: var(--colAActive);
 }

 .anterior,
 .siguiente,
 .paginaAnterior,
 .paginaSiguiente,
 button {
  display: inline-block;
  padding: var(--paddingPush);
  border: var(--borderPush);
  border-radius: var(--borderRadiusPush);
  text-align: center;
  text-decoration: none;
 }

 .anterior,
 .siguiente,
 .paginaAnterior,
 .paginaSiguiente {
  color: var(--colAPush);
  background-color: var(--colFondoAPush);
 }

 .anterior:visited,
 .siguiente:visited,
 .paginaAnterior:visited,
 .paginaSiguiente:visited {
  color: var(--colAVisitedPush);
  background-color: var(--colFondoAVisitedPush);
 }

 .anterior.bye,
 .siguiente.bye,
 .paginaAnterior.bye,
 .paginaSiguiente.bye {
  display: none;
 }

 .anterior:hover,
 .siguiente:hover,
 .paginaAnterior:hover,
 .paginaSiguiente:hover {
  color: var(--colAPushHover);
  background-color: var(--colFondoAPushHover);
 }

 .anterior:visited:hover,
 .siguiente:visited:hover,
 .paginaAnterior:visited:hover,
 .paginaSiguiente:visited:hover {
  color: var(--colAVisitedPushHover);
  background-color: var(--colFondoAVisitedPushHover);
 }

 .anterior:focus,
 .siguiente:focus,
 .paginaAnterior:focus,
 .paginaSiguiente:focus {
  color: var(--colAPushFocus);
  background-color: var(--colFondoAPushFocus);
 }

 .anterior:visited:focus,
 .siguiente:visited:focus,
 .paginaAnterior:visited:focus,
 .paginaSiguiente:visited:focus {
  color: var(--colAVisitedPushFocus);
  background-color: var(--colFondoAVisitedPushFocus);
 }

 .anterior:active,
 .siguiente:active,
 .paginaAnterior:active,
 .paginaSiguiente:active {
  color: var(--colAPushActive);
  background-color: var(--colFondoAPushActive);
 }

 .anterior:visited:active,
 .siguiente:visited:active,
 .paginaAnterior:visited:active,
 .paginaSiguiente:visited:active {
  color: var(--colAVisitedPushActive);
  background-color: var(--colFondoAVisitedPushActive);
 }

 button {
  color: var(--colPush);
  background-color: var(--colFondoPush);
 }

 button:hover {
  color: var(--colPushHover);
  background-color: var(--colFondoPushHover);
 }

 button:focus {
  color: var(--colPushFocus);
  background-color: var(--colFondoPushFocus);
 }

 button:active {
  color: var(--colPushActive);
  background-color: var(--colFondoPushActive);
 }

 .anterior span,
 .siguiente span,
 .paginaAnterior span,
 .paginaSiguiente span,
 button span {
  vertical-align: middle;
 }

 a[data-logo] {
  display: block;
  height: 54px;
  line-height: 54px;
  padding-left: 54px;
  margin-top: 1rem;
  background-image: url("/img/icono/maskable_icon_x48.png");
  background-position: 3px center;
  background-repeat: no-repeat;
 }

 a strong,
 a code,
 h1 strong,
 h1 code {
  font-size: 1em;
 }

 a strong,
 a code {
  color: var(--colAStrong);
 }

 nav a {
  font-family: var(--fontSans);
 }

 pre {
  font-family: var(--fontMono);
 }

 code {
  font-family: var(--fontMono);
  font-size: 1rem;
 }

 .tree {
  font-family: var(--fontSans);
 }

 .tree summary {
  text-decoration: underline;
  cursor: pointer;
 }

 .tree li {
  margin-top: 1em;
  margin-bottom: 1em;
 }

 h1:not(.default) {
  font-family: var(--fontSans);
  color: var(--colTituloFondo);
 }

 h1,
 .lectura a,
 .lectura p,
 .lectura blockquote {
  overflow-wrap: anywhere;
 }

 .autor {
  font-family: var(--fontSans);
  font-size: 1.5rem;
  color: var(--colTituloFondo);
 }

 figure {
  text-align: center;
 }

 figure img {
  width: 100%;
 }

 figcaption {
  font-family: var(--fontMono);
 }

 .print .noPrint {
  display: none;
 }

 @media print {
  .noPrint {
   display: none;
  }

  .pruebaDeEscritorio {
   page-break-before: always;
  }
 }

 iframe {
  /* background-color: white; */
  box-sizing: border-box;
  resize: both;
 }

 .lectura {
  max-width: var(--anchoLectura);
  margin: 1rem auto;
 }

 .lectura p,
 .lectura blockquote {
  text-align: justify;
 }

 .horizontal {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  align-items: start;
  justify-content: center;
 }

 .horizontal>*:first-child {
  flex: 1 1 auto;
 }

 .horizontal>*:nth-child(2) {
  flex: 1 1 40ch;
 }

 .horizontal iframe {
  width: 300px;
 }

 .columnas4 {
  columns: 4 180px;
  column-gap: 1rem;
 }

 .columnas2 {
  columns: 2 360px;
  column-gap: 1rem;
 }

 .resaltado {
  background-color: var(--colResaltado);
  color: var(--colLetraResaltado);
 }

 .resaltado2 {
  background-color: var(--colResaltado2);
  color: var(--colLetraResaltado);
 }

 .resaltado3 {
  background-color: var(--colResaltado3);
  color: var(--colLetraResaltado);
 }

 table.borde {
  margin-left: auto;
  margin-right: auto;
 }

 table.borde,
 table.borde td {
  border: thin solid;
  border-collapse: collapse;
 }

 table.borde th,
 table.borde td {
  padding: 0.4rem;
 }

 table.codeShow {
  margin-left: auto;
  margin-right: auto;
  text-align: left;
 }

 .codeShow td.codeShow_order {
  text-align: right;
  padding: 0 0 0 0;
  vertical-align: top;
  font-family: var(--fontMono);
  white-space: pre;
  font-size: 1rem;
  line-height: 1.2rem;
  /* Avoid selection */
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
 }

 .codeShow td:has(pre) {
  padding: 0 0 0 0.25rem;
  vertical-align: top;
 }

 .codeShow td pre {
  font-family: var(--fontMono);
  white-space: pre-wrap;
  overflow-wrap: anywhere;
  font-size: 1rem;
  line-height: 1.2rem;
  margin: 0;
 }

 .codeReserved {
  color: var(--colLetraCodeReserved);
  font-weight: bolder;
 }

 .codeString {
  color: var(--colLetraCodeString);
  font-weight: 600;
 }

 .codeComment {
  color: var(--colLetraCodeComment);
  font-style: italic;
 }

 @media print {

  .codeShow button {
   display: none;
  }
 }


 footer {
  margin-top: 1rem;
  display: block;
  text-align: center;
  font-family: var(--fontSans);
  font-size: small;
 }
</style>
 <style>
 body {
  scroll-padding-top: var(--padTop);
 }

 body {
  animation-timing-function: var(--introFuncion);
  animation-duration: var(--introDuracion);
  animation-fill-mode: forwards;
  animation-name: appear;
 }

 body.noTransition {
  animation-name: noTransition;
 }

 @keyframes appear {
  from {
   opacity: 0;
  }

  to {
   opacity: 1;
  }
 }

 @keyframes noTransition {
  0% {
   opacity: 0;
  }

  0.7% {
   opacity: 1;
  }

  100% {
   opacity: 1;
  }
 }

 #principal {
  padding-top: var(--padTop);
  box-sizing: border-box;
  transition: margin-left 0.7s ease-in-out;
 }

 #principal a {
  word-wrap: break-word;
 }

 #principal>#abre {
  position: fixed;
  top: var(--gap);
  left: var(--gap);
  transition-property: top, left;
  transition-duration: 0.7s, 0.7s;
  transition-timing-function: ease-in-out;
 }

 #principal>.anterior {
  position: fixed;
  top: var(--gap);
  transition-property: top, left;
  transition-duration: 0.7s, 0.7s;
  transition-timing-function: ease-in-out;
 }

 #principal>.siguiente {
  position: fixed;
  top: var(--gap);
  right: var(--gap);
  transition: top 0.7s ease-in-out;
 }

 .scroll #principal>#abre,
 .scroll #principal>.anterior,
 .scroll #principal>.siguiente {
  top: -10rem;
 }

 #principal>h1:not(.default) {
  margin-top: var(--marginTop);
  padding: var(--h1PadTop) 1rem 1rem 1rem;
  color: var(--colTitulo);
  background-color: var(--colTituloFondo);
 }

 #principal>h1:not(.default) strong,
 #principal>h1:not(.default) code {
  color: var(--colPrincipalTituloStrong);
 }

 #nav {
  position: fixed;
  top: 0;
  left: 0;
  bottom: 0;
  box-sizing: border-box;
  overflow: auto;
  color: var(--colLetra);
  background-color: var(--colFondoNav);
  padding: var(--padCont);
  transition: transform 0.7s ease-in-out;
  scrollbar-width: thin;
  scrollbar-color: var(--colThumb) var(--colScrollbar);
  overflow-wrap: anywhere;
 }

 #nav::-webkit-scrollbar {
  width: var(--anchoThumb);
  height: var(--anchoThumb);
 }

 #nav::-webkit-scrollbar-track {
  background: var(--colScrollbar);
 }

 #nav::-webkit-scrollbar-thumb {
  background-color: var(--colThumb);
  border-radius: var(--borderRadiusThumb);
 }

 #nav::-webkit-scrollbar-thumb:active {
  background-color: var(--colThumbActivo);
 }

 #nav p {
  margin: 0;
 }

 #nav a:not([data-logo]) {
  display: block;
  padding: var(--padNav);
 }

 #nav a.actual code,
 #nav a.actual strong {
  color: var(--colAStrong);
 }

 #nav a.actual {
  background-color: var(--colFondoNavSel);
 }

 @media screen and (max-width: 999px) {
  #principal {
   max-width: 100vw;
  }

  #cierra {
   position: fixed;
   top: 0;
   bottom: 0;
   left: 0;
   right: 0;
   background-color: var(--colSombra);
   transform: translateX(-120%);
   transition: transform 0.7s ease-out;
  }

  #nav {
   width: min(var(--anchoNav), 70%);
   box-shadow: var(--navSombra);
  }

  .xmenu>#nav {
   transform: translateX(-120%);
  }

  .menu>#cierra,
  .menu>#nav {
   transform: translateX(0);
  }

  #principal>.anterior {
   left: calc(2 * var(--gap) + 2rem);
  }
 }

 @media screen and (min-width: 1000px) {
  #cierra {
   display: none;
  }

  #nav {
   width: var(--anchoNav);
  }

  .menu>#nav {
   transform: translateX(-120%);
  }

  .xmenu>#principal {
   margin-left: var(--anchoNav)
  }

  .menu>#principal>.anterior {
   left: calc(2 * var(--gap) + 2rem);
  }

  .xmenu>#principal>.anterior {
   top: var(--gap);
   left: calc(var(--anchoNav) + var(--gap));
  }

  .xmenu.scroll #principal>.anterior {
   top: -10rem;
  }
 }

 @media print {

  #nav,
  #principal>#abre,
  #principal>.anterior,
  #principal>.siguiente {
   display: none;
  }

  #principal>h1:not(.default) {
   margin-top: 0.5rem;
   padding: 1rem;
   color: var(--colTituloFondo);
   background-color: transparent;
  }

 }
</style>
 
</head>

<body  class="xmenu">
 <div id="principal">
   <h1 >F. paho.javascript-1.0.3 / paho-mqtt.js</h1><table class="codeShow">
 <caption style="text-align: left">
  <button type=button title="Copiar al portapapeles"
    onclick="copyToClipboard(this)">
   <span class="material-symbols-outlined">
    content_copy
   </span>
  </button>
 </caption>
 <tbody>
  <tr><td class="codeShow_order">1</td><td><pre><span class="codeComment">/*******************************************************************************</span></pre></td></tr>
  <tr><td class="codeShow_order">2</td><td><pre><span class="codeComment"> * Copyright (c) 2013 IBM Corp.</span></pre></td></tr>
  <tr><td class="codeShow_order">3</td><td><pre><span class="codeComment"> *</span></pre></td></tr>
  <tr><td class="codeShow_order">4</td><td><pre><span class="codeComment"> * All rights reserved. This program and the accompanying materials</span></pre></td></tr>
  <tr><td class="codeShow_order">5</td><td><pre><span class="codeComment"> * are made available under the terms of the Eclipse Public License v1.0</span></pre></td></tr>
  <tr><td class="codeShow_order">6</td><td><pre><span class="codeComment"> * and Eclipse Distribution License v1.0 which accompany <span class="codeReserved">this</span> distribution.</span></pre></td></tr>
  <tr><td class="codeShow_order">7</td><td><pre><span class="codeComment"> *</span></pre></td></tr>
  <tr><td class="codeShow_order">8</td><td><pre><span class="codeComment"> * The Eclipse Public License is available at</span></pre></td></tr>
  <tr><td class="codeShow_order">9</td><td><pre><span class="codeComment"> *    http://www.eclipse.org/legal/epl-v10.html</span></pre></td></tr>
  <tr><td class="codeShow_order">10</td><td><pre><span class="codeComment"> * and the Eclipse Distribution License is available at</span></pre></td></tr>
  <tr><td class="codeShow_order">11</td><td><pre><span class="codeComment"> *   http://www.eclipse.org/org/documents/edl-v10.php.</span></pre></td></tr>
  <tr><td class="codeShow_order">12</td><td><pre><span class="codeComment"> *</span></pre></td></tr>
  <tr><td class="codeShow_order">13</td><td><pre><span class="codeComment"> * Contributors:</span></pre></td></tr>
  <tr><td class="codeShow_order">14</td><td><pre><span class="codeComment"> *    Andrew Banks - initial API and implementation and initial documentation</span></pre></td></tr>
  <tr><td class="codeShow_order">15</td><td><pre><span class="codeComment"> *******************************************************************************/</span></pre></td></tr>
  <tr><td class="codeShow_order">16</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">17</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">18</td><td><pre><span class="codeComment">// Only expose a single object name in the global namespace.</span></pre></td></tr>
  <tr><td class="codeShow_order">19</td><td><pre><span class="codeComment">// Everything must go through this module. Global Paho.MQTT module</span></pre></td></tr>
  <tr><td class="codeShow_order">20</td><td><pre><span class="codeComment">// only has a single public function, client, which returns</span></pre></td></tr>
  <tr><td class="codeShow_order">21</td><td><pre><span class="codeComment">// a Paho.MQTT client object given connection details.</span></pre></td></tr>
  <tr><td class="codeShow_order">22</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">23</td><td><pre><span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">24</td><td><pre><span class="codeComment"> * Send and receive messages using web browsers.</span></pre></td></tr>
  <tr><td class="codeShow_order">25</td><td><pre><span class="codeComment"> * &lt;p&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">26</td><td><pre><span class="codeComment"> * This programming interface lets a JavaScript client application use the MQTT V3.1 or</span></pre></td></tr>
  <tr><td class="codeShow_order">27</td><td><pre><span class="codeComment"> * V3.1.1 protocol <span class="codeReserved">to</span> connect <span class="codeReserved">to</span> an MQTT-supporting messaging server.</span></pre></td></tr>
  <tr><td class="codeShow_order">28</td><td><pre><span class="codeComment"> *</span></pre></td></tr>
  <tr><td class="codeShow_order">29</td><td><pre><span class="codeComment"> * The <span class="codeReserved">function</span> supported includes:</span></pre></td></tr>
  <tr><td class="codeShow_order">30</td><td><pre><span class="codeComment"> * &lt;ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">31</td><td><pre><span class="codeComment"> * &lt;li&gt;Connecting <span class="codeReserved">to</span> and disconnecting <span class="codeReserved">from</span> a server. The server is identified by its host name and port number.</span></pre></td></tr>
  <tr><td class="codeShow_order">32</td><td><pre><span class="codeComment"> * &lt;li&gt;Specifying options that relate <span class="codeReserved">to</span> the communications link with the server,</span></pre></td></tr>
  <tr><td class="codeShow_order">33</td><td><pre><span class="codeComment"> * <span class="codeReserved">for</span> example the frequency of keep-alive heartbeats, and whether SSL/TLS is required.</span></pre></td></tr>
  <tr><td class="codeShow_order">34</td><td><pre><span class="codeComment"> * &lt;li&gt;Subscribing <span class="codeReserved">to</span> and receiving messages <span class="codeReserved">from</span> MQTT Topics.</span></pre></td></tr>
  <tr><td class="codeShow_order">35</td><td><pre><span class="codeComment"> * &lt;li&gt;Publishing messages <span class="codeReserved">to</span> MQTT Topics.</span></pre></td></tr>
  <tr><td class="codeShow_order">36</td><td><pre><span class="codeComment"> * &lt;/ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">37</td><td><pre><span class="codeComment"> * &lt;p&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">38</td><td><pre><span class="codeComment"> * The API consists of two main objects:</span></pre></td></tr>
  <tr><td class="codeShow_order">39</td><td><pre><span class="codeComment"> * &lt;dl&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">40</td><td><pre><span class="codeComment"> * &lt;dt&gt;&lt;b&gt;{<span class="codeReserved">@link</span> Paho.MQTT.Client}&lt;/b&gt;&lt;/dt&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">41</td><td><pre><span class="codeComment"> * &lt;dd&gt;This contains methods that provide the functionality of the API,</span></pre></td></tr>
  <tr><td class="codeShow_order">42</td><td><pre><span class="codeComment"> * including provision of callbacks that notify the application when a message</span></pre></td></tr>
  <tr><td class="codeShow_order">43</td><td><pre><span class="codeComment"> * arrives <span class="codeReserved">from</span> or is delivered <span class="codeReserved">to</span> the messaging server,</span></pre></td></tr>
  <tr><td class="codeShow_order">44</td><td><pre><span class="codeComment"> * or when the status of its connection <span class="codeReserved">to</span> the messaging server changes.&lt;/dd&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">45</td><td><pre><span class="codeComment"> * &lt;dt&gt;&lt;b&gt;{<span class="codeReserved">@link</span> Paho.MQTT.Message}&lt;/b&gt;&lt;/dt&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">46</td><td><pre><span class="codeComment"> * &lt;dd&gt;This encapsulates the payload of the message along with various attributes</span></pre></td></tr>
  <tr><td class="codeShow_order">47</td><td><pre><span class="codeComment"> * associated with its delivery, <span class="codeReserved">in</span> particular the destination <span class="codeReserved">to</span> which it has</span></pre></td></tr>
  <tr><td class="codeShow_order">48</td><td><pre><span class="codeComment"> * been (or is about <span class="codeReserved">to</span> be) sent.&lt;/dd&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">49</td><td><pre><span class="codeComment"> * &lt;/dl&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">50</td><td><pre><span class="codeComment"> * &lt;p&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">51</td><td><pre><span class="codeComment"> * The programming interface validates parameters passed <span class="codeReserved">to</span> it, and will <span class="codeReserved">throw</span></span></pre></td></tr>
  <tr><td class="codeShow_order">52</td><td><pre><span class="codeComment"> * an Error containing an error message intended <span class="codeReserved">for</span> developer use, <span class="codeReserved">if</span> it detects</span></pre></td></tr>
  <tr><td class="codeShow_order">53</td><td><pre><span class="codeComment"> * an error with any parameter.</span></pre></td></tr>
  <tr><td class="codeShow_order">54</td><td><pre><span class="codeComment"> * &lt;p&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">55</td><td><pre><span class="codeComment"> * Example:</span></pre></td></tr>
  <tr><td class="codeShow_order">56</td><td><pre><span class="codeComment"> *</span></pre></td></tr>
  <tr><td class="codeShow_order">57</td><td><pre><span class="codeComment"> * &lt;code&gt;&lt;pre&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">58</td><td><pre><span class="codeComment">client = <span class="codeReserved">new</span> Paho.MQTT.Client(location.hostname, Number(location.port), &quot;clientId&quot;);</span></pre></td></tr>
  <tr><td class="codeShow_order">59</td><td><pre><span class="codeComment">client.onConnectionLost = onConnectionLost;</span></pre></td></tr>
  <tr><td class="codeShow_order">60</td><td><pre><span class="codeComment">client.onMessageArrived = onMessageArrived;</span></pre></td></tr>
  <tr><td class="codeShow_order">61</td><td><pre><span class="codeComment">client.connect({onSuccess:onConnect});</span></pre></td></tr>
  <tr><td class="codeShow_order">62</td><td><pre><span class="codeComment"></span></pre></td></tr>
  <tr><td class="codeShow_order">63</td><td><pre><span class="codeComment"><span class="codeReserved">function</span> onConnect() {</span></pre></td></tr>
  <tr><td class="codeShow_order">64</td><td><pre><span class="codeComment">  // Once a connection has been made, make a subscription and send a message.</span></pre></td></tr>
  <tr><td class="codeShow_order">65</td><td><pre><span class="codeComment">  console.log(&quot;onConnect&quot;);</span></pre></td></tr>
  <tr><td class="codeShow_order">66</td><td><pre><span class="codeComment">  client.subscribe(&quot;/World&quot;);</span></pre></td></tr>
  <tr><td class="codeShow_order">67</td><td><pre><span class="codeComment">  message = <span class="codeReserved">new</span> Paho.MQTT.Message(&quot;Hello&quot;);</span></pre></td></tr>
  <tr><td class="codeShow_order">68</td><td><pre><span class="codeComment">  message.destinationName = &quot;/World&quot;;</span></pre></td></tr>
  <tr><td class="codeShow_order">69</td><td><pre><span class="codeComment">  client.send(message);</span></pre></td></tr>
  <tr><td class="codeShow_order">70</td><td><pre><span class="codeComment">};</span></pre></td></tr>
  <tr><td class="codeShow_order">71</td><td><pre><span class="codeComment"><span class="codeReserved">function</span> onConnectionLost(responseObject) {</span></pre></td></tr>
  <tr><td class="codeShow_order">72</td><td><pre><span class="codeComment">  <span class="codeReserved">if</span> (responseObject.errorCode !== 0)</span></pre></td></tr>
  <tr><td class="codeShow_order">73</td><td><pre><span class="codeComment">	console.log(&quot;onConnectionLost:&quot;+responseObject.errorMessage);</span></pre></td></tr>
  <tr><td class="codeShow_order">74</td><td><pre><span class="codeComment">};</span></pre></td></tr>
  <tr><td class="codeShow_order">75</td><td><pre><span class="codeComment"><span class="codeReserved">function</span> onMessageArrived(message) {</span></pre></td></tr>
  <tr><td class="codeShow_order">76</td><td><pre><span class="codeComment">  console.log(&quot;onMessageArrived:&quot;+message.payloadString);</span></pre></td></tr>
  <tr><td class="codeShow_order">77</td><td><pre><span class="codeComment">  client.disconnect();</span></pre></td></tr>
  <tr><td class="codeShow_order">78</td><td><pre><span class="codeComment">};</span></pre></td></tr>
  <tr><td class="codeShow_order">79</td><td><pre><span class="codeComment"> * &lt;/pre&gt;&lt;/code&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">80</td><td><pre><span class="codeComment"> * <span class="codeReserved">@namespace</span> Paho.MQTT</span></pre></td></tr>
  <tr><td class="codeShow_order">81</td><td><pre><span class="codeComment"> */</span></pre></td></tr>
  <tr><td class="codeShow_order">82</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">83</td><td><pre><span class="codeComment">/* jshint shadow:<span class="codeReserved">true</span> */</span></pre></td></tr>
  <tr><td class="codeShow_order">84</td><td><pre>(<span class="codeReserved">function</span> ExportLibrary(root, factory) {</pre></td></tr>
  <tr><td class="codeShow_order">85</td><td><pre>	<span class="codeReserved">if</span>(<span class="codeReserved">typeof</span> exports === <span class="codeString">'object'</span> && <span class="codeReserved">typeof</span> module === <span class="codeString">'object'</span>){</pre></td></tr>
  <tr><td class="codeShow_order">86</td><td><pre>		module.exports = factory();</pre></td></tr>
  <tr><td class="codeShow_order">87</td><td><pre>	} <span class="codeReserved">else</span> <span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> define === <span class="codeString">'<span class="codeReserved">function</span>'</span> && define.amd){</pre></td></tr>
  <tr><td class="codeShow_order">88</td><td><pre>		define(factory);</pre></td></tr>
  <tr><td class="codeShow_order">89</td><td><pre>	} <span class="codeReserved">else</span> <span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> exports === <span class="codeString">'object'</span>){</pre></td></tr>
  <tr><td class="codeShow_order">90</td><td><pre>		exports = factory();</pre></td></tr>
  <tr><td class="codeShow_order">91</td><td><pre>	} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">92</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> root.Paho === <span class="codeString">'undefined'</span>){</pre></td></tr>
  <tr><td class="codeShow_order">93</td><td><pre>			root.Paho = {};</pre></td></tr>
  <tr><td class="codeShow_order">94</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">95</td><td><pre>		root.Paho.MQTT = factory();</pre></td></tr>
  <tr><td class="codeShow_order">96</td><td><pre>	}</pre></td></tr>
  <tr><td class="codeShow_order">97</td><td><pre>})(<span class="codeReserved">this</span>, <span class="codeReserved">function</span> LibraryFactory(){</pre></td></tr>
  <tr><td class="codeShow_order">98</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">99</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">100</td><td><pre><span class="codeReserved">var</span> PahoMQTT = (<span class="codeReserved">function</span> (global) {</pre></td></tr>
  <tr><td class="codeShow_order">101</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">102</td><td><pre>	<span class="codeComment">// Private variables below, these are only visible inside the function closure</span></pre></td></tr>
  <tr><td class="codeShow_order">103</td><td><pre>	<span class="codeComment">// which is used to define the module.</span></pre></td></tr>
  <tr><td class="codeShow_order">104</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">105</td><td><pre>	<span class="codeReserved">var</span> version = <span class="codeString">"@VERSION@"</span>;</pre></td></tr>
  <tr><td class="codeShow_order">106</td><td><pre>	<span class="codeReserved">var</span> buildLevel = <span class="codeString">"@BUILDLEVEL@"</span>;</pre></td></tr>
  <tr><td class="codeShow_order">107</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">108</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">109</td><td><pre><span class="codeComment">	 * Unique message type identifiers, with associated</span></pre></td></tr>
  <tr><td class="codeShow_order">110</td><td><pre><span class="codeComment">	 * associated integer values.</span></pre></td></tr>
  <tr><td class="codeShow_order">111</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@private</span></span></pre></td></tr>
  <tr><td class="codeShow_order">112</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">113</td><td><pre>	<span class="codeReserved">var</span> MESSAGE_TYPE = {</pre></td></tr>
  <tr><td class="codeShow_order">114</td><td><pre>		CONNECT: 1,</pre></td></tr>
  <tr><td class="codeShow_order">115</td><td><pre>		CONNACK: 2,</pre></td></tr>
  <tr><td class="codeShow_order">116</td><td><pre>		PUBLISH: 3,</pre></td></tr>
  <tr><td class="codeShow_order">117</td><td><pre>		PUBACK: 4,</pre></td></tr>
  <tr><td class="codeShow_order">118</td><td><pre>		PUBREC: 5,</pre></td></tr>
  <tr><td class="codeShow_order">119</td><td><pre>		PUBREL: 6,</pre></td></tr>
  <tr><td class="codeShow_order">120</td><td><pre>		PUBCOMP: 7,</pre></td></tr>
  <tr><td class="codeShow_order">121</td><td><pre>		SUBSCRIBE: 8,</pre></td></tr>
  <tr><td class="codeShow_order">122</td><td><pre>		SUBACK: 9,</pre></td></tr>
  <tr><td class="codeShow_order">123</td><td><pre>		UNSUBSCRIBE: 10,</pre></td></tr>
  <tr><td class="codeShow_order">124</td><td><pre>		UNSUBACK: 11,</pre></td></tr>
  <tr><td class="codeShow_order">125</td><td><pre>		PINGREQ: 12,</pre></td></tr>
  <tr><td class="codeShow_order">126</td><td><pre>		PINGRESP: 13,</pre></td></tr>
  <tr><td class="codeShow_order">127</td><td><pre>		DISCONNECT: 14</pre></td></tr>
  <tr><td class="codeShow_order">128</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">129</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">130</td><td><pre>	<span class="codeComment">// Collection of utility methods used to simplify module code</span></pre></td></tr>
  <tr><td class="codeShow_order">131</td><td><pre>	<span class="codeComment">// and promote the DRY pattern.</span></pre></td></tr>
  <tr><td class="codeShow_order">132</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">133</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">134</td><td><pre><span class="codeComment">	 * Validate an object&#039;s parameter names <span class="codeReserved">to</span> ensure they</span></pre></td></tr>
  <tr><td class="codeShow_order">135</td><td><pre><span class="codeComment">	 * match a list of expected variables name <span class="codeReserved">for</span> <span class="codeReserved">this</span> option</span></pre></td></tr>
  <tr><td class="codeShow_order">136</td><td><pre><span class="codeComment">	 * type. Used <span class="codeReserved">to</span> ensure option object passed into the API don&#039;t</span></pre></td></tr>
  <tr><td class="codeShow_order">137</td><td><pre><span class="codeComment">	 * contain erroneous parameters.</span></pre></td></tr>
  <tr><td class="codeShow_order">138</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> {Object} obj - User options object</span></pre></td></tr>
  <tr><td class="codeShow_order">139</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> {Object} keys - valid keys and types that may exist <span class="codeReserved">in</span> obj.</span></pre></td></tr>
  <tr><td class="codeShow_order">140</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@throws</span> {Error} Invalid option parameter found.</span></pre></td></tr>
  <tr><td class="codeShow_order">141</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@private</span></span></pre></td></tr>
  <tr><td class="codeShow_order">142</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">143</td><td><pre>	<span class="codeReserved">var</span> validate = <span class="codeReserved">function</span>(obj, keys) {</pre></td></tr>
  <tr><td class="codeShow_order">144</td><td><pre>		<span class="codeReserved">for</span> (<span class="codeReserved">var</span> key <span class="codeReserved">in</span> obj) {</pre></td></tr>
  <tr><td class="codeShow_order">145</td><td><pre>			<span class="codeReserved">if</span> (obj.hasOwnProperty(key)) {</pre></td></tr>
  <tr><td class="codeShow_order">146</td><td><pre>				<span class="codeReserved">if</span> (keys.hasOwnProperty(key)) {</pre></td></tr>
  <tr><td class="codeShow_order">147</td><td><pre>					<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> obj[key] !== keys[key])</pre></td></tr>
  <tr><td class="codeShow_order">148</td><td><pre>					   <span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> obj[key], key]));</pre></td></tr>
  <tr><td class="codeShow_order">149</td><td><pre>				} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">150</td><td><pre>					<span class="codeReserved">var</span> errorStr = <span class="codeString">"Unknown property, "</span> + key + <span class="codeString">". Valid properties are:"</span>;</pre></td></tr>
  <tr><td class="codeShow_order">151</td><td><pre>					<span class="codeReserved">for</span> (<span class="codeReserved">var</span> validKey <span class="codeReserved">in</span> keys)</pre></td></tr>
  <tr><td class="codeShow_order">152</td><td><pre>						<span class="codeReserved">if</span> (keys.hasOwnProperty(validKey))</pre></td></tr>
  <tr><td class="codeShow_order">153</td><td><pre>							errorStr = errorStr+<span class="codeString">" "</span>+validKey;</pre></td></tr>
  <tr><td class="codeShow_order">154</td><td><pre>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(errorStr);</pre></td></tr>
  <tr><td class="codeShow_order">155</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">156</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">157</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">158</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">159</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">160</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">161</td><td><pre><span class="codeComment">	 * Return a <span class="codeReserved">new</span> <span class="codeReserved">function</span> which runs the user <span class="codeReserved">function</span> bound</span></pre></td></tr>
  <tr><td class="codeShow_order">162</td><td><pre><span class="codeComment">	 * <span class="codeReserved">to</span> a fixed scope.</span></pre></td></tr>
  <tr><td class="codeShow_order">163</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> {<span class="codeReserved">function</span>} User <span class="codeReserved">function</span></span></pre></td></tr>
  <tr><td class="codeShow_order">164</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> {object} Function scope</span></pre></td></tr>
  <tr><td class="codeShow_order">165</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@return</span> {<span class="codeReserved">function</span>} User <span class="codeReserved">function</span> bound <span class="codeReserved">to</span> another scope</span></pre></td></tr>
  <tr><td class="codeShow_order">166</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@private</span></span></pre></td></tr>
  <tr><td class="codeShow_order">167</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">168</td><td><pre>	<span class="codeReserved">var</span> scope = <span class="codeReserved">function</span> (f, scope) {</pre></td></tr>
  <tr><td class="codeShow_order">169</td><td><pre>		<span class="codeReserved">return</span> <span class="codeReserved">function</span> () {</pre></td></tr>
  <tr><td class="codeShow_order">170</td><td><pre>			<span class="codeReserved">return</span> f.apply(scope, arguments);</pre></td></tr>
  <tr><td class="codeShow_order">171</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">172</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">173</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">174</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">175</td><td><pre><span class="codeComment">	 * Unique message type identifiers, with associated</span></pre></td></tr>
  <tr><td class="codeShow_order">176</td><td><pre><span class="codeComment">	 * associated integer values.</span></pre></td></tr>
  <tr><td class="codeShow_order">177</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@private</span></span></pre></td></tr>
  <tr><td class="codeShow_order">178</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">179</td><td><pre>	<span class="codeReserved">var</span> ERROR = {</pre></td></tr>
  <tr><td class="codeShow_order">180</td><td><pre>		OK: {code:0, text:<span class="codeString">"AMQJSC0000I OK."</span>},</pre></td></tr>
  <tr><td class="codeShow_order">181</td><td><pre>		CONNECT_TIMEOUT: {code:1, text:<span class="codeString">"AMQJSC0001E Connect timed out."</span>},</pre></td></tr>
  <tr><td class="codeShow_order">182</td><td><pre>		SUBSCRIBE_TIMEOUT: {code:2, text:<span class="codeString">"AMQJS0002E Subscribe timed out."</span>},</pre></td></tr>
  <tr><td class="codeShow_order">183</td><td><pre>		UNSUBSCRIBE_TIMEOUT: {code:3, text:<span class="codeString">"AMQJS0003E Unsubscribe timed out."</span>},</pre></td></tr>
  <tr><td class="codeShow_order">184</td><td><pre>		PING_TIMEOUT: {code:4, text:<span class="codeString">"AMQJS0004E Ping timed out."</span>},</pre></td></tr>
  <tr><td class="codeShow_order">185</td><td><pre>		INTERNAL_ERROR: {code:5, text:<span class="codeString">"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}"</span>},</pre></td></tr>
  <tr><td class="codeShow_order">186</td><td><pre>		CONNACK_RETURNCODE: {code:6, text:<span class="codeString">"AMQJS0006E Bad Connack <span class="codeReserved">return</span> code:{0} {1}."</span>},</pre></td></tr>
  <tr><td class="codeShow_order">187</td><td><pre>		SOCKET_ERROR: {code:7, text:<span class="codeString">"AMQJS0007E Socket error:{0}."</span>},</pre></td></tr>
  <tr><td class="codeShow_order">188</td><td><pre>		SOCKET_CLOSE: {code:8, text:<span class="codeString">"AMQJS0008I Socket closed."</span>},</pre></td></tr>
  <tr><td class="codeShow_order">189</td><td><pre>		MALFORMED_UTF: {code:9, text:<span class="codeString">"AMQJS0009E Malformed UTF data:{0} {1} {2}."</span>},</pre></td></tr>
  <tr><td class="codeShow_order">190</td><td><pre>		UNSUPPORTED: {code:10, text:<span class="codeString">"AMQJS0010E {0} is not supported by <span class="codeReserved">this</span> browser."</span>},</pre></td></tr>
  <tr><td class="codeShow_order">191</td><td><pre>		INVALID_STATE: {code:11, text:<span class="codeString">"AMQJS0011E Invalid state {0}."</span>},</pre></td></tr>
  <tr><td class="codeShow_order">192</td><td><pre>		INVALID_TYPE: {code:12, text:<span class="codeString">"AMQJS0012E Invalid type {0} <span class="codeReserved">for</span> {1}."</span>},</pre></td></tr>
  <tr><td class="codeShow_order">193</td><td><pre>		INVALID_ARGUMENT: {code:13, text:<span class="codeString">"AMQJS0013E Invalid argument {0} <span class="codeReserved">for</span> {1}."</span>},</pre></td></tr>
  <tr><td class="codeShow_order">194</td><td><pre>		UNSUPPORTED_OPERATION: {code:14, text:<span class="codeString">"AMQJS0014E Unsupported operation."</span>},</pre></td></tr>
  <tr><td class="codeShow_order">195</td><td><pre>		INVALID_STORED_DATA: {code:15, text:<span class="codeString">"AMQJS0015E Invalid data <span class="codeReserved">in</span> local storage key={0} value={1}."</span>},</pre></td></tr>
  <tr><td class="codeShow_order">196</td><td><pre>		INVALID_MQTT_MESSAGE_TYPE: {code:16, text:<span class="codeString">"AMQJS0016E Invalid MQTT message type {0}."</span>},</pre></td></tr>
  <tr><td class="codeShow_order">197</td><td><pre>		MALFORMED_UNICODE: {code:17, text:<span class="codeString">"AMQJS0017E Malformed Unicode string:{0} {1}."</span>},</pre></td></tr>
  <tr><td class="codeShow_order">198</td><td><pre>		BUFFER_FULL: {code:18, text:<span class="codeString">"AMQJS0018E Message buffer is full, maximum buffer size: {0}."</span>},</pre></td></tr>
  <tr><td class="codeShow_order">199</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">200</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">201</td><td><pre>	<span class="codeComment">/** CONNACK RC Meaning. */</span></pre></td></tr>
  <tr><td class="codeShow_order">202</td><td><pre>	<span class="codeReserved">var</span> CONNACK_RC = {</pre></td></tr>
  <tr><td class="codeShow_order">203</td><td><pre>		0:<span class="codeString">"Connection Accepted"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">204</td><td><pre>		1:<span class="codeString">"Connection Refused: unacceptable protocol version"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">205</td><td><pre>		2:<span class="codeString">"Connection Refused: identifier rejected"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">206</td><td><pre>		3:<span class="codeString">"Connection Refused: server unavailable"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">207</td><td><pre>		4:<span class="codeString">"Connection Refused: bad user name or password"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">208</td><td><pre>		5:<span class="codeString">"Connection Refused: not authorized"</span></pre></td></tr>
  <tr><td class="codeShow_order">209</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">210</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">211</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">212</td><td><pre><span class="codeComment">	 * Format an error message text.</span></pre></td></tr>
  <tr><td class="codeShow_order">213</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@private</span></span></pre></td></tr>
  <tr><td class="codeShow_order">214</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> {error} ERROR.<span class="codeReserved">KEY</span> value above.</span></pre></td></tr>
  <tr><td class="codeShow_order">215</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> {substitutions} [array] substituted into the text.</span></pre></td></tr>
  <tr><td class="codeShow_order">216</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@return</span> the text with the substitutions made.</span></pre></td></tr>
  <tr><td class="codeShow_order">217</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">218</td><td><pre>	<span class="codeReserved">var</span> format = <span class="codeReserved">function</span>(error, substitutions) {</pre></td></tr>
  <tr><td class="codeShow_order">219</td><td><pre>		<span class="codeReserved">var</span> text = error.text;</pre></td></tr>
  <tr><td class="codeShow_order">220</td><td><pre>		<span class="codeReserved">if</span> (substitutions) {</pre></td></tr>
  <tr><td class="codeShow_order">221</td><td><pre>		  <span class="codeReserved">var</span> field,start;</pre></td></tr>
  <tr><td class="codeShow_order">222</td><td><pre>		  <span class="codeReserved">for</span> (<span class="codeReserved">var</span> i=0; i&lt;<span class="codeReserved">substitutions</span>.length; i++) {</pre></td></tr>
  <tr><td class="codeShow_order">223</td><td><pre>			field = <span class="codeString">"{"</span>+i+<span class="codeString">"}"</span>;</pre></td></tr>
  <tr><td class="codeShow_order">224</td><td><pre>			start = text.indexOf(field);</pre></td></tr>
  <tr><td class="codeShow_order">225</td><td><pre>			<span class="codeReserved">if</span>(start &gt; 0) {</pre></td></tr>
  <tr><td class="codeShow_order">226</td><td><pre>				<span class="codeReserved">var</span> part1 = text.substring(0,start);</pre></td></tr>
  <tr><td class="codeShow_order">227</td><td><pre>				<span class="codeReserved">var</span> part2 = text.substring(start+field.length);</pre></td></tr>
  <tr><td class="codeShow_order">228</td><td><pre>				text = part1+substitutions[i]+part2;</pre></td></tr>
  <tr><td class="codeShow_order">229</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">230</td><td><pre>		  }</pre></td></tr>
  <tr><td class="codeShow_order">231</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">232</td><td><pre>		<span class="codeReserved">return</span> text;</pre></td></tr>
  <tr><td class="codeShow_order">233</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">234</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">235</td><td><pre>	<span class="codeComment">//MQTT protocol and version          6    M    Q    I    s    d    p    3</span></pre></td></tr>
  <tr><td class="codeShow_order">236</td><td><pre>	<span class="codeReserved">var</span> MqttProtoIdentifierv3 = [0x00,0x06,0x4d,0x51,0x49,0x73,0x64,0x70,0x03];</pre></td></tr>
  <tr><td class="codeShow_order">237</td><td><pre>	<span class="codeComment">//MQTT proto/version for 311         4    M    Q    T    T    4</span></pre></td></tr>
  <tr><td class="codeShow_order">238</td><td><pre>	<span class="codeReserved">var</span> MqttProtoIdentifierv4 = [0x00,0x04,0x4d,0x51,0x54,0x54,0x04];</pre></td></tr>
  <tr><td class="codeShow_order">239</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">240</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">241</td><td><pre><span class="codeComment">	 * Construct an MQTT wire protocol message.</span></pre></td></tr>
  <tr><td class="codeShow_order">242</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> type MQTT packet type.</span></pre></td></tr>
  <tr><td class="codeShow_order">243</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> options optional wire message attributes.</span></pre></td></tr>
  <tr><td class="codeShow_order">244</td><td><pre><span class="codeComment">	 *</span></pre></td></tr>
  <tr><td class="codeShow_order">245</td><td><pre><span class="codeComment">	 * Optional properties</span></pre></td></tr>
  <tr><td class="codeShow_order">246</td><td><pre><span class="codeComment">	 *</span></pre></td></tr>
  <tr><td class="codeShow_order">247</td><td><pre><span class="codeComment">	 * messageIdentifier: message ID <span class="codeReserved">in</span> the range [0..65535]</span></pre></td></tr>
  <tr><td class="codeShow_order">248</td><td><pre><span class="codeComment">	 * payloadMessage:	Application Message - PUBLISH only</span></pre></td></tr>
  <tr><td class="codeShow_order">249</td><td><pre><span class="codeComment">	 * connectStrings:	array of 0 or more Strings <span class="codeReserved">to</span> be put into the CONNECT payload</span></pre></td></tr>
  <tr><td class="codeShow_order">250</td><td><pre><span class="codeComment">	 * topics:			array of strings (SUBSCRIBE, UNSUBSCRIBE)</span></pre></td></tr>
  <tr><td class="codeShow_order">251</td><td><pre><span class="codeComment">	 * requestQoS:		array of QoS values [0..2]</span></pre></td></tr>
  <tr><td class="codeShow_order">252</td><td><pre><span class="codeComment">	 *</span></pre></td></tr>
  <tr><td class="codeShow_order">253</td><td><pre><span class="codeComment">	 * &quot;Flag&quot; properties</span></pre></td></tr>
  <tr><td class="codeShow_order">254</td><td><pre><span class="codeComment">	 * cleanSession:	<span class="codeReserved">true</span> <span class="codeReserved">if</span> present / <span class="codeReserved">false</span> <span class="codeReserved">if</span> absent (CONNECT)</span></pre></td></tr>
  <tr><td class="codeShow_order">255</td><td><pre><span class="codeComment">	 * willMessage:  	<span class="codeReserved">true</span> <span class="codeReserved">if</span> present / <span class="codeReserved">false</span> <span class="codeReserved">if</span> absent (CONNECT)</span></pre></td></tr>
  <tr><td class="codeShow_order">256</td><td><pre><span class="codeComment">	 * isRetained:		<span class="codeReserved">true</span> <span class="codeReserved">if</span> present / <span class="codeReserved">false</span> <span class="codeReserved">if</span> absent (CONNECT)</span></pre></td></tr>
  <tr><td class="codeShow_order">257</td><td><pre><span class="codeComment">	 * userName:		<span class="codeReserved">true</span> <span class="codeReserved">if</span> present / <span class="codeReserved">false</span> <span class="codeReserved">if</span> absent (CONNECT)</span></pre></td></tr>
  <tr><td class="codeShow_order">258</td><td><pre><span class="codeComment">	 * password:		<span class="codeReserved">true</span> <span class="codeReserved">if</span> present / <span class="codeReserved">false</span> <span class="codeReserved">if</span> absent (CONNECT)</span></pre></td></tr>
  <tr><td class="codeShow_order">259</td><td><pre><span class="codeComment">	 * keepAliveInterval:	integer [0..65535]  (CONNECT)</span></pre></td></tr>
  <tr><td class="codeShow_order">260</td><td><pre><span class="codeComment">	 *</span></pre></td></tr>
  <tr><td class="codeShow_order">261</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@private</span></span></pre></td></tr>
  <tr><td class="codeShow_order">262</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@ignore</span></span></pre></td></tr>
  <tr><td class="codeShow_order">263</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">264</td><td><pre>	<span class="codeReserved">var</span> WireMessage = <span class="codeReserved">function</span> (type, options) {</pre></td></tr>
  <tr><td class="codeShow_order">265</td><td><pre>		<span class="codeReserved">this</span>.type = type;</pre></td></tr>
  <tr><td class="codeShow_order">266</td><td><pre>		<span class="codeReserved">for</span> (<span class="codeReserved">var</span> name <span class="codeReserved">in</span> options) {</pre></td></tr>
  <tr><td class="codeShow_order">267</td><td><pre>			<span class="codeReserved">if</span> (options.hasOwnProperty(name)) {</pre></td></tr>
  <tr><td class="codeShow_order">268</td><td><pre>				<span class="codeReserved">this</span>[name] = options[name];</pre></td></tr>
  <tr><td class="codeShow_order">269</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">270</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">271</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">272</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">273</td><td><pre>	WireMessage.prototype.encode = <span class="codeReserved">function</span>() {</pre></td></tr>
  <tr><td class="codeShow_order">274</td><td><pre>		<span class="codeComment">// Compute the first byte of the fixed header</span></pre></td></tr>
  <tr><td class="codeShow_order">275</td><td><pre>		<span class="codeReserved">var</span> first = ((<span class="codeReserved">this</span>.type & 0x0f) &lt;&lt; 4);</pre></td></tr>
  <tr><td class="codeShow_order">276</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">277</td><td><pre>		<span class="codeComment">/*</span></pre></td></tr>
  <tr><td class="codeShow_order">278</td><td><pre><span class="codeComment">		 * Now calculate the length of the variable header + payload by adding up the lengths</span></pre></td></tr>
  <tr><td class="codeShow_order">279</td><td><pre><span class="codeComment">		 * of all the component parts</span></pre></td></tr>
  <tr><td class="codeShow_order">280</td><td><pre><span class="codeComment">		 */</span></pre></td></tr>
  <tr><td class="codeShow_order">281</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">282</td><td><pre>		<span class="codeReserved">var</span> remLength = 0;</pre></td></tr>
  <tr><td class="codeShow_order">283</td><td><pre>		<span class="codeReserved">var</span> topicStrLength = [];</pre></td></tr>
  <tr><td class="codeShow_order">284</td><td><pre>		<span class="codeReserved">var</span> destinationNameLength = 0;</pre></td></tr>
  <tr><td class="codeShow_order">285</td><td><pre>		<span class="codeReserved">var</span> willMessagePayloadBytes;</pre></td></tr>
  <tr><td class="codeShow_order">286</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">287</td><td><pre>		<span class="codeComment">// if the message contains a messageIdentifier then we need two bytes for that</span></pre></td></tr>
  <tr><td class="codeShow_order">288</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.messageIdentifier !== undefined)</pre></td></tr>
  <tr><td class="codeShow_order">289</td><td><pre>			remLength += 2;</pre></td></tr>
  <tr><td class="codeShow_order">290</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">291</td><td><pre>		<span class="codeReserved">switch</span>(<span class="codeReserved">this</span>.type) {</pre></td></tr>
  <tr><td class="codeShow_order">292</td><td><pre>			<span class="codeComment">// If this a Connect then we need to include 12 bytes for its header</span></pre></td></tr>
  <tr><td class="codeShow_order">293</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.CONNECT:</pre></td></tr>
  <tr><td class="codeShow_order">294</td><td><pre>				<span class="codeReserved">switch</span>(<span class="codeReserved">this</span>.mqttVersion) {</pre></td></tr>
  <tr><td class="codeShow_order">295</td><td><pre>					<span class="codeReserved">case</span> 3:</pre></td></tr>
  <tr><td class="codeShow_order">296</td><td><pre>						remLength += MqttProtoIdentifierv3.length + 3;</pre></td></tr>
  <tr><td class="codeShow_order">297</td><td><pre>						<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">298</td><td><pre>					<span class="codeReserved">case</span> 4:</pre></td></tr>
  <tr><td class="codeShow_order">299</td><td><pre>						remLength += MqttProtoIdentifierv4.length + 3;</pre></td></tr>
  <tr><td class="codeShow_order">300</td><td><pre>						<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">301</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">302</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">303</td><td><pre>				remLength += UTF8Length(<span class="codeReserved">this</span>.clientId) + 2;</pre></td></tr>
  <tr><td class="codeShow_order">304</td><td><pre>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.willMessage !== undefined) {</pre></td></tr>
  <tr><td class="codeShow_order">305</td><td><pre>					remLength += UTF8Length(<span class="codeReserved">this</span>.willMessage.destinationName) + 2;</pre></td></tr>
  <tr><td class="codeShow_order">306</td><td><pre>					<span class="codeComment">// Will message is always a string, sent as UTF-8 characters with a preceding length.</span></pre></td></tr>
  <tr><td class="codeShow_order">307</td><td><pre>					willMessagePayloadBytes = <span class="codeReserved">this</span>.willMessage.payloadBytes;</pre></td></tr>
  <tr><td class="codeShow_order">308</td><td><pre>					<span class="codeReserved">if</span> (!(willMessagePayloadBytes <span class="codeReserved">instanceof</span> Uint8Array))</pre></td></tr>
  <tr><td class="codeShow_order">309</td><td><pre>						willMessagePayloadBytes = <span class="codeReserved">new</span> Uint8Array(payloadBytes);</pre></td></tr>
  <tr><td class="codeShow_order">310</td><td><pre>					remLength += willMessagePayloadBytes.byteLength +2;</pre></td></tr>
  <tr><td class="codeShow_order">311</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">312</td><td><pre>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.userName !== undefined)</pre></td></tr>
  <tr><td class="codeShow_order">313</td><td><pre>					remLength += UTF8Length(<span class="codeReserved">this</span>.userName) + 2;</pre></td></tr>
  <tr><td class="codeShow_order">314</td><td><pre>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.password !== undefined)</pre></td></tr>
  <tr><td class="codeShow_order">315</td><td><pre>					remLength += UTF8Length(<span class="codeReserved">this</span>.password) + 2;</pre></td></tr>
  <tr><td class="codeShow_order">316</td><td><pre>			<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">317</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">318</td><td><pre>			<span class="codeComment">// Subscribe, Unsubscribe can both contain topic strings</span></pre></td></tr>
  <tr><td class="codeShow_order">319</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.SUBSCRIBE:</pre></td></tr>
  <tr><td class="codeShow_order">320</td><td><pre>				first |= 0x02; <span class="codeComment">// Qos = 1;</span></pre></td></tr>
  <tr><td class="codeShow_order">321</td><td><pre>				<span class="codeReserved">for</span> ( <span class="codeReserved">var</span> i = 0; i &lt; <span class="codeReserved">this</span>.topics.length; i++) {</pre></td></tr>
  <tr><td class="codeShow_order">322</td><td><pre>					topicStrLength[i] = UTF8Length(<span class="codeReserved">this</span>.topics[i]);</pre></td></tr>
  <tr><td class="codeShow_order">323</td><td><pre>					remLength += topicStrLength[i] + 2;</pre></td></tr>
  <tr><td class="codeShow_order">324</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">325</td><td><pre>				remLength += <span class="codeReserved">this</span>.requestedQos.length; <span class="codeComment">// 1 byte for each topic&#039;s Qos</span></pre></td></tr>
  <tr><td class="codeShow_order">326</td><td><pre>				<span class="codeComment">// QoS on Subscribe only</span></pre></td></tr>
  <tr><td class="codeShow_order">327</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">328</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">329</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.UNSUBSCRIBE:</pre></td></tr>
  <tr><td class="codeShow_order">330</td><td><pre>				first |= 0x02; <span class="codeComment">// Qos = 1;</span></pre></td></tr>
  <tr><td class="codeShow_order">331</td><td><pre>				<span class="codeReserved">for</span> ( <span class="codeReserved">var</span> i = 0; i &lt; <span class="codeReserved">this</span>.topics.length; i++) {</pre></td></tr>
  <tr><td class="codeShow_order">332</td><td><pre>					topicStrLength[i] = UTF8Length(<span class="codeReserved">this</span>.topics[i]);</pre></td></tr>
  <tr><td class="codeShow_order">333</td><td><pre>					remLength += topicStrLength[i] + 2;</pre></td></tr>
  <tr><td class="codeShow_order">334</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">335</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">336</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">337</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.PUBREL:</pre></td></tr>
  <tr><td class="codeShow_order">338</td><td><pre>				first |= 0x02; <span class="codeComment">// Qos = 1;</span></pre></td></tr>
  <tr><td class="codeShow_order">339</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">340</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">341</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.PUBLISH:</pre></td></tr>
  <tr><td class="codeShow_order">342</td><td><pre>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.payloadMessage.duplicate) first |= 0x08;</pre></td></tr>
  <tr><td class="codeShow_order">343</td><td><pre>				first  = first |= (<span class="codeReserved">this</span>.payloadMessage.qos &lt;&lt; 1);</pre></td></tr>
  <tr><td class="codeShow_order">344</td><td><pre>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.payloadMessage.retained) first |= 0x01;</pre></td></tr>
  <tr><td class="codeShow_order">345</td><td><pre>				destinationNameLength = UTF8Length(<span class="codeReserved">this</span>.payloadMessage.destinationName);</pre></td></tr>
  <tr><td class="codeShow_order">346</td><td><pre>				remLength += destinationNameLength + 2;</pre></td></tr>
  <tr><td class="codeShow_order">347</td><td><pre>				<span class="codeReserved">var</span> payloadBytes = <span class="codeReserved">this</span>.payloadMessage.payloadBytes;</pre></td></tr>
  <tr><td class="codeShow_order">348</td><td><pre>				remLength += payloadBytes.byteLength;</pre></td></tr>
  <tr><td class="codeShow_order">349</td><td><pre>				<span class="codeReserved">if</span> (payloadBytes <span class="codeReserved">instanceof</span> ArrayBuffer)</pre></td></tr>
  <tr><td class="codeShow_order">350</td><td><pre>					payloadBytes = <span class="codeReserved">new</span> Uint8Array(payloadBytes);</pre></td></tr>
  <tr><td class="codeShow_order">351</td><td><pre>				<span class="codeReserved">else</span> <span class="codeReserved">if</span> (!(payloadBytes <span class="codeReserved">instanceof</span> Uint8Array))</pre></td></tr>
  <tr><td class="codeShow_order">352</td><td><pre>					payloadBytes = <span class="codeReserved">new</span> Uint8Array(payloadBytes.buffer);</pre></td></tr>
  <tr><td class="codeShow_order">353</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">354</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">355</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.DISCONNECT:</pre></td></tr>
  <tr><td class="codeShow_order">356</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">357</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">358</td><td><pre>			<span class="codeReserved">default</span>:</pre></td></tr>
  <tr><td class="codeShow_order">359</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">360</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">361</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">362</td><td><pre>		<span class="codeComment">// Now we can allocate a buffer for the message</span></pre></td></tr>
  <tr><td class="codeShow_order">363</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">364</td><td><pre>		<span class="codeReserved">var</span> mbi = encodeMBI(remLength);  <span class="codeComment">// Convert the length to MQTT MBI format</span></pre></td></tr>
  <tr><td class="codeShow_order">365</td><td><pre>		<span class="codeReserved">var</span> pos = mbi.length + 1;        <span class="codeComment">// Offset of start of variable header</span></pre></td></tr>
  <tr><td class="codeShow_order">366</td><td><pre>		<span class="codeReserved">var</span> buffer = <span class="codeReserved">new</span> ArrayBuffer(remLength + pos);</pre></td></tr>
  <tr><td class="codeShow_order">367</td><td><pre>		<span class="codeReserved">var</span> byteStream = <span class="codeReserved">new</span> Uint8Array(buffer);    <span class="codeComment">// view it as a sequence of bytes</span></pre></td></tr>
  <tr><td class="codeShow_order">368</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">369</td><td><pre>		<span class="codeComment">//Write the fixed header into the buffer</span></pre></td></tr>
  <tr><td class="codeShow_order">370</td><td><pre>		byteStream[0] = first;</pre></td></tr>
  <tr><td class="codeShow_order">371</td><td><pre>		byteStream.set(mbi,1);</pre></td></tr>
  <tr><td class="codeShow_order">372</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">373</td><td><pre>		<span class="codeComment">// If this is a PUBLISH then the variable header starts with a topic</span></pre></td></tr>
  <tr><td class="codeShow_order">374</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.type == MESSAGE_TYPE.PUBLISH)</pre></td></tr>
  <tr><td class="codeShow_order">375</td><td><pre>			pos = writeString(<span class="codeReserved">this</span>.payloadMessage.destinationName, destinationNameLength, byteStream, pos);</pre></td></tr>
  <tr><td class="codeShow_order">376</td><td><pre>		<span class="codeComment">// If this is a CONNECT then the variable header contains the protocol name/version, flags and keepalive time</span></pre></td></tr>
  <tr><td class="codeShow_order">377</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">378</td><td><pre>		<span class="codeReserved">else</span> <span class="codeReserved">if</span> (<span class="codeReserved">this</span>.type == MESSAGE_TYPE.CONNECT) {</pre></td></tr>
  <tr><td class="codeShow_order">379</td><td><pre>			<span class="codeReserved">switch</span> (<span class="codeReserved">this</span>.mqttVersion) {</pre></td></tr>
  <tr><td class="codeShow_order">380</td><td><pre>				<span class="codeReserved">case</span> 3:</pre></td></tr>
  <tr><td class="codeShow_order">381</td><td><pre>					byteStream.set(MqttProtoIdentifierv3, pos);</pre></td></tr>
  <tr><td class="codeShow_order">382</td><td><pre>					pos += MqttProtoIdentifierv3.length;</pre></td></tr>
  <tr><td class="codeShow_order">383</td><td><pre>					<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">384</td><td><pre>				<span class="codeReserved">case</span> 4:</pre></td></tr>
  <tr><td class="codeShow_order">385</td><td><pre>					byteStream.set(MqttProtoIdentifierv4, pos);</pre></td></tr>
  <tr><td class="codeShow_order">386</td><td><pre>					pos += MqttProtoIdentifierv4.length;</pre></td></tr>
  <tr><td class="codeShow_order">387</td><td><pre>					<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">388</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">389</td><td><pre>			<span class="codeReserved">var</span> connectFlags = 0;</pre></td></tr>
  <tr><td class="codeShow_order">390</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.cleanSession)</pre></td></tr>
  <tr><td class="codeShow_order">391</td><td><pre>				connectFlags = 0x02;</pre></td></tr>
  <tr><td class="codeShow_order">392</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.willMessage !== undefined ) {</pre></td></tr>
  <tr><td class="codeShow_order">393</td><td><pre>				connectFlags |= 0x04;</pre></td></tr>
  <tr><td class="codeShow_order">394</td><td><pre>				connectFlags |= (<span class="codeReserved">this</span>.willMessage.qos&lt;&lt;3);</pre></td></tr>
  <tr><td class="codeShow_order">395</td><td><pre>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.willMessage.retained) {</pre></td></tr>
  <tr><td class="codeShow_order">396</td><td><pre>					connectFlags |= 0x20;</pre></td></tr>
  <tr><td class="codeShow_order">397</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">398</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">399</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.userName !== undefined)</pre></td></tr>
  <tr><td class="codeShow_order">400</td><td><pre>				connectFlags |= 0x80;</pre></td></tr>
  <tr><td class="codeShow_order">401</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.password !== undefined)</pre></td></tr>
  <tr><td class="codeShow_order">402</td><td><pre>				connectFlags |= 0x40;</pre></td></tr>
  <tr><td class="codeShow_order">403</td><td><pre>			byteStream[pos++] = connectFlags;</pre></td></tr>
  <tr><td class="codeShow_order">404</td><td><pre>			pos = writeUint16 (<span class="codeReserved">this</span>.keepAliveInterval, byteStream, pos);</pre></td></tr>
  <tr><td class="codeShow_order">405</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">406</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">407</td><td><pre>		<span class="codeComment">// Output the messageIdentifier - if there is one</span></pre></td></tr>
  <tr><td class="codeShow_order">408</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.messageIdentifier !== undefined)</pre></td></tr>
  <tr><td class="codeShow_order">409</td><td><pre>			pos = writeUint16 (<span class="codeReserved">this</span>.messageIdentifier, byteStream, pos);</pre></td></tr>
  <tr><td class="codeShow_order">410</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">411</td><td><pre>		<span class="codeReserved">switch</span>(<span class="codeReserved">this</span>.type) {</pre></td></tr>
  <tr><td class="codeShow_order">412</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.CONNECT:</pre></td></tr>
  <tr><td class="codeShow_order">413</td><td><pre>				pos = writeString(<span class="codeReserved">this</span>.clientId, UTF8Length(<span class="codeReserved">this</span>.clientId), byteStream, pos);</pre></td></tr>
  <tr><td class="codeShow_order">414</td><td><pre>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.willMessage !== undefined) {</pre></td></tr>
  <tr><td class="codeShow_order">415</td><td><pre>					pos = writeString(<span class="codeReserved">this</span>.willMessage.destinationName, UTF8Length(<span class="codeReserved">this</span>.willMessage.destinationName), byteStream, pos);</pre></td></tr>
  <tr><td class="codeShow_order">416</td><td><pre>					pos = writeUint16(willMessagePayloadBytes.byteLength, byteStream, pos);</pre></td></tr>
  <tr><td class="codeShow_order">417</td><td><pre>					byteStream.set(willMessagePayloadBytes, pos);</pre></td></tr>
  <tr><td class="codeShow_order">418</td><td><pre>					pos += willMessagePayloadBytes.byteLength;</pre></td></tr>
  <tr><td class="codeShow_order">419</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">420</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">421</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.userName !== undefined)</pre></td></tr>
  <tr><td class="codeShow_order">422</td><td><pre>				pos = writeString(<span class="codeReserved">this</span>.userName, UTF8Length(<span class="codeReserved">this</span>.userName), byteStream, pos);</pre></td></tr>
  <tr><td class="codeShow_order">423</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.password !== undefined)</pre></td></tr>
  <tr><td class="codeShow_order">424</td><td><pre>				pos = writeString(<span class="codeReserved">this</span>.password, UTF8Length(<span class="codeReserved">this</span>.password), byteStream, pos);</pre></td></tr>
  <tr><td class="codeShow_order">425</td><td><pre>			<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">426</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">427</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.PUBLISH:</pre></td></tr>
  <tr><td class="codeShow_order">428</td><td><pre>				<span class="codeComment">// PUBLISH has a text or binary payload, if text do not add a 2 byte length field, just the UTF characters.</span></pre></td></tr>
  <tr><td class="codeShow_order">429</td><td><pre>				byteStream.set(payloadBytes, pos);</pre></td></tr>
  <tr><td class="codeShow_order">430</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">431</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">432</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">433</td><td><pre><span class="codeComment">//    	    case MESSAGE_TYPE.PUBREC:</span></pre></td></tr>
  <tr><td class="codeShow_order">434</td><td><pre><span class="codeComment">//    	    case MESSAGE_TYPE.PUBREL:</span></pre></td></tr>
  <tr><td class="codeShow_order">435</td><td><pre><span class="codeComment">//    	    case MESSAGE_TYPE.PUBCOMP:</span></pre></td></tr>
  <tr><td class="codeShow_order">436</td><td><pre><span class="codeComment">//    	    	break;</span></pre></td></tr>
  <tr><td class="codeShow_order">437</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">438</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.SUBSCRIBE:</pre></td></tr>
  <tr><td class="codeShow_order">439</td><td><pre>				<span class="codeComment">// SUBSCRIBE has a list of topic strings and request QoS</span></pre></td></tr>
  <tr><td class="codeShow_order">440</td><td><pre>				<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i=0; i&lt;<span class="codeReserved">this</span>.topics.length; i++) {</pre></td></tr>
  <tr><td class="codeShow_order">441</td><td><pre>					pos = writeString(<span class="codeReserved">this</span>.topics[i], topicStrLength[i], byteStream, pos);</pre></td></tr>
  <tr><td class="codeShow_order">442</td><td><pre>					byteStream[pos++] = <span class="codeReserved">this</span>.requestedQos[i];</pre></td></tr>
  <tr><td class="codeShow_order">443</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">444</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">445</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">446</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.UNSUBSCRIBE:</pre></td></tr>
  <tr><td class="codeShow_order">447</td><td><pre>				<span class="codeComment">// UNSUBSCRIBE has a list of topic strings</span></pre></td></tr>
  <tr><td class="codeShow_order">448</td><td><pre>				<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i=0; i&lt;<span class="codeReserved">this</span>.topics.length; i++)</pre></td></tr>
  <tr><td class="codeShow_order">449</td><td><pre>					pos = writeString(<span class="codeReserved">this</span>.topics[i], topicStrLength[i], byteStream, pos);</pre></td></tr>
  <tr><td class="codeShow_order">450</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">451</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">452</td><td><pre>			<span class="codeReserved">default</span>:</pre></td></tr>
  <tr><td class="codeShow_order">453</td><td><pre>				<span class="codeComment">// Do nothing.</span></pre></td></tr>
  <tr><td class="codeShow_order">454</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">455</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">456</td><td><pre>		<span class="codeReserved">return</span> buffer;</pre></td></tr>
  <tr><td class="codeShow_order">457</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">458</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">459</td><td><pre>	<span class="codeReserved">function</span> decodeMessage(input,pos) {</pre></td></tr>
  <tr><td class="codeShow_order">460</td><td><pre>	    <span class="codeReserved">var</span> startingPos = pos;</pre></td></tr>
  <tr><td class="codeShow_order">461</td><td><pre>		<span class="codeReserved">var</span> first = input[pos];</pre></td></tr>
  <tr><td class="codeShow_order">462</td><td><pre>		<span class="codeReserved">var</span> type = first &gt;&gt; 4;</pre></td></tr>
  <tr><td class="codeShow_order">463</td><td><pre>		<span class="codeReserved">var</span> messageInfo = first &= 0x0f;</pre></td></tr>
  <tr><td class="codeShow_order">464</td><td><pre>		pos += 1;</pre></td></tr>
  <tr><td class="codeShow_order">465</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">466</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">467</td><td><pre>		<span class="codeComment">// Decode the remaining length (MBI format)</span></pre></td></tr>
  <tr><td class="codeShow_order">468</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">469</td><td><pre>		<span class="codeReserved">var</span> digit;</pre></td></tr>
  <tr><td class="codeShow_order">470</td><td><pre>		<span class="codeReserved">var</span> remLength = 0;</pre></td></tr>
  <tr><td class="codeShow_order">471</td><td><pre>		<span class="codeReserved">var</span> multiplier = 1;</pre></td></tr>
  <tr><td class="codeShow_order">472</td><td><pre>		<span class="codeReserved">do</span> {</pre></td></tr>
  <tr><td class="codeShow_order">473</td><td><pre>			<span class="codeReserved">if</span> (pos == input.length) {</pre></td></tr>
  <tr><td class="codeShow_order">474</td><td><pre>			    <span class="codeReserved">return</span> [<span class="codeReserved">null</span>,startingPos];</pre></td></tr>
  <tr><td class="codeShow_order">475</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">476</td><td><pre>			digit = input[pos++];</pre></td></tr>
  <tr><td class="codeShow_order">477</td><td><pre>			remLength += ((digit & 0x7F) * multiplier);</pre></td></tr>
  <tr><td class="codeShow_order">478</td><td><pre>			multiplier *= 128;</pre></td></tr>
  <tr><td class="codeShow_order">479</td><td><pre>		} <span class="codeReserved">while</span> ((digit & 0x80) !== 0);</pre></td></tr>
  <tr><td class="codeShow_order">480</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">481</td><td><pre>		<span class="codeReserved">var</span> endPos = pos+remLength;</pre></td></tr>
  <tr><td class="codeShow_order">482</td><td><pre>		<span class="codeReserved">if</span> (endPos &gt; input.length) {</pre></td></tr>
  <tr><td class="codeShow_order">483</td><td><pre>		    <span class="codeReserved">return</span> [<span class="codeReserved">null</span>,startingPos];</pre></td></tr>
  <tr><td class="codeShow_order">484</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">485</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">486</td><td><pre>		<span class="codeReserved">var</span> wireMessage = <span class="codeReserved">new</span> WireMessage(type);</pre></td></tr>
  <tr><td class="codeShow_order">487</td><td><pre>		<span class="codeReserved">switch</span>(type) {</pre></td></tr>
  <tr><td class="codeShow_order">488</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.CONNACK:</pre></td></tr>
  <tr><td class="codeShow_order">489</td><td><pre>				<span class="codeReserved">var</span> connectAcknowledgeFlags = input[pos++];</pre></td></tr>
  <tr><td class="codeShow_order">490</td><td><pre>				<span class="codeReserved">if</span> (connectAcknowledgeFlags & 0x01)</pre></td></tr>
  <tr><td class="codeShow_order">491</td><td><pre>					wireMessage.sessionPresent = <span class="codeReserved">true</span>;</pre></td></tr>
  <tr><td class="codeShow_order">492</td><td><pre>				wireMessage.returnCode = input[pos++];</pre></td></tr>
  <tr><td class="codeShow_order">493</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">494</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">495</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.PUBLISH:</pre></td></tr>
  <tr><td class="codeShow_order">496</td><td><pre>				<span class="codeReserved">var</span> qos = (messageInfo &gt;&gt; 1) & 0x03;</pre></td></tr>
  <tr><td class="codeShow_order">497</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">498</td><td><pre>				<span class="codeReserved">var</span> len = readUint16(input, pos);</pre></td></tr>
  <tr><td class="codeShow_order">499</td><td><pre>				pos += 2;</pre></td></tr>
  <tr><td class="codeShow_order">500</td><td><pre>				<span class="codeReserved">var</span> topicName = parseUTF8(input, pos, len);</pre></td></tr>
  <tr><td class="codeShow_order">501</td><td><pre>				pos += len;</pre></td></tr>
  <tr><td class="codeShow_order">502</td><td><pre>				<span class="codeComment">// If QoS 1 or 2 there will be a messageIdentifier</span></pre></td></tr>
  <tr><td class="codeShow_order">503</td><td><pre>				<span class="codeReserved">if</span> (qos &gt; 0) {</pre></td></tr>
  <tr><td class="codeShow_order">504</td><td><pre>					wireMessage.messageIdentifier = readUint16(input, pos);</pre></td></tr>
  <tr><td class="codeShow_order">505</td><td><pre>					pos += 2;</pre></td></tr>
  <tr><td class="codeShow_order">506</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">507</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">508</td><td><pre>				<span class="codeReserved">var</span> message = <span class="codeReserved">new</span> Paho.MQTT.Message(input.subarray(pos, endPos));</pre></td></tr>
  <tr><td class="codeShow_order">509</td><td><pre>				<span class="codeReserved">if</span> ((messageInfo & 0x01) == 0x01)</pre></td></tr>
  <tr><td class="codeShow_order">510</td><td><pre>					message.retained = <span class="codeReserved">true</span>;</pre></td></tr>
  <tr><td class="codeShow_order">511</td><td><pre>				<span class="codeReserved">if</span> ((messageInfo & 0x08) == 0x08)</pre></td></tr>
  <tr><td class="codeShow_order">512</td><td><pre>					message.duplicate =  <span class="codeReserved">true</span>;</pre></td></tr>
  <tr><td class="codeShow_order">513</td><td><pre>				message.qos = qos;</pre></td></tr>
  <tr><td class="codeShow_order">514</td><td><pre>				message.destinationName = topicName;</pre></td></tr>
  <tr><td class="codeShow_order">515</td><td><pre>				wireMessage.payloadMessage = message;</pre></td></tr>
  <tr><td class="codeShow_order">516</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">517</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">518</td><td><pre>			<span class="codeReserved">case</span>  MESSAGE_TYPE.PUBACK:</pre></td></tr>
  <tr><td class="codeShow_order">519</td><td><pre>			<span class="codeReserved">case</span>  MESSAGE_TYPE.PUBREC:</pre></td></tr>
  <tr><td class="codeShow_order">520</td><td><pre>			<span class="codeReserved">case</span>  MESSAGE_TYPE.PUBREL:</pre></td></tr>
  <tr><td class="codeShow_order">521</td><td><pre>			<span class="codeReserved">case</span>  MESSAGE_TYPE.PUBCOMP:</pre></td></tr>
  <tr><td class="codeShow_order">522</td><td><pre>			<span class="codeReserved">case</span>  MESSAGE_TYPE.UNSUBACK:</pre></td></tr>
  <tr><td class="codeShow_order">523</td><td><pre>				wireMessage.messageIdentifier = readUint16(input, pos);</pre></td></tr>
  <tr><td class="codeShow_order">524</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">525</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">526</td><td><pre>			<span class="codeReserved">case</span>  MESSAGE_TYPE.SUBACK:</pre></td></tr>
  <tr><td class="codeShow_order">527</td><td><pre>				wireMessage.messageIdentifier = readUint16(input, pos);</pre></td></tr>
  <tr><td class="codeShow_order">528</td><td><pre>				pos += 2;</pre></td></tr>
  <tr><td class="codeShow_order">529</td><td><pre>				wireMessage.returnCode = input.subarray(pos, endPos);</pre></td></tr>
  <tr><td class="codeShow_order">530</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">531</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">532</td><td><pre>			<span class="codeReserved">default</span>:</pre></td></tr>
  <tr><td class="codeShow_order">533</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">534</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">535</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">536</td><td><pre>		<span class="codeReserved">return</span> [wireMessage,endPos];</pre></td></tr>
  <tr><td class="codeShow_order">537</td><td><pre>	}</pre></td></tr>
  <tr><td class="codeShow_order">538</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">539</td><td><pre>	<span class="codeReserved">function</span> writeUint16(input, buffer, offset) {</pre></td></tr>
  <tr><td class="codeShow_order">540</td><td><pre>		buffer[offset++] = input &gt;&gt; 8;      <span class="codeComment">//MSB</span></pre></td></tr>
  <tr><td class="codeShow_order">541</td><td><pre>		buffer[offset++] = input % 256;     <span class="codeComment">//LSB</span></pre></td></tr>
  <tr><td class="codeShow_order">542</td><td><pre>		<span class="codeReserved">return</span> offset;</pre></td></tr>
  <tr><td class="codeShow_order">543</td><td><pre>	}</pre></td></tr>
  <tr><td class="codeShow_order">544</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">545</td><td><pre>	<span class="codeReserved">function</span> writeString(input, utf8Length, buffer, offset) {</pre></td></tr>
  <tr><td class="codeShow_order">546</td><td><pre>		offset = writeUint16(utf8Length, buffer, offset);</pre></td></tr>
  <tr><td class="codeShow_order">547</td><td><pre>		stringToUTF8(input, buffer, offset);</pre></td></tr>
  <tr><td class="codeShow_order">548</td><td><pre>		<span class="codeReserved">return</span> offset + utf8Length;</pre></td></tr>
  <tr><td class="codeShow_order">549</td><td><pre>	}</pre></td></tr>
  <tr><td class="codeShow_order">550</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">551</td><td><pre>	<span class="codeReserved">function</span> readUint16(buffer, offset) {</pre></td></tr>
  <tr><td class="codeShow_order">552</td><td><pre>		<span class="codeReserved">return</span> 256*buffer[offset] + buffer[offset+1];</pre></td></tr>
  <tr><td class="codeShow_order">553</td><td><pre>	}</pre></td></tr>
  <tr><td class="codeShow_order">554</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">555</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">556</td><td><pre><span class="codeComment">	 * Encodes an MQTT Multi-Byte Integer</span></pre></td></tr>
  <tr><td class="codeShow_order">557</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@private</span></span></pre></td></tr>
  <tr><td class="codeShow_order">558</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">559</td><td><pre>	<span class="codeReserved">function</span> encodeMBI(number) {</pre></td></tr>
  <tr><td class="codeShow_order">560</td><td><pre>		<span class="codeReserved">var</span> output = <span class="codeReserved">new</span> Array(1);</pre></td></tr>
  <tr><td class="codeShow_order">561</td><td><pre>		<span class="codeReserved">var</span> numBytes = 0;</pre></td></tr>
  <tr><td class="codeShow_order">562</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">563</td><td><pre>		<span class="codeReserved">do</span> {</pre></td></tr>
  <tr><td class="codeShow_order">564</td><td><pre>			<span class="codeReserved">var</span> digit = number % 128;</pre></td></tr>
  <tr><td class="codeShow_order">565</td><td><pre>			number = number &gt;&gt; 7;</pre></td></tr>
  <tr><td class="codeShow_order">566</td><td><pre>			<span class="codeReserved">if</span> (number &gt; 0) {</pre></td></tr>
  <tr><td class="codeShow_order">567</td><td><pre>				digit |= 0x80;</pre></td></tr>
  <tr><td class="codeShow_order">568</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">569</td><td><pre>			output[numBytes++] = digit;</pre></td></tr>
  <tr><td class="codeShow_order">570</td><td><pre>		} <span class="codeReserved">while</span> ( (number &gt; 0) && (numBytes&lt;4) );</pre></td></tr>
  <tr><td class="codeShow_order">571</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">572</td><td><pre>		<span class="codeReserved">return</span> output;</pre></td></tr>
  <tr><td class="codeShow_order">573</td><td><pre>	}</pre></td></tr>
  <tr><td class="codeShow_order">574</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">575</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">576</td><td><pre><span class="codeComment">	 * Takes a String and calculates its length <span class="codeReserved">in</span> bytes when encoded <span class="codeReserved">in</span> UTF8.</span></pre></td></tr>
  <tr><td class="codeShow_order">577</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@private</span></span></pre></td></tr>
  <tr><td class="codeShow_order">578</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">579</td><td><pre>	<span class="codeReserved">function</span> UTF8Length(input) {</pre></td></tr>
  <tr><td class="codeShow_order">580</td><td><pre>		<span class="codeReserved">var</span> output = 0;</pre></td></tr>
  <tr><td class="codeShow_order">581</td><td><pre>		<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i = 0; i&lt;<span class="codeReserved">input</span>.length; i++)</pre></td></tr>
  <tr><td class="codeShow_order">582</td><td><pre>		{</pre></td></tr>
  <tr><td class="codeShow_order">583</td><td><pre>			<span class="codeReserved">var</span> charCode = input.charCodeAt(i);</pre></td></tr>
  <tr><td class="codeShow_order">584</td><td><pre>				<span class="codeReserved">if</span> (charCode &gt; 0x7FF)</pre></td></tr>
  <tr><td class="codeShow_order">585</td><td><pre>				   {</pre></td></tr>
  <tr><td class="codeShow_order">586</td><td><pre>					  <span class="codeComment">// Surrogate pair means its a 4 byte character</span></pre></td></tr>
  <tr><td class="codeShow_order">587</td><td><pre>					  <span class="codeReserved">if</span> (0xD800 &lt;= charCode && charCode &lt;= 0xDBFF)</pre></td></tr>
  <tr><td class="codeShow_order">588</td><td><pre>						{</pre></td></tr>
  <tr><td class="codeShow_order">589</td><td><pre>						  i++;</pre></td></tr>
  <tr><td class="codeShow_order">590</td><td><pre>						  output++;</pre></td></tr>
  <tr><td class="codeShow_order">591</td><td><pre>						}</pre></td></tr>
  <tr><td class="codeShow_order">592</td><td><pre>				   output +=3;</pre></td></tr>
  <tr><td class="codeShow_order">593</td><td><pre>				   }</pre></td></tr>
  <tr><td class="codeShow_order">594</td><td><pre>			<span class="codeReserved">else</span> <span class="codeReserved">if</span> (charCode &gt; 0x7F)</pre></td></tr>
  <tr><td class="codeShow_order">595</td><td><pre>				output +=2;</pre></td></tr>
  <tr><td class="codeShow_order">596</td><td><pre>			<span class="codeReserved">else</span></pre></td></tr>
  <tr><td class="codeShow_order">597</td><td><pre>				output++;</pre></td></tr>
  <tr><td class="codeShow_order">598</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">599</td><td><pre>		<span class="codeReserved">return</span> output;</pre></td></tr>
  <tr><td class="codeShow_order">600</td><td><pre>	}</pre></td></tr>
  <tr><td class="codeShow_order">601</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">602</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">603</td><td><pre><span class="codeComment">	 * Takes a String and writes it into an array <span class="codeReserved">as</span> UTF8 encoded bytes.</span></pre></td></tr>
  <tr><td class="codeShow_order">604</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@private</span></span></pre></td></tr>
  <tr><td class="codeShow_order">605</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">606</td><td><pre>	<span class="codeReserved">function</span> stringToUTF8(input, output, start) {</pre></td></tr>
  <tr><td class="codeShow_order">607</td><td><pre>		<span class="codeReserved">var</span> pos = start;</pre></td></tr>
  <tr><td class="codeShow_order">608</td><td><pre>		<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i = 0; i&lt;<span class="codeReserved">input</span>.length; i++) {</pre></td></tr>
  <tr><td class="codeShow_order">609</td><td><pre>			<span class="codeReserved">var</span> charCode = input.charCodeAt(i);</pre></td></tr>
  <tr><td class="codeShow_order">610</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">611</td><td><pre>			<span class="codeComment">// Check for a surrogate pair.</span></pre></td></tr>
  <tr><td class="codeShow_order">612</td><td><pre>			<span class="codeReserved">if</span> (0xD800 &lt;= charCode && charCode &lt;= 0xDBFF) {</pre></td></tr>
  <tr><td class="codeShow_order">613</td><td><pre>				<span class="codeReserved">var</span> lowCharCode = input.charCodeAt(++i);</pre></td></tr>
  <tr><td class="codeShow_order">614</td><td><pre>				<span class="codeReserved">if</span> (isNaN(lowCharCode)) {</pre></td></tr>
  <tr><td class="codeShow_order">615</td><td><pre>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.MALFORMED_UNICODE, [charCode, lowCharCode]));</pre></td></tr>
  <tr><td class="codeShow_order">616</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">617</td><td><pre>				charCode = ((charCode - 0xD800)&lt;&lt;10) + (lowCharCode - 0xDC00) + 0x10000;</pre></td></tr>
  <tr><td class="codeShow_order">618</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">619</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">620</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">621</td><td><pre>			<span class="codeReserved">if</span> (charCode &lt;= 0x7F) {</pre></td></tr>
  <tr><td class="codeShow_order">622</td><td><pre>				output[pos++] = charCode;</pre></td></tr>
  <tr><td class="codeShow_order">623</td><td><pre>			} <span class="codeReserved">else</span> <span class="codeReserved">if</span> (charCode &lt;= 0x7FF) {</pre></td></tr>
  <tr><td class="codeShow_order">624</td><td><pre>				output[pos++] = charCode&gt;&gt;6  & 0x1F | 0xC0;</pre></td></tr>
  <tr><td class="codeShow_order">625</td><td><pre>				output[pos++] = charCode     & 0x3F | 0x80;</pre></td></tr>
  <tr><td class="codeShow_order">626</td><td><pre>			} <span class="codeReserved">else</span> <span class="codeReserved">if</span> (charCode &lt;= 0xFFFF) {</pre></td></tr>
  <tr><td class="codeShow_order">627</td><td><pre>				output[pos++] = charCode&gt;&gt;12 & 0x0F | 0xE0;</pre></td></tr>
  <tr><td class="codeShow_order">628</td><td><pre>				output[pos++] = charCode&gt;&gt;6  & 0x3F | 0x80;</pre></td></tr>
  <tr><td class="codeShow_order">629</td><td><pre>				output[pos++] = charCode     & 0x3F | 0x80;</pre></td></tr>
  <tr><td class="codeShow_order">630</td><td><pre>			} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">631</td><td><pre>				output[pos++] = charCode&gt;&gt;18 & 0x07 | 0xF0;</pre></td></tr>
  <tr><td class="codeShow_order">632</td><td><pre>				output[pos++] = charCode&gt;&gt;12 & 0x3F | 0x80;</pre></td></tr>
  <tr><td class="codeShow_order">633</td><td><pre>				output[pos++] = charCode&gt;&gt;6  & 0x3F | 0x80;</pre></td></tr>
  <tr><td class="codeShow_order">634</td><td><pre>				output[pos++] = charCode     & 0x3F | 0x80;</pre></td></tr>
  <tr><td class="codeShow_order">635</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">636</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">637</td><td><pre>		<span class="codeReserved">return</span> output;</pre></td></tr>
  <tr><td class="codeShow_order">638</td><td><pre>	}</pre></td></tr>
  <tr><td class="codeShow_order">639</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">640</td><td><pre>	<span class="codeReserved">function</span> parseUTF8(input, offset, length) {</pre></td></tr>
  <tr><td class="codeShow_order">641</td><td><pre>		<span class="codeReserved">var</span> output = <span class="codeString">""</span>;</pre></td></tr>
  <tr><td class="codeShow_order">642</td><td><pre>		<span class="codeReserved">var</span> utf16;</pre></td></tr>
  <tr><td class="codeShow_order">643</td><td><pre>		<span class="codeReserved">var</span> pos = offset;</pre></td></tr>
  <tr><td class="codeShow_order">644</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">645</td><td><pre>		<span class="codeReserved">while</span> (pos &lt; offset+length)</pre></td></tr>
  <tr><td class="codeShow_order">646</td><td><pre>		{</pre></td></tr>
  <tr><td class="codeShow_order">647</td><td><pre>			<span class="codeReserved">var</span> byte1 = input[pos++];</pre></td></tr>
  <tr><td class="codeShow_order">648</td><td><pre>			<span class="codeReserved">if</span> (byte1 &lt; 128)</pre></td></tr>
  <tr><td class="codeShow_order">649</td><td><pre>				utf16 = byte1;</pre></td></tr>
  <tr><td class="codeShow_order">650</td><td><pre>			<span class="codeReserved">else</span></pre></td></tr>
  <tr><td class="codeShow_order">651</td><td><pre>			{</pre></td></tr>
  <tr><td class="codeShow_order">652</td><td><pre>				<span class="codeReserved">var</span> byte2 = input[pos++]-128;</pre></td></tr>
  <tr><td class="codeShow_order">653</td><td><pre>				<span class="codeReserved">if</span> (byte2 &lt; 0)</pre></td></tr>
  <tr><td class="codeShow_order">654</td><td><pre>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.MALFORMED_UTF, [byte1.toString(16), byte2.toString(16),<span class="codeString">""</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">655</td><td><pre>				<span class="codeReserved">if</span> (byte1 &lt; 0xE0)             <span class="codeComment">// 2 byte character</span></pre></td></tr>
  <tr><td class="codeShow_order">656</td><td><pre>					utf16 = 64*(byte1-0xC0) + byte2;</pre></td></tr>
  <tr><td class="codeShow_order">657</td><td><pre>				<span class="codeReserved">else</span></pre></td></tr>
  <tr><td class="codeShow_order">658</td><td><pre>				{</pre></td></tr>
  <tr><td class="codeShow_order">659</td><td><pre>					<span class="codeReserved">var</span> byte3 = input[pos++]-128;</pre></td></tr>
  <tr><td class="codeShow_order">660</td><td><pre>					<span class="codeReserved">if</span> (byte3 &lt; 0)</pre></td></tr>
  <tr><td class="codeShow_order">661</td><td><pre>						<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.MALFORMED_UTF, [byte1.toString(16), byte2.toString(16), byte3.toString(16)]));</pre></td></tr>
  <tr><td class="codeShow_order">662</td><td><pre>					<span class="codeReserved">if</span> (byte1 &lt; 0xF0)        <span class="codeComment">// 3 byte character</span></pre></td></tr>
  <tr><td class="codeShow_order">663</td><td><pre>						utf16 = 4096*(byte1-0xE0) + 64*byte2 + byte3;</pre></td></tr>
  <tr><td class="codeShow_order">664</td><td><pre>								<span class="codeReserved">else</span></pre></td></tr>
  <tr><td class="codeShow_order">665</td><td><pre>								{</pre></td></tr>
  <tr><td class="codeShow_order">666</td><td><pre>								   <span class="codeReserved">var</span> byte4 = input[pos++]-128;</pre></td></tr>
  <tr><td class="codeShow_order">667</td><td><pre>								   <span class="codeReserved">if</span> (byte4 &lt; 0)</pre></td></tr>
  <tr><td class="codeShow_order">668</td><td><pre>						<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.MALFORMED_UTF, [byte1.toString(16), byte2.toString(16), byte3.toString(16), byte4.toString(16)]));</pre></td></tr>
  <tr><td class="codeShow_order">669</td><td><pre>								   <span class="codeReserved">if</span> (byte1 &lt; 0xF8)        <span class="codeComment">// 4 byte character</span></pre></td></tr>
  <tr><td class="codeShow_order">670</td><td><pre>										   utf16 = 262144*(byte1-0xF0) + 4096*byte2 + 64*byte3 + byte4;</pre></td></tr>
  <tr><td class="codeShow_order">671</td><td><pre>					   <span class="codeReserved">else</span>                     <span class="codeComment">// longer encodings are not supported</span></pre></td></tr>
  <tr><td class="codeShow_order">672</td><td><pre>						<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.MALFORMED_UTF, [byte1.toString(16), byte2.toString(16), byte3.toString(16), byte4.toString(16)]));</pre></td></tr>
  <tr><td class="codeShow_order">673</td><td><pre>								}</pre></td></tr>
  <tr><td class="codeShow_order">674</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">675</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">676</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">677</td><td><pre>				<span class="codeReserved">if</span> (utf16 &gt; 0xFFFF)   <span class="codeComment">// 4 byte character - express as a surrogate pair</span></pre></td></tr>
  <tr><td class="codeShow_order">678</td><td><pre>				  {</pre></td></tr>
  <tr><td class="codeShow_order">679</td><td><pre>					 utf16 -= 0x10000;</pre></td></tr>
  <tr><td class="codeShow_order">680</td><td><pre>					 output += String.fromCharCode(0xD800 + (utf16 &gt;&gt; 10)); <span class="codeComment">// lead character</span></pre></td></tr>
  <tr><td class="codeShow_order">681</td><td><pre>					 utf16 = 0xDC00 + (utf16 & 0x3FF);  <span class="codeComment">// trail character</span></pre></td></tr>
  <tr><td class="codeShow_order">682</td><td><pre>				  }</pre></td></tr>
  <tr><td class="codeShow_order">683</td><td><pre>			output += String.fromCharCode(utf16);</pre></td></tr>
  <tr><td class="codeShow_order">684</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">685</td><td><pre>		<span class="codeReserved">return</span> output;</pre></td></tr>
  <tr><td class="codeShow_order">686</td><td><pre>	}</pre></td></tr>
  <tr><td class="codeShow_order">687</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">688</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">689</td><td><pre><span class="codeComment">	 * Repeat keepalive requests, monitor responses.</span></pre></td></tr>
  <tr><td class="codeShow_order">690</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@ignore</span></span></pre></td></tr>
  <tr><td class="codeShow_order">691</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">692</td><td><pre>	<span class="codeReserved">var</span> Pinger = <span class="codeReserved">function</span>(client, window, keepAliveInterval) {</pre></td></tr>
  <tr><td class="codeShow_order">693</td><td><pre>		<span class="codeReserved">this</span>._client = client;</pre></td></tr>
  <tr><td class="codeShow_order">694</td><td><pre>		<span class="codeReserved">this</span>._window = window;</pre></td></tr>
  <tr><td class="codeShow_order">695</td><td><pre>		<span class="codeReserved">this</span>._keepAliveInterval = keepAliveInterval*1000;</pre></td></tr>
  <tr><td class="codeShow_order">696</td><td><pre>		<span class="codeReserved">this</span>.isReset = <span class="codeReserved">false</span>;</pre></td></tr>
  <tr><td class="codeShow_order">697</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">698</td><td><pre>		<span class="codeReserved">var</span> pingReq = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.PINGREQ).encode();</pre></td></tr>
  <tr><td class="codeShow_order">699</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">700</td><td><pre>		<span class="codeReserved">var</span> doTimeout = <span class="codeReserved">function</span> (pinger) {</pre></td></tr>
  <tr><td class="codeShow_order">701</td><td><pre>			<span class="codeReserved">return</span> <span class="codeReserved">function</span> () {</pre></td></tr>
  <tr><td class="codeShow_order">702</td><td><pre>				<span class="codeReserved">return</span> doPing.apply(pinger);</pre></td></tr>
  <tr><td class="codeShow_order">703</td><td><pre>			};</pre></td></tr>
  <tr><td class="codeShow_order">704</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">705</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">706</td><td><pre>		<span class="codeComment">/** <span class="codeReserved">@ignore</span> */</span></pre></td></tr>
  <tr><td class="codeShow_order">707</td><td><pre>		<span class="codeReserved">var</span> doPing = <span class="codeReserved">function</span>() {</pre></td></tr>
  <tr><td class="codeShow_order">708</td><td><pre>			<span class="codeReserved">if</span> (!<span class="codeReserved">this</span>.isReset) {</pre></td></tr>
  <tr><td class="codeShow_order">709</td><td><pre>				<span class="codeReserved">this</span>._client._trace(<span class="codeString">"Pinger.doPing"</span>, <span class="codeString">"Timed out"</span>);</pre></td></tr>
  <tr><td class="codeShow_order">710</td><td><pre>				<span class="codeReserved">this</span>._client._disconnected( ERROR.PING_TIMEOUT.code , format(ERROR.PING_TIMEOUT));</pre></td></tr>
  <tr><td class="codeShow_order">711</td><td><pre>			} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">712</td><td><pre>				<span class="codeReserved">this</span>.isReset = <span class="codeReserved">false</span>;</pre></td></tr>
  <tr><td class="codeShow_order">713</td><td><pre>				<span class="codeReserved">this</span>._client._trace(<span class="codeString">"Pinger.doPing"</span>, <span class="codeString">"send PINGREQ"</span>);</pre></td></tr>
  <tr><td class="codeShow_order">714</td><td><pre>				<span class="codeReserved">this</span>._client.socket.send(pingReq);</pre></td></tr>
  <tr><td class="codeShow_order">715</td><td><pre>				<span class="codeReserved">this</span>.timeout = <span class="codeReserved">this</span>._window.setTimeout(doTimeout(<span class="codeReserved">this</span>), <span class="codeReserved">this</span>._keepAliveInterval);</pre></td></tr>
  <tr><td class="codeShow_order">716</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">717</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">718</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">719</td><td><pre>		<span class="codeReserved">this</span>.reset = <span class="codeReserved">function</span>() {</pre></td></tr>
  <tr><td class="codeShow_order">720</td><td><pre>			<span class="codeReserved">this</span>.isReset = <span class="codeReserved">true</span>;</pre></td></tr>
  <tr><td class="codeShow_order">721</td><td><pre>			<span class="codeReserved">this</span>._window.clearTimeout(<span class="codeReserved">this</span>.timeout);</pre></td></tr>
  <tr><td class="codeShow_order">722</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._keepAliveInterval &gt; 0)</pre></td></tr>
  <tr><td class="codeShow_order">723</td><td><pre>				<span class="codeReserved">this</span>.timeout = setTimeout(doTimeout(<span class="codeReserved">this</span>), <span class="codeReserved">this</span>._keepAliveInterval);</pre></td></tr>
  <tr><td class="codeShow_order">724</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">725</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">726</td><td><pre>		<span class="codeReserved">this</span>.cancel = <span class="codeReserved">function</span>() {</pre></td></tr>
  <tr><td class="codeShow_order">727</td><td><pre>			<span class="codeReserved">this</span>._window.clearTimeout(<span class="codeReserved">this</span>.timeout);</pre></td></tr>
  <tr><td class="codeShow_order">728</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">729</td><td><pre>	 };</pre></td></tr>
  <tr><td class="codeShow_order">730</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">731</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">732</td><td><pre><span class="codeComment">	 * Monitor request completion.</span></pre></td></tr>
  <tr><td class="codeShow_order">733</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@ignore</span></span></pre></td></tr>
  <tr><td class="codeShow_order">734</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">735</td><td><pre>	<span class="codeReserved">var</span> Timeout = <span class="codeReserved">function</span>(client, window, timeoutSeconds, action, args) {</pre></td></tr>
  <tr><td class="codeShow_order">736</td><td><pre>		<span class="codeReserved">this</span>._window = window;</pre></td></tr>
  <tr><td class="codeShow_order">737</td><td><pre>		<span class="codeReserved">if</span> (!timeoutSeconds)</pre></td></tr>
  <tr><td class="codeShow_order">738</td><td><pre>			timeoutSeconds = 30;</pre></td></tr>
  <tr><td class="codeShow_order">739</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">740</td><td><pre>		<span class="codeReserved">var</span> doTimeout = <span class="codeReserved">function</span> (action, client, args) {</pre></td></tr>
  <tr><td class="codeShow_order">741</td><td><pre>			<span class="codeReserved">return</span> <span class="codeReserved">function</span> () {</pre></td></tr>
  <tr><td class="codeShow_order">742</td><td><pre>				<span class="codeReserved">return</span> action.apply(client, args);</pre></td></tr>
  <tr><td class="codeShow_order">743</td><td><pre>			};</pre></td></tr>
  <tr><td class="codeShow_order">744</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">745</td><td><pre>		<span class="codeReserved">this</span>.timeout = setTimeout(doTimeout(action, client, args), timeoutSeconds * 1000);</pre></td></tr>
  <tr><td class="codeShow_order">746</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">747</td><td><pre>		<span class="codeReserved">this</span>.cancel = <span class="codeReserved">function</span>() {</pre></td></tr>
  <tr><td class="codeShow_order">748</td><td><pre>			<span class="codeReserved">this</span>._window.clearTimeout(<span class="codeReserved">this</span>.timeout);</pre></td></tr>
  <tr><td class="codeShow_order">749</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">750</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">751</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">752</td><td><pre>	<span class="codeComment">/*</span></pre></td></tr>
  <tr><td class="codeShow_order">753</td><td><pre><span class="codeComment">	 * Internal implementation of the Websockets MQTT V3.1 client.</span></pre></td></tr>
  <tr><td class="codeShow_order">754</td><td><pre><span class="codeComment">	 *</span></pre></td></tr>
  <tr><td class="codeShow_order">755</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@name</span> Paho.MQTT.ClientImpl <span class="codeReserved">@constructor</span></span></pre></td></tr>
  <tr><td class="codeShow_order">756</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> {String} host the DNS nameof the webSocket host.</span></pre></td></tr>
  <tr><td class="codeShow_order">757</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> {Number} port the port number <span class="codeReserved">for</span> that host.</span></pre></td></tr>
  <tr><td class="codeShow_order">758</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> {String} clientId the MQ client identifier.</span></pre></td></tr>
  <tr><td class="codeShow_order">759</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">760</td><td><pre>	<span class="codeReserved">var</span> ClientImpl = <span class="codeReserved">function</span> (uri, host, port, path, clientId) {</pre></td></tr>
  <tr><td class="codeShow_order">761</td><td><pre>		<span class="codeComment">// Check dependencies are satisfied in this browser.</span></pre></td></tr>
  <tr><td class="codeShow_order">762</td><td><pre>		<span class="codeReserved">if</span> (!(<span class="codeString">"WebSocket"</span> <span class="codeReserved">in</span> global && global.WebSocket !== <span class="codeReserved">null</span>)) {</pre></td></tr>
  <tr><td class="codeShow_order">763</td><td><pre>			<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.UNSUPPORTED, [<span class="codeString">"WebSocket"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">764</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">765</td><td><pre>		<span class="codeReserved">if</span> (!(<span class="codeString">"localStorage"</span> <span class="codeReserved">in</span> global && global.localStorage !== <span class="codeReserved">null</span>)) {</pre></td></tr>
  <tr><td class="codeShow_order">766</td><td><pre>			<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.UNSUPPORTED, [<span class="codeString">"localStorage"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">767</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">768</td><td><pre>		<span class="codeReserved">if</span> (!(<span class="codeString">"ArrayBuffer"</span> <span class="codeReserved">in</span> global && global.ArrayBuffer !== <span class="codeReserved">null</span>)) {</pre></td></tr>
  <tr><td class="codeShow_order">769</td><td><pre>			<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.UNSUPPORTED, [<span class="codeString">"ArrayBuffer"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">770</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">771</td><td><pre>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Paho.MQTT.Client"</span>, uri, host, port, path, clientId);</pre></td></tr>
  <tr><td class="codeShow_order">772</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">773</td><td><pre>		<span class="codeReserved">this</span>.host = host;</pre></td></tr>
  <tr><td class="codeShow_order">774</td><td><pre>		<span class="codeReserved">this</span>.port = port;</pre></td></tr>
  <tr><td class="codeShow_order">775</td><td><pre>		<span class="codeReserved">this</span>.path = path;</pre></td></tr>
  <tr><td class="codeShow_order">776</td><td><pre>		<span class="codeReserved">this</span>.uri = uri;</pre></td></tr>
  <tr><td class="codeShow_order">777</td><td><pre>		<span class="codeReserved">this</span>.clientId = clientId;</pre></td></tr>
  <tr><td class="codeShow_order">778</td><td><pre>		<span class="codeReserved">this</span>._wsuri = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">779</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">780</td><td><pre>		<span class="codeComment">// Local storagekeys are qualified with the following string.</span></pre></td></tr>
  <tr><td class="codeShow_order">781</td><td><pre>		<span class="codeComment">// The conditional inclusion of path in the key is for backward</span></pre></td></tr>
  <tr><td class="codeShow_order">782</td><td><pre>		<span class="codeComment">// compatibility to when the path was not configurable and assumed to</span></pre></td></tr>
  <tr><td class="codeShow_order">783</td><td><pre>		<span class="codeComment">// be /mqtt</span></pre></td></tr>
  <tr><td class="codeShow_order">784</td><td><pre>		<span class="codeReserved">this</span>._localKey=host+<span class="codeString">":"</span>+port+(path!=<span class="codeString">"/mqtt"</span>?<span class="codeString">":"</span>+path:<span class="codeString">""</span>)+<span class="codeString">":"</span>+clientId+<span class="codeString">":"</span>;</pre></td></tr>
  <tr><td class="codeShow_order">785</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">786</td><td><pre>		<span class="codeComment">// Create private instance-only message queue</span></pre></td></tr>
  <tr><td class="codeShow_order">787</td><td><pre>		<span class="codeComment">// Internal queue of messages to be sent, in sending order.</span></pre></td></tr>
  <tr><td class="codeShow_order">788</td><td><pre>		<span class="codeReserved">this</span>._msg_queue = [];</pre></td></tr>
  <tr><td class="codeShow_order">789</td><td><pre>		<span class="codeReserved">this</span>._buffered_msg_queue = [];</pre></td></tr>
  <tr><td class="codeShow_order">790</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">791</td><td><pre>		<span class="codeComment">// Messages we have sent and are expecting a response for, indexed by their respective message ids.</span></pre></td></tr>
  <tr><td class="codeShow_order">792</td><td><pre>		<span class="codeReserved">this</span>._sentMessages = {};</pre></td></tr>
  <tr><td class="codeShow_order">793</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">794</td><td><pre>		<span class="codeComment">// Messages we have received and acknowleged and are expecting a confirm message for</span></pre></td></tr>
  <tr><td class="codeShow_order">795</td><td><pre>		<span class="codeComment">// indexed by their respective message ids.</span></pre></td></tr>
  <tr><td class="codeShow_order">796</td><td><pre>		<span class="codeReserved">this</span>._receivedMessages = {};</pre></td></tr>
  <tr><td class="codeShow_order">797</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">798</td><td><pre>		<span class="codeComment">// Internal list of callbacks to be executed when messages</span></pre></td></tr>
  <tr><td class="codeShow_order">799</td><td><pre>		<span class="codeComment">// have been successfully sent over web socket, e.g. disconnect</span></pre></td></tr>
  <tr><td class="codeShow_order">800</td><td><pre>		<span class="codeComment">// when it doesn&#039;t have to wait for ACK, just message is dispatched.</span></pre></td></tr>
  <tr><td class="codeShow_order">801</td><td><pre>		<span class="codeReserved">this</span>._notify_msg_sent = {};</pre></td></tr>
  <tr><td class="codeShow_order">802</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">803</td><td><pre>		<span class="codeComment">// Unique identifier for SEND messages, incrementing</span></pre></td></tr>
  <tr><td class="codeShow_order">804</td><td><pre>		<span class="codeComment">// counter as messages are sent.</span></pre></td></tr>
  <tr><td class="codeShow_order">805</td><td><pre>		<span class="codeReserved">this</span>._message_identifier = 1;</pre></td></tr>
  <tr><td class="codeShow_order">806</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">807</td><td><pre>		<span class="codeComment">// Used to determine the transmission sequence of stored sent messages.</span></pre></td></tr>
  <tr><td class="codeShow_order">808</td><td><pre>		<span class="codeReserved">this</span>._sequence = 0;</pre></td></tr>
  <tr><td class="codeShow_order">809</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">810</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">811</td><td><pre>		<span class="codeComment">// Load the local state, if any, from the saved version, only restore state relevant to this client.</span></pre></td></tr>
  <tr><td class="codeShow_order">812</td><td><pre>		<span class="codeReserved">for</span> (<span class="codeReserved">var</span> key <span class="codeReserved">in</span> localStorage)</pre></td></tr>
  <tr><td class="codeShow_order">813</td><td><pre>			<span class="codeReserved">if</span> (   key.indexOf(<span class="codeString">"Sent:"</span>+<span class="codeReserved">this</span>._localKey) === 0 || key.indexOf(<span class="codeString">"Received:"</span>+<span class="codeReserved">this</span>._localKey) === 0)</pre></td></tr>
  <tr><td class="codeShow_order">814</td><td><pre>			<span class="codeReserved">this</span>.restore(key);</pre></td></tr>
  <tr><td class="codeShow_order">815</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">816</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">817</td><td><pre>	<span class="codeComment">// Messaging Client public instance members.</span></pre></td></tr>
  <tr><td class="codeShow_order">818</td><td><pre>	ClientImpl.prototype.host = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">819</td><td><pre>	ClientImpl.prototype.port = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">820</td><td><pre>	ClientImpl.prototype.path = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">821</td><td><pre>	ClientImpl.prototype.uri = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">822</td><td><pre>	ClientImpl.prototype.clientId = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">823</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">824</td><td><pre>	<span class="codeComment">// Messaging Client private instance members.</span></pre></td></tr>
  <tr><td class="codeShow_order">825</td><td><pre>	ClientImpl.prototype.socket = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">826</td><td><pre>	<span class="codeComment">/* <span class="codeReserved">true</span> once we have received an acknowledgement <span class="codeReserved">to</span> a CONNECT packet. */</span></pre></td></tr>
  <tr><td class="codeShow_order">827</td><td><pre>	ClientImpl.prototype.connected = <span class="codeReserved">false</span>;</pre></td></tr>
  <tr><td class="codeShow_order">828</td><td><pre>	<span class="codeComment">/* The largest message identifier allowed, may not be larger than 2**16 but</span></pre></td></tr>
  <tr><td class="codeShow_order">829</td><td><pre><span class="codeComment">	 * <span class="codeReserved">if</span> set smaller reduces the maximum number of outbound messages allowed.</span></pre></td></tr>
  <tr><td class="codeShow_order">830</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">831</td><td><pre>	ClientImpl.prototype.maxMessageIdentifier = 65536;</pre></td></tr>
  <tr><td class="codeShow_order">832</td><td><pre>	ClientImpl.prototype.connectOptions = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">833</td><td><pre>	ClientImpl.prototype.hostIndex = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">834</td><td><pre>	ClientImpl.prototype.onConnected = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">835</td><td><pre>	ClientImpl.prototype.onConnectionLost = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">836</td><td><pre>	ClientImpl.prototype.onMessageDelivered = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">837</td><td><pre>	ClientImpl.prototype.onMessageArrived = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">838</td><td><pre>	ClientImpl.prototype.traceFunction = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">839</td><td><pre>	ClientImpl.prototype._msg_queue = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">840</td><td><pre>	ClientImpl.prototype._buffered_msg_queue = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">841</td><td><pre>	ClientImpl.prototype._connectTimeout = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">842</td><td><pre>	<span class="codeComment">/* The sendPinger monitors how long we allow before we send data <span class="codeReserved">to</span> prove <span class="codeReserved">to</span> the server that we are alive. */</span></pre></td></tr>
  <tr><td class="codeShow_order">843</td><td><pre>	ClientImpl.prototype.sendPinger = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">844</td><td><pre>	<span class="codeComment">/* The receivePinger monitors how long we allow before we require evidence that the server is alive. */</span></pre></td></tr>
  <tr><td class="codeShow_order">845</td><td><pre>	ClientImpl.prototype.receivePinger = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">846</td><td><pre>	ClientImpl.prototype._reconnectInterval = 1; <span class="codeComment">// Reconnect Delay, starts at 1 second</span></pre></td></tr>
  <tr><td class="codeShow_order">847</td><td><pre>	ClientImpl.prototype._reconnecting = <span class="codeReserved">false</span>;</pre></td></tr>
  <tr><td class="codeShow_order">848</td><td><pre>	ClientImpl.prototype._reconnectTimeout = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">849</td><td><pre>	ClientImpl.prototype.disconnectedPublishing = <span class="codeReserved">false</span>;</pre></td></tr>
  <tr><td class="codeShow_order">850</td><td><pre>	ClientImpl.prototype.disconnectedBufferSize = 5000;</pre></td></tr>
  <tr><td class="codeShow_order">851</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">852</td><td><pre>	ClientImpl.prototype.receiveBuffer = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">853</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">854</td><td><pre>	ClientImpl.prototype._traceBuffer = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">855</td><td><pre>	ClientImpl.prototype._MAX_TRACE_ENTRIES = 100;</pre></td></tr>
  <tr><td class="codeShow_order">856</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">857</td><td><pre>	ClientImpl.prototype.connect = <span class="codeReserved">function</span> (connectOptions) {</pre></td></tr>
  <tr><td class="codeShow_order">858</td><td><pre>		<span class="codeReserved">var</span> connectOptionsMasked = <span class="codeReserved">this</span>._traceMask(connectOptions, <span class="codeString">"password"</span>);</pre></td></tr>
  <tr><td class="codeShow_order">859</td><td><pre>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client.connect"</span>, connectOptionsMasked, <span class="codeReserved">this</span>.socket, <span class="codeReserved">this</span>.connected);</pre></td></tr>
  <tr><td class="codeShow_order">860</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">861</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connected)</pre></td></tr>
  <tr><td class="codeShow_order">862</td><td><pre>			<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_STATE, [<span class="codeString">"already connected"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">863</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.socket)</pre></td></tr>
  <tr><td class="codeShow_order">864</td><td><pre>			<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_STATE, [<span class="codeString">"already connected"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">865</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">866</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._reconnecting) {</pre></td></tr>
  <tr><td class="codeShow_order">867</td><td><pre>			<span class="codeComment">// connect() function is called while reconnect is in progress.</span></pre></td></tr>
  <tr><td class="codeShow_order">868</td><td><pre>			<span class="codeComment">// Terminate the auto reconnect process to use new connect options.</span></pre></td></tr>
  <tr><td class="codeShow_order">869</td><td><pre>			<span class="codeReserved">this</span>._reconnectTimeout.cancel();</pre></td></tr>
  <tr><td class="codeShow_order">870</td><td><pre>			<span class="codeReserved">this</span>._reconnectTimeout = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">871</td><td><pre>			<span class="codeReserved">this</span>._reconnecting = <span class="codeReserved">false</span>;</pre></td></tr>
  <tr><td class="codeShow_order">872</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">873</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">874</td><td><pre>		<span class="codeReserved">this</span>.connectOptions = connectOptions;</pre></td></tr>
  <tr><td class="codeShow_order">875</td><td><pre>		<span class="codeReserved">this</span>._reconnectInterval = 1;</pre></td></tr>
  <tr><td class="codeShow_order">876</td><td><pre>		<span class="codeReserved">this</span>._reconnecting = <span class="codeReserved">false</span>;</pre></td></tr>
  <tr><td class="codeShow_order">877</td><td><pre>		<span class="codeReserved">if</span> (connectOptions.uris) {</pre></td></tr>
  <tr><td class="codeShow_order">878</td><td><pre>			<span class="codeReserved">this</span>.hostIndex = 0;</pre></td></tr>
  <tr><td class="codeShow_order">879</td><td><pre>			<span class="codeReserved">this</span>._doConnect(connectOptions.uris[0]);</pre></td></tr>
  <tr><td class="codeShow_order">880</td><td><pre>		} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">881</td><td><pre>			<span class="codeReserved">this</span>._doConnect(<span class="codeReserved">this</span>.uri);</pre></td></tr>
  <tr><td class="codeShow_order">882</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">883</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">884</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">885</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">886</td><td><pre>	ClientImpl.prototype.subscribe = <span class="codeReserved">function</span> (filter, subscribeOptions) {</pre></td></tr>
  <tr><td class="codeShow_order">887</td><td><pre>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client.subscribe"</span>, filter, subscribeOptions);</pre></td></tr>
  <tr><td class="codeShow_order">888</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">889</td><td><pre>		<span class="codeReserved">if</span> (!<span class="codeReserved">this</span>.connected)</pre></td></tr>
  <tr><td class="codeShow_order">890</td><td><pre>			<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_STATE, [<span class="codeString">"not connected"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">891</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">892</td><td><pre>		<span class="codeReserved">var</span> wireMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.SUBSCRIBE);</pre></td></tr>
  <tr><td class="codeShow_order">893</td><td><pre>		wireMessage.topics=[filter];</pre></td></tr>
  <tr><td class="codeShow_order">894</td><td><pre>		<span class="codeReserved">if</span> (subscribeOptions.qos !== undefined)</pre></td></tr>
  <tr><td class="codeShow_order">895</td><td><pre>			wireMessage.requestedQos = [subscribeOptions.qos];</pre></td></tr>
  <tr><td class="codeShow_order">896</td><td><pre>		<span class="codeReserved">else</span></pre></td></tr>
  <tr><td class="codeShow_order">897</td><td><pre>			wireMessage.requestedQos = [0];</pre></td></tr>
  <tr><td class="codeShow_order">898</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">899</td><td><pre>		<span class="codeReserved">if</span> (subscribeOptions.onSuccess) {</pre></td></tr>
  <tr><td class="codeShow_order">900</td><td><pre>			wireMessage.onSuccess = <span class="codeReserved">function</span>(grantedQos) {subscribeOptions.onSuccess({invocationContext:subscribeOptions.invocationContext,grantedQos:grantedQos});};</pre></td></tr>
  <tr><td class="codeShow_order">901</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">902</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">903</td><td><pre>		<span class="codeReserved">if</span> (subscribeOptions.onFailure) {</pre></td></tr>
  <tr><td class="codeShow_order">904</td><td><pre>			wireMessage.onFailure = <span class="codeReserved">function</span>(errorCode) {subscribeOptions.onFailure({invocationContext:subscribeOptions.invocationContext,errorCode:errorCode, errorMessage:format(errorCode)});};</pre></td></tr>
  <tr><td class="codeShow_order">905</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">906</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">907</td><td><pre>		<span class="codeReserved">if</span> (subscribeOptions.timeout) {</pre></td></tr>
  <tr><td class="codeShow_order">908</td><td><pre>			wireMessage.timeOut = <span class="codeReserved">new</span> Timeout(<span class="codeReserved">this</span>, window, subscribeOptions.timeout, subscribeOptions.onFailure,</pre></td></tr>
  <tr><td class="codeShow_order">909</td><td><pre>						[{invocationContext:subscribeOptions.invocationContext,</pre></td></tr>
  <tr><td class="codeShow_order">910</td><td><pre>						errorCode:ERROR.SUBSCRIBE_TIMEOUT.code,</pre></td></tr>
  <tr><td class="codeShow_order">911</td><td><pre>						errorMessage:format(ERROR.SUBSCRIBE_TIMEOUT)}]);</pre></td></tr>
  <tr><td class="codeShow_order">912</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">913</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">914</td><td><pre>		<span class="codeComment">// All subscriptions return a SUBACK.</span></pre></td></tr>
  <tr><td class="codeShow_order">915</td><td><pre>		<span class="codeReserved">this</span>._requires_ack(wireMessage);</pre></td></tr>
  <tr><td class="codeShow_order">916</td><td><pre>		<span class="codeReserved">this</span>._schedule_message(wireMessage);</pre></td></tr>
  <tr><td class="codeShow_order">917</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">918</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">919</td><td><pre>	<span class="codeComment">/** <span class="codeReserved">@ignore</span> */</span></pre></td></tr>
  <tr><td class="codeShow_order">920</td><td><pre>	ClientImpl.prototype.unsubscribe = <span class="codeReserved">function</span>(filter, unsubscribeOptions) {</pre></td></tr>
  <tr><td class="codeShow_order">921</td><td><pre>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client.unsubscribe"</span>, filter, unsubscribeOptions);</pre></td></tr>
  <tr><td class="codeShow_order">922</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">923</td><td><pre>		<span class="codeReserved">if</span> (!<span class="codeReserved">this</span>.connected)</pre></td></tr>
  <tr><td class="codeShow_order">924</td><td><pre>		   <span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_STATE, [<span class="codeString">"not connected"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">925</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">926</td><td><pre>		<span class="codeReserved">var</span> wireMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.UNSUBSCRIBE);</pre></td></tr>
  <tr><td class="codeShow_order">927</td><td><pre>		wireMessage.topics = [filter];</pre></td></tr>
  <tr><td class="codeShow_order">928</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">929</td><td><pre>		<span class="codeReserved">if</span> (unsubscribeOptions.onSuccess) {</pre></td></tr>
  <tr><td class="codeShow_order">930</td><td><pre>			wireMessage.callback = <span class="codeReserved">function</span>() {unsubscribeOptions.onSuccess({invocationContext:unsubscribeOptions.invocationContext});};</pre></td></tr>
  <tr><td class="codeShow_order">931</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">932</td><td><pre>		<span class="codeReserved">if</span> (unsubscribeOptions.timeout) {</pre></td></tr>
  <tr><td class="codeShow_order">933</td><td><pre>			wireMessage.timeOut = <span class="codeReserved">new</span> Timeout(<span class="codeReserved">this</span>, window, unsubscribeOptions.timeout, unsubscribeOptions.onFailure,</pre></td></tr>
  <tr><td class="codeShow_order">934</td><td><pre>					  [{invocationContext:unsubscribeOptions.invocationContext,</pre></td></tr>
  <tr><td class="codeShow_order">935</td><td><pre>						errorCode:ERROR.UNSUBSCRIBE_TIMEOUT.code,</pre></td></tr>
  <tr><td class="codeShow_order">936</td><td><pre>						errorMessage:format(ERROR.UNSUBSCRIBE_TIMEOUT)}]);</pre></td></tr>
  <tr><td class="codeShow_order">937</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">938</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">939</td><td><pre>		<span class="codeComment">// All unsubscribes return a SUBACK.</span></pre></td></tr>
  <tr><td class="codeShow_order">940</td><td><pre>		<span class="codeReserved">this</span>._requires_ack(wireMessage);</pre></td></tr>
  <tr><td class="codeShow_order">941</td><td><pre>		<span class="codeReserved">this</span>._schedule_message(wireMessage);</pre></td></tr>
  <tr><td class="codeShow_order">942</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">943</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">944</td><td><pre>	ClientImpl.prototype.send = <span class="codeReserved">function</span> (message) {</pre></td></tr>
  <tr><td class="codeShow_order">945</td><td><pre>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client.send"</span>, message);</pre></td></tr>
  <tr><td class="codeShow_order">946</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">947</td><td><pre>		wireMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.PUBLISH);</pre></td></tr>
  <tr><td class="codeShow_order">948</td><td><pre>		wireMessage.payloadMessage = message;</pre></td></tr>
  <tr><td class="codeShow_order">949</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">950</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connected) {</pre></td></tr>
  <tr><td class="codeShow_order">951</td><td><pre>			<span class="codeComment">// Mark qos 1 & 2 message as &quot;ACK required&quot;</span></pre></td></tr>
  <tr><td class="codeShow_order">952</td><td><pre>			<span class="codeComment">// For qos 0 message, invoke onMessageDelivered callback if there is one.</span></pre></td></tr>
  <tr><td class="codeShow_order">953</td><td><pre>			<span class="codeComment">// Then schedule the message.</span></pre></td></tr>
  <tr><td class="codeShow_order">954</td><td><pre>			<span class="codeReserved">if</span> (message.qos &gt; 0) {</pre></td></tr>
  <tr><td class="codeShow_order">955</td><td><pre>			<span class="codeReserved">this</span>._requires_ack(wireMessage);</pre></td></tr>
  <tr><td class="codeShow_order">956</td><td><pre>			} <span class="codeReserved">else</span> <span class="codeReserved">if</span> (<span class="codeReserved">this</span>.onMessageDelivered) {</pre></td></tr>
  <tr><td class="codeShow_order">957</td><td><pre>			<span class="codeReserved">this</span>._notify_msg_sent[wireMessage] = <span class="codeReserved">this</span>.onMessageDelivered(wireMessage.payloadMessage);</pre></td></tr>
  <tr><td class="codeShow_order">958</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">959</td><td><pre>		<span class="codeReserved">this</span>._schedule_message(wireMessage);</pre></td></tr>
  <tr><td class="codeShow_order">960</td><td><pre>		} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">961</td><td><pre>			<span class="codeComment">// Currently disconnected, will not schedule this message</span></pre></td></tr>
  <tr><td class="codeShow_order">962</td><td><pre>			<span class="codeComment">// Check if reconnecting is in progress and disconnected publish is enabled.</span></pre></td></tr>
  <tr><td class="codeShow_order">963</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._reconnecting && <span class="codeReserved">this</span>.disconnectedPublishing) {</pre></td></tr>
  <tr><td class="codeShow_order">964</td><td><pre>				<span class="codeComment">// Check the limit which include the &quot;required ACK&quot; messages</span></pre></td></tr>
  <tr><td class="codeShow_order">965</td><td><pre>				<span class="codeReserved">var</span> messageCount = Object.keys(<span class="codeReserved">this</span>._sentMessages).length + <span class="codeReserved">this</span>._buffered_msg_queue.length;</pre></td></tr>
  <tr><td class="codeShow_order">966</td><td><pre>				<span class="codeReserved">if</span> (messageCount &gt; <span class="codeReserved">this</span>.disconnectedBufferSize) {</pre></td></tr>
  <tr><td class="codeShow_order">967</td><td><pre>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.BUFFER_FULL, [<span class="codeReserved">this</span>.disconnectedBufferSize]));</pre></td></tr>
  <tr><td class="codeShow_order">968</td><td><pre>				} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">969</td><td><pre>					<span class="codeReserved">if</span> (message.qos &gt; 0) {</pre></td></tr>
  <tr><td class="codeShow_order">970</td><td><pre>						<span class="codeComment">// Mark this message as &quot;ACK required&quot;</span></pre></td></tr>
  <tr><td class="codeShow_order">971</td><td><pre>						<span class="codeReserved">this</span>._requires_ack(wireMessage);</pre></td></tr>
  <tr><td class="codeShow_order">972</td><td><pre>					} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">973</td><td><pre>						wireMessage.sequence = ++<span class="codeReserved">this</span>._sequence;</pre></td></tr>
  <tr><td class="codeShow_order">974</td><td><pre>						<span class="codeReserved">this</span>._buffered_msg_queue.push(wireMessage);</pre></td></tr>
  <tr><td class="codeShow_order">975</td><td><pre>					}</pre></td></tr>
  <tr><td class="codeShow_order">976</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">977</td><td><pre>			} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">978</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_STATE, [<span class="codeString">"not connected"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">979</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">980</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">981</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">982</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">983</td><td><pre>	ClientImpl.prototype.disconnect = <span class="codeReserved">function</span> () {</pre></td></tr>
  <tr><td class="codeShow_order">984</td><td><pre>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client.disconnect"</span>);</pre></td></tr>
  <tr><td class="codeShow_order">985</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">986</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._reconnecting) {</pre></td></tr>
  <tr><td class="codeShow_order">987</td><td><pre>			<span class="codeComment">// disconnect() function is called while reconnect is in progress.</span></pre></td></tr>
  <tr><td class="codeShow_order">988</td><td><pre>			<span class="codeComment">// Terminate the auto reconnect process.</span></pre></td></tr>
  <tr><td class="codeShow_order">989</td><td><pre>			<span class="codeReserved">this</span>._reconnectTimeout.cancel();</pre></td></tr>
  <tr><td class="codeShow_order">990</td><td><pre>			<span class="codeReserved">this</span>._reconnectTimeout = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">991</td><td><pre>			<span class="codeReserved">this</span>._reconnecting = <span class="codeReserved">false</span>;</pre></td></tr>
  <tr><td class="codeShow_order">992</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">993</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">994</td><td><pre>		<span class="codeReserved">if</span> (!<span class="codeReserved">this</span>.socket)</pre></td></tr>
  <tr><td class="codeShow_order">995</td><td><pre>			<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_STATE, [<span class="codeString">"not connecting or connected"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">996</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">997</td><td><pre>		wireMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.DISCONNECT);</pre></td></tr>
  <tr><td class="codeShow_order">998</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">999</td><td><pre>		<span class="codeComment">// Run the disconnected call back as soon as the message has been sent,</span></pre></td></tr>
  <tr><td class="codeShow_order">1000</td><td><pre>		<span class="codeComment">// in case of a failure later on in the disconnect processing.</span></pre></td></tr>
  <tr><td class="codeShow_order">1001</td><td><pre>		<span class="codeComment">// as a consequence, the _disconected call back may be run several times.</span></pre></td></tr>
  <tr><td class="codeShow_order">1002</td><td><pre>		<span class="codeReserved">this</span>._notify_msg_sent[wireMessage] = scope(<span class="codeReserved">this</span>._disconnected, <span class="codeReserved">this</span>);</pre></td></tr>
  <tr><td class="codeShow_order">1003</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1004</td><td><pre>		<span class="codeReserved">this</span>._schedule_message(wireMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1005</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1006</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1007</td><td><pre>	ClientImpl.prototype.getTraceLog = <span class="codeReserved">function</span> () {</pre></td></tr>
  <tr><td class="codeShow_order">1008</td><td><pre>		<span class="codeReserved">if</span> ( <span class="codeReserved">this</span>._traceBuffer !== <span class="codeReserved">null</span> ) {</pre></td></tr>
  <tr><td class="codeShow_order">1009</td><td><pre>			<span class="codeReserved">this</span>._trace(<span class="codeString">"Client.getTraceLog"</span>, <span class="codeReserved">new</span> Date());</pre></td></tr>
  <tr><td class="codeShow_order">1010</td><td><pre>			<span class="codeReserved">this</span>._trace(<span class="codeString">"Client.getTraceLog <span class="codeReserved">in</span> flight messages"</span>, <span class="codeReserved">this</span>._sentMessages.length);</pre></td></tr>
  <tr><td class="codeShow_order">1011</td><td><pre>			<span class="codeReserved">for</span> (<span class="codeReserved">var</span> key <span class="codeReserved">in</span> <span class="codeReserved">this</span>._sentMessages)</pre></td></tr>
  <tr><td class="codeShow_order">1012</td><td><pre>				<span class="codeReserved">this</span>._trace(<span class="codeString">"_sentMessages "</span>,key, <span class="codeReserved">this</span>._sentMessages[key]);</pre></td></tr>
  <tr><td class="codeShow_order">1013</td><td><pre>			<span class="codeReserved">for</span> (<span class="codeReserved">var</span> key <span class="codeReserved">in</span> <span class="codeReserved">this</span>._receivedMessages)</pre></td></tr>
  <tr><td class="codeShow_order">1014</td><td><pre>				<span class="codeReserved">this</span>._trace(<span class="codeString">"_receivedMessages "</span>,key, <span class="codeReserved">this</span>._receivedMessages[key]);</pre></td></tr>
  <tr><td class="codeShow_order">1015</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1016</td><td><pre>			<span class="codeReserved">return</span> <span class="codeReserved">this</span>._traceBuffer;</pre></td></tr>
  <tr><td class="codeShow_order">1017</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1018</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1019</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1020</td><td><pre>	ClientImpl.prototype.startTrace = <span class="codeReserved">function</span> () {</pre></td></tr>
  <tr><td class="codeShow_order">1021</td><td><pre>		<span class="codeReserved">if</span> ( <span class="codeReserved">this</span>._traceBuffer === <span class="codeReserved">null</span> ) {</pre></td></tr>
  <tr><td class="codeShow_order">1022</td><td><pre>			<span class="codeReserved">this</span>._traceBuffer = [];</pre></td></tr>
  <tr><td class="codeShow_order">1023</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1024</td><td><pre>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client.startTrace"</span>, <span class="codeReserved">new</span> Date(), version);</pre></td></tr>
  <tr><td class="codeShow_order">1025</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1026</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1027</td><td><pre>	ClientImpl.prototype.stopTrace = <span class="codeReserved">function</span> () {</pre></td></tr>
  <tr><td class="codeShow_order">1028</td><td><pre>		delete <span class="codeReserved">this</span>._traceBuffer;</pre></td></tr>
  <tr><td class="codeShow_order">1029</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1030</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1031</td><td><pre>	ClientImpl.prototype._doConnect = <span class="codeReserved">function</span> (wsurl) {</pre></td></tr>
  <tr><td class="codeShow_order">1032</td><td><pre>		<span class="codeComment">// When the socket is open, this client will send the CONNECT WireMessage using the saved parameters.</span></pre></td></tr>
  <tr><td class="codeShow_order">1033</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connectOptions.useSSL) {</pre></td></tr>
  <tr><td class="codeShow_order">1034</td><td><pre>		    <span class="codeReserved">var</span> uriParts = wsurl.split(<span class="codeString">":"</span>);</pre></td></tr>
  <tr><td class="codeShow_order">1035</td><td><pre>		    uriParts[0] = <span class="codeString">"wss"</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1036</td><td><pre>		    wsurl = uriParts.join(<span class="codeString">":"</span>);</pre></td></tr>
  <tr><td class="codeShow_order">1037</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1038</td><td><pre>		<span class="codeReserved">this</span>._wsuri = wsurl;</pre></td></tr>
  <tr><td class="codeShow_order">1039</td><td><pre>		<span class="codeReserved">this</span>.connected = <span class="codeReserved">false</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1040</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1041</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1042</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1043</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connectOptions.mqttVersion &lt; 4) {</pre></td></tr>
  <tr><td class="codeShow_order">1044</td><td><pre>			<span class="codeReserved">this</span>.socket = <span class="codeReserved">new</span> WebSocket(wsurl, [<span class="codeString">"mqttv3.1"</span>]);</pre></td></tr>
  <tr><td class="codeShow_order">1045</td><td><pre>		} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">1046</td><td><pre>			<span class="codeReserved">this</span>.socket = <span class="codeReserved">new</span> WebSocket(wsurl, [<span class="codeString">"mqtt"</span>]);</pre></td></tr>
  <tr><td class="codeShow_order">1047</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1048</td><td><pre>		<span class="codeReserved">this</span>.socket.binaryType = <span class="codeString">'arraybuffer'</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1049</td><td><pre>		<span class="codeReserved">this</span>.socket.onopen = scope(<span class="codeReserved">this</span>._on_socket_open, <span class="codeReserved">this</span>);</pre></td></tr>
  <tr><td class="codeShow_order">1050</td><td><pre>		<span class="codeReserved">this</span>.socket.onmessage = scope(<span class="codeReserved">this</span>._on_socket_message, <span class="codeReserved">this</span>);</pre></td></tr>
  <tr><td class="codeShow_order">1051</td><td><pre>		<span class="codeReserved">this</span>.socket.onerror = scope(<span class="codeReserved">this</span>._on_socket_error, <span class="codeReserved">this</span>);</pre></td></tr>
  <tr><td class="codeShow_order">1052</td><td><pre>		<span class="codeReserved">this</span>.socket.onclose = scope(<span class="codeReserved">this</span>._on_socket_close, <span class="codeReserved">this</span>);</pre></td></tr>
  <tr><td class="codeShow_order">1053</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1054</td><td><pre>		<span class="codeReserved">this</span>.sendPinger = <span class="codeReserved">new</span> Pinger(<span class="codeReserved">this</span>, window, <span class="codeReserved">this</span>.connectOptions.keepAliveInterval);</pre></td></tr>
  <tr><td class="codeShow_order">1055</td><td><pre>		<span class="codeReserved">this</span>.receivePinger = <span class="codeReserved">new</span> Pinger(<span class="codeReserved">this</span>, window, <span class="codeReserved">this</span>.connectOptions.keepAliveInterval);</pre></td></tr>
  <tr><td class="codeShow_order">1056</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._connectTimeout) {</pre></td></tr>
  <tr><td class="codeShow_order">1057</td><td><pre>			<span class="codeReserved">this</span>._connectTimeout.cancel();</pre></td></tr>
  <tr><td class="codeShow_order">1058</td><td><pre>			<span class="codeReserved">this</span>._connectTimeout = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1059</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1060</td><td><pre>		<span class="codeReserved">this</span>._connectTimeout = <span class="codeReserved">new</span> Timeout(<span class="codeReserved">this</span>, window, <span class="codeReserved">this</span>.connectOptions.timeout, <span class="codeReserved">this</span>._disconnected,  [ERROR.CONNECT_TIMEOUT.code, format(ERROR.CONNECT_TIMEOUT)]);</pre></td></tr>
  <tr><td class="codeShow_order">1061</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1062</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1063</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1064</td><td><pre>	<span class="codeComment">// Schedule a new message to be sent over the WebSockets</span></pre></td></tr>
  <tr><td class="codeShow_order">1065</td><td><pre>	<span class="codeComment">// connection. CONNECT messages cause WebSocket connection</span></pre></td></tr>
  <tr><td class="codeShow_order">1066</td><td><pre>	<span class="codeComment">// to be started. All other messages are queued internally</span></pre></td></tr>
  <tr><td class="codeShow_order">1067</td><td><pre>	<span class="codeComment">// until this has happened. When WS connection starts, process</span></pre></td></tr>
  <tr><td class="codeShow_order">1068</td><td><pre>	<span class="codeComment">// all outstanding messages.</span></pre></td></tr>
  <tr><td class="codeShow_order">1069</td><td><pre>	ClientImpl.prototype._schedule_message = <span class="codeReserved">function</span> (message) {</pre></td></tr>
  <tr><td class="codeShow_order">1070</td><td><pre>		<span class="codeReserved">this</span>._msg_queue.push(message);</pre></td></tr>
  <tr><td class="codeShow_order">1071</td><td><pre>		<span class="codeComment">// Process outstanding messages in the queue if we have an  open socket, and have received CONNACK.</span></pre></td></tr>
  <tr><td class="codeShow_order">1072</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connected) {</pre></td></tr>
  <tr><td class="codeShow_order">1073</td><td><pre>			<span class="codeReserved">this</span>._process_queue();</pre></td></tr>
  <tr><td class="codeShow_order">1074</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1075</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1076</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1077</td><td><pre>	ClientImpl.prototype.store = <span class="codeReserved">function</span>(prefix, wireMessage) {</pre></td></tr>
  <tr><td class="codeShow_order">1078</td><td><pre>		<span class="codeReserved">var</span> storedMessage = {type:wireMessage.type, messageIdentifier:wireMessage.messageIdentifier, version:1};</pre></td></tr>
  <tr><td class="codeShow_order">1079</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1080</td><td><pre>		<span class="codeReserved">switch</span>(wireMessage.type) {</pre></td></tr>
  <tr><td class="codeShow_order">1081</td><td><pre>		  <span class="codeReserved">case</span> MESSAGE_TYPE.PUBLISH:</pre></td></tr>
  <tr><td class="codeShow_order">1082</td><td><pre>			  <span class="codeReserved">if</span>(wireMessage.pubRecReceived)</pre></td></tr>
  <tr><td class="codeShow_order">1083</td><td><pre>				  storedMessage.pubRecReceived = <span class="codeReserved">true</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1084</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1085</td><td><pre>			  <span class="codeComment">// Convert the payload to a hex string.</span></pre></td></tr>
  <tr><td class="codeShow_order">1086</td><td><pre>			  storedMessage.payloadMessage = {};</pre></td></tr>
  <tr><td class="codeShow_order">1087</td><td><pre>			  <span class="codeReserved">var</span> hex = <span class="codeString">""</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1088</td><td><pre>			  <span class="codeReserved">var</span> messageBytes = wireMessage.payloadMessage.payloadBytes;</pre></td></tr>
  <tr><td class="codeShow_order">1089</td><td><pre>			  <span class="codeReserved">for</span> (<span class="codeReserved">var</span> i=0; i&lt;<span class="codeReserved">messageBytes</span>.length; i++) {</pre></td></tr>
  <tr><td class="codeShow_order">1090</td><td><pre>				<span class="codeReserved">if</span> (messageBytes[i] &lt;= 0xF)</pre></td></tr>
  <tr><td class="codeShow_order">1091</td><td><pre>				  hex = hex+<span class="codeString">"0"</span>+messageBytes[i].toString(16);</pre></td></tr>
  <tr><td class="codeShow_order">1092</td><td><pre>				<span class="codeReserved">else</span></pre></td></tr>
  <tr><td class="codeShow_order">1093</td><td><pre>				  hex = hex+messageBytes[i].toString(16);</pre></td></tr>
  <tr><td class="codeShow_order">1094</td><td><pre>			  }</pre></td></tr>
  <tr><td class="codeShow_order">1095</td><td><pre>			  storedMessage.payloadMessage.payloadHex = hex;</pre></td></tr>
  <tr><td class="codeShow_order">1096</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1097</td><td><pre>			  storedMessage.payloadMessage.qos = wireMessage.payloadMessage.qos;</pre></td></tr>
  <tr><td class="codeShow_order">1098</td><td><pre>			  storedMessage.payloadMessage.destinationName = wireMessage.payloadMessage.destinationName;</pre></td></tr>
  <tr><td class="codeShow_order">1099</td><td><pre>			  <span class="codeReserved">if</span> (wireMessage.payloadMessage.duplicate)</pre></td></tr>
  <tr><td class="codeShow_order">1100</td><td><pre>				  storedMessage.payloadMessage.duplicate = <span class="codeReserved">true</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1101</td><td><pre>			  <span class="codeReserved">if</span> (wireMessage.payloadMessage.retained)</pre></td></tr>
  <tr><td class="codeShow_order">1102</td><td><pre>				  storedMessage.payloadMessage.retained = <span class="codeReserved">true</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1103</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1104</td><td><pre>			  <span class="codeComment">// Add a sequence number to sent messages.</span></pre></td></tr>
  <tr><td class="codeShow_order">1105</td><td><pre>			  <span class="codeReserved">if</span> ( prefix.indexOf(<span class="codeString">"Sent:"</span>) === 0 ) {</pre></td></tr>
  <tr><td class="codeShow_order">1106</td><td><pre>				  <span class="codeReserved">if</span> ( wireMessage.sequence === undefined )</pre></td></tr>
  <tr><td class="codeShow_order">1107</td><td><pre>					  wireMessage.sequence = ++<span class="codeReserved">this</span>._sequence;</pre></td></tr>
  <tr><td class="codeShow_order">1108</td><td><pre>				  storedMessage.sequence = wireMessage.sequence;</pre></td></tr>
  <tr><td class="codeShow_order">1109</td><td><pre>			  }</pre></td></tr>
  <tr><td class="codeShow_order">1110</td><td><pre>			  <span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1111</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1112</td><td><pre>			<span class="codeReserved">default</span>:</pre></td></tr>
  <tr><td class="codeShow_order">1113</td><td><pre>				<span class="codeReserved">throw</span> Error(format(ERROR.INVALID_STORED_DATA, [key, storedMessage]));</pre></td></tr>
  <tr><td class="codeShow_order">1114</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1115</td><td><pre>		localStorage.setItem(prefix+<span class="codeReserved">this</span>._localKey+wireMessage.messageIdentifier, JSON.stringify(storedMessage));</pre></td></tr>
  <tr><td class="codeShow_order">1116</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1117</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1118</td><td><pre>	ClientImpl.prototype.restore = <span class="codeReserved">function</span>(key) {</pre></td></tr>
  <tr><td class="codeShow_order">1119</td><td><pre>		<span class="codeReserved">var</span> value = localStorage.getItem(key);</pre></td></tr>
  <tr><td class="codeShow_order">1120</td><td><pre>		<span class="codeReserved">var</span> storedMessage = JSON.parse(value);</pre></td></tr>
  <tr><td class="codeShow_order">1121</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1122</td><td><pre>		<span class="codeReserved">var</span> wireMessage = <span class="codeReserved">new</span> WireMessage(storedMessage.type, storedMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1123</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1124</td><td><pre>		<span class="codeReserved">switch</span>(storedMessage.type) {</pre></td></tr>
  <tr><td class="codeShow_order">1125</td><td><pre>		  <span class="codeReserved">case</span> MESSAGE_TYPE.PUBLISH:</pre></td></tr>
  <tr><td class="codeShow_order">1126</td><td><pre>			  <span class="codeComment">// Replace the payload message with a Message object.</span></pre></td></tr>
  <tr><td class="codeShow_order">1127</td><td><pre>			  <span class="codeReserved">var</span> hex = storedMessage.payloadMessage.payloadHex;</pre></td></tr>
  <tr><td class="codeShow_order">1128</td><td><pre>			  <span class="codeReserved">var</span> buffer = <span class="codeReserved">new</span> ArrayBuffer((hex.length)/2);</pre></td></tr>
  <tr><td class="codeShow_order">1129</td><td><pre>			  <span class="codeReserved">var</span> byteStream = <span class="codeReserved">new</span> Uint8Array(buffer);</pre></td></tr>
  <tr><td class="codeShow_order">1130</td><td><pre>			  <span class="codeReserved">var</span> i = 0;</pre></td></tr>
  <tr><td class="codeShow_order">1131</td><td><pre>			  <span class="codeReserved">while</span> (hex.length &gt;= 2) {</pre></td></tr>
  <tr><td class="codeShow_order">1132</td><td><pre>				  <span class="codeReserved">var</span> x = parseInt(hex.substring(0, 2), 16);</pre></td></tr>
  <tr><td class="codeShow_order">1133</td><td><pre>				  hex = hex.substring(2, hex.length);</pre></td></tr>
  <tr><td class="codeShow_order">1134</td><td><pre>				  byteStream[i++] = x;</pre></td></tr>
  <tr><td class="codeShow_order">1135</td><td><pre>			  }</pre></td></tr>
  <tr><td class="codeShow_order">1136</td><td><pre>			  <span class="codeReserved">var</span> payloadMessage = <span class="codeReserved">new</span> Paho.MQTT.Message(byteStream);</pre></td></tr>
  <tr><td class="codeShow_order">1137</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1138</td><td><pre>			  payloadMessage.qos = storedMessage.payloadMessage.qos;</pre></td></tr>
  <tr><td class="codeShow_order">1139</td><td><pre>			  payloadMessage.destinationName = storedMessage.payloadMessage.destinationName;</pre></td></tr>
  <tr><td class="codeShow_order">1140</td><td><pre>			  <span class="codeReserved">if</span> (storedMessage.payloadMessage.duplicate)</pre></td></tr>
  <tr><td class="codeShow_order">1141</td><td><pre>				  payloadMessage.duplicate = <span class="codeReserved">true</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1142</td><td><pre>			  <span class="codeReserved">if</span> (storedMessage.payloadMessage.retained)</pre></td></tr>
  <tr><td class="codeShow_order">1143</td><td><pre>				  payloadMessage.retained = <span class="codeReserved">true</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1144</td><td><pre>			  wireMessage.payloadMessage = payloadMessage;</pre></td></tr>
  <tr><td class="codeShow_order">1145</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1146</td><td><pre>			  <span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1147</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1148</td><td><pre>			<span class="codeReserved">default</span>:</pre></td></tr>
  <tr><td class="codeShow_order">1149</td><td><pre>			  <span class="codeReserved">throw</span> Error(format(ERROR.INVALID_STORED_DATA, [key, value]));</pre></td></tr>
  <tr><td class="codeShow_order">1150</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1151</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1152</td><td><pre>		<span class="codeReserved">if</span> (key.indexOf(<span class="codeString">"Sent:"</span>+<span class="codeReserved">this</span>._localKey) === 0) {</pre></td></tr>
  <tr><td class="codeShow_order">1153</td><td><pre>			wireMessage.payloadMessage.duplicate = <span class="codeReserved">true</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1154</td><td><pre>			<span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier] = wireMessage;</pre></td></tr>
  <tr><td class="codeShow_order">1155</td><td><pre>		} <span class="codeReserved">else</span> <span class="codeReserved">if</span> (key.indexOf(<span class="codeString">"Received:"</span>+<span class="codeReserved">this</span>._localKey) === 0) {</pre></td></tr>
  <tr><td class="codeShow_order">1156</td><td><pre>			<span class="codeReserved">this</span>._receivedMessages[wireMessage.messageIdentifier] = wireMessage;</pre></td></tr>
  <tr><td class="codeShow_order">1157</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1158</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1159</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1160</td><td><pre>	ClientImpl.prototype._process_queue = <span class="codeReserved">function</span> () {</pre></td></tr>
  <tr><td class="codeShow_order">1161</td><td><pre>		<span class="codeReserved">var</span> message = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1162</td><td><pre>		<span class="codeComment">// Process messages in order they were added</span></pre></td></tr>
  <tr><td class="codeShow_order">1163</td><td><pre>		<span class="codeReserved">var</span> fifo = <span class="codeReserved">this</span>._msg_queue.reverse();</pre></td></tr>
  <tr><td class="codeShow_order">1164</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1165</td><td><pre>		<span class="codeComment">// Send all queued messages down socket connection</span></pre></td></tr>
  <tr><td class="codeShow_order">1166</td><td><pre>		<span class="codeReserved">while</span> ((message = fifo.pop())) {</pre></td></tr>
  <tr><td class="codeShow_order">1167</td><td><pre>			<span class="codeReserved">this</span>._socket_send(message);</pre></td></tr>
  <tr><td class="codeShow_order">1168</td><td><pre>			<span class="codeComment">// Notify listeners that message was successfully sent</span></pre></td></tr>
  <tr><td class="codeShow_order">1169</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._notify_msg_sent[message]) {</pre></td></tr>
  <tr><td class="codeShow_order">1170</td><td><pre>				<span class="codeReserved">this</span>._notify_msg_sent[message]();</pre></td></tr>
  <tr><td class="codeShow_order">1171</td><td><pre>				delete <span class="codeReserved">this</span>._notify_msg_sent[message];</pre></td></tr>
  <tr><td class="codeShow_order">1172</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">1173</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1174</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1175</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1176</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">1177</td><td><pre><span class="codeComment">	 * Expect an ACK response <span class="codeReserved">for</span> <span class="codeReserved">this</span> message. Add message <span class="codeReserved">to</span> the set of <span class="codeReserved">in</span> progress</span></pre></td></tr>
  <tr><td class="codeShow_order">1178</td><td><pre><span class="codeComment">	 * messages and set an unused identifier <span class="codeReserved">in</span> <span class="codeReserved">this</span> message.</span></pre></td></tr>
  <tr><td class="codeShow_order">1179</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@ignore</span></span></pre></td></tr>
  <tr><td class="codeShow_order">1180</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">1181</td><td><pre>	ClientImpl.prototype._requires_ack = <span class="codeReserved">function</span> (wireMessage) {</pre></td></tr>
  <tr><td class="codeShow_order">1182</td><td><pre>		<span class="codeReserved">var</span> messageCount = Object.keys(<span class="codeReserved">this</span>._sentMessages).length;</pre></td></tr>
  <tr><td class="codeShow_order">1183</td><td><pre>		<span class="codeReserved">if</span> (messageCount &gt; <span class="codeReserved">this</span>.maxMessageIdentifier)</pre></td></tr>
  <tr><td class="codeShow_order">1184</td><td><pre>			<span class="codeReserved">throw</span> Error (<span class="codeString">"Too many messages:"</span>+messageCount);</pre></td></tr>
  <tr><td class="codeShow_order">1185</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1186</td><td><pre>		<span class="codeReserved">while</span>(<span class="codeReserved">this</span>._sentMessages[<span class="codeReserved">this</span>._message_identifier] !== undefined) {</pre></td></tr>
  <tr><td class="codeShow_order">1187</td><td><pre>			<span class="codeReserved">this</span>._message_identifier++;</pre></td></tr>
  <tr><td class="codeShow_order">1188</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1189</td><td><pre>		wireMessage.messageIdentifier = <span class="codeReserved">this</span>._message_identifier;</pre></td></tr>
  <tr><td class="codeShow_order">1190</td><td><pre>		<span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier] = wireMessage;</pre></td></tr>
  <tr><td class="codeShow_order">1191</td><td><pre>		<span class="codeReserved">if</span> (wireMessage.type === MESSAGE_TYPE.PUBLISH) {</pre></td></tr>
  <tr><td class="codeShow_order">1192</td><td><pre>			<span class="codeReserved">this</span>.store(<span class="codeString">"Sent:"</span>, wireMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1193</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1194</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._message_identifier === <span class="codeReserved">this</span>.maxMessageIdentifier) {</pre></td></tr>
  <tr><td class="codeShow_order">1195</td><td><pre>			<span class="codeReserved">this</span>._message_identifier = 1;</pre></td></tr>
  <tr><td class="codeShow_order">1196</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1197</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1198</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1199</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">1200</td><td><pre><span class="codeComment">	 * Called when the underlying websocket has been opened.</span></pre></td></tr>
  <tr><td class="codeShow_order">1201</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@ignore</span></span></pre></td></tr>
  <tr><td class="codeShow_order">1202</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">1203</td><td><pre>	ClientImpl.prototype._on_socket_open = <span class="codeReserved">function</span> () {</pre></td></tr>
  <tr><td class="codeShow_order">1204</td><td><pre>		<span class="codeComment">// Create the CONNECT message object.</span></pre></td></tr>
  <tr><td class="codeShow_order">1205</td><td><pre>		<span class="codeReserved">var</span> wireMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.CONNECT, <span class="codeReserved">this</span>.connectOptions);</pre></td></tr>
  <tr><td class="codeShow_order">1206</td><td><pre>		wireMessage.clientId = <span class="codeReserved">this</span>.clientId;</pre></td></tr>
  <tr><td class="codeShow_order">1207</td><td><pre>		<span class="codeReserved">this</span>._socket_send(wireMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1208</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1209</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1210</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">1211</td><td><pre><span class="codeComment">	 * Called when the underlying websocket has received a complete packet.</span></pre></td></tr>
  <tr><td class="codeShow_order">1212</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@ignore</span></span></pre></td></tr>
  <tr><td class="codeShow_order">1213</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">1214</td><td><pre>	ClientImpl.prototype._on_socket_message = <span class="codeReserved">function</span> (event) {</pre></td></tr>
  <tr><td class="codeShow_order">1215</td><td><pre>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client._on_socket_message"</span>, event.data);</pre></td></tr>
  <tr><td class="codeShow_order">1216</td><td><pre>		<span class="codeReserved">var</span> messages = <span class="codeReserved">this</span>._deframeMessages(event.data);</pre></td></tr>
  <tr><td class="codeShow_order">1217</td><td><pre>		<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i = 0; i &lt; messages.length; i+=1) {</pre></td></tr>
  <tr><td class="codeShow_order">1218</td><td><pre>		    <span class="codeReserved">this</span>._handleMessage(messages[i]);</pre></td></tr>
  <tr><td class="codeShow_order">1219</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1220</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1221</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1222</td><td><pre>	ClientImpl.prototype._deframeMessages = <span class="codeReserved">function</span>(data) {</pre></td></tr>
  <tr><td class="codeShow_order">1223</td><td><pre>		<span class="codeReserved">var</span> byteArray = <span class="codeReserved">new</span> Uint8Array(data);</pre></td></tr>
  <tr><td class="codeShow_order">1224</td><td><pre>		<span class="codeReserved">var</span> messages = [];</pre></td></tr>
  <tr><td class="codeShow_order">1225</td><td><pre>	    <span class="codeReserved">if</span> (<span class="codeReserved">this</span>.receiveBuffer) {</pre></td></tr>
  <tr><td class="codeShow_order">1226</td><td><pre>	        <span class="codeReserved">var</span> newData = <span class="codeReserved">new</span> Uint8Array(<span class="codeReserved">this</span>.receiveBuffer.length+byteArray.length);</pre></td></tr>
  <tr><td class="codeShow_order">1227</td><td><pre>	        newData.set(<span class="codeReserved">this</span>.receiveBuffer);</pre></td></tr>
  <tr><td class="codeShow_order">1228</td><td><pre>	        newData.set(byteArray,<span class="codeReserved">this</span>.receiveBuffer.length);</pre></td></tr>
  <tr><td class="codeShow_order">1229</td><td><pre>	        byteArray = newData;</pre></td></tr>
  <tr><td class="codeShow_order">1230</td><td><pre>	        delete <span class="codeReserved">this</span>.receiveBuffer;</pre></td></tr>
  <tr><td class="codeShow_order">1231</td><td><pre>	    }</pre></td></tr>
  <tr><td class="codeShow_order">1232</td><td><pre>		<span class="codeReserved">try</span> {</pre></td></tr>
  <tr><td class="codeShow_order">1233</td><td><pre>		    <span class="codeReserved">var</span> offset = 0;</pre></td></tr>
  <tr><td class="codeShow_order">1234</td><td><pre>		    <span class="codeReserved">while</span>(offset &lt; byteArray.length) {</pre></td></tr>
  <tr><td class="codeShow_order">1235</td><td><pre>		        <span class="codeReserved">var</span> result = decodeMessage(byteArray,offset);</pre></td></tr>
  <tr><td class="codeShow_order">1236</td><td><pre>		        <span class="codeReserved">var</span> wireMessage = result[0];</pre></td></tr>
  <tr><td class="codeShow_order">1237</td><td><pre>		        offset = result[1];</pre></td></tr>
  <tr><td class="codeShow_order">1238</td><td><pre>		        <span class="codeReserved">if</span> (wireMessage !== <span class="codeReserved">null</span>) {</pre></td></tr>
  <tr><td class="codeShow_order">1239</td><td><pre>		            messages.push(wireMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1240</td><td><pre>		        } <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">1241</td><td><pre>		            <span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1242</td><td><pre>		        }</pre></td></tr>
  <tr><td class="codeShow_order">1243</td><td><pre>		    }</pre></td></tr>
  <tr><td class="codeShow_order">1244</td><td><pre>		    <span class="codeReserved">if</span> (offset &lt; byteArray.length) {</pre></td></tr>
  <tr><td class="codeShow_order">1245</td><td><pre>		    	<span class="codeReserved">this</span>.receiveBuffer = byteArray.subarray(offset);</pre></td></tr>
  <tr><td class="codeShow_order">1246</td><td><pre>		    }</pre></td></tr>
  <tr><td class="codeShow_order">1247</td><td><pre>		} <span class="codeReserved">catch</span> (error) {</pre></td></tr>
  <tr><td class="codeShow_order">1248</td><td><pre>			<span class="codeReserved">var</span> errorStack = ((error.hasOwnProperty(<span class="codeString">'stack'</span>) == <span class="codeString">'undefined'</span>) ? error.stack.toString() : <span class="codeString">"No Error Stack Available"</span>);</pre></td></tr>
  <tr><td class="codeShow_order">1249</td><td><pre>			<span class="codeReserved">this</span>._disconnected(ERROR.INTERNAL_ERROR.code , format(ERROR.INTERNAL_ERROR, [error.message,errorStack]));</pre></td></tr>
  <tr><td class="codeShow_order">1250</td><td><pre>			<span class="codeReserved">return</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1251</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1252</td><td><pre>		<span class="codeReserved">return</span> messages;</pre></td></tr>
  <tr><td class="codeShow_order">1253</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1254</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1255</td><td><pre>	ClientImpl.prototype._handleMessage = <span class="codeReserved">function</span>(wireMessage) {</pre></td></tr>
  <tr><td class="codeShow_order">1256</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1257</td><td><pre>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client._handleMessage"</span>, wireMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1258</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1259</td><td><pre>		<span class="codeReserved">try</span> {</pre></td></tr>
  <tr><td class="codeShow_order">1260</td><td><pre>			<span class="codeReserved">switch</span>(wireMessage.type) {</pre></td></tr>
  <tr><td class="codeShow_order">1261</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.CONNACK:</pre></td></tr>
  <tr><td class="codeShow_order">1262</td><td><pre>				<span class="codeReserved">this</span>._connectTimeout.cancel();</pre></td></tr>
  <tr><td class="codeShow_order">1263</td><td><pre>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._reconnectTimeout)</pre></td></tr>
  <tr><td class="codeShow_order">1264</td><td><pre>					<span class="codeReserved">this</span>._reconnectTimeout.cancel();</pre></td></tr>
  <tr><td class="codeShow_order">1265</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1266</td><td><pre>				<span class="codeComment">// If we have started using clean session then clear up the local state.</span></pre></td></tr>
  <tr><td class="codeShow_order">1267</td><td><pre>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connectOptions.cleanSession) {</pre></td></tr>
  <tr><td class="codeShow_order">1268</td><td><pre>					<span class="codeReserved">for</span> (<span class="codeReserved">var</span> key <span class="codeReserved">in</span> <span class="codeReserved">this</span>._sentMessages) {</pre></td></tr>
  <tr><td class="codeShow_order">1269</td><td><pre>						<span class="codeReserved">var</span> sentMessage = <span class="codeReserved">this</span>._sentMessages[key];</pre></td></tr>
  <tr><td class="codeShow_order">1270</td><td><pre>						localStorage.removeItem(<span class="codeString">"Sent:"</span>+<span class="codeReserved">this</span>._localKey+sentMessage.messageIdentifier);</pre></td></tr>
  <tr><td class="codeShow_order">1271</td><td><pre>					}</pre></td></tr>
  <tr><td class="codeShow_order">1272</td><td><pre>					<span class="codeReserved">this</span>._sentMessages = {};</pre></td></tr>
  <tr><td class="codeShow_order">1273</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1274</td><td><pre>					<span class="codeReserved">for</span> (<span class="codeReserved">var</span> key <span class="codeReserved">in</span> <span class="codeReserved">this</span>._receivedMessages) {</pre></td></tr>
  <tr><td class="codeShow_order">1275</td><td><pre>						<span class="codeReserved">var</span> receivedMessage = <span class="codeReserved">this</span>._receivedMessages[key];</pre></td></tr>
  <tr><td class="codeShow_order">1276</td><td><pre>						localStorage.removeItem(<span class="codeString">"Received:"</span>+<span class="codeReserved">this</span>._localKey+receivedMessage.messageIdentifier);</pre></td></tr>
  <tr><td class="codeShow_order">1277</td><td><pre>					}</pre></td></tr>
  <tr><td class="codeShow_order">1278</td><td><pre>					<span class="codeReserved">this</span>._receivedMessages = {};</pre></td></tr>
  <tr><td class="codeShow_order">1279</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">1280</td><td><pre>				<span class="codeComment">// Client connected and ready for business.</span></pre></td></tr>
  <tr><td class="codeShow_order">1281</td><td><pre>				<span class="codeReserved">if</span> (wireMessage.returnCode === 0) {</pre></td></tr>
  <tr><td class="codeShow_order">1282</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1283</td><td><pre>					<span class="codeReserved">this</span>.connected = <span class="codeReserved">true</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1284</td><td><pre>					<span class="codeComment">// Jump to the end of the list of uris and stop looking for a good host.</span></pre></td></tr>
  <tr><td class="codeShow_order">1285</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1286</td><td><pre>					<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connectOptions.uris)</pre></td></tr>
  <tr><td class="codeShow_order">1287</td><td><pre>            <span class="codeReserved">this</span>.hostIndex = <span class="codeReserved">this</span>.connectOptions.uris.length;</pre></td></tr>
  <tr><td class="codeShow_order">1288</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1289</td><td><pre>				} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">1290</td><td><pre>					<span class="codeReserved">this</span>._disconnected(ERROR.CONNACK_RETURNCODE.code , format(ERROR.CONNACK_RETURNCODE, [wireMessage.returnCode, CONNACK_RC[wireMessage.returnCode]]));</pre></td></tr>
  <tr><td class="codeShow_order">1291</td><td><pre>					<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1292</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">1293</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1294</td><td><pre>				<span class="codeComment">// Resend messages.</span></pre></td></tr>
  <tr><td class="codeShow_order">1295</td><td><pre>				<span class="codeReserved">var</span> sequencedMessages = [];</pre></td></tr>
  <tr><td class="codeShow_order">1296</td><td><pre>				<span class="codeReserved">for</span> (<span class="codeReserved">var</span> msgId <span class="codeReserved">in</span> <span class="codeReserved">this</span>._sentMessages) {</pre></td></tr>
  <tr><td class="codeShow_order">1297</td><td><pre>					<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._sentMessages.hasOwnProperty(msgId))</pre></td></tr>
  <tr><td class="codeShow_order">1298</td><td><pre>						sequencedMessages.push(<span class="codeReserved">this</span>._sentMessages[msgId]);</pre></td></tr>
  <tr><td class="codeShow_order">1299</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">1300</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1301</td><td><pre>				<span class="codeComment">// Also schedule qos 0 buffered messages if any</span></pre></td></tr>
  <tr><td class="codeShow_order">1302</td><td><pre>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._buffered_msg_queue.length &gt; 0) {</pre></td></tr>
  <tr><td class="codeShow_order">1303</td><td><pre>					<span class="codeReserved">var</span> msg = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1304</td><td><pre>					<span class="codeReserved">var</span> fifo = <span class="codeReserved">this</span>._buffered_msg_queue.reverse();</pre></td></tr>
  <tr><td class="codeShow_order">1305</td><td><pre>					<span class="codeReserved">while</span> ((msg = fifo.pop())) {</pre></td></tr>
  <tr><td class="codeShow_order">1306</td><td><pre>						sequencedMessages.push(msg);</pre></td></tr>
  <tr><td class="codeShow_order">1307</td><td><pre>						<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.onMessageDelivered)</pre></td></tr>
  <tr><td class="codeShow_order">1308</td><td><pre>							<span class="codeReserved">this</span>._notify_msg_sent[msg] = <span class="codeReserved">this</span>.onMessageDelivered(msg.payloadMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1309</td><td><pre>					}</pre></td></tr>
  <tr><td class="codeShow_order">1310</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">1311</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1312</td><td><pre>				<span class="codeComment">// Sort sentMessages into the original sent order.</span></pre></td></tr>
  <tr><td class="codeShow_order">1313</td><td><pre>				<span class="codeReserved">var</span> sequencedMessages = sequencedMessages.sort(<span class="codeReserved">function</span>(a,b) {<span class="codeReserved">return</span> a.sequence - b.sequence;} );</pre></td></tr>
  <tr><td class="codeShow_order">1314</td><td><pre>				<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i=0, len=sequencedMessages.length; i&lt;<span class="codeReserved">len</span>; i++) {</pre></td></tr>
  <tr><td class="codeShow_order">1315</td><td><pre>					<span class="codeReserved">var</span> sentMessage = sequencedMessages[i];</pre></td></tr>
  <tr><td class="codeShow_order">1316</td><td><pre>					<span class="codeReserved">if</span> (sentMessage.type == MESSAGE_TYPE.PUBLISH && sentMessage.pubRecReceived) {</pre></td></tr>
  <tr><td class="codeShow_order">1317</td><td><pre>						<span class="codeReserved">var</span> pubRelMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.PUBREL, {messageIdentifier:sentMessage.messageIdentifier});</pre></td></tr>
  <tr><td class="codeShow_order">1318</td><td><pre>						<span class="codeReserved">this</span>._schedule_message(pubRelMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1319</td><td><pre>					} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">1320</td><td><pre>						<span class="codeReserved">this</span>._schedule_message(sentMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1321</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">1322</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">1323</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1324</td><td><pre>				<span class="codeComment">// Execute the connectOptions.onSuccess callback if there is one.</span></pre></td></tr>
  <tr><td class="codeShow_order">1325</td><td><pre>        <span class="codeComment">// Will also now return if this connection was the result of an automatic</span></pre></td></tr>
  <tr><td class="codeShow_order">1326</td><td><pre>        <span class="codeComment">// reconnect and which URI was successfully connected to.</span></pre></td></tr>
  <tr><td class="codeShow_order">1327</td><td><pre>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connectOptions.onSuccess) {</pre></td></tr>
  <tr><td class="codeShow_order">1328</td><td><pre>					<span class="codeReserved">this</span>.connectOptions.onSuccess({invocationContext:<span class="codeReserved">this</span>.connectOptions.invocationContext});</pre></td></tr>
  <tr><td class="codeShow_order">1329</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">1330</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1331</td><td><pre>				<span class="codeReserved">var</span> reconnected = <span class="codeReserved">false</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1332</td><td><pre>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._reconnecting) {</pre></td></tr>
  <tr><td class="codeShow_order">1333</td><td><pre>					reconnected = <span class="codeReserved">true</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1334</td><td><pre>					<span class="codeReserved">this</span>._reconnectInterval = 1;</pre></td></tr>
  <tr><td class="codeShow_order">1335</td><td><pre>					<span class="codeReserved">this</span>._reconnecting = <span class="codeReserved">false</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1336</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">1337</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1338</td><td><pre>				<span class="codeComment">// Execute the onConnected callback if there is one.</span></pre></td></tr>
  <tr><td class="codeShow_order">1339</td><td><pre>				<span class="codeReserved">this</span>._connected(reconnected, <span class="codeReserved">this</span>._wsuri);</pre></td></tr>
  <tr><td class="codeShow_order">1340</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1341</td><td><pre>				<span class="codeComment">// Process all queued messages now that the connection is established.</span></pre></td></tr>
  <tr><td class="codeShow_order">1342</td><td><pre>				<span class="codeReserved">this</span>._process_queue();</pre></td></tr>
  <tr><td class="codeShow_order">1343</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1344</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1345</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.PUBLISH:</pre></td></tr>
  <tr><td class="codeShow_order">1346</td><td><pre>				<span class="codeReserved">this</span>._receivePublish(wireMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1347</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1348</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1349</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.PUBACK:</pre></td></tr>
  <tr><td class="codeShow_order">1350</td><td><pre>				<span class="codeReserved">var</span> sentMessage = <span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier];</pre></td></tr>
  <tr><td class="codeShow_order">1351</td><td><pre>				 <span class="codeComment">// If this is a re flow of a PUBACK after we have restarted receivedMessage will not exist.</span></pre></td></tr>
  <tr><td class="codeShow_order">1352</td><td><pre>				<span class="codeReserved">if</span> (sentMessage) {</pre></td></tr>
  <tr><td class="codeShow_order">1353</td><td><pre>					delete <span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier];</pre></td></tr>
  <tr><td class="codeShow_order">1354</td><td><pre>					localStorage.removeItem(<span class="codeString">"Sent:"</span>+<span class="codeReserved">this</span>._localKey+wireMessage.messageIdentifier);</pre></td></tr>
  <tr><td class="codeShow_order">1355</td><td><pre>					<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.onMessageDelivered)</pre></td></tr>
  <tr><td class="codeShow_order">1356</td><td><pre>						<span class="codeReserved">this</span>.onMessageDelivered(sentMessage.payloadMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1357</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">1358</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1359</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1360</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.PUBREC:</pre></td></tr>
  <tr><td class="codeShow_order">1361</td><td><pre>				<span class="codeReserved">var</span> sentMessage = <span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier];</pre></td></tr>
  <tr><td class="codeShow_order">1362</td><td><pre>				<span class="codeComment">// If this is a re flow of a PUBREC after we have restarted receivedMessage will not exist.</span></pre></td></tr>
  <tr><td class="codeShow_order">1363</td><td><pre>				<span class="codeReserved">if</span> (sentMessage) {</pre></td></tr>
  <tr><td class="codeShow_order">1364</td><td><pre>					sentMessage.pubRecReceived = <span class="codeReserved">true</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1365</td><td><pre>					<span class="codeReserved">var</span> pubRelMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.PUBREL, {messageIdentifier:wireMessage.messageIdentifier});</pre></td></tr>
  <tr><td class="codeShow_order">1366</td><td><pre>					<span class="codeReserved">this</span>.store(<span class="codeString">"Sent:"</span>, sentMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1367</td><td><pre>					<span class="codeReserved">this</span>._schedule_message(pubRelMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1368</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">1369</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1370</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1371</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.PUBREL:</pre></td></tr>
  <tr><td class="codeShow_order">1372</td><td><pre>				<span class="codeReserved">var</span> receivedMessage = <span class="codeReserved">this</span>._receivedMessages[wireMessage.messageIdentifier];</pre></td></tr>
  <tr><td class="codeShow_order">1373</td><td><pre>				localStorage.removeItem(<span class="codeString">"Received:"</span>+<span class="codeReserved">this</span>._localKey+wireMessage.messageIdentifier);</pre></td></tr>
  <tr><td class="codeShow_order">1374</td><td><pre>				<span class="codeComment">// If this is a re flow of a PUBREL after we have restarted receivedMessage will not exist.</span></pre></td></tr>
  <tr><td class="codeShow_order">1375</td><td><pre>				<span class="codeReserved">if</span> (receivedMessage) {</pre></td></tr>
  <tr><td class="codeShow_order">1376</td><td><pre>					<span class="codeReserved">this</span>._receiveMessage(receivedMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1377</td><td><pre>					delete <span class="codeReserved">this</span>._receivedMessages[wireMessage.messageIdentifier];</pre></td></tr>
  <tr><td class="codeShow_order">1378</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">1379</td><td><pre>				<span class="codeComment">// Always flow PubComp, we may have previously flowed PubComp but the server lost it and restarted.</span></pre></td></tr>
  <tr><td class="codeShow_order">1380</td><td><pre>				<span class="codeReserved">var</span> pubCompMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.PUBCOMP, {messageIdentifier:wireMessage.messageIdentifier});</pre></td></tr>
  <tr><td class="codeShow_order">1381</td><td><pre>				<span class="codeReserved">this</span>._schedule_message(pubCompMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1382</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1383</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1384</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1385</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1386</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.PUBCOMP:</pre></td></tr>
  <tr><td class="codeShow_order">1387</td><td><pre>				<span class="codeReserved">var</span> sentMessage = <span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier];</pre></td></tr>
  <tr><td class="codeShow_order">1388</td><td><pre>				delete <span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier];</pre></td></tr>
  <tr><td class="codeShow_order">1389</td><td><pre>				localStorage.removeItem(<span class="codeString">"Sent:"</span>+<span class="codeReserved">this</span>._localKey+wireMessage.messageIdentifier);</pre></td></tr>
  <tr><td class="codeShow_order">1390</td><td><pre>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.onMessageDelivered)</pre></td></tr>
  <tr><td class="codeShow_order">1391</td><td><pre>					<span class="codeReserved">this</span>.onMessageDelivered(sentMessage.payloadMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1392</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1393</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1394</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.SUBACK:</pre></td></tr>
  <tr><td class="codeShow_order">1395</td><td><pre>				<span class="codeReserved">var</span> sentMessage = <span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier];</pre></td></tr>
  <tr><td class="codeShow_order">1396</td><td><pre>				<span class="codeReserved">if</span> (sentMessage) {</pre></td></tr>
  <tr><td class="codeShow_order">1397</td><td><pre>					<span class="codeReserved">if</span>(sentMessage.timeOut)</pre></td></tr>
  <tr><td class="codeShow_order">1398</td><td><pre>						sentMessage.timeOut.cancel();</pre></td></tr>
  <tr><td class="codeShow_order">1399</td><td><pre>					<span class="codeComment">// This will need to be fixed when we add multiple topic support</span></pre></td></tr>
  <tr><td class="codeShow_order">1400</td><td><pre>          			<span class="codeReserved">if</span> (wireMessage.returnCode[0] === 0x80) {</pre></td></tr>
  <tr><td class="codeShow_order">1401</td><td><pre>						<span class="codeReserved">if</span> (sentMessage.onFailure) {</pre></td></tr>
  <tr><td class="codeShow_order">1402</td><td><pre>							sentMessage.onFailure(wireMessage.returnCode);</pre></td></tr>
  <tr><td class="codeShow_order">1403</td><td><pre>						}</pre></td></tr>
  <tr><td class="codeShow_order">1404</td><td><pre>					} <span class="codeReserved">else</span> <span class="codeReserved">if</span> (sentMessage.onSuccess) {</pre></td></tr>
  <tr><td class="codeShow_order">1405</td><td><pre>						sentMessage.onSuccess(wireMessage.returnCode);</pre></td></tr>
  <tr><td class="codeShow_order">1406</td><td><pre>					}</pre></td></tr>
  <tr><td class="codeShow_order">1407</td><td><pre>					delete <span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier];</pre></td></tr>
  <tr><td class="codeShow_order">1408</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">1409</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1410</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1411</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.UNSUBACK:</pre></td></tr>
  <tr><td class="codeShow_order">1412</td><td><pre>				<span class="codeReserved">var</span> sentMessage = <span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier];</pre></td></tr>
  <tr><td class="codeShow_order">1413</td><td><pre>				<span class="codeReserved">if</span> (sentMessage) {</pre></td></tr>
  <tr><td class="codeShow_order">1414</td><td><pre>					<span class="codeReserved">if</span> (sentMessage.timeOut)</pre></td></tr>
  <tr><td class="codeShow_order">1415</td><td><pre>						sentMessage.timeOut.cancel();</pre></td></tr>
  <tr><td class="codeShow_order">1416</td><td><pre>					<span class="codeReserved">if</span> (sentMessage.callback) {</pre></td></tr>
  <tr><td class="codeShow_order">1417</td><td><pre>						sentMessage.callback();</pre></td></tr>
  <tr><td class="codeShow_order">1418</td><td><pre>					}</pre></td></tr>
  <tr><td class="codeShow_order">1419</td><td><pre>					delete <span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier];</pre></td></tr>
  <tr><td class="codeShow_order">1420</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">1421</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1422</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1423</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1424</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.PINGRESP:</pre></td></tr>
  <tr><td class="codeShow_order">1425</td><td><pre>				<span class="codeComment">/* The sendPinger or receivePinger may have sent a ping, the receivePinger has already been reset. */</span></pre></td></tr>
  <tr><td class="codeShow_order">1426</td><td><pre>				<span class="codeReserved">this</span>.sendPinger.reset();</pre></td></tr>
  <tr><td class="codeShow_order">1427</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1428</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1429</td><td><pre>			<span class="codeReserved">case</span> MESSAGE_TYPE.DISCONNECT:</pre></td></tr>
  <tr><td class="codeShow_order">1430</td><td><pre>				<span class="codeComment">// Clients do not expect to receive disconnect packets.</span></pre></td></tr>
  <tr><td class="codeShow_order">1431</td><td><pre>				<span class="codeReserved">this</span>._disconnected(ERROR.INVALID_MQTT_MESSAGE_TYPE.code , format(ERROR.INVALID_MQTT_MESSAGE_TYPE, [wireMessage.type]));</pre></td></tr>
  <tr><td class="codeShow_order">1432</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1433</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1434</td><td><pre>			<span class="codeReserved">default</span>:</pre></td></tr>
  <tr><td class="codeShow_order">1435</td><td><pre>				<span class="codeReserved">this</span>._disconnected(ERROR.INVALID_MQTT_MESSAGE_TYPE.code , format(ERROR.INVALID_MQTT_MESSAGE_TYPE, [wireMessage.type]));</pre></td></tr>
  <tr><td class="codeShow_order">1436</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">1437</td><td><pre>		} <span class="codeReserved">catch</span> (error) {</pre></td></tr>
  <tr><td class="codeShow_order">1438</td><td><pre>			<span class="codeReserved">var</span> errorStack = ((error.hasOwnProperty(<span class="codeString">'stack'</span>) == <span class="codeString">'undefined'</span>) ? error.stack.toString() : <span class="codeString">"No Error Stack Available"</span>);</pre></td></tr>
  <tr><td class="codeShow_order">1439</td><td><pre>			<span class="codeReserved">this</span>._disconnected(ERROR.INTERNAL_ERROR.code , format(ERROR.INTERNAL_ERROR, [error.message,errorStack]));</pre></td></tr>
  <tr><td class="codeShow_order">1440</td><td><pre>			<span class="codeReserved">return</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1441</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1442</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1443</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1444</td><td><pre>	<span class="codeComment">/** <span class="codeReserved">@ignore</span> */</span></pre></td></tr>
  <tr><td class="codeShow_order">1445</td><td><pre>	ClientImpl.prototype._on_socket_error = <span class="codeReserved">function</span> (error) {</pre></td></tr>
  <tr><td class="codeShow_order">1446</td><td><pre>		<span class="codeReserved">if</span> (!<span class="codeReserved">this</span>._reconnecting) {</pre></td></tr>
  <tr><td class="codeShow_order">1447</td><td><pre>		<span class="codeReserved">this</span>._disconnected(ERROR.SOCKET_ERROR.code , format(ERROR.SOCKET_ERROR, [error.data]));</pre></td></tr>
  <tr><td class="codeShow_order">1448</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1449</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1450</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1451</td><td><pre>	<span class="codeComment">/** <span class="codeReserved">@ignore</span> */</span></pre></td></tr>
  <tr><td class="codeShow_order">1452</td><td><pre>	ClientImpl.prototype._on_socket_close = <span class="codeReserved">function</span> () {</pre></td></tr>
  <tr><td class="codeShow_order">1453</td><td><pre>		<span class="codeReserved">if</span> (!<span class="codeReserved">this</span>._reconnecting) {</pre></td></tr>
  <tr><td class="codeShow_order">1454</td><td><pre>		<span class="codeReserved">this</span>._disconnected(ERROR.SOCKET_CLOSE.code , format(ERROR.SOCKET_CLOSE));</pre></td></tr>
  <tr><td class="codeShow_order">1455</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1456</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1457</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1458</td><td><pre>	<span class="codeComment">/** <span class="codeReserved">@ignore</span> */</span></pre></td></tr>
  <tr><td class="codeShow_order">1459</td><td><pre>	ClientImpl.prototype._socket_send = <span class="codeReserved">function</span> (wireMessage) {</pre></td></tr>
  <tr><td class="codeShow_order">1460</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1461</td><td><pre>		<span class="codeReserved">if</span> (wireMessage.type == 1) {</pre></td></tr>
  <tr><td class="codeShow_order">1462</td><td><pre>			<span class="codeReserved">var</span> wireMessageMasked = <span class="codeReserved">this</span>._traceMask(wireMessage, <span class="codeString">"password"</span>);</pre></td></tr>
  <tr><td class="codeShow_order">1463</td><td><pre>			<span class="codeReserved">this</span>._trace(<span class="codeString">"Client._socket_send"</span>, wireMessageMasked);</pre></td></tr>
  <tr><td class="codeShow_order">1464</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1465</td><td><pre>		<span class="codeReserved">else</span> <span class="codeReserved">this</span>._trace(<span class="codeString">"Client._socket_send"</span>, wireMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1466</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1467</td><td><pre>		<span class="codeReserved">this</span>.socket.send(wireMessage.encode());</pre></td></tr>
  <tr><td class="codeShow_order">1468</td><td><pre>		<span class="codeComment">/* We have proved <span class="codeReserved">to</span> the server we are alive. */</span></pre></td></tr>
  <tr><td class="codeShow_order">1469</td><td><pre>		<span class="codeReserved">this</span>.sendPinger.reset();</pre></td></tr>
  <tr><td class="codeShow_order">1470</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1471</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1472</td><td><pre>	<span class="codeComment">/** <span class="codeReserved">@ignore</span> */</span></pre></td></tr>
  <tr><td class="codeShow_order">1473</td><td><pre>	ClientImpl.prototype._receivePublish = <span class="codeReserved">function</span> (wireMessage) {</pre></td></tr>
  <tr><td class="codeShow_order">1474</td><td><pre>		<span class="codeReserved">switch</span>(wireMessage.payloadMessage.qos) {</pre></td></tr>
  <tr><td class="codeShow_order">1475</td><td><pre>			<span class="codeReserved">case</span> <span class="codeString">"undefined"</span>:</pre></td></tr>
  <tr><td class="codeShow_order">1476</td><td><pre>			<span class="codeReserved">case</span> 0:</pre></td></tr>
  <tr><td class="codeShow_order">1477</td><td><pre>				<span class="codeReserved">this</span>._receiveMessage(wireMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1478</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1479</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1480</td><td><pre>			<span class="codeReserved">case</span> 1:</pre></td></tr>
  <tr><td class="codeShow_order">1481</td><td><pre>				<span class="codeReserved">var</span> pubAckMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.PUBACK, {messageIdentifier:wireMessage.messageIdentifier});</pre></td></tr>
  <tr><td class="codeShow_order">1482</td><td><pre>				<span class="codeReserved">this</span>._schedule_message(pubAckMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1483</td><td><pre>				<span class="codeReserved">this</span>._receiveMessage(wireMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1484</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1485</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1486</td><td><pre>			<span class="codeReserved">case</span> 2:</pre></td></tr>
  <tr><td class="codeShow_order">1487</td><td><pre>				<span class="codeReserved">this</span>._receivedMessages[wireMessage.messageIdentifier] = wireMessage;</pre></td></tr>
  <tr><td class="codeShow_order">1488</td><td><pre>				<span class="codeReserved">this</span>.store(<span class="codeString">"Received:"</span>, wireMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1489</td><td><pre>				<span class="codeReserved">var</span> pubRecMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.PUBREC, {messageIdentifier:wireMessage.messageIdentifier});</pre></td></tr>
  <tr><td class="codeShow_order">1490</td><td><pre>				<span class="codeReserved">this</span>._schedule_message(pubRecMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1491</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1492</td><td><pre>				<span class="codeReserved">break</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1493</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1494</td><td><pre>			<span class="codeReserved">default</span>:</pre></td></tr>
  <tr><td class="codeShow_order">1495</td><td><pre>				<span class="codeReserved">throw</span> Error(<span class="codeString">"Invaild qos="</span>+wireMmessage.payloadMessage.qos);</pre></td></tr>
  <tr><td class="codeShow_order">1496</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1497</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1498</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1499</td><td><pre>	<span class="codeComment">/** <span class="codeReserved">@ignore</span> */</span></pre></td></tr>
  <tr><td class="codeShow_order">1500</td><td><pre>	ClientImpl.prototype._receiveMessage = <span class="codeReserved">function</span> (wireMessage) {</pre></td></tr>
  <tr><td class="codeShow_order">1501</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.onMessageArrived) {</pre></td></tr>
  <tr><td class="codeShow_order">1502</td><td><pre>			<span class="codeReserved">this</span>.onMessageArrived(wireMessage.payloadMessage);</pre></td></tr>
  <tr><td class="codeShow_order">1503</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1504</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1505</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1506</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">1507</td><td><pre><span class="codeComment">	 * Client has connected.</span></pre></td></tr>
  <tr><td class="codeShow_order">1508</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> {reconnect} [boolean] indicate <span class="codeReserved">if</span> <span class="codeReserved">this</span> was a result of reconnect operation.</span></pre></td></tr>
  <tr><td class="codeShow_order">1509</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> {uri} [string] fully qualified WebSocket URI of the server.</span></pre></td></tr>
  <tr><td class="codeShow_order">1510</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">1511</td><td><pre>	ClientImpl.prototype._connected = <span class="codeReserved">function</span> (reconnect, uri) {</pre></td></tr>
  <tr><td class="codeShow_order">1512</td><td><pre>		<span class="codeComment">// Execute the onConnected callback if there is one.</span></pre></td></tr>
  <tr><td class="codeShow_order">1513</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.onConnected)</pre></td></tr>
  <tr><td class="codeShow_order">1514</td><td><pre>			<span class="codeReserved">this</span>.onConnected(reconnect, uri);</pre></td></tr>
  <tr><td class="codeShow_order">1515</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1516</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1517</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">1518</td><td><pre><span class="codeComment">	 * Attempts <span class="codeReserved">to</span> reconnect the client <span class="codeReserved">to</span> the server.</span></pre></td></tr>
  <tr><td class="codeShow_order">1519</td><td><pre><span class="codeComment">   * For each reconnect attempt, will double the reconnect interval</span></pre></td></tr>
  <tr><td class="codeShow_order">1520</td><td><pre><span class="codeComment">   * up <span class="codeReserved">to</span> 128 seconds.</span></pre></td></tr>
  <tr><td class="codeShow_order">1521</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">1522</td><td><pre>	ClientImpl.prototype._reconnect = <span class="codeReserved">function</span> () {</pre></td></tr>
  <tr><td class="codeShow_order">1523</td><td><pre>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client._reconnect"</span>);</pre></td></tr>
  <tr><td class="codeShow_order">1524</td><td><pre>		<span class="codeReserved">if</span> (!<span class="codeReserved">this</span>.connected) {</pre></td></tr>
  <tr><td class="codeShow_order">1525</td><td><pre>			<span class="codeReserved">this</span>._reconnecting = <span class="codeReserved">true</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1526</td><td><pre>			<span class="codeReserved">this</span>.sendPinger.cancel();</pre></td></tr>
  <tr><td class="codeShow_order">1527</td><td><pre>			<span class="codeReserved">this</span>.receivePinger.cancel();</pre></td></tr>
  <tr><td class="codeShow_order">1528</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._reconnectInterval &lt; 128)</pre></td></tr>
  <tr><td class="codeShow_order">1529</td><td><pre>				<span class="codeReserved">this</span>._reconnectInterval = <span class="codeReserved">this</span>._reconnectInterval * 2;</pre></td></tr>
  <tr><td class="codeShow_order">1530</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connectOptions.uris) {</pre></td></tr>
  <tr><td class="codeShow_order">1531</td><td><pre>				<span class="codeReserved">this</span>.hostIndex = 0;</pre></td></tr>
  <tr><td class="codeShow_order">1532</td><td><pre>				<span class="codeReserved">this</span>._doConnect(<span class="codeReserved">this</span>.connectOptions.uris[0]);</pre></td></tr>
  <tr><td class="codeShow_order">1533</td><td><pre>			} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">1534</td><td><pre>				<span class="codeReserved">this</span>._doConnect(<span class="codeReserved">this</span>.uri);</pre></td></tr>
  <tr><td class="codeShow_order">1535</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">1536</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1537</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1538</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1539</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">1540</td><td><pre><span class="codeComment">	 * Client has disconnected either at its own request or because the server</span></pre></td></tr>
  <tr><td class="codeShow_order">1541</td><td><pre><span class="codeComment">	 * or network disconnected it. Remove all non-durable state.</span></pre></td></tr>
  <tr><td class="codeShow_order">1542</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> {errorCode} [number] the error number.</span></pre></td></tr>
  <tr><td class="codeShow_order">1543</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> {errorText} [string] the error text.</span></pre></td></tr>
  <tr><td class="codeShow_order">1544</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@ignore</span></span></pre></td></tr>
  <tr><td class="codeShow_order">1545</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">1546</td><td><pre>	ClientImpl.prototype._disconnected = <span class="codeReserved">function</span> (errorCode, errorText) {</pre></td></tr>
  <tr><td class="codeShow_order">1547</td><td><pre>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client._disconnected"</span>, errorCode, errorText);</pre></td></tr>
  <tr><td class="codeShow_order">1548</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1549</td><td><pre>		<span class="codeReserved">if</span> (errorCode !== undefined && <span class="codeReserved">this</span>._reconnecting) {</pre></td></tr>
  <tr><td class="codeShow_order">1550</td><td><pre>      <span class="codeComment">//Continue automatic reconnect process</span></pre></td></tr>
  <tr><td class="codeShow_order">1551</td><td><pre>  		<span class="codeReserved">this</span>._reconnectTimeout = <span class="codeReserved">new</span> Timeout(<span class="codeReserved">this</span>, window, <span class="codeReserved">this</span>._reconnectInterval, <span class="codeReserved">this</span>._reconnect);</pre></td></tr>
  <tr><td class="codeShow_order">1552</td><td><pre>			<span class="codeReserved">return</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1553</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1554</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1555</td><td><pre>		<span class="codeReserved">this</span>.sendPinger.cancel();</pre></td></tr>
  <tr><td class="codeShow_order">1556</td><td><pre>		<span class="codeReserved">this</span>.receivePinger.cancel();</pre></td></tr>
  <tr><td class="codeShow_order">1557</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._connectTimeout) {</pre></td></tr>
  <tr><td class="codeShow_order">1558</td><td><pre>			<span class="codeReserved">this</span>._connectTimeout.cancel();</pre></td></tr>
  <tr><td class="codeShow_order">1559</td><td><pre>			<span class="codeReserved">this</span>._connectTimeout = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1560</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1561</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1562</td><td><pre>		<span class="codeComment">// Clear message buffers.</span></pre></td></tr>
  <tr><td class="codeShow_order">1563</td><td><pre>		<span class="codeReserved">this</span>._msg_queue = [];</pre></td></tr>
  <tr><td class="codeShow_order">1564</td><td><pre>		<span class="codeReserved">this</span>._buffered_msg_queue = [];</pre></td></tr>
  <tr><td class="codeShow_order">1565</td><td><pre>		<span class="codeReserved">this</span>._notify_msg_sent = {};</pre></td></tr>
  <tr><td class="codeShow_order">1566</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1567</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.socket) {</pre></td></tr>
  <tr><td class="codeShow_order">1568</td><td><pre>			<span class="codeComment">// Cancel all socket callbacks so that they cannot be driven again by this socket.</span></pre></td></tr>
  <tr><td class="codeShow_order">1569</td><td><pre>			<span class="codeReserved">this</span>.socket.onopen = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1570</td><td><pre>			<span class="codeReserved">this</span>.socket.onmessage = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1571</td><td><pre>			<span class="codeReserved">this</span>.socket.onerror = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1572</td><td><pre>			<span class="codeReserved">this</span>.socket.onclose = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1573</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.socket.readyState === 1)</pre></td></tr>
  <tr><td class="codeShow_order">1574</td><td><pre>				<span class="codeReserved">this</span>.socket.close();</pre></td></tr>
  <tr><td class="codeShow_order">1575</td><td><pre>			delete <span class="codeReserved">this</span>.socket;</pre></td></tr>
  <tr><td class="codeShow_order">1576</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1577</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1578</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connectOptions.uris && <span class="codeReserved">this</span>.hostIndex &lt; <span class="codeReserved">this</span>.connectOptions.uris.length-1) {</pre></td></tr>
  <tr><td class="codeShow_order">1579</td><td><pre>			<span class="codeComment">// Try the next host.</span></pre></td></tr>
  <tr><td class="codeShow_order">1580</td><td><pre>			<span class="codeReserved">this</span>.hostIndex++;</pre></td></tr>
  <tr><td class="codeShow_order">1581</td><td><pre>			<span class="codeReserved">this</span>._doConnect(<span class="codeReserved">this</span>.connectOptions.uris[<span class="codeReserved">this</span>.hostIndex]);</pre></td></tr>
  <tr><td class="codeShow_order">1582</td><td><pre>		} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">1583</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1584</td><td><pre>			<span class="codeReserved">if</span> (errorCode === undefined) {</pre></td></tr>
  <tr><td class="codeShow_order">1585</td><td><pre>				errorCode = ERROR.OK.code;</pre></td></tr>
  <tr><td class="codeShow_order">1586</td><td><pre>				errorText = format(ERROR.OK);</pre></td></tr>
  <tr><td class="codeShow_order">1587</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">1588</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1589</td><td><pre>			<span class="codeComment">// Run any application callbacks last as they may attempt to reconnect and hence create a new socket.</span></pre></td></tr>
  <tr><td class="codeShow_order">1590</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connected) {</pre></td></tr>
  <tr><td class="codeShow_order">1591</td><td><pre>				<span class="codeReserved">this</span>.connected = <span class="codeReserved">false</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1592</td><td><pre>				<span class="codeComment">// Execute the connectionLostCallback if there is one, and we were connected.</span></pre></td></tr>
  <tr><td class="codeShow_order">1593</td><td><pre>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.onConnectionLost) {</pre></td></tr>
  <tr><td class="codeShow_order">1594</td><td><pre>					<span class="codeReserved">this</span>.onConnectionLost({errorCode:errorCode, errorMessage:errorText, reconnect:<span class="codeReserved">this</span>.connectOptions.reconnect, uri:<span class="codeReserved">this</span>._wsuri});</pre></td></tr>
  <tr><td class="codeShow_order">1595</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">1596</td><td><pre>				<span class="codeReserved">if</span> (errorCode !== ERROR.OK.code && <span class="codeReserved">this</span>.connectOptions.reconnect) {</pre></td></tr>
  <tr><td class="codeShow_order">1597</td><td><pre>					<span class="codeComment">// Start automatic reconnect process for the very first time since last successful connect.</span></pre></td></tr>
  <tr><td class="codeShow_order">1598</td><td><pre>					<span class="codeReserved">this</span>._reconnectInterval = 1;</pre></td></tr>
  <tr><td class="codeShow_order">1599</td><td><pre>					<span class="codeReserved">this</span>._reconnect();</pre></td></tr>
  <tr><td class="codeShow_order">1600</td><td><pre>					<span class="codeReserved">return</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1601</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">1602</td><td><pre>			} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">1603</td><td><pre>				<span class="codeComment">// Otherwise we never had a connection, so indicate that the connect has failed.</span></pre></td></tr>
  <tr><td class="codeShow_order">1604</td><td><pre>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connectOptions.mqttVersion === 4 && <span class="codeReserved">this</span>.connectOptions.mqttVersionExplicit === <span class="codeReserved">false</span>) {</pre></td></tr>
  <tr><td class="codeShow_order">1605</td><td><pre>					<span class="codeReserved">this</span>._trace(<span class="codeString">"Failed <span class="codeReserved">to</span> connect V4, dropping back <span class="codeReserved">to</span> V3"</span>);</pre></td></tr>
  <tr><td class="codeShow_order">1606</td><td><pre>					<span class="codeReserved">this</span>.connectOptions.mqttVersion = 3;</pre></td></tr>
  <tr><td class="codeShow_order">1607</td><td><pre>					<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connectOptions.uris) {</pre></td></tr>
  <tr><td class="codeShow_order">1608</td><td><pre>						<span class="codeReserved">this</span>.hostIndex = 0;</pre></td></tr>
  <tr><td class="codeShow_order">1609</td><td><pre>						<span class="codeReserved">this</span>._doConnect(<span class="codeReserved">this</span>.connectOptions.uris[0]);</pre></td></tr>
  <tr><td class="codeShow_order">1610</td><td><pre>					} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">1611</td><td><pre>						<span class="codeReserved">this</span>._doConnect(<span class="codeReserved">this</span>.uri);</pre></td></tr>
  <tr><td class="codeShow_order">1612</td><td><pre>					}</pre></td></tr>
  <tr><td class="codeShow_order">1613</td><td><pre>				} <span class="codeReserved">else</span> <span class="codeReserved">if</span>(<span class="codeReserved">this</span>.connectOptions.onFailure) {</pre></td></tr>
  <tr><td class="codeShow_order">1614</td><td><pre>					<span class="codeReserved">this</span>.connectOptions.onFailure({invocationContext:<span class="codeReserved">this</span>.connectOptions.invocationContext, errorCode:errorCode, errorMessage:errorText});</pre></td></tr>
  <tr><td class="codeShow_order">1615</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">1616</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">1617</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1618</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1619</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1620</td><td><pre>	<span class="codeComment">/** <span class="codeReserved">@ignore</span> */</span></pre></td></tr>
  <tr><td class="codeShow_order">1621</td><td><pre>	ClientImpl.prototype._trace = <span class="codeReserved">function</span> () {</pre></td></tr>
  <tr><td class="codeShow_order">1622</td><td><pre>		<span class="codeComment">// Pass trace message back to client&#039;s callback function</span></pre></td></tr>
  <tr><td class="codeShow_order">1623</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.traceFunction) {</pre></td></tr>
  <tr><td class="codeShow_order">1624</td><td><pre>			<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i <span class="codeReserved">in</span> arguments)</pre></td></tr>
  <tr><td class="codeShow_order">1625</td><td><pre>			{</pre></td></tr>
  <tr><td class="codeShow_order">1626</td><td><pre>				<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> arguments[i] !== <span class="codeString">"undefined"</span>)</pre></td></tr>
  <tr><td class="codeShow_order">1627</td><td><pre>					arguments.splice(i, 1, JSON.stringify(arguments[i]));</pre></td></tr>
  <tr><td class="codeShow_order">1628</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">1629</td><td><pre>			<span class="codeReserved">var</span> record = Array.prototype.slice.call(arguments).join(<span class="codeString">""</span>);</pre></td></tr>
  <tr><td class="codeShow_order">1630</td><td><pre>			<span class="codeReserved">this</span>.traceFunction ({severity: <span class="codeString">"Debug"</span>, message: record	});</pre></td></tr>
  <tr><td class="codeShow_order">1631</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1632</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1633</td><td><pre>		<span class="codeComment">//buffer style trace</span></pre></td></tr>
  <tr><td class="codeShow_order">1634</td><td><pre>		<span class="codeReserved">if</span> ( <span class="codeReserved">this</span>._traceBuffer !== <span class="codeReserved">null</span> ) {</pre></td></tr>
  <tr><td class="codeShow_order">1635</td><td><pre>			<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i = 0, max = arguments.length; i &lt; max; i++) {</pre></td></tr>
  <tr><td class="codeShow_order">1636</td><td><pre>				<span class="codeReserved">if</span> ( <span class="codeReserved">this</span>._traceBuffer.length == <span class="codeReserved">this</span>._MAX_TRACE_ENTRIES ) {</pre></td></tr>
  <tr><td class="codeShow_order">1637</td><td><pre>					<span class="codeReserved">this</span>._traceBuffer.shift();</pre></td></tr>
  <tr><td class="codeShow_order">1638</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">1639</td><td><pre>				<span class="codeReserved">if</span> (i === 0) <span class="codeReserved">this</span>._traceBuffer.push(arguments[i]);</pre></td></tr>
  <tr><td class="codeShow_order">1640</td><td><pre>				<span class="codeReserved">else</span> <span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> arguments[i] === <span class="codeString">"undefined"</span> ) <span class="codeReserved">this</span>._traceBuffer.push(arguments[i]);</pre></td></tr>
  <tr><td class="codeShow_order">1641</td><td><pre>				<span class="codeReserved">else</span> <span class="codeReserved">this</span>._traceBuffer.push(<span class="codeString">"  "</span>+JSON.stringify(arguments[i]));</pre></td></tr>
  <tr><td class="codeShow_order">1642</td><td><pre>		   }</pre></td></tr>
  <tr><td class="codeShow_order">1643</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1644</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1645</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1646</td><td><pre>	<span class="codeComment">/** <span class="codeReserved">@ignore</span> */</span></pre></td></tr>
  <tr><td class="codeShow_order">1647</td><td><pre>	ClientImpl.prototype._traceMask = <span class="codeReserved">function</span> (traceObject, masked) {</pre></td></tr>
  <tr><td class="codeShow_order">1648</td><td><pre>		<span class="codeReserved">var</span> traceObjectMasked = {};</pre></td></tr>
  <tr><td class="codeShow_order">1649</td><td><pre>		<span class="codeReserved">for</span> (<span class="codeReserved">var</span> attr <span class="codeReserved">in</span> traceObject) {</pre></td></tr>
  <tr><td class="codeShow_order">1650</td><td><pre>			<span class="codeReserved">if</span> (traceObject.hasOwnProperty(attr)) {</pre></td></tr>
  <tr><td class="codeShow_order">1651</td><td><pre>				<span class="codeReserved">if</span> (attr == masked)</pre></td></tr>
  <tr><td class="codeShow_order">1652</td><td><pre>					traceObjectMasked[attr] = <span class="codeString">"******"</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1653</td><td><pre>				<span class="codeReserved">else</span></pre></td></tr>
  <tr><td class="codeShow_order">1654</td><td><pre>					traceObjectMasked[attr] = traceObject[attr];</pre></td></tr>
  <tr><td class="codeShow_order">1655</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">1656</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1657</td><td><pre>		<span class="codeReserved">return</span> traceObjectMasked;</pre></td></tr>
  <tr><td class="codeShow_order">1658</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">1659</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1660</td><td><pre>	<span class="codeComment">// ------------------------------------------------------------------------</span></pre></td></tr>
  <tr><td class="codeShow_order">1661</td><td><pre>	<span class="codeComment">// Public Programming interface.</span></pre></td></tr>
  <tr><td class="codeShow_order">1662</td><td><pre>	<span class="codeComment">// ------------------------------------------------------------------------</span></pre></td></tr>
  <tr><td class="codeShow_order">1663</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1664</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">1665</td><td><pre><span class="codeComment">	 * The JavaScript application communicates <span class="codeReserved">to</span> the server using a {<span class="codeReserved">@link</span> Paho.MQTT.Client} object.</span></pre></td></tr>
  <tr><td class="codeShow_order">1666</td><td><pre><span class="codeComment">	 * &lt;p&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1667</td><td><pre><span class="codeComment">	 * Most applications will create just one Client object and then call its connect() method,</span></pre></td></tr>
  <tr><td class="codeShow_order">1668</td><td><pre><span class="codeComment">	 * however applications can create more than one Client object <span class="codeReserved">if</span> they wish.</span></pre></td></tr>
  <tr><td class="codeShow_order">1669</td><td><pre><span class="codeComment">	 * In <span class="codeReserved">this</span> <span class="codeReserved">case</span> the combination of host, port and clientId attributes must be different <span class="codeReserved">for</span> each Client object.</span></pre></td></tr>
  <tr><td class="codeShow_order">1670</td><td><pre><span class="codeComment">	 * &lt;p&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1671</td><td><pre><span class="codeComment">	 * The send, subscribe and unsubscribe methods are implemented <span class="codeReserved">as</span> asynchronous JavaScript methods</span></pre></td></tr>
  <tr><td class="codeShow_order">1672</td><td><pre><span class="codeComment">	 * (even though the underlying protocol exchange might be synchronous <span class="codeReserved">in</span> nature).</span></pre></td></tr>
  <tr><td class="codeShow_order">1673</td><td><pre><span class="codeComment">	 * This means they signal their completion by calling back <span class="codeReserved">to</span> the application,</span></pre></td></tr>
  <tr><td class="codeShow_order">1674</td><td><pre><span class="codeComment">	 * via Success or Failure callback functions provided by the application on the method <span class="codeReserved">in</span> question.</span></pre></td></tr>
  <tr><td class="codeShow_order">1675</td><td><pre><span class="codeComment">	 * Such callbacks are called at most once per method invocation and <span class="codeReserved">do</span> not persist beyond the lifetime</span></pre></td></tr>
  <tr><td class="codeShow_order">1676</td><td><pre><span class="codeComment">	 * of the script that made the invocation.</span></pre></td></tr>
  <tr><td class="codeShow_order">1677</td><td><pre><span class="codeComment">	 * &lt;p&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1678</td><td><pre><span class="codeComment">	 * In contrast there are some callback functions, most notably &lt;i&gt;onMessageArrived&lt;/i&gt;,</span></pre></td></tr>
  <tr><td class="codeShow_order">1679</td><td><pre><span class="codeComment">	 * that are defined on the {<span class="codeReserved">@link</span> Paho.MQTT.Client} object.</span></pre></td></tr>
  <tr><td class="codeShow_order">1680</td><td><pre><span class="codeComment">	 * These may get called multiple times, and aren&#039;t directly related <span class="codeReserved">to</span> specific method invocations made by the client.</span></pre></td></tr>
  <tr><td class="codeShow_order">1681</td><td><pre><span class="codeComment">	 *</span></pre></td></tr>
  <tr><td class="codeShow_order">1682</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@name</span> Paho.MQTT.Client</span></pre></td></tr>
  <tr><td class="codeShow_order">1683</td><td><pre><span class="codeComment">	 *</span></pre></td></tr>
  <tr><td class="codeShow_order">1684</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@constructor</span></span></pre></td></tr>
  <tr><td class="codeShow_order">1685</td><td><pre><span class="codeComment">	 *</span></pre></td></tr>
  <tr><td class="codeShow_order">1686</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> {string} host - the address of the messaging server, <span class="codeReserved">as</span> a fully qualified WebSocket URI, <span class="codeReserved">as</span> a DNS name or dotted decimal IP address.</span></pre></td></tr>
  <tr><td class="codeShow_order">1687</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> {number} port - the port number <span class="codeReserved">to</span> connect <span class="codeReserved">to</span> - only required <span class="codeReserved">if</span> host is not a URI</span></pre></td></tr>
  <tr><td class="codeShow_order">1688</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> {string} path - the path on the host <span class="codeReserved">to</span> connect <span class="codeReserved">to</span> - only used <span class="codeReserved">if</span> host is not a URI. Default: &#039;/mqtt&#039;.</span></pre></td></tr>
  <tr><td class="codeShow_order">1689</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> {string} clientId - the Messaging client identifier, between 1 and 23 characters <span class="codeReserved">in</span> length.</span></pre></td></tr>
  <tr><td class="codeShow_order">1690</td><td><pre><span class="codeComment">	 *</span></pre></td></tr>
  <tr><td class="codeShow_order">1691</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@property</span> {string} host - &lt;i&gt;read only&lt;/i&gt; the server&#039;s DNS hostname or dotted decimal IP address.</span></pre></td></tr>
  <tr><td class="codeShow_order">1692</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@property</span> {number} port - &lt;i&gt;read only&lt;/i&gt; the server&#039;s port.</span></pre></td></tr>
  <tr><td class="codeShow_order">1693</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@property</span> {string} path - &lt;i&gt;read only&lt;/i&gt; the server&#039;s path.</span></pre></td></tr>
  <tr><td class="codeShow_order">1694</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@property</span> {string} clientId - &lt;i&gt;read only&lt;/i&gt; used when connecting <span class="codeReserved">to</span> the server.</span></pre></td></tr>
  <tr><td class="codeShow_order">1695</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@property</span> {<span class="codeReserved">function</span>} onConnectionLost - called when a connection has been lost.</span></pre></td></tr>
  <tr><td class="codeShow_order">1696</td><td><pre><span class="codeComment">	 *                            after a connect() method has succeeded.</span></pre></td></tr>
  <tr><td class="codeShow_order">1697</td><td><pre><span class="codeComment">	 *                            Establish the call back used when a connection has been lost. The connection may be</span></pre></td></tr>
  <tr><td class="codeShow_order">1698</td><td><pre><span class="codeComment">	 *                            lost because the client initiates a disconnect or because the server or network</span></pre></td></tr>
  <tr><td class="codeShow_order">1699</td><td><pre><span class="codeComment">	 *                            cause the client <span class="codeReserved">to</span> be disconnected. The disconnect call back may be called without</span></pre></td></tr>
  <tr><td class="codeShow_order">1700</td><td><pre><span class="codeComment">	 *                            the connectionComplete call back being invoked <span class="codeReserved">if</span>, <span class="codeReserved">for</span> example the client fails <span class="codeReserved">to</span></span></pre></td></tr>
  <tr><td class="codeShow_order">1701</td><td><pre><span class="codeComment">	 *                            connect.</span></pre></td></tr>
  <tr><td class="codeShow_order">1702</td><td><pre><span class="codeComment">	 *                            A single response object parameter is passed <span class="codeReserved">to</span> the onConnectionLost callback containing the following fields:</span></pre></td></tr>
  <tr><td class="codeShow_order">1703</td><td><pre><span class="codeComment">	 *                            &lt;ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1704</td><td><pre><span class="codeComment">	 *                            &lt;li&gt;errorCode</span></pre></td></tr>
  <tr><td class="codeShow_order">1705</td><td><pre><span class="codeComment">	 *                            &lt;li&gt;errorMessage</span></pre></td></tr>
  <tr><td class="codeShow_order">1706</td><td><pre><span class="codeComment">	 *                            &lt;/ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1707</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@property</span> {<span class="codeReserved">function</span>} onMessageDelivered - called when a message has been delivered.</span></pre></td></tr>
  <tr><td class="codeShow_order">1708</td><td><pre><span class="codeComment">	 *                            All processing that <span class="codeReserved">this</span> Client will ever <span class="codeReserved">do</span> has been completed. So, <span class="codeReserved">for</span> example,</span></pre></td></tr>
  <tr><td class="codeShow_order">1709</td><td><pre><span class="codeComment">	 *                            <span class="codeReserved">in</span> the <span class="codeReserved">case</span> of a Qos=2 message sent by <span class="codeReserved">this</span> client, the PubComp flow has been received <span class="codeReserved">from</span> the server</span></pre></td></tr>
  <tr><td class="codeShow_order">1710</td><td><pre><span class="codeComment">	 *                            and the message has been removed <span class="codeReserved">from</span> persistent storage before <span class="codeReserved">this</span> callback is invoked.</span></pre></td></tr>
  <tr><td class="codeShow_order">1711</td><td><pre><span class="codeComment">	 *                            Parameters passed <span class="codeReserved">to</span> the onMessageDelivered callback are:</span></pre></td></tr>
  <tr><td class="codeShow_order">1712</td><td><pre><span class="codeComment">	 *                            &lt;ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1713</td><td><pre><span class="codeComment">	 *                            &lt;li&gt;{<span class="codeReserved">@link</span> Paho.MQTT.Message} that was delivered.</span></pre></td></tr>
  <tr><td class="codeShow_order">1714</td><td><pre><span class="codeComment">	 *                            &lt;/ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1715</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@property</span> {<span class="codeReserved">function</span>} onMessageArrived - called when a message has arrived <span class="codeReserved">in</span> <span class="codeReserved">this</span> Paho.MQTT.client.</span></pre></td></tr>
  <tr><td class="codeShow_order">1716</td><td><pre><span class="codeComment">	 *                            Parameters passed <span class="codeReserved">to</span> the onMessageArrived callback are:</span></pre></td></tr>
  <tr><td class="codeShow_order">1717</td><td><pre><span class="codeComment">	 *                            &lt;ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1718</td><td><pre><span class="codeComment">	 *                            &lt;li&gt;{<span class="codeReserved">@link</span> Paho.MQTT.Message} that has arrived.</span></pre></td></tr>
  <tr><td class="codeShow_order">1719</td><td><pre><span class="codeComment">	 *                            &lt;/ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1720</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@property</span> {<span class="codeReserved">function</span>} onConnected - called when a connection is successfully made <span class="codeReserved">to</span> the server.</span></pre></td></tr>
  <tr><td class="codeShow_order">1721</td><td><pre><span class="codeComment">	 *                                  after a connect() method.</span></pre></td></tr>
  <tr><td class="codeShow_order">1722</td><td><pre><span class="codeComment">	 *                                  Parameters passed <span class="codeReserved">to</span> the onConnected callback are:</span></pre></td></tr>
  <tr><td class="codeShow_order">1723</td><td><pre><span class="codeComment">	 *                                  &lt;ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1724</td><td><pre><span class="codeComment">	 *                                  &lt;li&gt;reconnect (boolean) - If <span class="codeReserved">true</span>, the connection was the result of a reconnect.&lt;/li&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1725</td><td><pre><span class="codeComment">	 *                                  &lt;li&gt;URI (string) - The URI used <span class="codeReserved">to</span> connect <span class="codeReserved">to</span> the server.&lt;/li&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1726</td><td><pre><span class="codeComment">	 *                                  &lt;/ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1727</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@property</span> {boolean} disconnectedPublishing - <span class="codeReserved">if</span> set, will enable disconnected publishing <span class="codeReserved">in</span></span></pre></td></tr>
  <tr><td class="codeShow_order">1728</td><td><pre><span class="codeComment">	 *                                            <span class="codeReserved">in</span> the event that the connection <span class="codeReserved">to</span> the server is lost.</span></pre></td></tr>
  <tr><td class="codeShow_order">1729</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@property</span> {number} disconnectedBufferSize - Used <span class="codeReserved">to</span> set the maximum number of messages that the disconnected</span></pre></td></tr>
  <tr><td class="codeShow_order">1730</td><td><pre><span class="codeComment">	 *                                             buffer will hold before rejecting <span class="codeReserved">new</span> messages. Default size: 5000 messages</span></pre></td></tr>
  <tr><td class="codeShow_order">1731</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@property</span> {<span class="codeReserved">function</span>} trace - called whenever trace is called. TODO</span></pre></td></tr>
  <tr><td class="codeShow_order">1732</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">1733</td><td><pre>	<span class="codeReserved">var</span> Client = <span class="codeReserved">function</span> (host, port, path, clientId) {</pre></td></tr>
  <tr><td class="codeShow_order">1734</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1735</td><td><pre>	    <span class="codeReserved">var</span> uri;</pre></td></tr>
  <tr><td class="codeShow_order">1736</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1737</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> host !== <span class="codeString">"string"</span>)</pre></td></tr>
  <tr><td class="codeShow_order">1738</td><td><pre>			<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> host, <span class="codeString">"host"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1739</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1740</td><td><pre>	    <span class="codeReserved">if</span> (arguments.length == 2) {</pre></td></tr>
  <tr><td class="codeShow_order">1741</td><td><pre>	        <span class="codeComment">// host: must be full ws:// uri</span></pre></td></tr>
  <tr><td class="codeShow_order">1742</td><td><pre>	        <span class="codeComment">// port: clientId</span></pre></td></tr>
  <tr><td class="codeShow_order">1743</td><td><pre>	        clientId = port;</pre></td></tr>
  <tr><td class="codeShow_order">1744</td><td><pre>	        uri = host;</pre></td></tr>
  <tr><td class="codeShow_order">1745</td><td><pre>	        <span class="codeReserved">var</span> match = uri.match(<span class="codeString">/^(wss?):\/</span>\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/);</pre></td></tr>
  <tr><td class="codeShow_order">1746</td><td><pre>	        <span class="codeReserved">if</span> (match) {</pre></td></tr>
  <tr><td class="codeShow_order">1747</td><td><pre>	            host = match[4]||match[2];</pre></td></tr>
  <tr><td class="codeShow_order">1748</td><td><pre>	            port = parseInt(match[7]);</pre></td></tr>
  <tr><td class="codeShow_order">1749</td><td><pre>	            path = match[8];</pre></td></tr>
  <tr><td class="codeShow_order">1750</td><td><pre>	        } <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">1751</td><td><pre>	            <span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT,[host,<span class="codeString">"host"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1752</td><td><pre>	        }</pre></td></tr>
  <tr><td class="codeShow_order">1753</td><td><pre>	    } <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">1754</td><td><pre>	        <span class="codeReserved">if</span> (arguments.length == 3) {</pre></td></tr>
  <tr><td class="codeShow_order">1755</td><td><pre>				clientId = path;</pre></td></tr>
  <tr><td class="codeShow_order">1756</td><td><pre>				path = <span class="codeString">"/mqtt"</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1757</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">1758</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> port !== <span class="codeString">"number"</span> || port &lt; 0)</pre></td></tr>
  <tr><td class="codeShow_order">1759</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> port, <span class="codeString">"port"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1760</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> path !== <span class="codeString">"string"</span>)</pre></td></tr>
  <tr><td class="codeShow_order">1761</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> path, <span class="codeString">"path"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1762</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1763</td><td><pre>			<span class="codeReserved">var</span> ipv6AddSBracket = (host.indexOf(<span class="codeString">":"</span>) !== -1 && host.slice(0,1) !== <span class="codeString">"["</span> && host.slice(-1) !== <span class="codeString">"]"</span>);</pre></td></tr>
  <tr><td class="codeShow_order">1764</td><td><pre>			uri = <span class="codeString">"ws://"</span>+(ipv6AddSBracket?<span class="codeString">"["</span>+host+<span class="codeString">"]"</span>:host)+<span class="codeString">":"</span>+port+path;</pre></td></tr>
  <tr><td class="codeShow_order">1765</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1766</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1767</td><td><pre>		<span class="codeReserved">var</span> clientIdLength = 0;</pre></td></tr>
  <tr><td class="codeShow_order">1768</td><td><pre>		<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i = 0; i&lt;<span class="codeReserved">clientId</span>.length; i++) {</pre></td></tr>
  <tr><td class="codeShow_order">1769</td><td><pre>			<span class="codeReserved">var</span> charCode = clientId.charCodeAt(i);</pre></td></tr>
  <tr><td class="codeShow_order">1770</td><td><pre>			<span class="codeReserved">if</span> (0xD800 &lt;= charCode && charCode &lt;= 0xDBFF)  {</pre></td></tr>
  <tr><td class="codeShow_order">1771</td><td><pre>				 i++; <span class="codeComment">// Surrogate pair.</span></pre></td></tr>
  <tr><td class="codeShow_order">1772</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">1773</td><td><pre>			clientIdLength++;</pre></td></tr>
  <tr><td class="codeShow_order">1774</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">1775</td><td><pre>		<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> clientId !== <span class="codeString">"string"</span> || clientIdLength &gt; 65535)</pre></td></tr>
  <tr><td class="codeShow_order">1776</td><td><pre>			<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [clientId, <span class="codeString">"clientId"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1777</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1778</td><td><pre>		<span class="codeReserved">var</span> client = <span class="codeReserved">new</span> ClientImpl(uri, host, port, path, clientId);</pre></td></tr>
  <tr><td class="codeShow_order">1779</td><td><pre>		<span class="codeReserved">this</span>._getHost =  <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> host; };</pre></td></tr>
  <tr><td class="codeShow_order">1780</td><td><pre>		<span class="codeReserved">this</span>._setHost = <span class="codeReserved">function</span>() { <span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.UNSUPPORTED_OPERATION)); };</pre></td></tr>
  <tr><td class="codeShow_order">1781</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1782</td><td><pre>		<span class="codeReserved">this</span>._getPort = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> port; };</pre></td></tr>
  <tr><td class="codeShow_order">1783</td><td><pre>		<span class="codeReserved">this</span>._setPort = <span class="codeReserved">function</span>() { <span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.UNSUPPORTED_OPERATION)); };</pre></td></tr>
  <tr><td class="codeShow_order">1784</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1785</td><td><pre>		<span class="codeReserved">this</span>._getPath = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> path; };</pre></td></tr>
  <tr><td class="codeShow_order">1786</td><td><pre>		<span class="codeReserved">this</span>._setPath = <span class="codeReserved">function</span>() { <span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.UNSUPPORTED_OPERATION)); };</pre></td></tr>
  <tr><td class="codeShow_order">1787</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1788</td><td><pre>		<span class="codeReserved">this</span>._getURI = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> uri; };</pre></td></tr>
  <tr><td class="codeShow_order">1789</td><td><pre>		<span class="codeReserved">this</span>._setURI = <span class="codeReserved">function</span>() { <span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.UNSUPPORTED_OPERATION)); };</pre></td></tr>
  <tr><td class="codeShow_order">1790</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1791</td><td><pre>		<span class="codeReserved">this</span>._getClientId = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> client.clientId; };</pre></td></tr>
  <tr><td class="codeShow_order">1792</td><td><pre>		<span class="codeReserved">this</span>._setClientId = <span class="codeReserved">function</span>() { <span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.UNSUPPORTED_OPERATION)); };</pre></td></tr>
  <tr><td class="codeShow_order">1793</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1794</td><td><pre>		<span class="codeReserved">this</span>._getOnConnected = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> client.onConnected; };</pre></td></tr>
  <tr><td class="codeShow_order">1795</td><td><pre>		<span class="codeReserved">this</span>._setOnConnected = <span class="codeReserved">function</span>(newOnConnected) {</pre></td></tr>
  <tr><td class="codeShow_order">1796</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> newOnConnected === <span class="codeString">"<span class="codeReserved">function</span>"</span>)</pre></td></tr>
  <tr><td class="codeShow_order">1797</td><td><pre>				client.onConnected = newOnConnected;</pre></td></tr>
  <tr><td class="codeShow_order">1798</td><td><pre>			<span class="codeReserved">else</span></pre></td></tr>
  <tr><td class="codeShow_order">1799</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> newOnConnected, <span class="codeString">"onConnected"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1800</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">1801</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1802</td><td><pre>		<span class="codeReserved">this</span>._getDisconnectedPublishing = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> client.disconnectedPublishing; };</pre></td></tr>
  <tr><td class="codeShow_order">1803</td><td><pre>		<span class="codeReserved">this</span>._setDisconnectedPublishing = <span class="codeReserved">function</span>(newDisconnectedPublishing) {</pre></td></tr>
  <tr><td class="codeShow_order">1804</td><td><pre>			client.disconnectedPublishing = newDisconnectedPublishing;</pre></td></tr>
  <tr><td class="codeShow_order">1805</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">1806</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1807</td><td><pre>		<span class="codeReserved">this</span>._getDisconnectedBufferSize = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> client.disconnectedBufferSize; };</pre></td></tr>
  <tr><td class="codeShow_order">1808</td><td><pre>		<span class="codeReserved">this</span>._setDisconnectedBufferSize = <span class="codeReserved">function</span>(newDisconnectedBufferSize) {</pre></td></tr>
  <tr><td class="codeShow_order">1809</td><td><pre>			client.disconnectedBufferSize = newDisconnectedBufferSize;</pre></td></tr>
  <tr><td class="codeShow_order">1810</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">1811</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1812</td><td><pre>		<span class="codeReserved">this</span>._getOnConnectionLost = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> client.onConnectionLost; };</pre></td></tr>
  <tr><td class="codeShow_order">1813</td><td><pre>		<span class="codeReserved">this</span>._setOnConnectionLost = <span class="codeReserved">function</span>(newOnConnectionLost) {</pre></td></tr>
  <tr><td class="codeShow_order">1814</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> newOnConnectionLost === <span class="codeString">"<span class="codeReserved">function</span>"</span>)</pre></td></tr>
  <tr><td class="codeShow_order">1815</td><td><pre>				client.onConnectionLost = newOnConnectionLost;</pre></td></tr>
  <tr><td class="codeShow_order">1816</td><td><pre>			<span class="codeReserved">else</span></pre></td></tr>
  <tr><td class="codeShow_order">1817</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> newOnConnectionLost, <span class="codeString">"onConnectionLost"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1818</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">1819</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1820</td><td><pre>		<span class="codeReserved">this</span>._getOnMessageDelivered = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> client.onMessageDelivered; };</pre></td></tr>
  <tr><td class="codeShow_order">1821</td><td><pre>		<span class="codeReserved">this</span>._setOnMessageDelivered = <span class="codeReserved">function</span>(newOnMessageDelivered) {</pre></td></tr>
  <tr><td class="codeShow_order">1822</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> newOnMessageDelivered === <span class="codeString">"<span class="codeReserved">function</span>"</span>)</pre></td></tr>
  <tr><td class="codeShow_order">1823</td><td><pre>				client.onMessageDelivered = newOnMessageDelivered;</pre></td></tr>
  <tr><td class="codeShow_order">1824</td><td><pre>			<span class="codeReserved">else</span></pre></td></tr>
  <tr><td class="codeShow_order">1825</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> newOnMessageDelivered, <span class="codeString">"onMessageDelivered"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1826</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">1827</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1828</td><td><pre>		<span class="codeReserved">this</span>._getOnMessageArrived = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> client.onMessageArrived; };</pre></td></tr>
  <tr><td class="codeShow_order">1829</td><td><pre>		<span class="codeReserved">this</span>._setOnMessageArrived = <span class="codeReserved">function</span>(newOnMessageArrived) {</pre></td></tr>
  <tr><td class="codeShow_order">1830</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> newOnMessageArrived === <span class="codeString">"<span class="codeReserved">function</span>"</span>)</pre></td></tr>
  <tr><td class="codeShow_order">1831</td><td><pre>				client.onMessageArrived = newOnMessageArrived;</pre></td></tr>
  <tr><td class="codeShow_order">1832</td><td><pre>			<span class="codeReserved">else</span></pre></td></tr>
  <tr><td class="codeShow_order">1833</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> newOnMessageArrived, <span class="codeString">"onMessageArrived"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1834</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">1835</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1836</td><td><pre>		<span class="codeReserved">this</span>._getTrace = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> client.traceFunction; };</pre></td></tr>
  <tr><td class="codeShow_order">1837</td><td><pre>		<span class="codeReserved">this</span>._setTrace = <span class="codeReserved">function</span>(trace) {</pre></td></tr>
  <tr><td class="codeShow_order">1838</td><td><pre>			<span class="codeReserved">if</span>(<span class="codeReserved">typeof</span> trace === <span class="codeString">"<span class="codeReserved">function</span>"</span>){</pre></td></tr>
  <tr><td class="codeShow_order">1839</td><td><pre>				client.traceFunction = trace;</pre></td></tr>
  <tr><td class="codeShow_order">1840</td><td><pre>			}<span class="codeReserved">else</span>{</pre></td></tr>
  <tr><td class="codeShow_order">1841</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> trace, <span class="codeString">"onTrace"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1842</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">1843</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">1844</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1845</td><td><pre>		<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">1846</td><td><pre><span class="codeComment">		 * Connect <span class="codeReserved">this</span> Messaging client <span class="codeReserved">to</span> its server.</span></pre></td></tr>
  <tr><td class="codeShow_order">1847</td><td><pre><span class="codeComment">		 *</span></pre></td></tr>
  <tr><td class="codeShow_order">1848</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@name</span> Paho.MQTT.Client#connect</span></pre></td></tr>
  <tr><td class="codeShow_order">1849</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@function</span></span></pre></td></tr>
  <tr><td class="codeShow_order">1850</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {object} connectOptions - Attributes used with the connection.</span></pre></td></tr>
  <tr><td class="codeShow_order">1851</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {number} connectOptions.timeout - If the connect has not succeeded within <span class="codeReserved">this</span></span></pre></td></tr>
  <tr><td class="codeShow_order">1852</td><td><pre><span class="codeComment">		 *                    number of seconds, it is deemed <span class="codeReserved">to</span> have failed.</span></pre></td></tr>
  <tr><td class="codeShow_order">1853</td><td><pre><span class="codeComment">		 *                    The <span class="codeReserved">default</span> is 30 seconds.</span></pre></td></tr>
  <tr><td class="codeShow_order">1854</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {string} connectOptions.userName - Authentication username <span class="codeReserved">for</span> <span class="codeReserved">this</span> connection.</span></pre></td></tr>
  <tr><td class="codeShow_order">1855</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {string} connectOptions.password - Authentication password <span class="codeReserved">for</span> <span class="codeReserved">this</span> connection.</span></pre></td></tr>
  <tr><td class="codeShow_order">1856</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {Paho.MQTT.Message} connectOptions.willMessage - sent by the server when the client</span></pre></td></tr>
  <tr><td class="codeShow_order">1857</td><td><pre><span class="codeComment">		 *                    disconnects abnormally.</span></pre></td></tr>
  <tr><td class="codeShow_order">1858</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {number} connectOptions.keepAliveInterval - the server disconnects <span class="codeReserved">this</span> client <span class="codeReserved">if</span></span></pre></td></tr>
  <tr><td class="codeShow_order">1859</td><td><pre><span class="codeComment">		 *                    there is no activity <span class="codeReserved">for</span> <span class="codeReserved">this</span> number of seconds.</span></pre></td></tr>
  <tr><td class="codeShow_order">1860</td><td><pre><span class="codeComment">		 *                    The <span class="codeReserved">default</span> value of 60 seconds is assumed <span class="codeReserved">if</span> not set.</span></pre></td></tr>
  <tr><td class="codeShow_order">1861</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {boolean} connectOptions.cleanSession - <span class="codeReserved">if</span> <span class="codeReserved">true</span>(<span class="codeReserved">default</span>) the client and server</span></pre></td></tr>
  <tr><td class="codeShow_order">1862</td><td><pre><span class="codeComment">		 *                    persistent state is deleted on successful connect.</span></pre></td></tr>
  <tr><td class="codeShow_order">1863</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {boolean} connectOptions.useSSL - <span class="codeReserved">if</span> present and <span class="codeReserved">true</span>, use an SSL Websocket connection.</span></pre></td></tr>
  <tr><td class="codeShow_order">1864</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {object} connectOptions.invocationContext - passed <span class="codeReserved">to</span> the onSuccess callback or onFailure callback.</span></pre></td></tr>
  <tr><td class="codeShow_order">1865</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {<span class="codeReserved">function</span>} connectOptions.onSuccess - called when the connect acknowledgement</span></pre></td></tr>
  <tr><td class="codeShow_order">1866</td><td><pre><span class="codeComment">		 *                    has been received <span class="codeReserved">from</span> the server.</span></pre></td></tr>
  <tr><td class="codeShow_order">1867</td><td><pre><span class="codeComment">		 * A single response object parameter is passed <span class="codeReserved">to</span> the onSuccess callback containing the following fields:</span></pre></td></tr>
  <tr><td class="codeShow_order">1868</td><td><pre><span class="codeComment">		 * &lt;ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1869</td><td><pre><span class="codeComment">		 * &lt;li&gt;invocationContext <span class="codeReserved">as</span> passed <span class="codeReserved">in</span> <span class="codeReserved">to</span> the onSuccess method <span class="codeReserved">in</span> the connectOptions.</span></pre></td></tr>
  <tr><td class="codeShow_order">1870</td><td><pre><span class="codeComment">		 * &lt;/ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1871</td><td><pre><span class="codeComment">     * <span class="codeReserved">@param</span> {<span class="codeReserved">function</span>} connectOptions.onFailure - called when the connect request has failed or timed out.</span></pre></td></tr>
  <tr><td class="codeShow_order">1872</td><td><pre><span class="codeComment">		 * A single response object parameter is passed <span class="codeReserved">to</span> the onFailure callback containing the following fields:</span></pre></td></tr>
  <tr><td class="codeShow_order">1873</td><td><pre><span class="codeComment">		 * &lt;ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1874</td><td><pre><span class="codeComment">		 * &lt;li&gt;invocationContext <span class="codeReserved">as</span> passed <span class="codeReserved">in</span> <span class="codeReserved">to</span> the onFailure method <span class="codeReserved">in</span> the connectOptions.</span></pre></td></tr>
  <tr><td class="codeShow_order">1875</td><td><pre><span class="codeComment">		 * &lt;li&gt;errorCode a number indicating the nature of the error.</span></pre></td></tr>
  <tr><td class="codeShow_order">1876</td><td><pre><span class="codeComment">		 * &lt;li&gt;errorMessage text describing the error.</span></pre></td></tr>
  <tr><td class="codeShow_order">1877</td><td><pre><span class="codeComment">		 * &lt;/ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1878</td><td><pre><span class="codeComment">     * <span class="codeReserved">@param</span> {array} connectOptions.hosts - If present <span class="codeReserved">this</span> contains either a set of hostnames or fully qualified</span></pre></td></tr>
  <tr><td class="codeShow_order">1879</td><td><pre><span class="codeComment">		 * WebSocket URIs (ws://iot.eclipse.org:80/ws), that are tried <span class="codeReserved">in</span> order <span class="codeReserved">in</span> place</span></pre></td></tr>
  <tr><td class="codeShow_order">1880</td><td><pre><span class="codeComment">		 * of the host and port paramater on the construtor. The hosts are tried one at at time <span class="codeReserved">in</span> order until</span></pre></td></tr>
  <tr><td class="codeShow_order">1881</td><td><pre><span class="codeComment">		 * one of then succeeds.</span></pre></td></tr>
  <tr><td class="codeShow_order">1882</td><td><pre><span class="codeComment">     * <span class="codeReserved">@param</span> {array} connectOptions.ports - If present the set of ports matching the hosts. If hosts contains URIs, <span class="codeReserved">this</span> property</span></pre></td></tr>
  <tr><td class="codeShow_order">1883</td><td><pre><span class="codeComment">		 * is not used.</span></pre></td></tr>
  <tr><td class="codeShow_order">1884</td><td><pre><span class="codeComment">     * <span class="codeReserved">@param</span> {boolean} connectOptions.reconnect - Sets whether the client will automatically attempt <span class="codeReserved">to</span> reconnect</span></pre></td></tr>
  <tr><td class="codeShow_order">1885</td><td><pre><span class="codeComment">     * <span class="codeReserved">to</span> the server <span class="codeReserved">if</span> the connection is lost.</span></pre></td></tr>
  <tr><td class="codeShow_order">1886</td><td><pre><span class="codeComment">     *&lt;ul&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1887</td><td><pre><span class="codeComment">     *&lt;li&gt;If set <span class="codeReserved">to</span> <span class="codeReserved">false</span>, the client will not attempt <span class="codeReserved">to</span> automatically reconnect <span class="codeReserved">to</span> the server <span class="codeReserved">in</span> the event that the</span></pre></td></tr>
  <tr><td class="codeShow_order">1888</td><td><pre><span class="codeComment">     * connection is lost.&lt;/li&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1889</td><td><pre><span class="codeComment">     *&lt;li&gt;If set <span class="codeReserved">to</span> <span class="codeReserved">true</span>, <span class="codeReserved">in</span> the event that the connection is lost, the client will attempt <span class="codeReserved">to</span> reconnect <span class="codeReserved">to</span> the server.</span></pre></td></tr>
  <tr><td class="codeShow_order">1890</td><td><pre><span class="codeComment">     * It will initially wait 1 second before it attempts <span class="codeReserved">to</span> reconnect, <span class="codeReserved">for</span> every failed reconnect attempt, the delay</span></pre></td></tr>
  <tr><td class="codeShow_order">1891</td><td><pre><span class="codeComment">     * will double until it is at 2 minutes at which point the delay will stay at 2 minutes.&lt;/li&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1892</td><td><pre><span class="codeComment">     *&lt;/ul&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1893</td><td><pre><span class="codeComment">     * <span class="codeReserved">@param</span> {number} connectOptions.mqttVersion - The version of MQTT <span class="codeReserved">to</span> use <span class="codeReserved">to</span> connect <span class="codeReserved">to</span> the MQTT Broker.</span></pre></td></tr>
  <tr><td class="codeShow_order">1894</td><td><pre><span class="codeComment">     *&lt;ul&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1895</td><td><pre><span class="codeComment">     *&lt;li&gt;3 - MQTT V3.1&lt;/li&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1896</td><td><pre><span class="codeComment">     *&lt;li&gt;4 - MQTT V3.1.1&lt;/li&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1897</td><td><pre><span class="codeComment">     *&lt;/ul&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">1898</td><td><pre><span class="codeComment">     * <span class="codeReserved">@param</span> {boolean} connectOptions.mqttVersionExplicit - If set <span class="codeReserved">to</span> <span class="codeReserved">true</span>, will force the connection <span class="codeReserved">to</span> use the</span></pre></td></tr>
  <tr><td class="codeShow_order">1899</td><td><pre><span class="codeComment">     * selected MQTT Version or will fail <span class="codeReserved">to</span> connect.</span></pre></td></tr>
  <tr><td class="codeShow_order">1900</td><td><pre><span class="codeComment">     * <span class="codeReserved">@param</span> {array} connectOptions.uris - If present, should contain a list of fully qualified WebSocket uris</span></pre></td></tr>
  <tr><td class="codeShow_order">1901</td><td><pre><span class="codeComment">     * (e.g. ws://iot.eclipse.org:80/ws), that are tried <span class="codeReserved">in</span> order <span class="codeReserved">in</span> place of the host and port parameter of the construtor.</span></pre></td></tr>
  <tr><td class="codeShow_order">1902</td><td><pre><span class="codeComment">     * The uris are tried one at a time <span class="codeReserved">in</span> order until one of them succeeds. Do not use <span class="codeReserved">this</span> <span class="codeReserved">in</span> conjunction with hosts <span class="codeReserved">as</span></span></pre></td></tr>
  <tr><td class="codeShow_order">1903</td><td><pre><span class="codeComment">     * the hosts array will be converted <span class="codeReserved">to</span> uris and will overwrite <span class="codeReserved">this</span> property.</span></pre></td></tr>
  <tr><td class="codeShow_order">1904</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@throws</span> {InvalidState} If the client is not <span class="codeReserved">in</span> disconnected state. The client must have received connectionLost</span></pre></td></tr>
  <tr><td class="codeShow_order">1905</td><td><pre><span class="codeComment">		 * or disconnected before calling connect <span class="codeReserved">for</span> a second or subsequent time.</span></pre></td></tr>
  <tr><td class="codeShow_order">1906</td><td><pre><span class="codeComment">		 */</span></pre></td></tr>
  <tr><td class="codeShow_order">1907</td><td><pre>		<span class="codeReserved">this</span>.connect = <span class="codeReserved">function</span> (connectOptions) {</pre></td></tr>
  <tr><td class="codeShow_order">1908</td><td><pre>			connectOptions = connectOptions || {} ;</pre></td></tr>
  <tr><td class="codeShow_order">1909</td><td><pre>			validate(connectOptions,  {timeout:<span class="codeString">"number"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">1910</td><td><pre>									   userName:<span class="codeString">"string"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">1911</td><td><pre>									   password:<span class="codeString">"string"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">1912</td><td><pre>									   willMessage:<span class="codeString">"object"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">1913</td><td><pre>									   keepAliveInterval:<span class="codeString">"number"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">1914</td><td><pre>									   cleanSession:<span class="codeString">"boolean"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">1915</td><td><pre>									   useSSL:<span class="codeString">"boolean"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">1916</td><td><pre>									   invocationContext:<span class="codeString">"object"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">1917</td><td><pre>									   onSuccess:<span class="codeString">"<span class="codeReserved">function</span>"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">1918</td><td><pre>									   onFailure:<span class="codeString">"<span class="codeReserved">function</span>"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">1919</td><td><pre>									   hosts:<span class="codeString">"object"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">1920</td><td><pre>									   ports:<span class="codeString">"object"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">1921</td><td><pre>									   reconnect:<span class="codeString">"boolean"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">1922</td><td><pre>									   mqttVersion:<span class="codeString">"number"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">1923</td><td><pre>									   mqttVersionExplicit:<span class="codeString">"boolean"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">1924</td><td><pre>									   uris: <span class="codeString">"object"</span>});</pre></td></tr>
  <tr><td class="codeShow_order">1925</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1926</td><td><pre>			<span class="codeComment">// If no keep alive interval is set, assume 60 seconds.</span></pre></td></tr>
  <tr><td class="codeShow_order">1927</td><td><pre>			<span class="codeReserved">if</span> (connectOptions.keepAliveInterval === undefined)</pre></td></tr>
  <tr><td class="codeShow_order">1928</td><td><pre>				connectOptions.keepAliveInterval = 60;</pre></td></tr>
  <tr><td class="codeShow_order">1929</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1930</td><td><pre>			<span class="codeReserved">if</span> (connectOptions.mqttVersion &gt; 4 || connectOptions.mqttVersion &lt; 3) {</pre></td></tr>
  <tr><td class="codeShow_order">1931</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.mqttVersion, <span class="codeString">"connectOptions.mqttVersion"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1932</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">1933</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1934</td><td><pre>			<span class="codeReserved">if</span> (connectOptions.mqttVersion === undefined) {</pre></td></tr>
  <tr><td class="codeShow_order">1935</td><td><pre>				connectOptions.mqttVersionExplicit = <span class="codeReserved">false</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1936</td><td><pre>				connectOptions.mqttVersion = 4;</pre></td></tr>
  <tr><td class="codeShow_order">1937</td><td><pre>			} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">1938</td><td><pre>				connectOptions.mqttVersionExplicit = <span class="codeReserved">true</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1939</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">1940</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1941</td><td><pre>			<span class="codeComment">//Check that if password is set, so is username</span></pre></td></tr>
  <tr><td class="codeShow_order">1942</td><td><pre>			<span class="codeReserved">if</span> (connectOptions.password !== undefined && connectOptions.userName === undefined)</pre></td></tr>
  <tr><td class="codeShow_order">1943</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.password, <span class="codeString">"connectOptions.password"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1944</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1945</td><td><pre>			<span class="codeReserved">if</span> (connectOptions.willMessage) {</pre></td></tr>
  <tr><td class="codeShow_order">1946</td><td><pre>				<span class="codeReserved">if</span> (!(connectOptions.willMessage <span class="codeReserved">instanceof</span> Message))</pre></td></tr>
  <tr><td class="codeShow_order">1947</td><td><pre>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [connectOptions.willMessage, <span class="codeString">"connectOptions.willMessage"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1948</td><td><pre>				<span class="codeComment">// The will message must have a payload that can be represented as a string.</span></pre></td></tr>
  <tr><td class="codeShow_order">1949</td><td><pre>				<span class="codeComment">// Cause the willMessage to throw an exception if this is not the case.</span></pre></td></tr>
  <tr><td class="codeShow_order">1950</td><td><pre>				connectOptions.willMessage.stringPayload = <span class="codeReserved">null</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1951</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1952</td><td><pre>				<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> connectOptions.willMessage.destinationName === <span class="codeString">"undefined"</span>)</pre></td></tr>
  <tr><td class="codeShow_order">1953</td><td><pre>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> connectOptions.willMessage.destinationName, <span class="codeString">"connectOptions.willMessage.destinationName"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1954</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">1955</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> connectOptions.cleanSession === <span class="codeString">"undefined"</span>)</pre></td></tr>
  <tr><td class="codeShow_order">1956</td><td><pre>				connectOptions.cleanSession = <span class="codeReserved">true</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1957</td><td><pre>			<span class="codeReserved">if</span> (connectOptions.hosts) {</pre></td></tr>
  <tr><td class="codeShow_order">1958</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1959</td><td><pre>				<span class="codeReserved">if</span> (!(connectOptions.hosts <span class="codeReserved">instanceof</span> Array) )</pre></td></tr>
  <tr><td class="codeShow_order">1960</td><td><pre>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.hosts, <span class="codeString">"connectOptions.hosts"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1961</td><td><pre>				<span class="codeReserved">if</span> (connectOptions.hosts.length &lt;1 )</pre></td></tr>
  <tr><td class="codeShow_order">1962</td><td><pre>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.hosts, <span class="codeString">"connectOptions.hosts"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1963</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1964</td><td><pre>				<span class="codeReserved">var</span> usingURIs = <span class="codeReserved">false</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1965</td><td><pre>				<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i = 0; i&lt;<span class="codeReserved">connectOptions</span>.hosts.length; i++) {</pre></td></tr>
  <tr><td class="codeShow_order">1966</td><td><pre>					<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> connectOptions.hosts[i] !== <span class="codeString">"string"</span>)</pre></td></tr>
  <tr><td class="codeShow_order">1967</td><td><pre>						<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> connectOptions.hosts[i], <span class="codeString">"connectOptions.hosts["</span>+i+<span class="codeString">"]"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1968</td><td><pre>					<span class="codeReserved">if</span> (<span class="codeString">/^(wss?):\/</span>\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/.test(connectOptions.hosts[i])) {</pre></td></tr>
  <tr><td class="codeShow_order">1969</td><td><pre>						<span class="codeReserved">if</span> (i === 0) {</pre></td></tr>
  <tr><td class="codeShow_order">1970</td><td><pre>							usingURIs = <span class="codeReserved">true</span>;</pre></td></tr>
  <tr><td class="codeShow_order">1971</td><td><pre>						} <span class="codeReserved">else</span> <span class="codeReserved">if</span> (!usingURIs) {</pre></td></tr>
  <tr><td class="codeShow_order">1972</td><td><pre>							<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.hosts[i], <span class="codeString">"connectOptions.hosts["</span>+i+<span class="codeString">"]"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1973</td><td><pre>						}</pre></td></tr>
  <tr><td class="codeShow_order">1974</td><td><pre>					} <span class="codeReserved">else</span> <span class="codeReserved">if</span> (usingURIs) {</pre></td></tr>
  <tr><td class="codeShow_order">1975</td><td><pre>						<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.hosts[i], <span class="codeString">"connectOptions.hosts["</span>+i+<span class="codeString">"]"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1976</td><td><pre>					}</pre></td></tr>
  <tr><td class="codeShow_order">1977</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">1978</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1979</td><td><pre>				<span class="codeReserved">if</span> (!usingURIs) {</pre></td></tr>
  <tr><td class="codeShow_order">1980</td><td><pre>					<span class="codeReserved">if</span> (!connectOptions.ports)</pre></td></tr>
  <tr><td class="codeShow_order">1981</td><td><pre>						<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.ports, <span class="codeString">"connectOptions.ports"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1982</td><td><pre>					<span class="codeReserved">if</span> (!(connectOptions.ports <span class="codeReserved">instanceof</span> Array) )</pre></td></tr>
  <tr><td class="codeShow_order">1983</td><td><pre>						<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.ports, <span class="codeString">"connectOptions.ports"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1984</td><td><pre>					<span class="codeReserved">if</span> (connectOptions.hosts.length !== connectOptions.ports.length)</pre></td></tr>
  <tr><td class="codeShow_order">1985</td><td><pre>						<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.ports, <span class="codeString">"connectOptions.ports"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1986</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1987</td><td><pre>					connectOptions.uris = [];</pre></td></tr>
  <tr><td class="codeShow_order">1988</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1989</td><td><pre>					<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i = 0; i&lt;<span class="codeReserved">connectOptions</span>.hosts.length; i++) {</pre></td></tr>
  <tr><td class="codeShow_order">1990</td><td><pre>						<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> connectOptions.ports[i] !== <span class="codeString">"number"</span> || connectOptions.ports[i] &lt; 0)</pre></td></tr>
  <tr><td class="codeShow_order">1991</td><td><pre>							<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> connectOptions.ports[i], <span class="codeString">"connectOptions.ports["</span>+i+<span class="codeString">"]"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">1992</td><td><pre>						<span class="codeReserved">var</span> host = connectOptions.hosts[i];</pre></td></tr>
  <tr><td class="codeShow_order">1993</td><td><pre>						<span class="codeReserved">var</span> port = connectOptions.ports[i];</pre></td></tr>
  <tr><td class="codeShow_order">1994</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">1995</td><td><pre>						<span class="codeReserved">var</span> ipv6 = (host.indexOf(<span class="codeString">":"</span>) !== -1);</pre></td></tr>
  <tr><td class="codeShow_order">1996</td><td><pre>						uri = <span class="codeString">"ws://"</span>+(ipv6?<span class="codeString">"["</span>+host+<span class="codeString">"]"</span>:host)+<span class="codeString">":"</span>+port+path;</pre></td></tr>
  <tr><td class="codeShow_order">1997</td><td><pre>						connectOptions.uris.push(uri);</pre></td></tr>
  <tr><td class="codeShow_order">1998</td><td><pre>					}</pre></td></tr>
  <tr><td class="codeShow_order">1999</td><td><pre>				} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">2000</td><td><pre>					connectOptions.uris = connectOptions.hosts;</pre></td></tr>
  <tr><td class="codeShow_order">2001</td><td><pre>				}</pre></td></tr>
  <tr><td class="codeShow_order">2002</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">2003</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2004</td><td><pre>			client.connect(connectOptions);</pre></td></tr>
  <tr><td class="codeShow_order">2005</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">2006</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2007</td><td><pre>		<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">2008</td><td><pre><span class="codeComment">		 * Subscribe <span class="codeReserved">for</span> messages, request receipt of a copy of messages sent <span class="codeReserved">to</span> the destinations described by the filter.</span></pre></td></tr>
  <tr><td class="codeShow_order">2009</td><td><pre><span class="codeComment">		 *</span></pre></td></tr>
  <tr><td class="codeShow_order">2010</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@name</span> Paho.MQTT.Client#subscribe</span></pre></td></tr>
  <tr><td class="codeShow_order">2011</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@function</span></span></pre></td></tr>
  <tr><td class="codeShow_order">2012</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {string} filter describing the destinations <span class="codeReserved">to</span> receive messages <span class="codeReserved">from</span>.</span></pre></td></tr>
  <tr><td class="codeShow_order">2013</td><td><pre><span class="codeComment">		 * &lt;br&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2014</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {object} subscribeOptions - used <span class="codeReserved">to</span> control the subscription</span></pre></td></tr>
  <tr><td class="codeShow_order">2015</td><td><pre><span class="codeComment">		 *</span></pre></td></tr>
  <tr><td class="codeShow_order">2016</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {number} subscribeOptions.qos - the maiximum qos of any publications sent</span></pre></td></tr>
  <tr><td class="codeShow_order">2017</td><td><pre><span class="codeComment">		 *                                  <span class="codeReserved">as</span> a result of making <span class="codeReserved">this</span> subscription.</span></pre></td></tr>
  <tr><td class="codeShow_order">2018</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {object} subscribeOptions.invocationContext - passed <span class="codeReserved">to</span> the onSuccess callback</span></pre></td></tr>
  <tr><td class="codeShow_order">2019</td><td><pre><span class="codeComment">		 *                                  or onFailure callback.</span></pre></td></tr>
  <tr><td class="codeShow_order">2020</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {<span class="codeReserved">function</span>} subscribeOptions.onSuccess - called when the subscribe acknowledgement</span></pre></td></tr>
  <tr><td class="codeShow_order">2021</td><td><pre><span class="codeComment">		 *                                  has been received <span class="codeReserved">from</span> the server.</span></pre></td></tr>
  <tr><td class="codeShow_order">2022</td><td><pre><span class="codeComment">		 *                                  A single response object parameter is passed <span class="codeReserved">to</span> the onSuccess callback containing the following fields:</span></pre></td></tr>
  <tr><td class="codeShow_order">2023</td><td><pre><span class="codeComment">		 *                                  &lt;ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2024</td><td><pre><span class="codeComment">		 *                                  &lt;li&gt;invocationContext <span class="codeReserved">if</span> set <span class="codeReserved">in</span> the subscribeOptions.</span></pre></td></tr>
  <tr><td class="codeShow_order">2025</td><td><pre><span class="codeComment">		 *                                  &lt;/ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2026</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {<span class="codeReserved">function</span>} subscribeOptions.onFailure - called when the subscribe request has failed or timed out.</span></pre></td></tr>
  <tr><td class="codeShow_order">2027</td><td><pre><span class="codeComment">		 *                                  A single response object parameter is passed <span class="codeReserved">to</span> the onFailure callback containing the following fields:</span></pre></td></tr>
  <tr><td class="codeShow_order">2028</td><td><pre><span class="codeComment">		 *                                  &lt;ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2029</td><td><pre><span class="codeComment">		 *                                  &lt;li&gt;invocationContext - <span class="codeReserved">if</span> set <span class="codeReserved">in</span> the subscribeOptions.</span></pre></td></tr>
  <tr><td class="codeShow_order">2030</td><td><pre><span class="codeComment">		 *                                  &lt;li&gt;errorCode - a number indicating the nature of the error.</span></pre></td></tr>
  <tr><td class="codeShow_order">2031</td><td><pre><span class="codeComment">		 *                                  &lt;li&gt;errorMessage - text describing the error.</span></pre></td></tr>
  <tr><td class="codeShow_order">2032</td><td><pre><span class="codeComment">		 *                                  &lt;/ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2033</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {number} subscribeOptions.timeout - which, <span class="codeReserved">if</span> present, determines the number of</span></pre></td></tr>
  <tr><td class="codeShow_order">2034</td><td><pre><span class="codeComment">		 *                                  seconds after which the onFailure calback is called.</span></pre></td></tr>
  <tr><td class="codeShow_order">2035</td><td><pre><span class="codeComment">		 *                                  The presence of a timeout does not prevent the onSuccess</span></pre></td></tr>
  <tr><td class="codeShow_order">2036</td><td><pre><span class="codeComment">		 *                                  callback <span class="codeReserved">from</span> being called when the subscribe completes.</span></pre></td></tr>
  <tr><td class="codeShow_order">2037</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@throws</span> {InvalidState} <span class="codeReserved">if</span> the client is not <span class="codeReserved">in</span> connected state.</span></pre></td></tr>
  <tr><td class="codeShow_order">2038</td><td><pre><span class="codeComment">		 */</span></pre></td></tr>
  <tr><td class="codeShow_order">2039</td><td><pre>		<span class="codeReserved">this</span>.subscribe = <span class="codeReserved">function</span> (filter, subscribeOptions) {</pre></td></tr>
  <tr><td class="codeShow_order">2040</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> filter !== <span class="codeString">"string"</span>)</pre></td></tr>
  <tr><td class="codeShow_order">2041</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(<span class="codeString">"Invalid argument:"</span>+filter);</pre></td></tr>
  <tr><td class="codeShow_order">2042</td><td><pre>			subscribeOptions = subscribeOptions || {} ;</pre></td></tr>
  <tr><td class="codeShow_order">2043</td><td><pre>			validate(subscribeOptions,  {qos:<span class="codeString">"number"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">2044</td><td><pre>										 invocationContext:<span class="codeString">"object"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">2045</td><td><pre>										 onSuccess:<span class="codeString">"<span class="codeReserved">function</span>"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">2046</td><td><pre>										 onFailure:<span class="codeString">"<span class="codeReserved">function</span>"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">2047</td><td><pre>										 timeout:<span class="codeString">"number"</span></pre></td></tr>
  <tr><td class="codeShow_order">2048</td><td><pre>										});</pre></td></tr>
  <tr><td class="codeShow_order">2049</td><td><pre>			<span class="codeReserved">if</span> (subscribeOptions.timeout && !subscribeOptions.onFailure)</pre></td></tr>
  <tr><td class="codeShow_order">2050</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(<span class="codeString">"subscribeOptions.timeout specified with no onFailure callback."</span>);</pre></td></tr>
  <tr><td class="codeShow_order">2051</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> subscribeOptions.qos !== <span class="codeString">"undefined"</span> && !(subscribeOptions.qos === 0 || subscribeOptions.qos === 1 || subscribeOptions.qos === 2 ))</pre></td></tr>
  <tr><td class="codeShow_order">2052</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [subscribeOptions.qos, <span class="codeString">"subscribeOptions.qos"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">2053</td><td><pre>			client.subscribe(filter, subscribeOptions);</pre></td></tr>
  <tr><td class="codeShow_order">2054</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">2055</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2056</td><td><pre>		<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">2057</td><td><pre><span class="codeComment">		 * Unsubscribe <span class="codeReserved">for</span> messages, stop receiving messages sent <span class="codeReserved">to</span> destinations described by the filter.</span></pre></td></tr>
  <tr><td class="codeShow_order">2058</td><td><pre><span class="codeComment">		 *</span></pre></td></tr>
  <tr><td class="codeShow_order">2059</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@name</span> Paho.MQTT.Client#unsubscribe</span></pre></td></tr>
  <tr><td class="codeShow_order">2060</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@function</span></span></pre></td></tr>
  <tr><td class="codeShow_order">2061</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {string} filter - describing the destinations <span class="codeReserved">to</span> receive messages <span class="codeReserved">from</span>.</span></pre></td></tr>
  <tr><td class="codeShow_order">2062</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {object} unsubscribeOptions - used <span class="codeReserved">to</span> control the subscription</span></pre></td></tr>
  <tr><td class="codeShow_order">2063</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {object} unsubscribeOptions.invocationContext - passed <span class="codeReserved">to</span> the onSuccess callback</span></pre></td></tr>
  <tr><td class="codeShow_order">2064</td><td><pre><span class="codeComment">		                                      or onFailure callback.</span></pre></td></tr>
  <tr><td class="codeShow_order">2065</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {<span class="codeReserved">function</span>} unsubscribeOptions.onSuccess - called when the unsubscribe acknowledgement has been received <span class="codeReserved">from</span> the server.</span></pre></td></tr>
  <tr><td class="codeShow_order">2066</td><td><pre><span class="codeComment">		 *                                    A single response object parameter is passed <span class="codeReserved">to</span> the</span></pre></td></tr>
  <tr><td class="codeShow_order">2067</td><td><pre><span class="codeComment">		 *                                    onSuccess callback containing the following fields:</span></pre></td></tr>
  <tr><td class="codeShow_order">2068</td><td><pre><span class="codeComment">		 *                                    &lt;ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2069</td><td><pre><span class="codeComment">		 *                                    &lt;li&gt;invocationContext - <span class="codeReserved">if</span> set <span class="codeReserved">in</span> the unsubscribeOptions.</span></pre></td></tr>
  <tr><td class="codeShow_order">2070</td><td><pre><span class="codeComment">		 *                                    &lt;/ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2071</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {<span class="codeReserved">function</span>} unsubscribeOptions.onFailure called when the unsubscribe request has failed or timed out.</span></pre></td></tr>
  <tr><td class="codeShow_order">2072</td><td><pre><span class="codeComment">		 *                                    A single response object parameter is passed <span class="codeReserved">to</span> the onFailure callback containing the following fields:</span></pre></td></tr>
  <tr><td class="codeShow_order">2073</td><td><pre><span class="codeComment">		 *                                    &lt;ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2074</td><td><pre><span class="codeComment">		 *                                    &lt;li&gt;invocationContext - <span class="codeReserved">if</span> set <span class="codeReserved">in</span> the unsubscribeOptions.</span></pre></td></tr>
  <tr><td class="codeShow_order">2075</td><td><pre><span class="codeComment">		 *                                    &lt;li&gt;errorCode - a number indicating the nature of the error.</span></pre></td></tr>
  <tr><td class="codeShow_order">2076</td><td><pre><span class="codeComment">		 *                                    &lt;li&gt;errorMessage - text describing the error.</span></pre></td></tr>
  <tr><td class="codeShow_order">2077</td><td><pre><span class="codeComment">		 *                                    &lt;/ol&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2078</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {number} unsubscribeOptions.timeout - which, <span class="codeReserved">if</span> present, determines the number of seconds</span></pre></td></tr>
  <tr><td class="codeShow_order">2079</td><td><pre><span class="codeComment">		 *                                    after which the onFailure callback is called. The presence of</span></pre></td></tr>
  <tr><td class="codeShow_order">2080</td><td><pre><span class="codeComment">		 *                                    a timeout does not prevent the onSuccess callback <span class="codeReserved">from</span> being</span></pre></td></tr>
  <tr><td class="codeShow_order">2081</td><td><pre><span class="codeComment">		 *                                    called when the unsubscribe completes</span></pre></td></tr>
  <tr><td class="codeShow_order">2082</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@throws</span> {InvalidState} <span class="codeReserved">if</span> the client is not <span class="codeReserved">in</span> connected state.</span></pre></td></tr>
  <tr><td class="codeShow_order">2083</td><td><pre><span class="codeComment">		 */</span></pre></td></tr>
  <tr><td class="codeShow_order">2084</td><td><pre>		<span class="codeReserved">this</span>.unsubscribe = <span class="codeReserved">function</span> (filter, unsubscribeOptions) {</pre></td></tr>
  <tr><td class="codeShow_order">2085</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> filter !== <span class="codeString">"string"</span>)</pre></td></tr>
  <tr><td class="codeShow_order">2086</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(<span class="codeString">"Invalid argument:"</span>+filter);</pre></td></tr>
  <tr><td class="codeShow_order">2087</td><td><pre>			unsubscribeOptions = unsubscribeOptions || {} ;</pre></td></tr>
  <tr><td class="codeShow_order">2088</td><td><pre>			validate(unsubscribeOptions,  {invocationContext:<span class="codeString">"object"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">2089</td><td><pre>										   onSuccess:<span class="codeString">"<span class="codeReserved">function</span>"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">2090</td><td><pre>										   onFailure:<span class="codeString">"<span class="codeReserved">function</span>"</span>,</pre></td></tr>
  <tr><td class="codeShow_order">2091</td><td><pre>										   timeout:<span class="codeString">"number"</span></pre></td></tr>
  <tr><td class="codeShow_order">2092</td><td><pre>										  });</pre></td></tr>
  <tr><td class="codeShow_order">2093</td><td><pre>			<span class="codeReserved">if</span> (unsubscribeOptions.timeout && !unsubscribeOptions.onFailure)</pre></td></tr>
  <tr><td class="codeShow_order">2094</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(<span class="codeString">"unsubscribeOptions.timeout specified with no onFailure callback."</span>);</pre></td></tr>
  <tr><td class="codeShow_order">2095</td><td><pre>			client.unsubscribe(filter, unsubscribeOptions);</pre></td></tr>
  <tr><td class="codeShow_order">2096</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">2097</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2098</td><td><pre>		<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">2099</td><td><pre><span class="codeComment">		 * Send a message <span class="codeReserved">to</span> the consumers of the destination <span class="codeReserved">in</span> the Message.</span></pre></td></tr>
  <tr><td class="codeShow_order">2100</td><td><pre><span class="codeComment">		 *</span></pre></td></tr>
  <tr><td class="codeShow_order">2101</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@name</span> Paho.MQTT.Client#send</span></pre></td></tr>
  <tr><td class="codeShow_order">2102</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@function</span></span></pre></td></tr>
  <tr><td class="codeShow_order">2103</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {string|Paho.MQTT.Message} topic - &lt;b&gt;mandatory&lt;/b&gt; The name of the destination <span class="codeReserved">to</span> which the message is <span class="codeReserved">to</span> be sent.</span></pre></td></tr>
  <tr><td class="codeShow_order">2104</td><td><pre><span class="codeComment">		 * 					   - If it is the only parameter, used <span class="codeReserved">as</span> Paho.MQTT.Message object.</span></pre></td></tr>
  <tr><td class="codeShow_order">2105</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {String|ArrayBuffer} payload - The message data <span class="codeReserved">to</span> be sent.</span></pre></td></tr>
  <tr><td class="codeShow_order">2106</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {number} qos The Quality of Service used <span class="codeReserved">to</span> deliver the message.</span></pre></td></tr>
  <tr><td class="codeShow_order">2107</td><td><pre><span class="codeComment">		 * 		&lt;dl&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2108</td><td><pre><span class="codeComment">		 * 			&lt;dt&gt;0 Best effort (<span class="codeReserved">default</span>).</span></pre></td></tr>
  <tr><td class="codeShow_order">2109</td><td><pre><span class="codeComment">		 *     			&lt;dt&gt;1 At least once.</span></pre></td></tr>
  <tr><td class="codeShow_order">2110</td><td><pre><span class="codeComment">		 *     			&lt;dt&gt;2 Exactly once.</span></pre></td></tr>
  <tr><td class="codeShow_order">2111</td><td><pre><span class="codeComment">		 * 		&lt;/dl&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2112</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {Boolean} retained If <span class="codeReserved">true</span>, the message is <span class="codeReserved">to</span> be retained by the server and delivered</span></pre></td></tr>
  <tr><td class="codeShow_order">2113</td><td><pre><span class="codeComment">		 *                     <span class="codeReserved">to</span> both current and future subscriptions.</span></pre></td></tr>
  <tr><td class="codeShow_order">2114</td><td><pre><span class="codeComment">		 *                     If <span class="codeReserved">false</span> the server only delivers the message <span class="codeReserved">to</span> current subscribers, <span class="codeReserved">this</span> is the <span class="codeReserved">default</span> <span class="codeReserved">for</span> <span class="codeReserved">new</span> Messages.</span></pre></td></tr>
  <tr><td class="codeShow_order">2115</td><td><pre><span class="codeComment">		 *                     A received message has the retained boolean set <span class="codeReserved">to</span> <span class="codeReserved">true</span> <span class="codeReserved">if</span> the message was published</span></pre></td></tr>
  <tr><td class="codeShow_order">2116</td><td><pre><span class="codeComment">		 *                     with the retained boolean set <span class="codeReserved">to</span> <span class="codeReserved">true</span></span></pre></td></tr>
  <tr><td class="codeShow_order">2117</td><td><pre><span class="codeComment">		 *                     and the subscrption was made after the message has been published.</span></pre></td></tr>
  <tr><td class="codeShow_order">2118</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@throws</span> {InvalidState} <span class="codeReserved">if</span> the client is not connected.</span></pre></td></tr>
  <tr><td class="codeShow_order">2119</td><td><pre><span class="codeComment">		 */</span></pre></td></tr>
  <tr><td class="codeShow_order">2120</td><td><pre>		<span class="codeReserved">this</span>.send = <span class="codeReserved">function</span> (topic,payload,qos,retained) {</pre></td></tr>
  <tr><td class="codeShow_order">2121</td><td><pre>			<span class="codeReserved">var</span> message ;</pre></td></tr>
  <tr><td class="codeShow_order">2122</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2123</td><td><pre>			<span class="codeReserved">if</span>(arguments.length === 0){</pre></td></tr>
  <tr><td class="codeShow_order">2124</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(<span class="codeString">"Invalid argument."</span>+<span class="codeString">"length"</span>);</pre></td></tr>
  <tr><td class="codeShow_order">2125</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2126</td><td><pre>			}<span class="codeReserved">else</span> <span class="codeReserved">if</span>(arguments.length == 1) {</pre></td></tr>
  <tr><td class="codeShow_order">2127</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2128</td><td><pre>				<span class="codeReserved">if</span> (!(topic <span class="codeReserved">instanceof</span> Message) && (<span class="codeReserved">typeof</span> topic !== <span class="codeString">"string"</span>))</pre></td></tr>
  <tr><td class="codeShow_order">2129</td><td><pre>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(<span class="codeString">"Invalid argument:"</span>+ <span class="codeReserved">typeof</span> topic);</pre></td></tr>
  <tr><td class="codeShow_order">2130</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2131</td><td><pre>				message = topic;</pre></td></tr>
  <tr><td class="codeShow_order">2132</td><td><pre>				<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> message.destinationName === <span class="codeString">"undefined"</span>)</pre></td></tr>
  <tr><td class="codeShow_order">2133</td><td><pre>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT,[message.destinationName,<span class="codeString">"Message.destinationName"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">2134</td><td><pre>				client.send(message);</pre></td></tr>
  <tr><td class="codeShow_order">2135</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2136</td><td><pre>			}<span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">2137</td><td><pre>				<span class="codeComment">//parameter checking in Message object</span></pre></td></tr>
  <tr><td class="codeShow_order">2138</td><td><pre>				message = <span class="codeReserved">new</span> Message(payload);</pre></td></tr>
  <tr><td class="codeShow_order">2139</td><td><pre>				message.destinationName = topic;</pre></td></tr>
  <tr><td class="codeShow_order">2140</td><td><pre>				<span class="codeReserved">if</span>(arguments.length &gt;= 3)</pre></td></tr>
  <tr><td class="codeShow_order">2141</td><td><pre>					message.qos = qos;</pre></td></tr>
  <tr><td class="codeShow_order">2142</td><td><pre>				<span class="codeReserved">if</span>(arguments.length &gt;= 4)</pre></td></tr>
  <tr><td class="codeShow_order">2143</td><td><pre>					message.retained = retained;</pre></td></tr>
  <tr><td class="codeShow_order">2144</td><td><pre>				client.send(message);</pre></td></tr>
  <tr><td class="codeShow_order">2145</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">2146</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">2147</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2148</td><td><pre>		<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">2149</td><td><pre><span class="codeComment">		 * Publish a message <span class="codeReserved">to</span> the consumers of the destination <span class="codeReserved">in</span> the Message.</span></pre></td></tr>
  <tr><td class="codeShow_order">2150</td><td><pre><span class="codeComment">		 * Synonym <span class="codeReserved">for</span> Paho.Mqtt.Client#send</span></pre></td></tr>
  <tr><td class="codeShow_order">2151</td><td><pre><span class="codeComment">		 *</span></pre></td></tr>
  <tr><td class="codeShow_order">2152</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@name</span> Paho.MQTT.Client#publish</span></pre></td></tr>
  <tr><td class="codeShow_order">2153</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@function</span></span></pre></td></tr>
  <tr><td class="codeShow_order">2154</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {string|Paho.MQTT.Message} topic - &lt;b&gt;mandatory&lt;/b&gt; The name of the topic <span class="codeReserved">to</span> which the message is <span class="codeReserved">to</span> be published.</span></pre></td></tr>
  <tr><td class="codeShow_order">2155</td><td><pre><span class="codeComment">		 * 					   - If it is the only parameter, used <span class="codeReserved">as</span> Paho.MQTT.Message object.</span></pre></td></tr>
  <tr><td class="codeShow_order">2156</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {String|ArrayBuffer} payload - The message data <span class="codeReserved">to</span> be published.</span></pre></td></tr>
  <tr><td class="codeShow_order">2157</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {number} qos The Quality of Service used <span class="codeReserved">to</span> deliver the message.</span></pre></td></tr>
  <tr><td class="codeShow_order">2158</td><td><pre><span class="codeComment">		 * 		&lt;dl&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2159</td><td><pre><span class="codeComment">		 * 			&lt;dt&gt;0 Best effort (<span class="codeReserved">default</span>).</span></pre></td></tr>
  <tr><td class="codeShow_order">2160</td><td><pre><span class="codeComment">		 *     			&lt;dt&gt;1 At least once.</span></pre></td></tr>
  <tr><td class="codeShow_order">2161</td><td><pre><span class="codeComment">		 *     			&lt;dt&gt;2 Exactly once.</span></pre></td></tr>
  <tr><td class="codeShow_order">2162</td><td><pre><span class="codeComment">		 * 		&lt;/dl&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2163</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@param</span> {Boolean} retained If <span class="codeReserved">true</span>, the message is <span class="codeReserved">to</span> be retained by the server and delivered</span></pre></td></tr>
  <tr><td class="codeShow_order">2164</td><td><pre><span class="codeComment">		 *                     <span class="codeReserved">to</span> both current and future subscriptions.</span></pre></td></tr>
  <tr><td class="codeShow_order">2165</td><td><pre><span class="codeComment">		 *                     If <span class="codeReserved">false</span> the server only delivers the message <span class="codeReserved">to</span> current subscribers, <span class="codeReserved">this</span> is the <span class="codeReserved">default</span> <span class="codeReserved">for</span> <span class="codeReserved">new</span> Messages.</span></pre></td></tr>
  <tr><td class="codeShow_order">2166</td><td><pre><span class="codeComment">		 *                     A received message has the retained boolean set <span class="codeReserved">to</span> <span class="codeReserved">true</span> <span class="codeReserved">if</span> the message was published</span></pre></td></tr>
  <tr><td class="codeShow_order">2167</td><td><pre><span class="codeComment">		 *                     with the retained boolean set <span class="codeReserved">to</span> <span class="codeReserved">true</span></span></pre></td></tr>
  <tr><td class="codeShow_order">2168</td><td><pre><span class="codeComment">		 *                     and the subscrption was made after the message has been published.</span></pre></td></tr>
  <tr><td class="codeShow_order">2169</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@throws</span> {InvalidState} <span class="codeReserved">if</span> the client is not connected.</span></pre></td></tr>
  <tr><td class="codeShow_order">2170</td><td><pre><span class="codeComment">		 */</span></pre></td></tr>
  <tr><td class="codeShow_order">2171</td><td><pre>		 <span class="codeReserved">this</span>.publish = <span class="codeReserved">function</span>(topic,payload,qos,retained) {</pre></td></tr>
  <tr><td class="codeShow_order">2172</td><td><pre>			 console.log(<span class="codeString">"Publising message <span class="codeReserved">to</span>: "</span>, topic);</pre></td></tr>
  <tr><td class="codeShow_order">2173</td><td><pre>			 <span class="codeReserved">var</span> message ;</pre></td></tr>
  <tr><td class="codeShow_order">2174</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2175</td><td><pre> 			<span class="codeReserved">if</span>(arguments.length === 0){</pre></td></tr>
  <tr><td class="codeShow_order">2176</td><td><pre> 				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(<span class="codeString">"Invalid argument."</span>+<span class="codeString">"length"</span>);</pre></td></tr>
  <tr><td class="codeShow_order">2177</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2178</td><td><pre> 			}<span class="codeReserved">else</span> <span class="codeReserved">if</span>(arguments.length == 1) {</pre></td></tr>
  <tr><td class="codeShow_order">2179</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2180</td><td><pre> 				<span class="codeReserved">if</span> (!(topic <span class="codeReserved">instanceof</span> Message) && (<span class="codeReserved">typeof</span> topic !== <span class="codeString">"string"</span>))</pre></td></tr>
  <tr><td class="codeShow_order">2181</td><td><pre> 					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(<span class="codeString">"Invalid argument:"</span>+ <span class="codeReserved">typeof</span> topic);</pre></td></tr>
  <tr><td class="codeShow_order">2182</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2183</td><td><pre> 				message = topic;</pre></td></tr>
  <tr><td class="codeShow_order">2184</td><td><pre> 				<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> message.destinationName === <span class="codeString">"undefined"</span>)</pre></td></tr>
  <tr><td class="codeShow_order">2185</td><td><pre> 					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT,[message.destinationName,<span class="codeString">"Message.destinationName"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">2186</td><td><pre> 				client.send(message);</pre></td></tr>
  <tr><td class="codeShow_order">2187</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2188</td><td><pre> 			}<span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">2189</td><td><pre> 				<span class="codeComment">//parameter checking in Message object</span></pre></td></tr>
  <tr><td class="codeShow_order">2190</td><td><pre> 				message = <span class="codeReserved">new</span> Message(payload);</pre></td></tr>
  <tr><td class="codeShow_order">2191</td><td><pre> 				message.destinationName = topic;</pre></td></tr>
  <tr><td class="codeShow_order">2192</td><td><pre> 				<span class="codeReserved">if</span>(arguments.length &gt;= 3)</pre></td></tr>
  <tr><td class="codeShow_order">2193</td><td><pre> 					message.qos = qos;</pre></td></tr>
  <tr><td class="codeShow_order">2194</td><td><pre> 				<span class="codeReserved">if</span>(arguments.length &gt;= 4)</pre></td></tr>
  <tr><td class="codeShow_order">2195</td><td><pre> 					message.retained = retained;</pre></td></tr>
  <tr><td class="codeShow_order">2196</td><td><pre> 				client.send(message);</pre></td></tr>
  <tr><td class="codeShow_order">2197</td><td><pre> 			}</pre></td></tr>
  <tr><td class="codeShow_order">2198</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">2199</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2200</td><td><pre>		<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">2201</td><td><pre><span class="codeComment">		 * Normal disconnect of <span class="codeReserved">this</span> Messaging client <span class="codeReserved">from</span> its server.</span></pre></td></tr>
  <tr><td class="codeShow_order">2202</td><td><pre><span class="codeComment">		 *</span></pre></td></tr>
  <tr><td class="codeShow_order">2203</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@name</span> Paho.MQTT.Client#disconnect</span></pre></td></tr>
  <tr><td class="codeShow_order">2204</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@function</span></span></pre></td></tr>
  <tr><td class="codeShow_order">2205</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@throws</span> {InvalidState} <span class="codeReserved">if</span> the client is already disconnected.</span></pre></td></tr>
  <tr><td class="codeShow_order">2206</td><td><pre><span class="codeComment">		 */</span></pre></td></tr>
  <tr><td class="codeShow_order">2207</td><td><pre>		<span class="codeReserved">this</span>.disconnect = <span class="codeReserved">function</span> () {</pre></td></tr>
  <tr><td class="codeShow_order">2208</td><td><pre>			client.disconnect();</pre></td></tr>
  <tr><td class="codeShow_order">2209</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">2210</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2211</td><td><pre>		<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">2212</td><td><pre><span class="codeComment">		 * Get the contents of the trace log.</span></pre></td></tr>
  <tr><td class="codeShow_order">2213</td><td><pre><span class="codeComment">		 *</span></pre></td></tr>
  <tr><td class="codeShow_order">2214</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@name</span> Paho.MQTT.Client#getTraceLog</span></pre></td></tr>
  <tr><td class="codeShow_order">2215</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@function</span></span></pre></td></tr>
  <tr><td class="codeShow_order">2216</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@return</span> {Object[]} tracebuffer containing the time ordered trace records.</span></pre></td></tr>
  <tr><td class="codeShow_order">2217</td><td><pre><span class="codeComment">		 */</span></pre></td></tr>
  <tr><td class="codeShow_order">2218</td><td><pre>		<span class="codeReserved">this</span>.getTraceLog = <span class="codeReserved">function</span> () {</pre></td></tr>
  <tr><td class="codeShow_order">2219</td><td><pre>			<span class="codeReserved">return</span> client.getTraceLog();</pre></td></tr>
  <tr><td class="codeShow_order">2220</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">2221</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2222</td><td><pre>		<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">2223</td><td><pre><span class="codeComment">		 * Start tracing.</span></pre></td></tr>
  <tr><td class="codeShow_order">2224</td><td><pre><span class="codeComment">		 *</span></pre></td></tr>
  <tr><td class="codeShow_order">2225</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@name</span> Paho.MQTT.Client#startTrace</span></pre></td></tr>
  <tr><td class="codeShow_order">2226</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@function</span></span></pre></td></tr>
  <tr><td class="codeShow_order">2227</td><td><pre><span class="codeComment">		 */</span></pre></td></tr>
  <tr><td class="codeShow_order">2228</td><td><pre>		<span class="codeReserved">this</span>.startTrace = <span class="codeReserved">function</span> () {</pre></td></tr>
  <tr><td class="codeShow_order">2229</td><td><pre>			client.startTrace();</pre></td></tr>
  <tr><td class="codeShow_order">2230</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">2231</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2232</td><td><pre>		<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">2233</td><td><pre><span class="codeComment">		 * Stop tracing.</span></pre></td></tr>
  <tr><td class="codeShow_order">2234</td><td><pre><span class="codeComment">		 *</span></pre></td></tr>
  <tr><td class="codeShow_order">2235</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@name</span> Paho.MQTT.Client#stopTrace</span></pre></td></tr>
  <tr><td class="codeShow_order">2236</td><td><pre><span class="codeComment">		 * <span class="codeReserved">@function</span></span></pre></td></tr>
  <tr><td class="codeShow_order">2237</td><td><pre><span class="codeComment">		 */</span></pre></td></tr>
  <tr><td class="codeShow_order">2238</td><td><pre>		<span class="codeReserved">this</span>.stopTrace = <span class="codeReserved">function</span> () {</pre></td></tr>
  <tr><td class="codeShow_order">2239</td><td><pre>			client.stopTrace();</pre></td></tr>
  <tr><td class="codeShow_order">2240</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">2241</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2242</td><td><pre>		<span class="codeReserved">this</span>.isConnected = <span class="codeReserved">function</span>() {</pre></td></tr>
  <tr><td class="codeShow_order">2243</td><td><pre>			<span class="codeReserved">return</span> client.connected;</pre></td></tr>
  <tr><td class="codeShow_order">2244</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">2245</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">2246</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2247</td><td><pre>	Client.prototype = {</pre></td></tr>
  <tr><td class="codeShow_order">2248</td><td><pre>		get host() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getHost(); },</pre></td></tr>
  <tr><td class="codeShow_order">2249</td><td><pre>		set host(newHost) { <span class="codeReserved">this</span>._setHost(newHost); },</pre></td></tr>
  <tr><td class="codeShow_order">2250</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2251</td><td><pre>		get port() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getPort(); },</pre></td></tr>
  <tr><td class="codeShow_order">2252</td><td><pre>		set port(newPort) { <span class="codeReserved">this</span>._setPort(newPort); },</pre></td></tr>
  <tr><td class="codeShow_order">2253</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2254</td><td><pre>		get path() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getPath(); },</pre></td></tr>
  <tr><td class="codeShow_order">2255</td><td><pre>		set path(newPath) { <span class="codeReserved">this</span>._setPath(newPath); },</pre></td></tr>
  <tr><td class="codeShow_order">2256</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2257</td><td><pre>		get clientId() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getClientId(); },</pre></td></tr>
  <tr><td class="codeShow_order">2258</td><td><pre>		set clientId(newClientId) { <span class="codeReserved">this</span>._setClientId(newClientId); },</pre></td></tr>
  <tr><td class="codeShow_order">2259</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2260</td><td><pre>		get onConnected() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getOnConnected(); },</pre></td></tr>
  <tr><td class="codeShow_order">2261</td><td><pre>		set onConnected(newOnConnected) { <span class="codeReserved">this</span>._setOnConnected(newOnConnected); },</pre></td></tr>
  <tr><td class="codeShow_order">2262</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2263</td><td><pre>		get disconnectedPublishing() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getDisconnectedPublishing(); },</pre></td></tr>
  <tr><td class="codeShow_order">2264</td><td><pre>		set disconnectedPublishing(newDisconnectedPublishing) { <span class="codeReserved">this</span>._setDisconnectedPublishing(newDisconnectedPublishing); },</pre></td></tr>
  <tr><td class="codeShow_order">2265</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2266</td><td><pre>		get disconnectedBufferSize() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getDisconnectedBufferSize(); },</pre></td></tr>
  <tr><td class="codeShow_order">2267</td><td><pre>		set disconnectedBufferSize(newDisconnectedBufferSize) { <span class="codeReserved">this</span>._setDisconnectedBufferSize(newDisconnectedBufferSize); },</pre></td></tr>
  <tr><td class="codeShow_order">2268</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2269</td><td><pre>		get onConnectionLost() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getOnConnectionLost(); },</pre></td></tr>
  <tr><td class="codeShow_order">2270</td><td><pre>		set onConnectionLost(newOnConnectionLost) { <span class="codeReserved">this</span>._setOnConnectionLost(newOnConnectionLost); },</pre></td></tr>
  <tr><td class="codeShow_order">2271</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2272</td><td><pre>		get onMessageDelivered() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getOnMessageDelivered(); },</pre></td></tr>
  <tr><td class="codeShow_order">2273</td><td><pre>		set onMessageDelivered(newOnMessageDelivered) { <span class="codeReserved">this</span>._setOnMessageDelivered(newOnMessageDelivered); },</pre></td></tr>
  <tr><td class="codeShow_order">2274</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2275</td><td><pre>		get onMessageArrived() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getOnMessageArrived(); },</pre></td></tr>
  <tr><td class="codeShow_order">2276</td><td><pre>		set onMessageArrived(newOnMessageArrived) { <span class="codeReserved">this</span>._setOnMessageArrived(newOnMessageArrived); },</pre></td></tr>
  <tr><td class="codeShow_order">2277</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2278</td><td><pre>		get trace() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getTrace(); },</pre></td></tr>
  <tr><td class="codeShow_order">2279</td><td><pre>		set trace(newTraceFunction) { <span class="codeReserved">this</span>._setTrace(newTraceFunction); }</pre></td></tr>
  <tr><td class="codeShow_order">2280</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2281</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">2282</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2283</td><td><pre>	<span class="codeComment">/**</span></pre></td></tr>
  <tr><td class="codeShow_order">2284</td><td><pre><span class="codeComment">	 * An application message, sent or received.</span></pre></td></tr>
  <tr><td class="codeShow_order">2285</td><td><pre><span class="codeComment">	 * &lt;p&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2286</td><td><pre><span class="codeComment">	 * All attributes may be <span class="codeReserved">null</span>, which implies the <span class="codeReserved">default</span> values.</span></pre></td></tr>
  <tr><td class="codeShow_order">2287</td><td><pre><span class="codeComment">	 *</span></pre></td></tr>
  <tr><td class="codeShow_order">2288</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@name</span> Paho.MQTT.Message</span></pre></td></tr>
  <tr><td class="codeShow_order">2289</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@constructor</span></span></pre></td></tr>
  <tr><td class="codeShow_order">2290</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@param</span> {String|ArrayBuffer} payload The message data <span class="codeReserved">to</span> be sent.</span></pre></td></tr>
  <tr><td class="codeShow_order">2291</td><td><pre><span class="codeComment">	 * &lt;p&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2292</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@property</span> {string} payloadString &lt;i&gt;read only&lt;/i&gt; The payload <span class="codeReserved">as</span> a string <span class="codeReserved">if</span> the payload consists of valid UTF-8 characters.</span></pre></td></tr>
  <tr><td class="codeShow_order">2293</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@property</span> {ArrayBuffer} payloadBytes &lt;i&gt;read only&lt;/i&gt; The payload <span class="codeReserved">as</span> an ArrayBuffer.</span></pre></td></tr>
  <tr><td class="codeShow_order">2294</td><td><pre><span class="codeComment">	 * &lt;p&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2295</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@property</span> {string} destinationName &lt;b&gt;mandatory&lt;/b&gt; The name of the destination <span class="codeReserved">to</span> which the message is <span class="codeReserved">to</span> be sent</span></pre></td></tr>
  <tr><td class="codeShow_order">2296</td><td><pre><span class="codeComment">	 *                    (<span class="codeReserved">for</span> messages about <span class="codeReserved">to</span> be sent) or the name of the destination <span class="codeReserved">from</span> which the message has been received.</span></pre></td></tr>
  <tr><td class="codeShow_order">2297</td><td><pre><span class="codeComment">	 *                    (<span class="codeReserved">for</span> messages received by the onMessage <span class="codeReserved">function</span>).</span></pre></td></tr>
  <tr><td class="codeShow_order">2298</td><td><pre><span class="codeComment">	 * &lt;p&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2299</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@property</span> {number} qos The Quality of Service used <span class="codeReserved">to</span> deliver the message.</span></pre></td></tr>
  <tr><td class="codeShow_order">2300</td><td><pre><span class="codeComment">	 * &lt;dl&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2301</td><td><pre><span class="codeComment">	 *     &lt;dt&gt;0 Best effort (<span class="codeReserved">default</span>).</span></pre></td></tr>
  <tr><td class="codeShow_order">2302</td><td><pre><span class="codeComment">	 *     &lt;dt&gt;1 At least once.</span></pre></td></tr>
  <tr><td class="codeShow_order">2303</td><td><pre><span class="codeComment">	 *     &lt;dt&gt;2 Exactly once.</span></pre></td></tr>
  <tr><td class="codeShow_order">2304</td><td><pre><span class="codeComment">	 * &lt;/dl&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2305</td><td><pre><span class="codeComment">	 * &lt;p&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2306</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@property</span> {Boolean} retained If <span class="codeReserved">true</span>, the message is <span class="codeReserved">to</span> be retained by the server and delivered</span></pre></td></tr>
  <tr><td class="codeShow_order">2307</td><td><pre><span class="codeComment">	 *                     <span class="codeReserved">to</span> both current and future subscriptions.</span></pre></td></tr>
  <tr><td class="codeShow_order">2308</td><td><pre><span class="codeComment">	 *                     If <span class="codeReserved">false</span> the server only delivers the message <span class="codeReserved">to</span> current subscribers, <span class="codeReserved">this</span> is the <span class="codeReserved">default</span> <span class="codeReserved">for</span> <span class="codeReserved">new</span> Messages.</span></pre></td></tr>
  <tr><td class="codeShow_order">2309</td><td><pre><span class="codeComment">	 *                     A received message has the retained boolean set <span class="codeReserved">to</span> <span class="codeReserved">true</span> <span class="codeReserved">if</span> the message was published</span></pre></td></tr>
  <tr><td class="codeShow_order">2310</td><td><pre><span class="codeComment">	 *                     with the retained boolean set <span class="codeReserved">to</span> <span class="codeReserved">true</span></span></pre></td></tr>
  <tr><td class="codeShow_order">2311</td><td><pre><span class="codeComment">	 *                     and the subscrption was made after the message has been published.</span></pre></td></tr>
  <tr><td class="codeShow_order">2312</td><td><pre><span class="codeComment">	 * &lt;p&gt;</span></pre></td></tr>
  <tr><td class="codeShow_order">2313</td><td><pre><span class="codeComment">	 * <span class="codeReserved">@property</span> {Boolean} duplicate &lt;i&gt;read only&lt;/i&gt; If <span class="codeReserved">true</span>, <span class="codeReserved">this</span> message might be a duplicate of one which has already been received.</span></pre></td></tr>
  <tr><td class="codeShow_order">2314</td><td><pre><span class="codeComment">	 *                     This is only set on messages received <span class="codeReserved">from</span> the server.</span></pre></td></tr>
  <tr><td class="codeShow_order">2315</td><td><pre><span class="codeComment">	 *</span></pre></td></tr>
  <tr><td class="codeShow_order">2316</td><td><pre><span class="codeComment">	 */</span></pre></td></tr>
  <tr><td class="codeShow_order">2317</td><td><pre>	<span class="codeReserved">var</span> Message = <span class="codeReserved">function</span> (newPayload) {</pre></td></tr>
  <tr><td class="codeShow_order">2318</td><td><pre>		<span class="codeReserved">var</span> payload;</pre></td></tr>
  <tr><td class="codeShow_order">2319</td><td><pre>		<span class="codeReserved">if</span> (   <span class="codeReserved">typeof</span> newPayload === <span class="codeString">"string"</span> ||</pre></td></tr>
  <tr><td class="codeShow_order">2320</td><td><pre>		newPayload <span class="codeReserved">instanceof</span> ArrayBuffer ||</pre></td></tr>
  <tr><td class="codeShow_order">2321</td><td><pre>		newPayload <span class="codeReserved">instanceof</span> Int8Array   ||</pre></td></tr>
  <tr><td class="codeShow_order">2322</td><td><pre>		newPayload <span class="codeReserved">instanceof</span> Uint8Array  ||</pre></td></tr>
  <tr><td class="codeShow_order">2323</td><td><pre>		newPayload <span class="codeReserved">instanceof</span> Int16Array  ||</pre></td></tr>
  <tr><td class="codeShow_order">2324</td><td><pre>		newPayload <span class="codeReserved">instanceof</span> Uint16Array ||</pre></td></tr>
  <tr><td class="codeShow_order">2325</td><td><pre>		newPayload <span class="codeReserved">instanceof</span> Int32Array  ||</pre></td></tr>
  <tr><td class="codeShow_order">2326</td><td><pre>		newPayload <span class="codeReserved">instanceof</span> Uint32Array ||</pre></td></tr>
  <tr><td class="codeShow_order">2327</td><td><pre>		newPayload <span class="codeReserved">instanceof</span> Float32Array ||</pre></td></tr>
  <tr><td class="codeShow_order">2328</td><td><pre>		newPayload <span class="codeReserved">instanceof</span> Float64Array</pre></td></tr>
  <tr><td class="codeShow_order">2329</td><td><pre>		   ) {</pre></td></tr>
  <tr><td class="codeShow_order">2330</td><td><pre>			payload = newPayload;</pre></td></tr>
  <tr><td class="codeShow_order">2331</td><td><pre>		} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">2332</td><td><pre>			<span class="codeReserved">throw</span> (format(ERROR.INVALID_ARGUMENT, [newPayload, <span class="codeString">"newPayload"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">2333</td><td><pre>		}</pre></td></tr>
  <tr><td class="codeShow_order">2334</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2335</td><td><pre>		<span class="codeReserved">this</span>._getPayloadString = <span class="codeReserved">function</span> () {</pre></td></tr>
  <tr><td class="codeShow_order">2336</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> payload === <span class="codeString">"string"</span>)</pre></td></tr>
  <tr><td class="codeShow_order">2337</td><td><pre>				<span class="codeReserved">return</span> payload;</pre></td></tr>
  <tr><td class="codeShow_order">2338</td><td><pre>			<span class="codeReserved">else</span></pre></td></tr>
  <tr><td class="codeShow_order">2339</td><td><pre>				<span class="codeReserved">return</span> parseUTF8(payload, 0, payload.length);</pre></td></tr>
  <tr><td class="codeShow_order">2340</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">2341</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2342</td><td><pre>		<span class="codeReserved">this</span>._getPayloadBytes = <span class="codeReserved">function</span>() {</pre></td></tr>
  <tr><td class="codeShow_order">2343</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> payload === <span class="codeString">"string"</span>) {</pre></td></tr>
  <tr><td class="codeShow_order">2344</td><td><pre>				<span class="codeReserved">var</span> buffer = <span class="codeReserved">new</span> ArrayBuffer(UTF8Length(payload));</pre></td></tr>
  <tr><td class="codeShow_order">2345</td><td><pre>				<span class="codeReserved">var</span> byteStream = <span class="codeReserved">new</span> Uint8Array(buffer);</pre></td></tr>
  <tr><td class="codeShow_order">2346</td><td><pre>				stringToUTF8(payload, byteStream, 0);</pre></td></tr>
  <tr><td class="codeShow_order">2347</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2348</td><td><pre>				<span class="codeReserved">return</span> byteStream;</pre></td></tr>
  <tr><td class="codeShow_order">2349</td><td><pre>			} <span class="codeReserved">else</span> {</pre></td></tr>
  <tr><td class="codeShow_order">2350</td><td><pre>				<span class="codeReserved">return</span> payload;</pre></td></tr>
  <tr><td class="codeShow_order">2351</td><td><pre>			}</pre></td></tr>
  <tr><td class="codeShow_order">2352</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">2353</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2354</td><td><pre>		<span class="codeReserved">var</span> destinationName;</pre></td></tr>
  <tr><td class="codeShow_order">2355</td><td><pre>		<span class="codeReserved">this</span>._getDestinationName = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> destinationName; };</pre></td></tr>
  <tr><td class="codeShow_order">2356</td><td><pre>		<span class="codeReserved">this</span>._setDestinationName = <span class="codeReserved">function</span>(newDestinationName) {</pre></td></tr>
  <tr><td class="codeShow_order">2357</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> newDestinationName === <span class="codeString">"string"</span>)</pre></td></tr>
  <tr><td class="codeShow_order">2358</td><td><pre>				destinationName = newDestinationName;</pre></td></tr>
  <tr><td class="codeShow_order">2359</td><td><pre>			<span class="codeReserved">else</span></pre></td></tr>
  <tr><td class="codeShow_order">2360</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [newDestinationName, <span class="codeString">"newDestinationName"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">2361</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">2362</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2363</td><td><pre>		<span class="codeReserved">var</span> qos = 0;</pre></td></tr>
  <tr><td class="codeShow_order">2364</td><td><pre>		<span class="codeReserved">this</span>._getQos = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> qos; };</pre></td></tr>
  <tr><td class="codeShow_order">2365</td><td><pre>		<span class="codeReserved">this</span>._setQos = <span class="codeReserved">function</span>(newQos) {</pre></td></tr>
  <tr><td class="codeShow_order">2366</td><td><pre>			<span class="codeReserved">if</span> (newQos === 0 || newQos === 1 || newQos === 2 )</pre></td></tr>
  <tr><td class="codeShow_order">2367</td><td><pre>				qos = newQos;</pre></td></tr>
  <tr><td class="codeShow_order">2368</td><td><pre>			<span class="codeReserved">else</span></pre></td></tr>
  <tr><td class="codeShow_order">2369</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(<span class="codeString">"Invalid argument:"</span>+newQos);</pre></td></tr>
  <tr><td class="codeShow_order">2370</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">2371</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2372</td><td><pre>		<span class="codeReserved">var</span> retained = <span class="codeReserved">false</span>;</pre></td></tr>
  <tr><td class="codeShow_order">2373</td><td><pre>		<span class="codeReserved">this</span>._getRetained = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> retained; };</pre></td></tr>
  <tr><td class="codeShow_order">2374</td><td><pre>		<span class="codeReserved">this</span>._setRetained = <span class="codeReserved">function</span>(newRetained) {</pre></td></tr>
  <tr><td class="codeShow_order">2375</td><td><pre>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> newRetained === <span class="codeString">"boolean"</span>)</pre></td></tr>
  <tr><td class="codeShow_order">2376</td><td><pre>				retained = newRetained;</pre></td></tr>
  <tr><td class="codeShow_order">2377</td><td><pre>			<span class="codeReserved">else</span></pre></td></tr>
  <tr><td class="codeShow_order">2378</td><td><pre>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [newRetained, <span class="codeString">"newRetained"</span>]));</pre></td></tr>
  <tr><td class="codeShow_order">2379</td><td><pre>		};</pre></td></tr>
  <tr><td class="codeShow_order">2380</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2381</td><td><pre>		<span class="codeReserved">var</span> duplicate = <span class="codeReserved">false</span>;</pre></td></tr>
  <tr><td class="codeShow_order">2382</td><td><pre>		<span class="codeReserved">this</span>._getDuplicate = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> duplicate; };</pre></td></tr>
  <tr><td class="codeShow_order">2383</td><td><pre>		<span class="codeReserved">this</span>._setDuplicate = <span class="codeReserved">function</span>(newDuplicate) { duplicate = newDuplicate; };</pre></td></tr>
  <tr><td class="codeShow_order">2384</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">2385</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2386</td><td><pre>	Message.prototype = {</pre></td></tr>
  <tr><td class="codeShow_order">2387</td><td><pre>		get payloadString() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getPayloadString(); },</pre></td></tr>
  <tr><td class="codeShow_order">2388</td><td><pre>		get payloadBytes() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getPayloadBytes(); },</pre></td></tr>
  <tr><td class="codeShow_order">2389</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2390</td><td><pre>		get destinationName() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getDestinationName(); },</pre></td></tr>
  <tr><td class="codeShow_order">2391</td><td><pre>		set destinationName(newDestinationName) { <span class="codeReserved">this</span>._setDestinationName(newDestinationName); },</pre></td></tr>
  <tr><td class="codeShow_order">2392</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2393</td><td><pre>		get topic() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getDestinationName(); },</pre></td></tr>
  <tr><td class="codeShow_order">2394</td><td><pre>		set topic(newTopic) { <span class="codeReserved">this</span>._setDestinationName(newTopic); },</pre></td></tr>
  <tr><td class="codeShow_order">2395</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2396</td><td><pre>		get qos() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getQos(); },</pre></td></tr>
  <tr><td class="codeShow_order">2397</td><td><pre>		set qos(newQos) { <span class="codeReserved">this</span>._setQos(newQos); },</pre></td></tr>
  <tr><td class="codeShow_order">2398</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2399</td><td><pre>		get retained() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getRetained(); },</pre></td></tr>
  <tr><td class="codeShow_order">2400</td><td><pre>		set retained(newRetained) { <span class="codeReserved">this</span>._setRetained(newRetained); },</pre></td></tr>
  <tr><td class="codeShow_order">2401</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2402</td><td><pre>		get duplicate() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getDuplicate(); },</pre></td></tr>
  <tr><td class="codeShow_order">2403</td><td><pre>		set duplicate(newDuplicate) { <span class="codeReserved">this</span>._setDuplicate(newDuplicate); }</pre></td></tr>
  <tr><td class="codeShow_order">2404</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">2405</td><td><pre></pre></td></tr>
  <tr><td class="codeShow_order">2406</td><td><pre>	<span class="codeComment">// Module contents.</span></pre></td></tr>
  <tr><td class="codeShow_order">2407</td><td><pre>	<span class="codeReserved">return</span> {</pre></td></tr>
  <tr><td class="codeShow_order">2408</td><td><pre>		Client: Client,</pre></td></tr>
  <tr><td class="codeShow_order">2409</td><td><pre>		Message: Message</pre></td></tr>
  <tr><td class="codeShow_order">2410</td><td><pre>	};</pre></td></tr>
  <tr><td class="codeShow_order">2411</td><td><pre>})(window);</pre></td></tr>
  <tr><td class="codeShow_order">2412</td><td><pre><span class="codeReserved">return</span> PahoMQTT;</pre></td></tr>
  <tr><td class="codeShow_order">2413</td><td><pre>});</pre></td></tr>
  <tr><td class="codeShow_order">2414</td><td><pre></pre></td></tr>
 </tbody>
</table>
 <footer>
 <p>
  <a rel="license"
    href="http://creativecommons.org/licenses/by/4.0/"><img
     alt="Licencia Creative Commons" style="border-width:0"
     src="/img/icono/160x30.webp" width="80" height="15" /></a>
  <br />Esta
  <span xmlns:dct="http://purl.org/dc/terms/"
    href="http://purl.org/dc/dcmitype/InteractiveResource"
    rel="dct:type">obra</span>
  de
  <a xmlns:cc="http://creativecommons.org/ns#"
    href="https://gilpgijs.github.io" property="cc:attributionName"
    rel="cc:attributionURL">Gilberto Pacheco Gallegos</a>
  está bajo una
  <a rel="license"
    href="http://creativecommons.org/licenses/by/4.0/">Licencia
   Creative Commons Atribución 4.0 Internacional</a>.
 </p>
</footer>
 <button id="abre" type="button" title="Menú" class="cambiaMenu">
  <span class="material-symbols-outlined">
   menu
  </span>
 </button>
 <a class="anterior" href="/m05iot/m-paho.javascript-1.0.3/m-paho-mqtt-min-js.html" title="E. paho.javascript-1.0.3 / paho-mqtt-min.js"><span class="material-symbols-outlined">
     skip_previous
    </span></a>
 <a class="siguiente" href="/m05iot/m-jsconfig-json.html" title="I. jsconfig.json"><span class="material-symbols-outlined">
     skip_next
     </span></a>
</div>
<div id="cierra" class="cambiaMenu"></div>
<nav id="nav">
 <button type="button" title="Cierra" class="cambiaMenu">
  <span class="material-symbols-outlined">
   close
  </span>
 </button>
 
   <p>
    <a href="/"
      data-logo="true">GilPG DM</a>
   </p>
   
   <p>
    <a href="/m05iot/">8. IoT</a>
   </p>
   
     <p>
      <a class="paginaAnterior" href="/m05iot/m-js/m-lib/m-ProblemDetailsError-js.html"
        title="7. js / lib / ProblemDetailsError.js"><span
        class="material-symbols-outlined">
         arrow_upward
        </span></a>
     </p>
   <h1><a href="/m05iot/m-paho.javascript-1.0.3/index.html">H. Carpeta « paho.javascript-1.0.3 »</a></h1>
   
   <ol type="A">
    
   <li>
    <p>
     <a href="/m05iot/m-paho.javascript-1.0.3/m-about-html.html">paho.javascript-1.0.3 / about.html</a>
    </p>
   </li>
   <li>
    <p>
     <a href="/m05iot/m-paho.javascript-1.0.3/m-CONTRIBUTING-md.html">paho.javascript-1.0.3 / CONTRIBUTING.md</a>
    </p>
   </li>
   <li>
    <p>
     <a href="/m05iot/m-paho.javascript-1.0.3/m-edl-v10.html">paho.javascript-1.0.3 / edl-v10</a>
    </p>
   </li>
   <li>
    <p>
     <a href="/m05iot/m-paho.javascript-1.0.3/m-epl-v10.html">paho.javascript-1.0.3 / epl-v10</a>
    </p>
   </li>
   <li>
    <p>
     <a href="/m05iot/m-paho.javascript-1.0.3/m-paho-mqtt-min-js.html">paho.javascript-1.0.3 / paho-mqtt-min.js</a>
    </p>
   </li>
   <li>
    <p>
     <a href="/m05iot/m-paho.javascript-1.0.3/m-paho-mqtt-js.html" class="actual">paho.javascript-1.0.3 / paho-mqtt.js</a>
    </p>
   </li>
   </ol>
   
    <p>
     <a class="paginaSiguiente" href="/m05iot/m-jsconfig-json.html"
       title="I. jsconfig.json"><span
       class="material-symbols-outlined">
        arrow_downward
       </span></a>
    </p>
 
</nav>
 <script>
 registraServiceWorker("/sw.js")
 const LOCAL_STORAGE_MENU = "menu"
 const MENU = "menu"
 const XMENU = "xmenu"
 const SCROLL = "scroll"
 const nav = document.querySelector("#nav")
 const abre = document.querySelector("#abre")

 /**@type {string} */
 let urlAnterior = "/m05iot/m-paho.javascript-1.0.3/m-paho-mqtt-min-js.html"
 /**@type {string} */
 let urlSiguiente = "/m05iot/m-jsconfig-json.html"
 /**@type {number|null} */
 let iniciaX = null
 /**@type {number|null} */
 let iniciaY = null
 /** @type {number} */
 let posY = 0
 /** @type {number} */
 let dy = 0
 /** @type {boolean} */
 let scrolling = false

 document.addEventListener("keydown", teclas)
 document.addEventListener("touchstart", iniciaTouch)
 document.addEventListener("touchmove", desplazaTouch)
 addEventListener("scroll", onScroll)
 if (abre) {
  abre.addEventListener("click", cambiaMenu)
 }
 const cambian = Array.from(document.querySelectorAll(".cambiaMenu"))
 for (const c of cambian) {
  c.addEventListener("click", cambiaMenu)
 }
 const menu = localStorage.getItem(LOCAL_STORAGE_MENU)
 if (menu) {
  if (menu === MENU) {
   document.body.classList.remove(XMENU)
   document.body.classList.add(MENU)
  } else {
   document.body.classList.remove(MENU)
   document.body.classList.add(XMENU)
  }
 }

 function registraServiceWorker(url) {
  if (navigator.serviceWorker) {
   navigator.serviceWorker.register(url).
    then(registro => {
     console.log("Service Worker registrado.")
     console.log(registro)
    }).
    catch(muestraError)
  }
 }

 function muestraError(e) {
  console.error(e)
  alert(e.message)
 }

 async function copyToClipboard(button) {
  try {
   const table = button.closest("table")
   if (table !== null) {
    const lineas = Array.from(table.querySelectorAll("td:nth-child(2)"))
    const codigo = lineas
     .map(linea => linea.textContent || "")
     .join("\n")
    if (codigo) {
     await navigator.clipboard.writeText(codigo)
     alert("Texto copiado al portapapeles.")
    }
   }
  } catch (e) {
   alert(e.message)
  }
 }

 function cambiaMenu() {
  document.body.classList.toggle(XMENU)
  document.body.classList.toggle(MENU)
  if (document.body.classList.contains(MENU)) {
   localStorage.setItem(LOCAL_STORAGE_MENU, MENU)
  } else {
   localStorage.setItem(LOCAL_STORAGE_MENU, XMENU)
  }
 }

 /** @param {KeyboardEvent} ev*/
 function teclas(ev) {
  switch (ev.key) {
   case "ArrowLeft":
    retrocede()
    break
   case "ArrowRight":
    avanza()
    break
  }
 }

 function retrocede() {
  if (urlAnterior) {
   location.href = urlAnterior
  }
 }

 function avanza() {
  if (urlSiguiente) {
   location.href = urlSiguiente
  }
 }

 /** @param {TouchEvent} ev*/
 function iniciaTouch(ev) {
  const toqueInicial = ev.touches[0]
  iniciaX = toqueInicial.clientX
  iniciaY = toqueInicial.clientY
 }

 /** @param {TouchEvent} ev*/
 function desplazaTouch(ev) {
  if (iniciaX && iniciaY) {
   const desplazamiento = ev.touches[0]
   var desplazamientoX = desplazamiento.clientX
   var desplazamientoY = desplazamiento.clientY
   var difX = desplazamientoX - iniciaX
   var difY = desplazamientoY - iniciaY
   // Checa que el movimiento no sea muy corto.
   if (Math.abs(difX) + Math.abs(difY) > 90) {
    if (Math.abs(difX) > Math.abs(difY)) {
     if (difX > 70) {
      retrocede()
     } else {
      avanza()
     }
     // Reinicia valores.
     iniciaX = null
     iniciaY = null
    }
   }
  }
 }

 function onScroll() {
  dy = scrollY - posY
  posY = scrollY
  if (!scrolling) {
   requestAnimationFrame(avanzaScroll)
  }
  scrolling = true
 }

 function avanzaScroll() {
  if (posY === 0) {
   document.body.classList.remove(SCROLL)
  } else if (dy < 0) {
   document.body.classList.remove(SCROLL)
  } else if (dy > 0) {
   document.body.classList.add(SCROLL)
  }
  scrolling = false
 }

</script>
</body>

</html>