<!DOCTYPE html>
<html lang="es" prefix="og: https://ogp.me/ns#">

<head>
 <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" sizes="32x32" href="/favicon.ico">
<meta name="theme-color" content="#039623">
<link rel="manifest" href="/site.webmanifest">
<script src="/lib/js/muestra-codigo.js"></script>
 <title>F. paho.javascript-1.0.3 / paho-mqtt.js - GilPG DM</title>
 <meta name="description" content="Código de «paho.javascript-1.0.3/paho-mqtt.js».">
 <meta name="og:image" content="https://gilpgdm.github.io/img/icono/icono2048.png">
 <style>
 /* https://paletton.com/#uid=74W0u0kllllaFw0g0qFqFg0w0aF */
 :root {
  --marginTop: 0.25rem;
  --padTop: 0;
  --h1PadTop: 2.5rem;
  --introDuracion: 2s;
  --introFuncion: ease-out;
  --padCont: 0.5rem;
  --padNav: 0.75rem 0.5rem;
  --anchoNav: 300px;
  --anchoLectura: 900px;
  --colLetra: black;
  --colFondo: white;
  --colPush: var(--colFondo);
  --colPushHover: var(--colFondo);
  --colPushFocus: var(--colFondo);
  --colPushActive: #bae397;
  --colFondoPush: #609732;
  --colFondoPushHover: #8abd5f;
  --colFondoPushFocus: #3e7213;
  --colFondoPushActive: #224c00;
  --paddingPush: 0.2rem 0.3rem;
  --borderPush: none;
  --borderRadiusPush: 0.6em;
  --colA: #6a7b15;
  --colAVisited: #6f256f;
  --colAActive: #e498af;
  --colAPush: var(--colFondo);
  --colAVisitedPush: var(--colFondo);
  --colAPushHover: var(--colFondo);
  --colAVisitedPushHover: var(--colFondo);
  --colAPushFocus: var(--colFondo);
  --colAVisitedPushFocus: var(--colFondo);
  --colAPushActive: var(--colFondo);
  --colAVisitedPushActive: var(--colFondo);
  --colFondoAPush: #6a7b15;
  --colFondoAVisitedPush: #6f256f;
  --colFondoAPushHover: #91a437;
  --colFondoAVisitedPushHover: #a66fa6;
  --colFondoAPushFocus: #445200;
  --colFondoAVisitedPushFocus: #530e53;
  --colFondoAPushActive: #e498af;
  --colFondoAVisitedPushActive: #e498af;
  --colSombra: #49494980;
  --navSombra: 0.5rem 0 0.5rem var(--colSombra);
  --shadowTitulo: 3px 1px 2px black;
  /* --colTitulo: #bae397; */
  --colTitulo: #609732;
  /* --colTituloFondo: #609732; */
  --colPrincipalTituloStrong: #6E256E;
  --colAStrong: var(--colLetra);
  /* --colNavH1Sel: #b35f7c; */
  --colFondoNav: var(--colFondo);
  --colFondoNavSel: #e498af;
  --colScrollbar: #CFD8DC;
  --colThumb: #90a4ae;
  --colThumbActivo: #3f3f3f;
  --colResaltado: #e9c8d2;
  --colResaltado2: #bae397;
  --colResaltado3: #cfcfcf;
  --colLetraResaltado: black;
  --colLetraCodeComment: #224c00;
  --colLetraCodeString: #903357;
  --colLetraCodeReserved: #445200;
  --colSecundario: #e498af;
  --colTarget: #cef4ff;
  --colStack1: black;
  --colStack2: #224ba5;
  --colStack3: #92731f;
  --anchoThumb: 7px;
  --borderRadiusThumb: 3.5px;
  --gap: 0.5rem;
  --fontMono: 'Xanh Mono', monospace;
  --fontSans: 'Patrick Hand', sans-serif;
  /* --fontSerif: 'Purple Purse', serif; */
  --fontSerif: Georgia, 'Times New Roman', Times, serif;
  font-family: var(--fontSerif);
  color: var(--colLetra);
  background-color: var(--colFondo);
  scrollbar-width: thin;
  scrollbar-color: var(--colThumb) var(--colScrollbar);
 }

 @media (prefers-color-scheme: light) {
  :root {
   --colLetra: black;
   --colFondo: white;
  }
 }

 /* https://paletton.com/#uid=74W0u0kaVz84jP27qHbeJtFiHpX */
 @media (prefers-color-scheme: dark) {

  :root {
   --colLetra: white;
   /* --colFondo: #272727; */
   --colFondo: black;
   --colPushActive: #e3f5d4;
   --colFondoPush: #bbe697;
   --colFondoPushHover: #d0eeb7;
   --colFondoPushFocus: #9ed372;
   --colFondoPushActive: #7db84d;
   --colA: #e9f7a3;
   --colAVisited: #c89ac8;
   --colAActive: #983351;
   --colFondoAPush: #e9f7a3;
   --colFondoAVisitedPush: #c89ac8;
   --colFondoAPushHover: #f6fcda;
   --colFondoAVisitedPushHover: #dec0de;
   --colFondoAPushFocus: #b4c853;
   --colFondoAVisitedPushFocus: #9a539a;
   --colFondoAPushActive: #983351;
   --colFondoAVisitedPushActive: #983351;
   --colSombra: #00000080;
   --colTitulo: #e3f5d4;
   --colPrincipalTituloStrong: #C899C8;
   /* --colTituloFondo: #7db84d; */
   /* --colNavH1Sel: #d37290; */
   --colFondoNavSel: #7a3059;
   --colScrollbar: #616161;
   --colThumb: #ffffff;
   --colResaltado: #7a3059;
   --colResaltado2: #5c922f;
   --colResaltado3: #4e4e4e;
   --colLetraResaltado: white;
   --colLetraCodeComment: #d0eeb7;
   --colLetraCodeString: #eeb7c8;
   --colLetraCodeReserved: #f0fac0;
  }
 }

 /* xanh-mono-regular - latin_latin-ext */
 @font-face {
  /* Check https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-display for other options. */
  font-display: swap;
  font-family: 'Xanh Mono';
  font-style: normal;
  font-weight: 400;
  /* Chrome 36+, Opera 23+, Firefox 39+, Safari 12+, iOS 10+ */
  src: url('/fonts/xanh-mono-v18-latin_latin-ext-regular.woff2') format('woff2');
 }

 /* xanh-mono-italic - latin_latin-ext */
 @font-face {
  /* Check https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-display for other options. */
  font-display: swap;
  font-family: 'Xanh Mono';
  font-style: italic;
  font-weight: 400;
  /* Chrome 36+, Opera 23+, Firefox 39+, Safari 12+, iOS 10+ */
  src: url('/fonts/xanh-mono-v18-latin_latin-ext-italic.woff2') format('woff2');
 }

 /* patrick-hand-regular - latin_latin-ext */
 @font-face {
  /* Check https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-display for other options. */
  font-display: swap;
  font-family: 'Patrick Hand';
  font-style: normal;
  font-weight: 400;
  /* Chrome 36+, Opera 23+, Firefox 39+, Safari 12+, iOS 10+ */
  src: url('/fonts/patrick-hand-v23-latin_latin-ext-regular.woff2') format('woff2');
 }

 /* purple-purse-regular - latin_latin-ext */
 @font-face {
  /* Check https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-display for other options. */
  font-display: swap;
  font-family: 'Purple Purse';
  font-style: normal;
  font-weight: 400;
  /* Chrome 36+, Opera 23+, Firefox 39+, Safari 12+, iOS 10+ */
  src: url('/fonts/purple-purse-v23-latin_latin-ext-regular.woff2') format('woff2');
 }

 @font-face {
  font-family: 'Material Symbols Outlined';
  font-style: normal;
  src:
   url(/fonts/MaterialSymbolsOutlined[FILL\,GRAD\,opsz\,wght].woff2) format('woff2'),
   url(/fonts/MaterialSymbolsOutlined[FILL\,GRAD\,opsz\,wght].ttf) format('truetype');
 }

 .material-symbols-outlined {
  font-family: 'Material Symbols Outlined';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  width: 24px;
  height: 24px;
  /* Preferred icon size */
  display: inline-block;
  line-height: 1;
  text-transform: none;
  letter-spacing: normal;
  word-wrap: normal;
  white-space: nowrap;
  direction: ltr;
 }

 body::-webkit-scrollbar {
  width: var(--anchoThumb);
  height: var(--anchoThumb);
 }

 body::-webkit-scrollbar-track {
  background: var(--colScrollbar);
 }

 body::-webkit-scrollbar-thumb {
  background-color: var(--colThumb);
  border-radius: var(--borderRadiusThumb);
 }

 body::-webkit-scrollbar-thumb:active {
  background-color: var(--colThumbActivo);
 }

 body {
  margin-top: 0;
 }

 a {
  color: var(--colA);
 }

 a:visited {
  color: var(--colAVisited);
 }

 a:active {
  color: var(--colAActive);
 }

 .anterior,
 .siguiente,
 .paginaAnterior,
 .paginaSiguiente,
 button {
  display: inline-block;
  padding: var(--paddingPush);
  border: var(--borderPush);
  border-radius: var(--borderRadiusPush);
  text-align: center;
  text-decoration: none;
 }

 .anterior,
 .siguiente,
 .paginaAnterior,
 .paginaSiguiente {
  color: var(--colAPush);
  background-color: var(--colFondoAPush);
 }

 .anterior:visited,
 .siguiente:visited,
 .paginaAnterior:visited,
 .paginaSiguiente:visited {
  color: var(--colAVisitedPush);
  background-color: var(--colFondoAVisitedPush);
 }

 .anterior.bye,
 .siguiente.bye,
 .paginaAnterior.bye,
 .paginaSiguiente.bye {
  display: none;
 }

 .anterior:hover,
 .siguiente:hover,
 .paginaAnterior:hover,
 .paginaSiguiente:hover {
  color: var(--colAPushHover);
  background-color: var(--colFondoAPushHover);
 }

 .anterior:visited:hover,
 .siguiente:visited:hover,
 .paginaAnterior:visited:hover,
 .paginaSiguiente:visited:hover {
  color: var(--colAVisitedPushHover);
  background-color: var(--colFondoAVisitedPushHover);
 }

 .anterior:focus,
 .siguiente:focus,
 .paginaAnterior:focus,
 .paginaSiguiente:focus {
  color: var(--colAPushFocus);
  background-color: var(--colFondoAPushFocus);
 }

 .anterior:visited:focus,
 .siguiente:visited:focus,
 .paginaAnterior:visited:focus,
 .paginaSiguiente:visited:focus {
  color: var(--colAVisitedPushFocus);
  background-color: var(--colFondoAVisitedPushFocus);
 }

 .anterior:active,
 .siguiente:active,
 .paginaAnterior:active,
 .paginaSiguiente:active {
  color: var(--colAPushActive);
  background-color: var(--colFondoAPushActive);
 }

 .anterior:visited:active,
 .siguiente:visited:active,
 .paginaAnterior:visited:active,
 .paginaSiguiente:visited:active {
  color: var(--colAVisitedPushActive);
  background-color: var(--colFondoAVisitedPushActive);
 }

 button {
  color: var(--colPush);
  background-color: var(--colFondoPush);
 }

 button:hover {
  color: var(--colPushHover);
  background-color: var(--colFondoPushHover);
 }

 button:focus {
  color: var(--colPushFocus);
  background-color: var(--colFondoPushFocus);
 }

 button:active {
  color: var(--colPushActive);
  background-color: var(--colFondoPushActive);
 }

 .anterior span,
 .siguiente span,
 .paginaAnterior span,
 .paginaSiguiente span,
 button span {
  vertical-align: middle;
 }

 a[data-logo] {
  display: block;
  height: 54px;
  line-height: 54px;
  padding-left: 54px;
  margin-top: 1rem;
  background-image: url("/img/icono/maskable_icon_x48.png");
  background-position: 3px center;
  background-repeat: no-repeat;
 }

 a strong,
 a code,
 h1 strong,
 h1 code {
  font-size: 1em;
 }

 a strong,
 a code {
  color: var(--colAStrong);
 }

 nav a {
  font-family: var(--fontSans);
 }

 pre {
  font-family: var(--fontMono);
 }

 code {
  font-family: var(--fontMono);
  font-size: 1rem;
 }

 .tree {
  font-family: var(--fontSans);
 }

 .tree summary {
  text-decoration: underline;
  cursor: pointer;
 }

 .tree li {
  margin-top: 1em;
  margin-bottom: 1em;
 }

 h1:not(.default) {
  font-family: var(--fontSans);
  color: var(--colTituloFondo);
 }

 h1,
 .lectura a,
 .lectura p,
 .lectura blockquote {
  overflow-wrap: anywhere;
 }

 .autor {
  font-family: var(--fontSans);
  font-size: 1.5rem;
  color: var(--colTituloFondo);
 }

 figure {
  text-align: center;
 }

 figure img {
  width: 100%;
 }

 figcaption {
  font-family: var(--fontMono);
 }

 .print .noPrint {
  display: none;
 }

 @media print {
  .noPrint {
   display: none;
  }

  .pruebaDeEscritorio {
   page-break-before: always;
  }
 }

 iframe {
  box-sizing: border-box;
  width: 300px;
 }

 .lectura {
  max-width: var(--anchoLectura);
  margin: 1rem auto;
 }

 .lectura p,
 .lectura blockquote {
  text-align: justify;
 }

 .horizontal {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  align-items: start;
  justify-content: center;
 }

 .horizontal>*:first-child {
  flex: 1 1 300px;
  text-align: center;
 }

 .horizontal>*:nth-child(2) {
  flex: 1 1 auto;
 }

 .columnas4 {
  columns: 4 180px;
  column-gap: 1rem;
 }

 .columnas2 {
  columns: 2 360px;
  column-gap: 1rem;
 }

 .resaltado {
  background-color: var(--colResaltado);
  color: var(--colLetraResaltado);
 }

 .resaltado2 {
  background-color: var(--colResaltado2);
  color: var(--colLetraResaltado);
 }

 .resaltado3 {
  background-color: var(--colResaltado3);
  color: var(--colLetraResaltado);
 }

 table.borde {
  margin-left: auto;
  margin-right: auto;
 }

 table.borde,
 table.borde td {
  border: thin solid;
  border-collapse: collapse;
 }

 table.borde th,
 table.borde td {
  padding: 0.4rem;
 }

 table.codeShow {
  margin-left: auto;
  margin-right: auto;
 }

 .codeShow td:first-child {
  text-align: right;
  padding: 0 0 0 0;
  vertical-align: top;
  font-family: var(--fontMono);
  white-space: pre;
  font-size: 1rem;
  line-height: 1.2rem;
  /* Avoid selection */
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
 }

 .codeShow td:nth-child(2) {
  padding: 0 0 0 0.25rem;
  vertical-align: top;
  font-family: var(--fontMono);
  white-space: pre-wrap;
  overflow-wrap: anywhere;
  font-size: 1rem;
  line-height: 1.2rem;
 }

 .codeReserved {
  color: var(--colLetraCodeReserved);
  font-weight: bolder;
 }

 .codeString {
  color: var(--colLetraCodeString);
  font-weight: 600;
 }

 .codeComment {
  color: var(--colLetraCodeComment);
  font-style: italic;
 }

 @media print {

  .codeShow button {
   display: none;
  }
 }


 footer {
  margin-top: 1rem;
  display: block;
  text-align: center;
  font-family: var(--fontSans);
  font-size: small;
 }
</style>
 <style>
 body {
  scroll-padding-top: var(--padTop);
 }

 body {
  animation-timing-function: var(--introFuncion);
  animation-duration: var(--introDuracion);
  animation-fill-mode: forwards;
  animation-name: appear;
 }

 body.noTransition {
  animation-name: noTransition;
 }

 @keyframes appear {
  from {
   opacity: 0;
  }

  to {
   opacity: 1;
  }
 }

 @keyframes noTransition {
  0% {
   opacity: 0;
  }

  0.7% {
   opacity: 1;
  }

  100% {
   opacity: 1;
  }
 }

 #principal {
  padding-top: var(--padTop);
  box-sizing: border-box;
  transition: margin-left 0.7s ease-in-out;
 }

 #principal a {
  word-wrap: break-word;
 }

 #principal>#abre {
  position: fixed;
  top: var(--gap);
  left: var(--gap);
  transition-property: top, left;
  transition-duration: 0.7s, 0.7s;
  transition-timing-function: ease-in-out;
 }

 #principal>.anterior {
  position: fixed;
  top: var(--gap);
  transition-property: top, left;
  transition-duration: 0.7s, 0.7s;
  transition-timing-function: ease-in-out;
 }

 #principal>.siguiente {
  position: fixed;
  top: var(--gap);
  right: var(--gap);
  transition: top 0.7s ease-in-out;
 }

 .scroll #principal>#abre,
 .scroll #principal>.anterior,
 .scroll #principal>.siguiente {
  top: -10rem;
 }

 #principal>h1:not(.default) {
  margin-top: var(--marginTop);
  padding: var(--h1PadTop) 1rem 1rem 1rem;
  color: var(--colTitulo);
  background-color: var(--colTituloFondo);
 }

 #principal>h1:not(.default) strong,
 #principal>h1:not(.default) code {
  color: var(--colPrincipalTituloStrong);
 }

 #nav {
  position: fixed;
  top: 0;
  left: 0;
  bottom: 0;
  box-sizing: border-box;
  overflow: auto;
  color: var(--colLetra);
  background-color: var(--colFondoNav);
  padding: var(--padCont);
  transition: transform 0.7s ease-in-out;
  scrollbar-width: thin;
  scrollbar-color: var(--colThumb) var(--colScrollbar);
  overflow-wrap: anywhere;
 }

 #nav::-webkit-scrollbar {
  width: var(--anchoThumb);
  height: var(--anchoThumb);
 }

 #nav::-webkit-scrollbar-track {
  background: var(--colScrollbar);
 }

 #nav::-webkit-scrollbar-thumb {
  background-color: var(--colThumb);
  border-radius: var(--borderRadiusThumb);
 }

 #nav::-webkit-scrollbar-thumb:active {
  background-color: var(--colThumbActivo);
 }

 #nav p {
  margin: 0;
 }

 #nav a:not([data-logo]) {
  display: block;
  padding: var(--padNav);
 }

 #nav a.actual code,
 #nav a.actual strong {
  color: var(--colAStrong);
 }

 #nav a.actual {
  background-color: var(--colFondoNavSel);
 }

 @media screen and (max-width: 999px) {
  #principal {
   max-width: 100vw;
  }

  #cierra {
   position: fixed;
   top: 0;
   bottom: 0;
   left: 0;
   right: 0;
   background-color: var(--colSombra);
   transform: translateX(-120%);
   transition: transform 0.7s ease-out;
  }

  #nav {
   width: min(var(--anchoNav), 70%);
   box-shadow: var(--navSombra);
  }

  .xmenu>#nav {
   transform: translateX(-120%);
  }

  .menu>#cierra,
  .menu>#nav {
   transform: translateX(0);
  }

  #principal>.anterior {
   left: calc(2 * var(--gap) + 2rem);
  }
 }

 @media screen and (min-width: 1000px) {
  #cierra {
   display: none;
  }

  #nav {
   width: var(--anchoNav);
  }

  .menu>#nav {
   transform: translateX(-120%);
  }

  .xmenu>#principal {
   margin-left: var(--anchoNav)
  }

  .menu>#principal>.anterior {
   left: calc(2 * var(--gap) + 2rem);
  }

  .xmenu>#principal>.anterior {
   top: var(--gap);
   left: calc(var(--anchoNav) + var(--gap));
  }

  .xmenu.scroll #principal>.anterior {
   top: -10rem;
  }
 }

 @media print {

  #nav,
  #principal>#abre,
  #principal>.anterior,
  #principal>.siguiente {
   display: none;
  }

  #principal>h1:not(.default) {
   margin-top: 0.5rem;
   padding: 1rem;
   color: var(--colTituloFondo);
   background-color: transparent;
  }

 }
</style>
 
</head>

<body  class="xmenu">
 <div id="principal">
   <h1 >F. paho.javascript-1.0.3 / paho-mqtt.js</h1><table class="codeShow">
 <caption style="text-align: left">
  <button type=button title="Copiar al portapapeles"
    onclick="copyToClipboard(this)">
   <span class="material-symbols-outlined">
    content_copy
   </span>
  </button>
 </caption>
 <tbody>
  <tr><td>1</td><td><span class="codeComment">/*******************************************************************************</span></td></tr>
  <tr><td>2</td><td><span class="codeComment"> * Copyright (c) 2013 IBM Corp.</span></td></tr>
  <tr><td>3</td><td><span class="codeComment"> *</span></td></tr>
  <tr><td>4</td><td><span class="codeComment"> * All rights reserved. This program and the accompanying materials</span></td></tr>
  <tr><td>5</td><td><span class="codeComment"> * are made available under the terms of the Eclipse Public License v1.0</span></td></tr>
  <tr><td>6</td><td><span class="codeComment"> * and Eclipse Distribution License v1.0 which accompany <span class="codeReserved">this</span> distribution.</span></td></tr>
  <tr><td>7</td><td><span class="codeComment"> *</span></td></tr>
  <tr><td>8</td><td><span class="codeComment"> * The Eclipse Public License is available at</span></td></tr>
  <tr><td>9</td><td><span class="codeComment"> *    http://www.eclipse.org/legal/epl-v10.html</span></td></tr>
  <tr><td>10</td><td><span class="codeComment"> * and the Eclipse Distribution License is available at</span></td></tr>
  <tr><td>11</td><td><span class="codeComment"> *   http://www.eclipse.org/org/documents/edl-v10.php.</span></td></tr>
  <tr><td>12</td><td><span class="codeComment"> *</span></td></tr>
  <tr><td>13</td><td><span class="codeComment"> * Contributors:</span></td></tr>
  <tr><td>14</td><td><span class="codeComment"> *    Andrew Banks - initial API and implementation and initial documentation</span></td></tr>
  <tr><td>15</td><td><span class="codeComment"> *******************************************************************************/</span></td></tr>
  <tr><td>16</td><td></td></tr>
  <tr><td>17</td><td></td></tr>
  <tr><td>18</td><td><span class="codeComment">// Only expose a single object name in the global namespace.</span></td></tr>
  <tr><td>19</td><td><span class="codeComment">// Everything must go through this module. Global Paho.MQTT module</span></td></tr>
  <tr><td>20</td><td><span class="codeComment">// only has a single public function, client, which returns</span></td></tr>
  <tr><td>21</td><td><span class="codeComment">// a Paho.MQTT client object given connection details.</span></td></tr>
  <tr><td>22</td><td></td></tr>
  <tr><td>23</td><td><span class="codeComment">/**</span></td></tr>
  <tr><td>24</td><td><span class="codeComment"> * Send and receive messages using web browsers.</span></td></tr>
  <tr><td>25</td><td><span class="codeComment"> * &lt;p&gt;</span></td></tr>
  <tr><td>26</td><td><span class="codeComment"> * This programming interface lets a JavaScript client application use the MQTT V3.1 or</span></td></tr>
  <tr><td>27</td><td><span class="codeComment"> * V3.1.1 protocol <span class="codeReserved">to</span> connect <span class="codeReserved">to</span> an MQTT-supporting messaging server.</span></td></tr>
  <tr><td>28</td><td><span class="codeComment"> *</span></td></tr>
  <tr><td>29</td><td><span class="codeComment"> * The <span class="codeReserved">function</span> supported includes:</span></td></tr>
  <tr><td>30</td><td><span class="codeComment"> * &lt;ol&gt;</span></td></tr>
  <tr><td>31</td><td><span class="codeComment"> * &lt;li&gt;Connecting <span class="codeReserved">to</span> and disconnecting <span class="codeReserved">from</span> a server. The server is identified by its host name and port number.</span></td></tr>
  <tr><td>32</td><td><span class="codeComment"> * &lt;li&gt;Specifying options that relate <span class="codeReserved">to</span> the communications link with the server,</span></td></tr>
  <tr><td>33</td><td><span class="codeComment"> * <span class="codeReserved">for</span> example the frequency of keep-alive heartbeats, and whether SSL/TLS is required.</span></td></tr>
  <tr><td>34</td><td><span class="codeComment"> * &lt;li&gt;Subscribing <span class="codeReserved">to</span> and receiving messages <span class="codeReserved">from</span> MQTT Topics.</span></td></tr>
  <tr><td>35</td><td><span class="codeComment"> * &lt;li&gt;Publishing messages <span class="codeReserved">to</span> MQTT Topics.</span></td></tr>
  <tr><td>36</td><td><span class="codeComment"> * &lt;/ol&gt;</span></td></tr>
  <tr><td>37</td><td><span class="codeComment"> * &lt;p&gt;</span></td></tr>
  <tr><td>38</td><td><span class="codeComment"> * The API consists of two main objects:</span></td></tr>
  <tr><td>39</td><td><span class="codeComment"> * &lt;dl&gt;</span></td></tr>
  <tr><td>40</td><td><span class="codeComment"> * &lt;dt&gt;&lt;b&gt;{<span class="codeReserved">@link</span> Paho.MQTT.Client}&lt;/b&gt;&lt;/dt&gt;</span></td></tr>
  <tr><td>41</td><td><span class="codeComment"> * &lt;dd&gt;This contains methods that provide the functionality of the API,</span></td></tr>
  <tr><td>42</td><td><span class="codeComment"> * including provision of callbacks that notify the application when a message</span></td></tr>
  <tr><td>43</td><td><span class="codeComment"> * arrives <span class="codeReserved">from</span> or is delivered <span class="codeReserved">to</span> the messaging server,</span></td></tr>
  <tr><td>44</td><td><span class="codeComment"> * or when the status of its connection <span class="codeReserved">to</span> the messaging server changes.&lt;/dd&gt;</span></td></tr>
  <tr><td>45</td><td><span class="codeComment"> * &lt;dt&gt;&lt;b&gt;{<span class="codeReserved">@link</span> Paho.MQTT.Message}&lt;/b&gt;&lt;/dt&gt;</span></td></tr>
  <tr><td>46</td><td><span class="codeComment"> * &lt;dd&gt;This encapsulates the payload of the message along with various attributes</span></td></tr>
  <tr><td>47</td><td><span class="codeComment"> * associated with its delivery, <span class="codeReserved">in</span> particular the destination <span class="codeReserved">to</span> which it has</span></td></tr>
  <tr><td>48</td><td><span class="codeComment"> * been (or is about <span class="codeReserved">to</span> be) sent.&lt;/dd&gt;</span></td></tr>
  <tr><td>49</td><td><span class="codeComment"> * &lt;/dl&gt;</span></td></tr>
  <tr><td>50</td><td><span class="codeComment"> * &lt;p&gt;</span></td></tr>
  <tr><td>51</td><td><span class="codeComment"> * The programming interface validates parameters passed <span class="codeReserved">to</span> it, and will <span class="codeReserved">throw</span></span></td></tr>
  <tr><td>52</td><td><span class="codeComment"> * an Error containing an error message intended <span class="codeReserved">for</span> developer use, <span class="codeReserved">if</span> it detects</span></td></tr>
  <tr><td>53</td><td><span class="codeComment"> * an error with any parameter.</span></td></tr>
  <tr><td>54</td><td><span class="codeComment"> * &lt;p&gt;</span></td></tr>
  <tr><td>55</td><td><span class="codeComment"> * Example:</span></td></tr>
  <tr><td>56</td><td><span class="codeComment"> *</span></td></tr>
  <tr><td>57</td><td><span class="codeComment"> * &lt;code&gt;&lt;pre&gt;</span></td></tr>
  <tr><td>58</td><td><span class="codeComment">client = <span class="codeReserved">new</span> Paho.MQTT.Client(location.hostname, Number(location.port), &quot;clientId&quot;);</span></td></tr>
  <tr><td>59</td><td><span class="codeComment">client.onConnectionLost = onConnectionLost;</span></td></tr>
  <tr><td>60</td><td><span class="codeComment">client.onMessageArrived = onMessageArrived;</span></td></tr>
  <tr><td>61</td><td><span class="codeComment">client.connect({onSuccess:onConnect});</span></td></tr>
  <tr><td>62</td><td><span class="codeComment"></span></td></tr>
  <tr><td>63</td><td><span class="codeComment"><span class="codeReserved">function</span> onConnect() {</span></td></tr>
  <tr><td>64</td><td><span class="codeComment">  // Once a connection has been made, make a subscription and send a message.</span></td></tr>
  <tr><td>65</td><td><span class="codeComment">  console.log(&quot;onConnect&quot;);</span></td></tr>
  <tr><td>66</td><td><span class="codeComment">  client.subscribe(&quot;/World&quot;);</span></td></tr>
  <tr><td>67</td><td><span class="codeComment">  message = <span class="codeReserved">new</span> Paho.MQTT.Message(&quot;Hello&quot;);</span></td></tr>
  <tr><td>68</td><td><span class="codeComment">  message.destinationName = &quot;/World&quot;;</span></td></tr>
  <tr><td>69</td><td><span class="codeComment">  client.send(message);</span></td></tr>
  <tr><td>70</td><td><span class="codeComment">};</span></td></tr>
  <tr><td>71</td><td><span class="codeComment"><span class="codeReserved">function</span> onConnectionLost(responseObject) {</span></td></tr>
  <tr><td>72</td><td><span class="codeComment">  <span class="codeReserved">if</span> (responseObject.errorCode !== 0)</span></td></tr>
  <tr><td>73</td><td><span class="codeComment">	console.log(&quot;onConnectionLost:&quot;+responseObject.errorMessage);</span></td></tr>
  <tr><td>74</td><td><span class="codeComment">};</span></td></tr>
  <tr><td>75</td><td><span class="codeComment"><span class="codeReserved">function</span> onMessageArrived(message) {</span></td></tr>
  <tr><td>76</td><td><span class="codeComment">  console.log(&quot;onMessageArrived:&quot;+message.payloadString);</span></td></tr>
  <tr><td>77</td><td><span class="codeComment">  client.disconnect();</span></td></tr>
  <tr><td>78</td><td><span class="codeComment">};</span></td></tr>
  <tr><td>79</td><td><span class="codeComment"> * &lt;/pre&gt;&lt;/code&gt;</span></td></tr>
  <tr><td>80</td><td><span class="codeComment"> * <span class="codeReserved">@namespace</span> Paho.MQTT</span></td></tr>
  <tr><td>81</td><td><span class="codeComment"> */</span></td></tr>
  <tr><td>82</td><td></td></tr>
  <tr><td>83</td><td><span class="codeComment">/* jshint shadow:<span class="codeReserved">true</span> */</span></td></tr>
  <tr><td>84</td><td>(<span class="codeReserved">function</span> ExportLibrary(root, factory) {</td></tr>
  <tr><td>85</td><td>	<span class="codeReserved">if</span>(<span class="codeReserved">typeof</span> exports === <span class="codeString">'object'</span> && <span class="codeReserved">typeof</span> module === <span class="codeString">'object'</span>){</td></tr>
  <tr><td>86</td><td>		module.exports = factory();</td></tr>
  <tr><td>87</td><td>	} <span class="codeReserved">else</span> <span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> define === <span class="codeString">'<span class="codeReserved">function</span>'</span> && define.amd){</td></tr>
  <tr><td>88</td><td>		define(factory);</td></tr>
  <tr><td>89</td><td>	} <span class="codeReserved">else</span> <span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> exports === <span class="codeString">'object'</span>){</td></tr>
  <tr><td>90</td><td>		exports = factory();</td></tr>
  <tr><td>91</td><td>	} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>92</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> root.Paho === <span class="codeString">'undefined'</span>){</td></tr>
  <tr><td>93</td><td>			root.Paho = {};</td></tr>
  <tr><td>94</td><td>		}</td></tr>
  <tr><td>95</td><td>		root.Paho.MQTT = factory();</td></tr>
  <tr><td>96</td><td>	}</td></tr>
  <tr><td>97</td><td>})(<span class="codeReserved">this</span>, <span class="codeReserved">function</span> LibraryFactory(){</td></tr>
  <tr><td>98</td><td></td></tr>
  <tr><td>99</td><td></td></tr>
  <tr><td>100</td><td><span class="codeReserved">var</span> PahoMQTT = (<span class="codeReserved">function</span> (global) {</td></tr>
  <tr><td>101</td><td></td></tr>
  <tr><td>102</td><td>	<span class="codeComment">// Private variables below, these are only visible inside the function closure</span></td></tr>
  <tr><td>103</td><td>	<span class="codeComment">// which is used to define the module.</span></td></tr>
  <tr><td>104</td><td></td></tr>
  <tr><td>105</td><td>	<span class="codeReserved">var</span> version = <span class="codeString">"@VERSION@"</span>;</td></tr>
  <tr><td>106</td><td>	<span class="codeReserved">var</span> buildLevel = <span class="codeString">"@BUILDLEVEL@"</span>;</td></tr>
  <tr><td>107</td><td></td></tr>
  <tr><td>108</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>109</td><td><span class="codeComment">	 * Unique message type identifiers, with associated</span></td></tr>
  <tr><td>110</td><td><span class="codeComment">	 * associated integer values.</span></td></tr>
  <tr><td>111</td><td><span class="codeComment">	 * <span class="codeReserved">@private</span></span></td></tr>
  <tr><td>112</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>113</td><td>	<span class="codeReserved">var</span> MESSAGE_TYPE = {</td></tr>
  <tr><td>114</td><td>		CONNECT: 1,</td></tr>
  <tr><td>115</td><td>		CONNACK: 2,</td></tr>
  <tr><td>116</td><td>		PUBLISH: 3,</td></tr>
  <tr><td>117</td><td>		PUBACK: 4,</td></tr>
  <tr><td>118</td><td>		PUBREC: 5,</td></tr>
  <tr><td>119</td><td>		PUBREL: 6,</td></tr>
  <tr><td>120</td><td>		PUBCOMP: 7,</td></tr>
  <tr><td>121</td><td>		SUBSCRIBE: 8,</td></tr>
  <tr><td>122</td><td>		SUBACK: 9,</td></tr>
  <tr><td>123</td><td>		UNSUBSCRIBE: 10,</td></tr>
  <tr><td>124</td><td>		UNSUBACK: 11,</td></tr>
  <tr><td>125</td><td>		PINGREQ: 12,</td></tr>
  <tr><td>126</td><td>		PINGRESP: 13,</td></tr>
  <tr><td>127</td><td>		DISCONNECT: 14</td></tr>
  <tr><td>128</td><td>	};</td></tr>
  <tr><td>129</td><td></td></tr>
  <tr><td>130</td><td>	<span class="codeComment">// Collection of utility methods used to simplify module code</span></td></tr>
  <tr><td>131</td><td>	<span class="codeComment">// and promote the DRY pattern.</span></td></tr>
  <tr><td>132</td><td></td></tr>
  <tr><td>133</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>134</td><td><span class="codeComment">	 * Validate an object&#039;s parameter names <span class="codeReserved">to</span> ensure they</span></td></tr>
  <tr><td>135</td><td><span class="codeComment">	 * match a list of expected variables name <span class="codeReserved">for</span> <span class="codeReserved">this</span> option</span></td></tr>
  <tr><td>136</td><td><span class="codeComment">	 * type. Used <span class="codeReserved">to</span> ensure option object passed into the API don&#039;t</span></td></tr>
  <tr><td>137</td><td><span class="codeComment">	 * contain erroneous parameters.</span></td></tr>
  <tr><td>138</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> {Object} obj - User options object</span></td></tr>
  <tr><td>139</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> {Object} keys - valid keys and types that may exist <span class="codeReserved">in</span> obj.</span></td></tr>
  <tr><td>140</td><td><span class="codeComment">	 * <span class="codeReserved">@throws</span> {Error} Invalid option parameter found.</span></td></tr>
  <tr><td>141</td><td><span class="codeComment">	 * <span class="codeReserved">@private</span></span></td></tr>
  <tr><td>142</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>143</td><td>	<span class="codeReserved">var</span> validate = <span class="codeReserved">function</span>(obj, keys) {</td></tr>
  <tr><td>144</td><td>		<span class="codeReserved">for</span> (<span class="codeReserved">var</span> key <span class="codeReserved">in</span> obj) {</td></tr>
  <tr><td>145</td><td>			<span class="codeReserved">if</span> (obj.hasOwnProperty(key)) {</td></tr>
  <tr><td>146</td><td>				<span class="codeReserved">if</span> (keys.hasOwnProperty(key)) {</td></tr>
  <tr><td>147</td><td>					<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> obj[key] !== keys[key])</td></tr>
  <tr><td>148</td><td>					   <span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> obj[key], key]));</td></tr>
  <tr><td>149</td><td>				} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>150</td><td>					<span class="codeReserved">var</span> errorStr = <span class="codeString">"Unknown property, "</span> + key + <span class="codeString">". Valid properties are:"</span>;</td></tr>
  <tr><td>151</td><td>					<span class="codeReserved">for</span> (<span class="codeReserved">var</span> validKey <span class="codeReserved">in</span> keys)</td></tr>
  <tr><td>152</td><td>						<span class="codeReserved">if</span> (keys.hasOwnProperty(validKey))</td></tr>
  <tr><td>153</td><td>							errorStr = errorStr+<span class="codeString">" "</span>+validKey;</td></tr>
  <tr><td>154</td><td>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(errorStr);</td></tr>
  <tr><td>155</td><td>				}</td></tr>
  <tr><td>156</td><td>			}</td></tr>
  <tr><td>157</td><td>		}</td></tr>
  <tr><td>158</td><td>	};</td></tr>
  <tr><td>159</td><td></td></tr>
  <tr><td>160</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>161</td><td><span class="codeComment">	 * Return a <span class="codeReserved">new</span> <span class="codeReserved">function</span> which runs the user <span class="codeReserved">function</span> bound</span></td></tr>
  <tr><td>162</td><td><span class="codeComment">	 * <span class="codeReserved">to</span> a fixed scope.</span></td></tr>
  <tr><td>163</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> {<span class="codeReserved">function</span>} User <span class="codeReserved">function</span></span></td></tr>
  <tr><td>164</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> {object} Function scope</span></td></tr>
  <tr><td>165</td><td><span class="codeComment">	 * <span class="codeReserved">@return</span> {<span class="codeReserved">function</span>} User <span class="codeReserved">function</span> bound <span class="codeReserved">to</span> another scope</span></td></tr>
  <tr><td>166</td><td><span class="codeComment">	 * <span class="codeReserved">@private</span></span></td></tr>
  <tr><td>167</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>168</td><td>	<span class="codeReserved">var</span> scope = <span class="codeReserved">function</span> (f, scope) {</td></tr>
  <tr><td>169</td><td>		<span class="codeReserved">return</span> <span class="codeReserved">function</span> () {</td></tr>
  <tr><td>170</td><td>			<span class="codeReserved">return</span> f.apply(scope, arguments);</td></tr>
  <tr><td>171</td><td>		};</td></tr>
  <tr><td>172</td><td>	};</td></tr>
  <tr><td>173</td><td></td></tr>
  <tr><td>174</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>175</td><td><span class="codeComment">	 * Unique message type identifiers, with associated</span></td></tr>
  <tr><td>176</td><td><span class="codeComment">	 * associated integer values.</span></td></tr>
  <tr><td>177</td><td><span class="codeComment">	 * <span class="codeReserved">@private</span></span></td></tr>
  <tr><td>178</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>179</td><td>	<span class="codeReserved">var</span> ERROR = {</td></tr>
  <tr><td>180</td><td>		OK: {code:0, text:<span class="codeString">"AMQJSC0000I OK."</span>},</td></tr>
  <tr><td>181</td><td>		CONNECT_TIMEOUT: {code:1, text:<span class="codeString">"AMQJSC0001E Connect timed out."</span>},</td></tr>
  <tr><td>182</td><td>		SUBSCRIBE_TIMEOUT: {code:2, text:<span class="codeString">"AMQJS0002E Subscribe timed out."</span>},</td></tr>
  <tr><td>183</td><td>		UNSUBSCRIBE_TIMEOUT: {code:3, text:<span class="codeString">"AMQJS0003E Unsubscribe timed out."</span>},</td></tr>
  <tr><td>184</td><td>		PING_TIMEOUT: {code:4, text:<span class="codeString">"AMQJS0004E Ping timed out."</span>},</td></tr>
  <tr><td>185</td><td>		INTERNAL_ERROR: {code:5, text:<span class="codeString">"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}"</span>},</td></tr>
  <tr><td>186</td><td>		CONNACK_RETURNCODE: {code:6, text:<span class="codeString">"AMQJS0006E Bad Connack <span class="codeReserved">return</span> code:{0} {1}."</span>},</td></tr>
  <tr><td>187</td><td>		SOCKET_ERROR: {code:7, text:<span class="codeString">"AMQJS0007E Socket error:{0}."</span>},</td></tr>
  <tr><td>188</td><td>		SOCKET_CLOSE: {code:8, text:<span class="codeString">"AMQJS0008I Socket closed."</span>},</td></tr>
  <tr><td>189</td><td>		MALFORMED_UTF: {code:9, text:<span class="codeString">"AMQJS0009E Malformed UTF data:{0} {1} {2}."</span>},</td></tr>
  <tr><td>190</td><td>		UNSUPPORTED: {code:10, text:<span class="codeString">"AMQJS0010E {0} is not supported by <span class="codeReserved">this</span> browser."</span>},</td></tr>
  <tr><td>191</td><td>		INVALID_STATE: {code:11, text:<span class="codeString">"AMQJS0011E Invalid state {0}."</span>},</td></tr>
  <tr><td>192</td><td>		INVALID_TYPE: {code:12, text:<span class="codeString">"AMQJS0012E Invalid type {0} <span class="codeReserved">for</span> {1}."</span>},</td></tr>
  <tr><td>193</td><td>		INVALID_ARGUMENT: {code:13, text:<span class="codeString">"AMQJS0013E Invalid argument {0} <span class="codeReserved">for</span> {1}."</span>},</td></tr>
  <tr><td>194</td><td>		UNSUPPORTED_OPERATION: {code:14, text:<span class="codeString">"AMQJS0014E Unsupported operation."</span>},</td></tr>
  <tr><td>195</td><td>		INVALID_STORED_DATA: {code:15, text:<span class="codeString">"AMQJS0015E Invalid data <span class="codeReserved">in</span> local storage key={0} value={1}."</span>},</td></tr>
  <tr><td>196</td><td>		INVALID_MQTT_MESSAGE_TYPE: {code:16, text:<span class="codeString">"AMQJS0016E Invalid MQTT message type {0}."</span>},</td></tr>
  <tr><td>197</td><td>		MALFORMED_UNICODE: {code:17, text:<span class="codeString">"AMQJS0017E Malformed Unicode string:{0} {1}."</span>},</td></tr>
  <tr><td>198</td><td>		BUFFER_FULL: {code:18, text:<span class="codeString">"AMQJS0018E Message buffer is full, maximum buffer size: {0}."</span>},</td></tr>
  <tr><td>199</td><td>	};</td></tr>
  <tr><td>200</td><td></td></tr>
  <tr><td>201</td><td>	<span class="codeComment">/** CONNACK RC Meaning. */</span></td></tr>
  <tr><td>202</td><td>	<span class="codeReserved">var</span> CONNACK_RC = {</td></tr>
  <tr><td>203</td><td>		0:<span class="codeString">"Connection Accepted"</span>,</td></tr>
  <tr><td>204</td><td>		1:<span class="codeString">"Connection Refused: unacceptable protocol version"</span>,</td></tr>
  <tr><td>205</td><td>		2:<span class="codeString">"Connection Refused: identifier rejected"</span>,</td></tr>
  <tr><td>206</td><td>		3:<span class="codeString">"Connection Refused: server unavailable"</span>,</td></tr>
  <tr><td>207</td><td>		4:<span class="codeString">"Connection Refused: bad user name or password"</span>,</td></tr>
  <tr><td>208</td><td>		5:<span class="codeString">"Connection Refused: not authorized"</span></td></tr>
  <tr><td>209</td><td>	};</td></tr>
  <tr><td>210</td><td></td></tr>
  <tr><td>211</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>212</td><td><span class="codeComment">	 * Format an error message text.</span></td></tr>
  <tr><td>213</td><td><span class="codeComment">	 * <span class="codeReserved">@private</span></span></td></tr>
  <tr><td>214</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> {error} ERROR.<span class="codeReserved">KEY</span> value above.</span></td></tr>
  <tr><td>215</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> {substitutions} [array] substituted into the text.</span></td></tr>
  <tr><td>216</td><td><span class="codeComment">	 * <span class="codeReserved">@return</span> the text with the substitutions made.</span></td></tr>
  <tr><td>217</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>218</td><td>	<span class="codeReserved">var</span> format = <span class="codeReserved">function</span>(error, substitutions) {</td></tr>
  <tr><td>219</td><td>		<span class="codeReserved">var</span> text = error.text;</td></tr>
  <tr><td>220</td><td>		<span class="codeReserved">if</span> (substitutions) {</td></tr>
  <tr><td>221</td><td>		  <span class="codeReserved">var</span> field,start;</td></tr>
  <tr><td>222</td><td>		  <span class="codeReserved">for</span> (<span class="codeReserved">var</span> i=0; i&lt;<span class="codeReserved">substitutions</span>.length; i++) {</td></tr>
  <tr><td>223</td><td>			field = <span class="codeString">"{"</span>+i+<span class="codeString">"}"</span>;</td></tr>
  <tr><td>224</td><td>			start = text.indexOf(field);</td></tr>
  <tr><td>225</td><td>			<span class="codeReserved">if</span>(start &gt; 0) {</td></tr>
  <tr><td>226</td><td>				<span class="codeReserved">var</span> part1 = text.substring(0,start);</td></tr>
  <tr><td>227</td><td>				<span class="codeReserved">var</span> part2 = text.substring(start+field.length);</td></tr>
  <tr><td>228</td><td>				text = part1+substitutions[i]+part2;</td></tr>
  <tr><td>229</td><td>			}</td></tr>
  <tr><td>230</td><td>		  }</td></tr>
  <tr><td>231</td><td>		}</td></tr>
  <tr><td>232</td><td>		<span class="codeReserved">return</span> text;</td></tr>
  <tr><td>233</td><td>	};</td></tr>
  <tr><td>234</td><td></td></tr>
  <tr><td>235</td><td>	<span class="codeComment">//MQTT protocol and version          6    M    Q    I    s    d    p    3</span></td></tr>
  <tr><td>236</td><td>	<span class="codeReserved">var</span> MqttProtoIdentifierv3 = [0x00,0x06,0x4d,0x51,0x49,0x73,0x64,0x70,0x03];</td></tr>
  <tr><td>237</td><td>	<span class="codeComment">//MQTT proto/version for 311         4    M    Q    T    T    4</span></td></tr>
  <tr><td>238</td><td>	<span class="codeReserved">var</span> MqttProtoIdentifierv4 = [0x00,0x04,0x4d,0x51,0x54,0x54,0x04];</td></tr>
  <tr><td>239</td><td></td></tr>
  <tr><td>240</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>241</td><td><span class="codeComment">	 * Construct an MQTT wire protocol message.</span></td></tr>
  <tr><td>242</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> type MQTT packet type.</span></td></tr>
  <tr><td>243</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> options optional wire message attributes.</span></td></tr>
  <tr><td>244</td><td><span class="codeComment">	 *</span></td></tr>
  <tr><td>245</td><td><span class="codeComment">	 * Optional properties</span></td></tr>
  <tr><td>246</td><td><span class="codeComment">	 *</span></td></tr>
  <tr><td>247</td><td><span class="codeComment">	 * messageIdentifier: message ID <span class="codeReserved">in</span> the range [0..65535]</span></td></tr>
  <tr><td>248</td><td><span class="codeComment">	 * payloadMessage:	Application Message - PUBLISH only</span></td></tr>
  <tr><td>249</td><td><span class="codeComment">	 * connectStrings:	array of 0 or more Strings <span class="codeReserved">to</span> be put into the CONNECT payload</span></td></tr>
  <tr><td>250</td><td><span class="codeComment">	 * topics:			array of strings (SUBSCRIBE, UNSUBSCRIBE)</span></td></tr>
  <tr><td>251</td><td><span class="codeComment">	 * requestQoS:		array of QoS values [0..2]</span></td></tr>
  <tr><td>252</td><td><span class="codeComment">	 *</span></td></tr>
  <tr><td>253</td><td><span class="codeComment">	 * &quot;Flag&quot; properties</span></td></tr>
  <tr><td>254</td><td><span class="codeComment">	 * cleanSession:	<span class="codeReserved">true</span> <span class="codeReserved">if</span> present / <span class="codeReserved">false</span> <span class="codeReserved">if</span> absent (CONNECT)</span></td></tr>
  <tr><td>255</td><td><span class="codeComment">	 * willMessage:  	<span class="codeReserved">true</span> <span class="codeReserved">if</span> present / <span class="codeReserved">false</span> <span class="codeReserved">if</span> absent (CONNECT)</span></td></tr>
  <tr><td>256</td><td><span class="codeComment">	 * isRetained:		<span class="codeReserved">true</span> <span class="codeReserved">if</span> present / <span class="codeReserved">false</span> <span class="codeReserved">if</span> absent (CONNECT)</span></td></tr>
  <tr><td>257</td><td><span class="codeComment">	 * userName:		<span class="codeReserved">true</span> <span class="codeReserved">if</span> present / <span class="codeReserved">false</span> <span class="codeReserved">if</span> absent (CONNECT)</span></td></tr>
  <tr><td>258</td><td><span class="codeComment">	 * password:		<span class="codeReserved">true</span> <span class="codeReserved">if</span> present / <span class="codeReserved">false</span> <span class="codeReserved">if</span> absent (CONNECT)</span></td></tr>
  <tr><td>259</td><td><span class="codeComment">	 * keepAliveInterval:	integer [0..65535]  (CONNECT)</span></td></tr>
  <tr><td>260</td><td><span class="codeComment">	 *</span></td></tr>
  <tr><td>261</td><td><span class="codeComment">	 * <span class="codeReserved">@private</span></span></td></tr>
  <tr><td>262</td><td><span class="codeComment">	 * <span class="codeReserved">@ignore</span></span></td></tr>
  <tr><td>263</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>264</td><td>	<span class="codeReserved">var</span> WireMessage = <span class="codeReserved">function</span> (type, options) {</td></tr>
  <tr><td>265</td><td>		<span class="codeReserved">this</span>.type = type;</td></tr>
  <tr><td>266</td><td>		<span class="codeReserved">for</span> (<span class="codeReserved">var</span> name <span class="codeReserved">in</span> options) {</td></tr>
  <tr><td>267</td><td>			<span class="codeReserved">if</span> (options.hasOwnProperty(name)) {</td></tr>
  <tr><td>268</td><td>				<span class="codeReserved">this</span>[name] = options[name];</td></tr>
  <tr><td>269</td><td>			}</td></tr>
  <tr><td>270</td><td>		}</td></tr>
  <tr><td>271</td><td>	};</td></tr>
  <tr><td>272</td><td></td></tr>
  <tr><td>273</td><td>	WireMessage.prototype.encode = <span class="codeReserved">function</span>() {</td></tr>
  <tr><td>274</td><td>		<span class="codeComment">// Compute the first byte of the fixed header</span></td></tr>
  <tr><td>275</td><td>		<span class="codeReserved">var</span> first = ((<span class="codeReserved">this</span>.type & 0x0f) &lt;&lt; 4);</td></tr>
  <tr><td>276</td><td></td></tr>
  <tr><td>277</td><td>		<span class="codeComment">/*</span></td></tr>
  <tr><td>278</td><td><span class="codeComment">		 * Now calculate the length of the variable header + payload by adding up the lengths</span></td></tr>
  <tr><td>279</td><td><span class="codeComment">		 * of all the component parts</span></td></tr>
  <tr><td>280</td><td><span class="codeComment">		 */</span></td></tr>
  <tr><td>281</td><td></td></tr>
  <tr><td>282</td><td>		<span class="codeReserved">var</span> remLength = 0;</td></tr>
  <tr><td>283</td><td>		<span class="codeReserved">var</span> topicStrLength = [];</td></tr>
  <tr><td>284</td><td>		<span class="codeReserved">var</span> destinationNameLength = 0;</td></tr>
  <tr><td>285</td><td>		<span class="codeReserved">var</span> willMessagePayloadBytes;</td></tr>
  <tr><td>286</td><td></td></tr>
  <tr><td>287</td><td>		<span class="codeComment">// if the message contains a messageIdentifier then we need two bytes for that</span></td></tr>
  <tr><td>288</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.messageIdentifier !== undefined)</td></tr>
  <tr><td>289</td><td>			remLength += 2;</td></tr>
  <tr><td>290</td><td></td></tr>
  <tr><td>291</td><td>		<span class="codeReserved">switch</span>(<span class="codeReserved">this</span>.type) {</td></tr>
  <tr><td>292</td><td>			<span class="codeComment">// If this a Connect then we need to include 12 bytes for its header</span></td></tr>
  <tr><td>293</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.CONNECT:</td></tr>
  <tr><td>294</td><td>				<span class="codeReserved">switch</span>(<span class="codeReserved">this</span>.mqttVersion) {</td></tr>
  <tr><td>295</td><td>					<span class="codeReserved">case</span> 3:</td></tr>
  <tr><td>296</td><td>						remLength += MqttProtoIdentifierv3.length + 3;</td></tr>
  <tr><td>297</td><td>						<span class="codeReserved">break</span>;</td></tr>
  <tr><td>298</td><td>					<span class="codeReserved">case</span> 4:</td></tr>
  <tr><td>299</td><td>						remLength += MqttProtoIdentifierv4.length + 3;</td></tr>
  <tr><td>300</td><td>						<span class="codeReserved">break</span>;</td></tr>
  <tr><td>301</td><td>				}</td></tr>
  <tr><td>302</td><td></td></tr>
  <tr><td>303</td><td>				remLength += UTF8Length(<span class="codeReserved">this</span>.clientId) + 2;</td></tr>
  <tr><td>304</td><td>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.willMessage !== undefined) {</td></tr>
  <tr><td>305</td><td>					remLength += UTF8Length(<span class="codeReserved">this</span>.willMessage.destinationName) + 2;</td></tr>
  <tr><td>306</td><td>					<span class="codeComment">// Will message is always a string, sent as UTF-8 characters with a preceding length.</span></td></tr>
  <tr><td>307</td><td>					willMessagePayloadBytes = <span class="codeReserved">this</span>.willMessage.payloadBytes;</td></tr>
  <tr><td>308</td><td>					<span class="codeReserved">if</span> (!(willMessagePayloadBytes <span class="codeReserved">instanceof</span> Uint8Array))</td></tr>
  <tr><td>309</td><td>						willMessagePayloadBytes = <span class="codeReserved">new</span> Uint8Array(payloadBytes);</td></tr>
  <tr><td>310</td><td>					remLength += willMessagePayloadBytes.byteLength +2;</td></tr>
  <tr><td>311</td><td>				}</td></tr>
  <tr><td>312</td><td>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.userName !== undefined)</td></tr>
  <tr><td>313</td><td>					remLength += UTF8Length(<span class="codeReserved">this</span>.userName) + 2;</td></tr>
  <tr><td>314</td><td>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.password !== undefined)</td></tr>
  <tr><td>315</td><td>					remLength += UTF8Length(<span class="codeReserved">this</span>.password) + 2;</td></tr>
  <tr><td>316</td><td>			<span class="codeReserved">break</span>;</td></tr>
  <tr><td>317</td><td></td></tr>
  <tr><td>318</td><td>			<span class="codeComment">// Subscribe, Unsubscribe can both contain topic strings</span></td></tr>
  <tr><td>319</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.SUBSCRIBE:</td></tr>
  <tr><td>320</td><td>				first |= 0x02; <span class="codeComment">// Qos = 1;</span></td></tr>
  <tr><td>321</td><td>				<span class="codeReserved">for</span> ( <span class="codeReserved">var</span> i = 0; i &lt; <span class="codeReserved">this</span>.topics.length; i++) {</td></tr>
  <tr><td>322</td><td>					topicStrLength[i] = UTF8Length(<span class="codeReserved">this</span>.topics[i]);</td></tr>
  <tr><td>323</td><td>					remLength += topicStrLength[i] + 2;</td></tr>
  <tr><td>324</td><td>				}</td></tr>
  <tr><td>325</td><td>				remLength += <span class="codeReserved">this</span>.requestedQos.length; <span class="codeComment">// 1 byte for each topic&#039;s Qos</span></td></tr>
  <tr><td>326</td><td>				<span class="codeComment">// QoS on Subscribe only</span></td></tr>
  <tr><td>327</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>328</td><td></td></tr>
  <tr><td>329</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.UNSUBSCRIBE:</td></tr>
  <tr><td>330</td><td>				first |= 0x02; <span class="codeComment">// Qos = 1;</span></td></tr>
  <tr><td>331</td><td>				<span class="codeReserved">for</span> ( <span class="codeReserved">var</span> i = 0; i &lt; <span class="codeReserved">this</span>.topics.length; i++) {</td></tr>
  <tr><td>332</td><td>					topicStrLength[i] = UTF8Length(<span class="codeReserved">this</span>.topics[i]);</td></tr>
  <tr><td>333</td><td>					remLength += topicStrLength[i] + 2;</td></tr>
  <tr><td>334</td><td>				}</td></tr>
  <tr><td>335</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>336</td><td></td></tr>
  <tr><td>337</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.PUBREL:</td></tr>
  <tr><td>338</td><td>				first |= 0x02; <span class="codeComment">// Qos = 1;</span></td></tr>
  <tr><td>339</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>340</td><td></td></tr>
  <tr><td>341</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.PUBLISH:</td></tr>
  <tr><td>342</td><td>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.payloadMessage.duplicate) first |= 0x08;</td></tr>
  <tr><td>343</td><td>				first  = first |= (<span class="codeReserved">this</span>.payloadMessage.qos &lt;&lt; 1);</td></tr>
  <tr><td>344</td><td>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.payloadMessage.retained) first |= 0x01;</td></tr>
  <tr><td>345</td><td>				destinationNameLength = UTF8Length(<span class="codeReserved">this</span>.payloadMessage.destinationName);</td></tr>
  <tr><td>346</td><td>				remLength += destinationNameLength + 2;</td></tr>
  <tr><td>347</td><td>				<span class="codeReserved">var</span> payloadBytes = <span class="codeReserved">this</span>.payloadMessage.payloadBytes;</td></tr>
  <tr><td>348</td><td>				remLength += payloadBytes.byteLength;</td></tr>
  <tr><td>349</td><td>				<span class="codeReserved">if</span> (payloadBytes <span class="codeReserved">instanceof</span> ArrayBuffer)</td></tr>
  <tr><td>350</td><td>					payloadBytes = <span class="codeReserved">new</span> Uint8Array(payloadBytes);</td></tr>
  <tr><td>351</td><td>				<span class="codeReserved">else</span> <span class="codeReserved">if</span> (!(payloadBytes <span class="codeReserved">instanceof</span> Uint8Array))</td></tr>
  <tr><td>352</td><td>					payloadBytes = <span class="codeReserved">new</span> Uint8Array(payloadBytes.buffer);</td></tr>
  <tr><td>353</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>354</td><td></td></tr>
  <tr><td>355</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.DISCONNECT:</td></tr>
  <tr><td>356</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>357</td><td></td></tr>
  <tr><td>358</td><td>			<span class="codeReserved">default</span>:</td></tr>
  <tr><td>359</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>360</td><td>		}</td></tr>
  <tr><td>361</td><td></td></tr>
  <tr><td>362</td><td>		<span class="codeComment">// Now we can allocate a buffer for the message</span></td></tr>
  <tr><td>363</td><td></td></tr>
  <tr><td>364</td><td>		<span class="codeReserved">var</span> mbi = encodeMBI(remLength);  <span class="codeComment">// Convert the length to MQTT MBI format</span></td></tr>
  <tr><td>365</td><td>		<span class="codeReserved">var</span> pos = mbi.length + 1;        <span class="codeComment">// Offset of start of variable header</span></td></tr>
  <tr><td>366</td><td>		<span class="codeReserved">var</span> buffer = <span class="codeReserved">new</span> ArrayBuffer(remLength + pos);</td></tr>
  <tr><td>367</td><td>		<span class="codeReserved">var</span> byteStream = <span class="codeReserved">new</span> Uint8Array(buffer);    <span class="codeComment">// view it as a sequence of bytes</span></td></tr>
  <tr><td>368</td><td></td></tr>
  <tr><td>369</td><td>		<span class="codeComment">//Write the fixed header into the buffer</span></td></tr>
  <tr><td>370</td><td>		byteStream[0] = first;</td></tr>
  <tr><td>371</td><td>		byteStream.set(mbi,1);</td></tr>
  <tr><td>372</td><td></td></tr>
  <tr><td>373</td><td>		<span class="codeComment">// If this is a PUBLISH then the variable header starts with a topic</span></td></tr>
  <tr><td>374</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.type == MESSAGE_TYPE.PUBLISH)</td></tr>
  <tr><td>375</td><td>			pos = writeString(<span class="codeReserved">this</span>.payloadMessage.destinationName, destinationNameLength, byteStream, pos);</td></tr>
  <tr><td>376</td><td>		<span class="codeComment">// If this is a CONNECT then the variable header contains the protocol name/version, flags and keepalive time</span></td></tr>
  <tr><td>377</td><td></td></tr>
  <tr><td>378</td><td>		<span class="codeReserved">else</span> <span class="codeReserved">if</span> (<span class="codeReserved">this</span>.type == MESSAGE_TYPE.CONNECT) {</td></tr>
  <tr><td>379</td><td>			<span class="codeReserved">switch</span> (<span class="codeReserved">this</span>.mqttVersion) {</td></tr>
  <tr><td>380</td><td>				<span class="codeReserved">case</span> 3:</td></tr>
  <tr><td>381</td><td>					byteStream.set(MqttProtoIdentifierv3, pos);</td></tr>
  <tr><td>382</td><td>					pos += MqttProtoIdentifierv3.length;</td></tr>
  <tr><td>383</td><td>					<span class="codeReserved">break</span>;</td></tr>
  <tr><td>384</td><td>				<span class="codeReserved">case</span> 4:</td></tr>
  <tr><td>385</td><td>					byteStream.set(MqttProtoIdentifierv4, pos);</td></tr>
  <tr><td>386</td><td>					pos += MqttProtoIdentifierv4.length;</td></tr>
  <tr><td>387</td><td>					<span class="codeReserved">break</span>;</td></tr>
  <tr><td>388</td><td>			}</td></tr>
  <tr><td>389</td><td>			<span class="codeReserved">var</span> connectFlags = 0;</td></tr>
  <tr><td>390</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.cleanSession)</td></tr>
  <tr><td>391</td><td>				connectFlags = 0x02;</td></tr>
  <tr><td>392</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.willMessage !== undefined ) {</td></tr>
  <tr><td>393</td><td>				connectFlags |= 0x04;</td></tr>
  <tr><td>394</td><td>				connectFlags |= (<span class="codeReserved">this</span>.willMessage.qos&lt;&lt;3);</td></tr>
  <tr><td>395</td><td>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.willMessage.retained) {</td></tr>
  <tr><td>396</td><td>					connectFlags |= 0x20;</td></tr>
  <tr><td>397</td><td>				}</td></tr>
  <tr><td>398</td><td>			}</td></tr>
  <tr><td>399</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.userName !== undefined)</td></tr>
  <tr><td>400</td><td>				connectFlags |= 0x80;</td></tr>
  <tr><td>401</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.password !== undefined)</td></tr>
  <tr><td>402</td><td>				connectFlags |= 0x40;</td></tr>
  <tr><td>403</td><td>			byteStream[pos++] = connectFlags;</td></tr>
  <tr><td>404</td><td>			pos = writeUint16 (<span class="codeReserved">this</span>.keepAliveInterval, byteStream, pos);</td></tr>
  <tr><td>405</td><td>		}</td></tr>
  <tr><td>406</td><td></td></tr>
  <tr><td>407</td><td>		<span class="codeComment">// Output the messageIdentifier - if there is one</span></td></tr>
  <tr><td>408</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.messageIdentifier !== undefined)</td></tr>
  <tr><td>409</td><td>			pos = writeUint16 (<span class="codeReserved">this</span>.messageIdentifier, byteStream, pos);</td></tr>
  <tr><td>410</td><td></td></tr>
  <tr><td>411</td><td>		<span class="codeReserved">switch</span>(<span class="codeReserved">this</span>.type) {</td></tr>
  <tr><td>412</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.CONNECT:</td></tr>
  <tr><td>413</td><td>				pos = writeString(<span class="codeReserved">this</span>.clientId, UTF8Length(<span class="codeReserved">this</span>.clientId), byteStream, pos);</td></tr>
  <tr><td>414</td><td>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.willMessage !== undefined) {</td></tr>
  <tr><td>415</td><td>					pos = writeString(<span class="codeReserved">this</span>.willMessage.destinationName, UTF8Length(<span class="codeReserved">this</span>.willMessage.destinationName), byteStream, pos);</td></tr>
  <tr><td>416</td><td>					pos = writeUint16(willMessagePayloadBytes.byteLength, byteStream, pos);</td></tr>
  <tr><td>417</td><td>					byteStream.set(willMessagePayloadBytes, pos);</td></tr>
  <tr><td>418</td><td>					pos += willMessagePayloadBytes.byteLength;</td></tr>
  <tr><td>419</td><td></td></tr>
  <tr><td>420</td><td>				}</td></tr>
  <tr><td>421</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.userName !== undefined)</td></tr>
  <tr><td>422</td><td>				pos = writeString(<span class="codeReserved">this</span>.userName, UTF8Length(<span class="codeReserved">this</span>.userName), byteStream, pos);</td></tr>
  <tr><td>423</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.password !== undefined)</td></tr>
  <tr><td>424</td><td>				pos = writeString(<span class="codeReserved">this</span>.password, UTF8Length(<span class="codeReserved">this</span>.password), byteStream, pos);</td></tr>
  <tr><td>425</td><td>			<span class="codeReserved">break</span>;</td></tr>
  <tr><td>426</td><td></td></tr>
  <tr><td>427</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.PUBLISH:</td></tr>
  <tr><td>428</td><td>				<span class="codeComment">// PUBLISH has a text or binary payload, if text do not add a 2 byte length field, just the UTF characters.</span></td></tr>
  <tr><td>429</td><td>				byteStream.set(payloadBytes, pos);</td></tr>
  <tr><td>430</td><td></td></tr>
  <tr><td>431</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>432</td><td></td></tr>
  <tr><td>433</td><td><span class="codeComment">//    	    case MESSAGE_TYPE.PUBREC:</span></td></tr>
  <tr><td>434</td><td><span class="codeComment">//    	    case MESSAGE_TYPE.PUBREL:</span></td></tr>
  <tr><td>435</td><td><span class="codeComment">//    	    case MESSAGE_TYPE.PUBCOMP:</span></td></tr>
  <tr><td>436</td><td><span class="codeComment">//    	    	break;</span></td></tr>
  <tr><td>437</td><td></td></tr>
  <tr><td>438</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.SUBSCRIBE:</td></tr>
  <tr><td>439</td><td>				<span class="codeComment">// SUBSCRIBE has a list of topic strings and request QoS</span></td></tr>
  <tr><td>440</td><td>				<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i=0; i&lt;<span class="codeReserved">this</span>.topics.length; i++) {</td></tr>
  <tr><td>441</td><td>					pos = writeString(<span class="codeReserved">this</span>.topics[i], topicStrLength[i], byteStream, pos);</td></tr>
  <tr><td>442</td><td>					byteStream[pos++] = <span class="codeReserved">this</span>.requestedQos[i];</td></tr>
  <tr><td>443</td><td>				}</td></tr>
  <tr><td>444</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>445</td><td></td></tr>
  <tr><td>446</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.UNSUBSCRIBE:</td></tr>
  <tr><td>447</td><td>				<span class="codeComment">// UNSUBSCRIBE has a list of topic strings</span></td></tr>
  <tr><td>448</td><td>				<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i=0; i&lt;<span class="codeReserved">this</span>.topics.length; i++)</td></tr>
  <tr><td>449</td><td>					pos = writeString(<span class="codeReserved">this</span>.topics[i], topicStrLength[i], byteStream, pos);</td></tr>
  <tr><td>450</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>451</td><td></td></tr>
  <tr><td>452</td><td>			<span class="codeReserved">default</span>:</td></tr>
  <tr><td>453</td><td>				<span class="codeComment">// Do nothing.</span></td></tr>
  <tr><td>454</td><td>		}</td></tr>
  <tr><td>455</td><td></td></tr>
  <tr><td>456</td><td>		<span class="codeReserved">return</span> buffer;</td></tr>
  <tr><td>457</td><td>	};</td></tr>
  <tr><td>458</td><td></td></tr>
  <tr><td>459</td><td>	<span class="codeReserved">function</span> decodeMessage(input,pos) {</td></tr>
  <tr><td>460</td><td>	    <span class="codeReserved">var</span> startingPos = pos;</td></tr>
  <tr><td>461</td><td>		<span class="codeReserved">var</span> first = input[pos];</td></tr>
  <tr><td>462</td><td>		<span class="codeReserved">var</span> type = first &gt;&gt; 4;</td></tr>
  <tr><td>463</td><td>		<span class="codeReserved">var</span> messageInfo = first &= 0x0f;</td></tr>
  <tr><td>464</td><td>		pos += 1;</td></tr>
  <tr><td>465</td><td></td></tr>
  <tr><td>466</td><td></td></tr>
  <tr><td>467</td><td>		<span class="codeComment">// Decode the remaining length (MBI format)</span></td></tr>
  <tr><td>468</td><td></td></tr>
  <tr><td>469</td><td>		<span class="codeReserved">var</span> digit;</td></tr>
  <tr><td>470</td><td>		<span class="codeReserved">var</span> remLength = 0;</td></tr>
  <tr><td>471</td><td>		<span class="codeReserved">var</span> multiplier = 1;</td></tr>
  <tr><td>472</td><td>		<span class="codeReserved">do</span> {</td></tr>
  <tr><td>473</td><td>			<span class="codeReserved">if</span> (pos == input.length) {</td></tr>
  <tr><td>474</td><td>			    <span class="codeReserved">return</span> [<span class="codeReserved">null</span>,startingPos];</td></tr>
  <tr><td>475</td><td>			}</td></tr>
  <tr><td>476</td><td>			digit = input[pos++];</td></tr>
  <tr><td>477</td><td>			remLength += ((digit & 0x7F) * multiplier);</td></tr>
  <tr><td>478</td><td>			multiplier *= 128;</td></tr>
  <tr><td>479</td><td>		} <span class="codeReserved">while</span> ((digit & 0x80) !== 0);</td></tr>
  <tr><td>480</td><td></td></tr>
  <tr><td>481</td><td>		<span class="codeReserved">var</span> endPos = pos+remLength;</td></tr>
  <tr><td>482</td><td>		<span class="codeReserved">if</span> (endPos &gt; input.length) {</td></tr>
  <tr><td>483</td><td>		    <span class="codeReserved">return</span> [<span class="codeReserved">null</span>,startingPos];</td></tr>
  <tr><td>484</td><td>		}</td></tr>
  <tr><td>485</td><td></td></tr>
  <tr><td>486</td><td>		<span class="codeReserved">var</span> wireMessage = <span class="codeReserved">new</span> WireMessage(type);</td></tr>
  <tr><td>487</td><td>		<span class="codeReserved">switch</span>(type) {</td></tr>
  <tr><td>488</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.CONNACK:</td></tr>
  <tr><td>489</td><td>				<span class="codeReserved">var</span> connectAcknowledgeFlags = input[pos++];</td></tr>
  <tr><td>490</td><td>				<span class="codeReserved">if</span> (connectAcknowledgeFlags & 0x01)</td></tr>
  <tr><td>491</td><td>					wireMessage.sessionPresent = <span class="codeReserved">true</span>;</td></tr>
  <tr><td>492</td><td>				wireMessage.returnCode = input[pos++];</td></tr>
  <tr><td>493</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>494</td><td></td></tr>
  <tr><td>495</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.PUBLISH:</td></tr>
  <tr><td>496</td><td>				<span class="codeReserved">var</span> qos = (messageInfo &gt;&gt; 1) & 0x03;</td></tr>
  <tr><td>497</td><td></td></tr>
  <tr><td>498</td><td>				<span class="codeReserved">var</span> len = readUint16(input, pos);</td></tr>
  <tr><td>499</td><td>				pos += 2;</td></tr>
  <tr><td>500</td><td>				<span class="codeReserved">var</span> topicName = parseUTF8(input, pos, len);</td></tr>
  <tr><td>501</td><td>				pos += len;</td></tr>
  <tr><td>502</td><td>				<span class="codeComment">// If QoS 1 or 2 there will be a messageIdentifier</span></td></tr>
  <tr><td>503</td><td>				<span class="codeReserved">if</span> (qos &gt; 0) {</td></tr>
  <tr><td>504</td><td>					wireMessage.messageIdentifier = readUint16(input, pos);</td></tr>
  <tr><td>505</td><td>					pos += 2;</td></tr>
  <tr><td>506</td><td>				}</td></tr>
  <tr><td>507</td><td></td></tr>
  <tr><td>508</td><td>				<span class="codeReserved">var</span> message = <span class="codeReserved">new</span> Paho.MQTT.Message(input.subarray(pos, endPos));</td></tr>
  <tr><td>509</td><td>				<span class="codeReserved">if</span> ((messageInfo & 0x01) == 0x01)</td></tr>
  <tr><td>510</td><td>					message.retained = <span class="codeReserved">true</span>;</td></tr>
  <tr><td>511</td><td>				<span class="codeReserved">if</span> ((messageInfo & 0x08) == 0x08)</td></tr>
  <tr><td>512</td><td>					message.duplicate =  <span class="codeReserved">true</span>;</td></tr>
  <tr><td>513</td><td>				message.qos = qos;</td></tr>
  <tr><td>514</td><td>				message.destinationName = topicName;</td></tr>
  <tr><td>515</td><td>				wireMessage.payloadMessage = message;</td></tr>
  <tr><td>516</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>517</td><td></td></tr>
  <tr><td>518</td><td>			<span class="codeReserved">case</span>  MESSAGE_TYPE.PUBACK:</td></tr>
  <tr><td>519</td><td>			<span class="codeReserved">case</span>  MESSAGE_TYPE.PUBREC:</td></tr>
  <tr><td>520</td><td>			<span class="codeReserved">case</span>  MESSAGE_TYPE.PUBREL:</td></tr>
  <tr><td>521</td><td>			<span class="codeReserved">case</span>  MESSAGE_TYPE.PUBCOMP:</td></tr>
  <tr><td>522</td><td>			<span class="codeReserved">case</span>  MESSAGE_TYPE.UNSUBACK:</td></tr>
  <tr><td>523</td><td>				wireMessage.messageIdentifier = readUint16(input, pos);</td></tr>
  <tr><td>524</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>525</td><td></td></tr>
  <tr><td>526</td><td>			<span class="codeReserved">case</span>  MESSAGE_TYPE.SUBACK:</td></tr>
  <tr><td>527</td><td>				wireMessage.messageIdentifier = readUint16(input, pos);</td></tr>
  <tr><td>528</td><td>				pos += 2;</td></tr>
  <tr><td>529</td><td>				wireMessage.returnCode = input.subarray(pos, endPos);</td></tr>
  <tr><td>530</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>531</td><td></td></tr>
  <tr><td>532</td><td>			<span class="codeReserved">default</span>:</td></tr>
  <tr><td>533</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>534</td><td>		}</td></tr>
  <tr><td>535</td><td></td></tr>
  <tr><td>536</td><td>		<span class="codeReserved">return</span> [wireMessage,endPos];</td></tr>
  <tr><td>537</td><td>	}</td></tr>
  <tr><td>538</td><td></td></tr>
  <tr><td>539</td><td>	<span class="codeReserved">function</span> writeUint16(input, buffer, offset) {</td></tr>
  <tr><td>540</td><td>		buffer[offset++] = input &gt;&gt; 8;      <span class="codeComment">//MSB</span></td></tr>
  <tr><td>541</td><td>		buffer[offset++] = input % 256;     <span class="codeComment">//LSB</span></td></tr>
  <tr><td>542</td><td>		<span class="codeReserved">return</span> offset;</td></tr>
  <tr><td>543</td><td>	}</td></tr>
  <tr><td>544</td><td></td></tr>
  <tr><td>545</td><td>	<span class="codeReserved">function</span> writeString(input, utf8Length, buffer, offset) {</td></tr>
  <tr><td>546</td><td>		offset = writeUint16(utf8Length, buffer, offset);</td></tr>
  <tr><td>547</td><td>		stringToUTF8(input, buffer, offset);</td></tr>
  <tr><td>548</td><td>		<span class="codeReserved">return</span> offset + utf8Length;</td></tr>
  <tr><td>549</td><td>	}</td></tr>
  <tr><td>550</td><td></td></tr>
  <tr><td>551</td><td>	<span class="codeReserved">function</span> readUint16(buffer, offset) {</td></tr>
  <tr><td>552</td><td>		<span class="codeReserved">return</span> 256*buffer[offset] + buffer[offset+1];</td></tr>
  <tr><td>553</td><td>	}</td></tr>
  <tr><td>554</td><td></td></tr>
  <tr><td>555</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>556</td><td><span class="codeComment">	 * Encodes an MQTT Multi-Byte Integer</span></td></tr>
  <tr><td>557</td><td><span class="codeComment">	 * <span class="codeReserved">@private</span></span></td></tr>
  <tr><td>558</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>559</td><td>	<span class="codeReserved">function</span> encodeMBI(number) {</td></tr>
  <tr><td>560</td><td>		<span class="codeReserved">var</span> output = <span class="codeReserved">new</span> Array(1);</td></tr>
  <tr><td>561</td><td>		<span class="codeReserved">var</span> numBytes = 0;</td></tr>
  <tr><td>562</td><td></td></tr>
  <tr><td>563</td><td>		<span class="codeReserved">do</span> {</td></tr>
  <tr><td>564</td><td>			<span class="codeReserved">var</span> digit = number % 128;</td></tr>
  <tr><td>565</td><td>			number = number &gt;&gt; 7;</td></tr>
  <tr><td>566</td><td>			<span class="codeReserved">if</span> (number &gt; 0) {</td></tr>
  <tr><td>567</td><td>				digit |= 0x80;</td></tr>
  <tr><td>568</td><td>			}</td></tr>
  <tr><td>569</td><td>			output[numBytes++] = digit;</td></tr>
  <tr><td>570</td><td>		} <span class="codeReserved">while</span> ( (number &gt; 0) && (numBytes&lt;4) );</td></tr>
  <tr><td>571</td><td></td></tr>
  <tr><td>572</td><td>		<span class="codeReserved">return</span> output;</td></tr>
  <tr><td>573</td><td>	}</td></tr>
  <tr><td>574</td><td></td></tr>
  <tr><td>575</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>576</td><td><span class="codeComment">	 * Takes a String and calculates its length <span class="codeReserved">in</span> bytes when encoded <span class="codeReserved">in</span> UTF8.</span></td></tr>
  <tr><td>577</td><td><span class="codeComment">	 * <span class="codeReserved">@private</span></span></td></tr>
  <tr><td>578</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>579</td><td>	<span class="codeReserved">function</span> UTF8Length(input) {</td></tr>
  <tr><td>580</td><td>		<span class="codeReserved">var</span> output = 0;</td></tr>
  <tr><td>581</td><td>		<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i = 0; i&lt;<span class="codeReserved">input</span>.length; i++)</td></tr>
  <tr><td>582</td><td>		{</td></tr>
  <tr><td>583</td><td>			<span class="codeReserved">var</span> charCode = input.charCodeAt(i);</td></tr>
  <tr><td>584</td><td>				<span class="codeReserved">if</span> (charCode &gt; 0x7FF)</td></tr>
  <tr><td>585</td><td>				   {</td></tr>
  <tr><td>586</td><td>					  <span class="codeComment">// Surrogate pair means its a 4 byte character</span></td></tr>
  <tr><td>587</td><td>					  <span class="codeReserved">if</span> (0xD800 &lt;= charCode && charCode &lt;= 0xDBFF)</td></tr>
  <tr><td>588</td><td>						{</td></tr>
  <tr><td>589</td><td>						  i++;</td></tr>
  <tr><td>590</td><td>						  output++;</td></tr>
  <tr><td>591</td><td>						}</td></tr>
  <tr><td>592</td><td>				   output +=3;</td></tr>
  <tr><td>593</td><td>				   }</td></tr>
  <tr><td>594</td><td>			<span class="codeReserved">else</span> <span class="codeReserved">if</span> (charCode &gt; 0x7F)</td></tr>
  <tr><td>595</td><td>				output +=2;</td></tr>
  <tr><td>596</td><td>			<span class="codeReserved">else</span></td></tr>
  <tr><td>597</td><td>				output++;</td></tr>
  <tr><td>598</td><td>		}</td></tr>
  <tr><td>599</td><td>		<span class="codeReserved">return</span> output;</td></tr>
  <tr><td>600</td><td>	}</td></tr>
  <tr><td>601</td><td></td></tr>
  <tr><td>602</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>603</td><td><span class="codeComment">	 * Takes a String and writes it into an array <span class="codeReserved">as</span> UTF8 encoded bytes.</span></td></tr>
  <tr><td>604</td><td><span class="codeComment">	 * <span class="codeReserved">@private</span></span></td></tr>
  <tr><td>605</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>606</td><td>	<span class="codeReserved">function</span> stringToUTF8(input, output, start) {</td></tr>
  <tr><td>607</td><td>		<span class="codeReserved">var</span> pos = start;</td></tr>
  <tr><td>608</td><td>		<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i = 0; i&lt;<span class="codeReserved">input</span>.length; i++) {</td></tr>
  <tr><td>609</td><td>			<span class="codeReserved">var</span> charCode = input.charCodeAt(i);</td></tr>
  <tr><td>610</td><td></td></tr>
  <tr><td>611</td><td>			<span class="codeComment">// Check for a surrogate pair.</span></td></tr>
  <tr><td>612</td><td>			<span class="codeReserved">if</span> (0xD800 &lt;= charCode && charCode &lt;= 0xDBFF) {</td></tr>
  <tr><td>613</td><td>				<span class="codeReserved">var</span> lowCharCode = input.charCodeAt(++i);</td></tr>
  <tr><td>614</td><td>				<span class="codeReserved">if</span> (isNaN(lowCharCode)) {</td></tr>
  <tr><td>615</td><td>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.MALFORMED_UNICODE, [charCode, lowCharCode]));</td></tr>
  <tr><td>616</td><td>				}</td></tr>
  <tr><td>617</td><td>				charCode = ((charCode - 0xD800)&lt;&lt;10) + (lowCharCode - 0xDC00) + 0x10000;</td></tr>
  <tr><td>618</td><td></td></tr>
  <tr><td>619</td><td>			}</td></tr>
  <tr><td>620</td><td></td></tr>
  <tr><td>621</td><td>			<span class="codeReserved">if</span> (charCode &lt;= 0x7F) {</td></tr>
  <tr><td>622</td><td>				output[pos++] = charCode;</td></tr>
  <tr><td>623</td><td>			} <span class="codeReserved">else</span> <span class="codeReserved">if</span> (charCode &lt;= 0x7FF) {</td></tr>
  <tr><td>624</td><td>				output[pos++] = charCode&gt;&gt;6  & 0x1F | 0xC0;</td></tr>
  <tr><td>625</td><td>				output[pos++] = charCode     & 0x3F | 0x80;</td></tr>
  <tr><td>626</td><td>			} <span class="codeReserved">else</span> <span class="codeReserved">if</span> (charCode &lt;= 0xFFFF) {</td></tr>
  <tr><td>627</td><td>				output[pos++] = charCode&gt;&gt;12 & 0x0F | 0xE0;</td></tr>
  <tr><td>628</td><td>				output[pos++] = charCode&gt;&gt;6  & 0x3F | 0x80;</td></tr>
  <tr><td>629</td><td>				output[pos++] = charCode     & 0x3F | 0x80;</td></tr>
  <tr><td>630</td><td>			} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>631</td><td>				output[pos++] = charCode&gt;&gt;18 & 0x07 | 0xF0;</td></tr>
  <tr><td>632</td><td>				output[pos++] = charCode&gt;&gt;12 & 0x3F | 0x80;</td></tr>
  <tr><td>633</td><td>				output[pos++] = charCode&gt;&gt;6  & 0x3F | 0x80;</td></tr>
  <tr><td>634</td><td>				output[pos++] = charCode     & 0x3F | 0x80;</td></tr>
  <tr><td>635</td><td>			}</td></tr>
  <tr><td>636</td><td>		}</td></tr>
  <tr><td>637</td><td>		<span class="codeReserved">return</span> output;</td></tr>
  <tr><td>638</td><td>	}</td></tr>
  <tr><td>639</td><td></td></tr>
  <tr><td>640</td><td>	<span class="codeReserved">function</span> parseUTF8(input, offset, length) {</td></tr>
  <tr><td>641</td><td>		<span class="codeReserved">var</span> output = <span class="codeString">""</span>;</td></tr>
  <tr><td>642</td><td>		<span class="codeReserved">var</span> utf16;</td></tr>
  <tr><td>643</td><td>		<span class="codeReserved">var</span> pos = offset;</td></tr>
  <tr><td>644</td><td></td></tr>
  <tr><td>645</td><td>		<span class="codeReserved">while</span> (pos &lt; offset+length)</td></tr>
  <tr><td>646</td><td>		{</td></tr>
  <tr><td>647</td><td>			<span class="codeReserved">var</span> byte1 = input[pos++];</td></tr>
  <tr><td>648</td><td>			<span class="codeReserved">if</span> (byte1 &lt; 128)</td></tr>
  <tr><td>649</td><td>				utf16 = byte1;</td></tr>
  <tr><td>650</td><td>			<span class="codeReserved">else</span></td></tr>
  <tr><td>651</td><td>			{</td></tr>
  <tr><td>652</td><td>				<span class="codeReserved">var</span> byte2 = input[pos++]-128;</td></tr>
  <tr><td>653</td><td>				<span class="codeReserved">if</span> (byte2 &lt; 0)</td></tr>
  <tr><td>654</td><td>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.MALFORMED_UTF, [byte1.toString(16), byte2.toString(16),<span class="codeString">""</span>]));</td></tr>
  <tr><td>655</td><td>				<span class="codeReserved">if</span> (byte1 &lt; 0xE0)             <span class="codeComment">// 2 byte character</span></td></tr>
  <tr><td>656</td><td>					utf16 = 64*(byte1-0xC0) + byte2;</td></tr>
  <tr><td>657</td><td>				<span class="codeReserved">else</span></td></tr>
  <tr><td>658</td><td>				{</td></tr>
  <tr><td>659</td><td>					<span class="codeReserved">var</span> byte3 = input[pos++]-128;</td></tr>
  <tr><td>660</td><td>					<span class="codeReserved">if</span> (byte3 &lt; 0)</td></tr>
  <tr><td>661</td><td>						<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.MALFORMED_UTF, [byte1.toString(16), byte2.toString(16), byte3.toString(16)]));</td></tr>
  <tr><td>662</td><td>					<span class="codeReserved">if</span> (byte1 &lt; 0xF0)        <span class="codeComment">// 3 byte character</span></td></tr>
  <tr><td>663</td><td>						utf16 = 4096*(byte1-0xE0) + 64*byte2 + byte3;</td></tr>
  <tr><td>664</td><td>								<span class="codeReserved">else</span></td></tr>
  <tr><td>665</td><td>								{</td></tr>
  <tr><td>666</td><td>								   <span class="codeReserved">var</span> byte4 = input[pos++]-128;</td></tr>
  <tr><td>667</td><td>								   <span class="codeReserved">if</span> (byte4 &lt; 0)</td></tr>
  <tr><td>668</td><td>						<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.MALFORMED_UTF, [byte1.toString(16), byte2.toString(16), byte3.toString(16), byte4.toString(16)]));</td></tr>
  <tr><td>669</td><td>								   <span class="codeReserved">if</span> (byte1 &lt; 0xF8)        <span class="codeComment">// 4 byte character</span></td></tr>
  <tr><td>670</td><td>										   utf16 = 262144*(byte1-0xF0) + 4096*byte2 + 64*byte3 + byte4;</td></tr>
  <tr><td>671</td><td>					   <span class="codeReserved">else</span>                     <span class="codeComment">// longer encodings are not supported</span></td></tr>
  <tr><td>672</td><td>						<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.MALFORMED_UTF, [byte1.toString(16), byte2.toString(16), byte3.toString(16), byte4.toString(16)]));</td></tr>
  <tr><td>673</td><td>								}</td></tr>
  <tr><td>674</td><td>				}</td></tr>
  <tr><td>675</td><td>			}</td></tr>
  <tr><td>676</td><td></td></tr>
  <tr><td>677</td><td>				<span class="codeReserved">if</span> (utf16 &gt; 0xFFFF)   <span class="codeComment">// 4 byte character - express as a surrogate pair</span></td></tr>
  <tr><td>678</td><td>				  {</td></tr>
  <tr><td>679</td><td>					 utf16 -= 0x10000;</td></tr>
  <tr><td>680</td><td>					 output += String.fromCharCode(0xD800 + (utf16 &gt;&gt; 10)); <span class="codeComment">// lead character</span></td></tr>
  <tr><td>681</td><td>					 utf16 = 0xDC00 + (utf16 & 0x3FF);  <span class="codeComment">// trail character</span></td></tr>
  <tr><td>682</td><td>				  }</td></tr>
  <tr><td>683</td><td>			output += String.fromCharCode(utf16);</td></tr>
  <tr><td>684</td><td>		}</td></tr>
  <tr><td>685</td><td>		<span class="codeReserved">return</span> output;</td></tr>
  <tr><td>686</td><td>	}</td></tr>
  <tr><td>687</td><td></td></tr>
  <tr><td>688</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>689</td><td><span class="codeComment">	 * Repeat keepalive requests, monitor responses.</span></td></tr>
  <tr><td>690</td><td><span class="codeComment">	 * <span class="codeReserved">@ignore</span></span></td></tr>
  <tr><td>691</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>692</td><td>	<span class="codeReserved">var</span> Pinger = <span class="codeReserved">function</span>(client, window, keepAliveInterval) {</td></tr>
  <tr><td>693</td><td>		<span class="codeReserved">this</span>._client = client;</td></tr>
  <tr><td>694</td><td>		<span class="codeReserved">this</span>._window = window;</td></tr>
  <tr><td>695</td><td>		<span class="codeReserved">this</span>._keepAliveInterval = keepAliveInterval*1000;</td></tr>
  <tr><td>696</td><td>		<span class="codeReserved">this</span>.isReset = <span class="codeReserved">false</span>;</td></tr>
  <tr><td>697</td><td></td></tr>
  <tr><td>698</td><td>		<span class="codeReserved">var</span> pingReq = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.PINGREQ).encode();</td></tr>
  <tr><td>699</td><td></td></tr>
  <tr><td>700</td><td>		<span class="codeReserved">var</span> doTimeout = <span class="codeReserved">function</span> (pinger) {</td></tr>
  <tr><td>701</td><td>			<span class="codeReserved">return</span> <span class="codeReserved">function</span> () {</td></tr>
  <tr><td>702</td><td>				<span class="codeReserved">return</span> doPing.apply(pinger);</td></tr>
  <tr><td>703</td><td>			};</td></tr>
  <tr><td>704</td><td>		};</td></tr>
  <tr><td>705</td><td></td></tr>
  <tr><td>706</td><td>		<span class="codeComment">/** <span class="codeReserved">@ignore</span> */</span></td></tr>
  <tr><td>707</td><td>		<span class="codeReserved">var</span> doPing = <span class="codeReserved">function</span>() {</td></tr>
  <tr><td>708</td><td>			<span class="codeReserved">if</span> (!<span class="codeReserved">this</span>.isReset) {</td></tr>
  <tr><td>709</td><td>				<span class="codeReserved">this</span>._client._trace(<span class="codeString">"Pinger.doPing"</span>, <span class="codeString">"Timed out"</span>);</td></tr>
  <tr><td>710</td><td>				<span class="codeReserved">this</span>._client._disconnected( ERROR.PING_TIMEOUT.code , format(ERROR.PING_TIMEOUT));</td></tr>
  <tr><td>711</td><td>			} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>712</td><td>				<span class="codeReserved">this</span>.isReset = <span class="codeReserved">false</span>;</td></tr>
  <tr><td>713</td><td>				<span class="codeReserved">this</span>._client._trace(<span class="codeString">"Pinger.doPing"</span>, <span class="codeString">"send PINGREQ"</span>);</td></tr>
  <tr><td>714</td><td>				<span class="codeReserved">this</span>._client.socket.send(pingReq);</td></tr>
  <tr><td>715</td><td>				<span class="codeReserved">this</span>.timeout = <span class="codeReserved">this</span>._window.setTimeout(doTimeout(<span class="codeReserved">this</span>), <span class="codeReserved">this</span>._keepAliveInterval);</td></tr>
  <tr><td>716</td><td>			}</td></tr>
  <tr><td>717</td><td>		};</td></tr>
  <tr><td>718</td><td></td></tr>
  <tr><td>719</td><td>		<span class="codeReserved">this</span>.reset = <span class="codeReserved">function</span>() {</td></tr>
  <tr><td>720</td><td>			<span class="codeReserved">this</span>.isReset = <span class="codeReserved">true</span>;</td></tr>
  <tr><td>721</td><td>			<span class="codeReserved">this</span>._window.clearTimeout(<span class="codeReserved">this</span>.timeout);</td></tr>
  <tr><td>722</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._keepAliveInterval &gt; 0)</td></tr>
  <tr><td>723</td><td>				<span class="codeReserved">this</span>.timeout = setTimeout(doTimeout(<span class="codeReserved">this</span>), <span class="codeReserved">this</span>._keepAliveInterval);</td></tr>
  <tr><td>724</td><td>		};</td></tr>
  <tr><td>725</td><td></td></tr>
  <tr><td>726</td><td>		<span class="codeReserved">this</span>.cancel = <span class="codeReserved">function</span>() {</td></tr>
  <tr><td>727</td><td>			<span class="codeReserved">this</span>._window.clearTimeout(<span class="codeReserved">this</span>.timeout);</td></tr>
  <tr><td>728</td><td>		};</td></tr>
  <tr><td>729</td><td>	 };</td></tr>
  <tr><td>730</td><td></td></tr>
  <tr><td>731</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>732</td><td><span class="codeComment">	 * Monitor request completion.</span></td></tr>
  <tr><td>733</td><td><span class="codeComment">	 * <span class="codeReserved">@ignore</span></span></td></tr>
  <tr><td>734</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>735</td><td>	<span class="codeReserved">var</span> Timeout = <span class="codeReserved">function</span>(client, window, timeoutSeconds, action, args) {</td></tr>
  <tr><td>736</td><td>		<span class="codeReserved">this</span>._window = window;</td></tr>
  <tr><td>737</td><td>		<span class="codeReserved">if</span> (!timeoutSeconds)</td></tr>
  <tr><td>738</td><td>			timeoutSeconds = 30;</td></tr>
  <tr><td>739</td><td></td></tr>
  <tr><td>740</td><td>		<span class="codeReserved">var</span> doTimeout = <span class="codeReserved">function</span> (action, client, args) {</td></tr>
  <tr><td>741</td><td>			<span class="codeReserved">return</span> <span class="codeReserved">function</span> () {</td></tr>
  <tr><td>742</td><td>				<span class="codeReserved">return</span> action.apply(client, args);</td></tr>
  <tr><td>743</td><td>			};</td></tr>
  <tr><td>744</td><td>		};</td></tr>
  <tr><td>745</td><td>		<span class="codeReserved">this</span>.timeout = setTimeout(doTimeout(action, client, args), timeoutSeconds * 1000);</td></tr>
  <tr><td>746</td><td></td></tr>
  <tr><td>747</td><td>		<span class="codeReserved">this</span>.cancel = <span class="codeReserved">function</span>() {</td></tr>
  <tr><td>748</td><td>			<span class="codeReserved">this</span>._window.clearTimeout(<span class="codeReserved">this</span>.timeout);</td></tr>
  <tr><td>749</td><td>		};</td></tr>
  <tr><td>750</td><td>	};</td></tr>
  <tr><td>751</td><td></td></tr>
  <tr><td>752</td><td>	<span class="codeComment">/*</span></td></tr>
  <tr><td>753</td><td><span class="codeComment">	 * Internal implementation of the Websockets MQTT V3.1 client.</span></td></tr>
  <tr><td>754</td><td><span class="codeComment">	 *</span></td></tr>
  <tr><td>755</td><td><span class="codeComment">	 * <span class="codeReserved">@name</span> Paho.MQTT.ClientImpl <span class="codeReserved">@constructor</span></span></td></tr>
  <tr><td>756</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> {String} host the DNS nameof the webSocket host.</span></td></tr>
  <tr><td>757</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> {Number} port the port number <span class="codeReserved">for</span> that host.</span></td></tr>
  <tr><td>758</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> {String} clientId the MQ client identifier.</span></td></tr>
  <tr><td>759</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>760</td><td>	<span class="codeReserved">var</span> ClientImpl = <span class="codeReserved">function</span> (uri, host, port, path, clientId) {</td></tr>
  <tr><td>761</td><td>		<span class="codeComment">// Check dependencies are satisfied in this browser.</span></td></tr>
  <tr><td>762</td><td>		<span class="codeReserved">if</span> (!(<span class="codeString">"WebSocket"</span> <span class="codeReserved">in</span> global && global.WebSocket !== <span class="codeReserved">null</span>)) {</td></tr>
  <tr><td>763</td><td>			<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.UNSUPPORTED, [<span class="codeString">"WebSocket"</span>]));</td></tr>
  <tr><td>764</td><td>		}</td></tr>
  <tr><td>765</td><td>		<span class="codeReserved">if</span> (!(<span class="codeString">"localStorage"</span> <span class="codeReserved">in</span> global && global.localStorage !== <span class="codeReserved">null</span>)) {</td></tr>
  <tr><td>766</td><td>			<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.UNSUPPORTED, [<span class="codeString">"localStorage"</span>]));</td></tr>
  <tr><td>767</td><td>		}</td></tr>
  <tr><td>768</td><td>		<span class="codeReserved">if</span> (!(<span class="codeString">"ArrayBuffer"</span> <span class="codeReserved">in</span> global && global.ArrayBuffer !== <span class="codeReserved">null</span>)) {</td></tr>
  <tr><td>769</td><td>			<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.UNSUPPORTED, [<span class="codeString">"ArrayBuffer"</span>]));</td></tr>
  <tr><td>770</td><td>		}</td></tr>
  <tr><td>771</td><td>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Paho.MQTT.Client"</span>, uri, host, port, path, clientId);</td></tr>
  <tr><td>772</td><td></td></tr>
  <tr><td>773</td><td>		<span class="codeReserved">this</span>.host = host;</td></tr>
  <tr><td>774</td><td>		<span class="codeReserved">this</span>.port = port;</td></tr>
  <tr><td>775</td><td>		<span class="codeReserved">this</span>.path = path;</td></tr>
  <tr><td>776</td><td>		<span class="codeReserved">this</span>.uri = uri;</td></tr>
  <tr><td>777</td><td>		<span class="codeReserved">this</span>.clientId = clientId;</td></tr>
  <tr><td>778</td><td>		<span class="codeReserved">this</span>._wsuri = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>779</td><td></td></tr>
  <tr><td>780</td><td>		<span class="codeComment">// Local storagekeys are qualified with the following string.</span></td></tr>
  <tr><td>781</td><td>		<span class="codeComment">// The conditional inclusion of path in the key is for backward</span></td></tr>
  <tr><td>782</td><td>		<span class="codeComment">// compatibility to when the path was not configurable and assumed to</span></td></tr>
  <tr><td>783</td><td>		<span class="codeComment">// be /mqtt</span></td></tr>
  <tr><td>784</td><td>		<span class="codeReserved">this</span>._localKey=host+<span class="codeString">":"</span>+port+(path!=<span class="codeString">"/mqtt"</span>?<span class="codeString">":"</span>+path:<span class="codeString">""</span>)+<span class="codeString">":"</span>+clientId+<span class="codeString">":"</span>;</td></tr>
  <tr><td>785</td><td></td></tr>
  <tr><td>786</td><td>		<span class="codeComment">// Create private instance-only message queue</span></td></tr>
  <tr><td>787</td><td>		<span class="codeComment">// Internal queue of messages to be sent, in sending order.</span></td></tr>
  <tr><td>788</td><td>		<span class="codeReserved">this</span>._msg_queue = [];</td></tr>
  <tr><td>789</td><td>		<span class="codeReserved">this</span>._buffered_msg_queue = [];</td></tr>
  <tr><td>790</td><td></td></tr>
  <tr><td>791</td><td>		<span class="codeComment">// Messages we have sent and are expecting a response for, indexed by their respective message ids.</span></td></tr>
  <tr><td>792</td><td>		<span class="codeReserved">this</span>._sentMessages = {};</td></tr>
  <tr><td>793</td><td></td></tr>
  <tr><td>794</td><td>		<span class="codeComment">// Messages we have received and acknowleged and are expecting a confirm message for</span></td></tr>
  <tr><td>795</td><td>		<span class="codeComment">// indexed by their respective message ids.</span></td></tr>
  <tr><td>796</td><td>		<span class="codeReserved">this</span>._receivedMessages = {};</td></tr>
  <tr><td>797</td><td></td></tr>
  <tr><td>798</td><td>		<span class="codeComment">// Internal list of callbacks to be executed when messages</span></td></tr>
  <tr><td>799</td><td>		<span class="codeComment">// have been successfully sent over web socket, e.g. disconnect</span></td></tr>
  <tr><td>800</td><td>		<span class="codeComment">// when it doesn&#039;t have to wait for ACK, just message is dispatched.</span></td></tr>
  <tr><td>801</td><td>		<span class="codeReserved">this</span>._notify_msg_sent = {};</td></tr>
  <tr><td>802</td><td></td></tr>
  <tr><td>803</td><td>		<span class="codeComment">// Unique identifier for SEND messages, incrementing</span></td></tr>
  <tr><td>804</td><td>		<span class="codeComment">// counter as messages are sent.</span></td></tr>
  <tr><td>805</td><td>		<span class="codeReserved">this</span>._message_identifier = 1;</td></tr>
  <tr><td>806</td><td></td></tr>
  <tr><td>807</td><td>		<span class="codeComment">// Used to determine the transmission sequence of stored sent messages.</span></td></tr>
  <tr><td>808</td><td>		<span class="codeReserved">this</span>._sequence = 0;</td></tr>
  <tr><td>809</td><td></td></tr>
  <tr><td>810</td><td></td></tr>
  <tr><td>811</td><td>		<span class="codeComment">// Load the local state, if any, from the saved version, only restore state relevant to this client.</span></td></tr>
  <tr><td>812</td><td>		<span class="codeReserved">for</span> (<span class="codeReserved">var</span> key <span class="codeReserved">in</span> localStorage)</td></tr>
  <tr><td>813</td><td>			<span class="codeReserved">if</span> (   key.indexOf(<span class="codeString">"Sent:"</span>+<span class="codeReserved">this</span>._localKey) === 0 || key.indexOf(<span class="codeString">"Received:"</span>+<span class="codeReserved">this</span>._localKey) === 0)</td></tr>
  <tr><td>814</td><td>			<span class="codeReserved">this</span>.restore(key);</td></tr>
  <tr><td>815</td><td>	};</td></tr>
  <tr><td>816</td><td></td></tr>
  <tr><td>817</td><td>	<span class="codeComment">// Messaging Client public instance members.</span></td></tr>
  <tr><td>818</td><td>	ClientImpl.prototype.host = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>819</td><td>	ClientImpl.prototype.port = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>820</td><td>	ClientImpl.prototype.path = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>821</td><td>	ClientImpl.prototype.uri = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>822</td><td>	ClientImpl.prototype.clientId = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>823</td><td></td></tr>
  <tr><td>824</td><td>	<span class="codeComment">// Messaging Client private instance members.</span></td></tr>
  <tr><td>825</td><td>	ClientImpl.prototype.socket = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>826</td><td>	<span class="codeComment">/* <span class="codeReserved">true</span> once we have received an acknowledgement <span class="codeReserved">to</span> a CONNECT packet. */</span></td></tr>
  <tr><td>827</td><td>	ClientImpl.prototype.connected = <span class="codeReserved">false</span>;</td></tr>
  <tr><td>828</td><td>	<span class="codeComment">/* The largest message identifier allowed, may not be larger than 2**16 but</span></td></tr>
  <tr><td>829</td><td><span class="codeComment">	 * <span class="codeReserved">if</span> set smaller reduces the maximum number of outbound messages allowed.</span></td></tr>
  <tr><td>830</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>831</td><td>	ClientImpl.prototype.maxMessageIdentifier = 65536;</td></tr>
  <tr><td>832</td><td>	ClientImpl.prototype.connectOptions = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>833</td><td>	ClientImpl.prototype.hostIndex = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>834</td><td>	ClientImpl.prototype.onConnected = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>835</td><td>	ClientImpl.prototype.onConnectionLost = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>836</td><td>	ClientImpl.prototype.onMessageDelivered = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>837</td><td>	ClientImpl.prototype.onMessageArrived = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>838</td><td>	ClientImpl.prototype.traceFunction = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>839</td><td>	ClientImpl.prototype._msg_queue = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>840</td><td>	ClientImpl.prototype._buffered_msg_queue = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>841</td><td>	ClientImpl.prototype._connectTimeout = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>842</td><td>	<span class="codeComment">/* The sendPinger monitors how long we allow before we send data <span class="codeReserved">to</span> prove <span class="codeReserved">to</span> the server that we are alive. */</span></td></tr>
  <tr><td>843</td><td>	ClientImpl.prototype.sendPinger = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>844</td><td>	<span class="codeComment">/* The receivePinger monitors how long we allow before we require evidence that the server is alive. */</span></td></tr>
  <tr><td>845</td><td>	ClientImpl.prototype.receivePinger = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>846</td><td>	ClientImpl.prototype._reconnectInterval = 1; <span class="codeComment">// Reconnect Delay, starts at 1 second</span></td></tr>
  <tr><td>847</td><td>	ClientImpl.prototype._reconnecting = <span class="codeReserved">false</span>;</td></tr>
  <tr><td>848</td><td>	ClientImpl.prototype._reconnectTimeout = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>849</td><td>	ClientImpl.prototype.disconnectedPublishing = <span class="codeReserved">false</span>;</td></tr>
  <tr><td>850</td><td>	ClientImpl.prototype.disconnectedBufferSize = 5000;</td></tr>
  <tr><td>851</td><td></td></tr>
  <tr><td>852</td><td>	ClientImpl.prototype.receiveBuffer = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>853</td><td></td></tr>
  <tr><td>854</td><td>	ClientImpl.prototype._traceBuffer = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>855</td><td>	ClientImpl.prototype._MAX_TRACE_ENTRIES = 100;</td></tr>
  <tr><td>856</td><td></td></tr>
  <tr><td>857</td><td>	ClientImpl.prototype.connect = <span class="codeReserved">function</span> (connectOptions) {</td></tr>
  <tr><td>858</td><td>		<span class="codeReserved">var</span> connectOptionsMasked = <span class="codeReserved">this</span>._traceMask(connectOptions, <span class="codeString">"password"</span>);</td></tr>
  <tr><td>859</td><td>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client.connect"</span>, connectOptionsMasked, <span class="codeReserved">this</span>.socket, <span class="codeReserved">this</span>.connected);</td></tr>
  <tr><td>860</td><td></td></tr>
  <tr><td>861</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connected)</td></tr>
  <tr><td>862</td><td>			<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_STATE, [<span class="codeString">"already connected"</span>]));</td></tr>
  <tr><td>863</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.socket)</td></tr>
  <tr><td>864</td><td>			<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_STATE, [<span class="codeString">"already connected"</span>]));</td></tr>
  <tr><td>865</td><td></td></tr>
  <tr><td>866</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._reconnecting) {</td></tr>
  <tr><td>867</td><td>			<span class="codeComment">// connect() function is called while reconnect is in progress.</span></td></tr>
  <tr><td>868</td><td>			<span class="codeComment">// Terminate the auto reconnect process to use new connect options.</span></td></tr>
  <tr><td>869</td><td>			<span class="codeReserved">this</span>._reconnectTimeout.cancel();</td></tr>
  <tr><td>870</td><td>			<span class="codeReserved">this</span>._reconnectTimeout = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>871</td><td>			<span class="codeReserved">this</span>._reconnecting = <span class="codeReserved">false</span>;</td></tr>
  <tr><td>872</td><td>		}</td></tr>
  <tr><td>873</td><td></td></tr>
  <tr><td>874</td><td>		<span class="codeReserved">this</span>.connectOptions = connectOptions;</td></tr>
  <tr><td>875</td><td>		<span class="codeReserved">this</span>._reconnectInterval = 1;</td></tr>
  <tr><td>876</td><td>		<span class="codeReserved">this</span>._reconnecting = <span class="codeReserved">false</span>;</td></tr>
  <tr><td>877</td><td>		<span class="codeReserved">if</span> (connectOptions.uris) {</td></tr>
  <tr><td>878</td><td>			<span class="codeReserved">this</span>.hostIndex = 0;</td></tr>
  <tr><td>879</td><td>			<span class="codeReserved">this</span>._doConnect(connectOptions.uris[0]);</td></tr>
  <tr><td>880</td><td>		} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>881</td><td>			<span class="codeReserved">this</span>._doConnect(<span class="codeReserved">this</span>.uri);</td></tr>
  <tr><td>882</td><td>		}</td></tr>
  <tr><td>883</td><td></td></tr>
  <tr><td>884</td><td>	};</td></tr>
  <tr><td>885</td><td></td></tr>
  <tr><td>886</td><td>	ClientImpl.prototype.subscribe = <span class="codeReserved">function</span> (filter, subscribeOptions) {</td></tr>
  <tr><td>887</td><td>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client.subscribe"</span>, filter, subscribeOptions);</td></tr>
  <tr><td>888</td><td></td></tr>
  <tr><td>889</td><td>		<span class="codeReserved">if</span> (!<span class="codeReserved">this</span>.connected)</td></tr>
  <tr><td>890</td><td>			<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_STATE, [<span class="codeString">"not connected"</span>]));</td></tr>
  <tr><td>891</td><td></td></tr>
  <tr><td>892</td><td>		<span class="codeReserved">var</span> wireMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.SUBSCRIBE);</td></tr>
  <tr><td>893</td><td>		wireMessage.topics=[filter];</td></tr>
  <tr><td>894</td><td>		<span class="codeReserved">if</span> (subscribeOptions.qos !== undefined)</td></tr>
  <tr><td>895</td><td>			wireMessage.requestedQos = [subscribeOptions.qos];</td></tr>
  <tr><td>896</td><td>		<span class="codeReserved">else</span></td></tr>
  <tr><td>897</td><td>			wireMessage.requestedQos = [0];</td></tr>
  <tr><td>898</td><td></td></tr>
  <tr><td>899</td><td>		<span class="codeReserved">if</span> (subscribeOptions.onSuccess) {</td></tr>
  <tr><td>900</td><td>			wireMessage.onSuccess = <span class="codeReserved">function</span>(grantedQos) {subscribeOptions.onSuccess({invocationContext:subscribeOptions.invocationContext,grantedQos:grantedQos});};</td></tr>
  <tr><td>901</td><td>		}</td></tr>
  <tr><td>902</td><td></td></tr>
  <tr><td>903</td><td>		<span class="codeReserved">if</span> (subscribeOptions.onFailure) {</td></tr>
  <tr><td>904</td><td>			wireMessage.onFailure = <span class="codeReserved">function</span>(errorCode) {subscribeOptions.onFailure({invocationContext:subscribeOptions.invocationContext,errorCode:errorCode, errorMessage:format(errorCode)});};</td></tr>
  <tr><td>905</td><td>		}</td></tr>
  <tr><td>906</td><td></td></tr>
  <tr><td>907</td><td>		<span class="codeReserved">if</span> (subscribeOptions.timeout) {</td></tr>
  <tr><td>908</td><td>			wireMessage.timeOut = <span class="codeReserved">new</span> Timeout(<span class="codeReserved">this</span>, window, subscribeOptions.timeout, subscribeOptions.onFailure,</td></tr>
  <tr><td>909</td><td>						[{invocationContext:subscribeOptions.invocationContext,</td></tr>
  <tr><td>910</td><td>						errorCode:ERROR.SUBSCRIBE_TIMEOUT.code,</td></tr>
  <tr><td>911</td><td>						errorMessage:format(ERROR.SUBSCRIBE_TIMEOUT)}]);</td></tr>
  <tr><td>912</td><td>		}</td></tr>
  <tr><td>913</td><td></td></tr>
  <tr><td>914</td><td>		<span class="codeComment">// All subscriptions return a SUBACK.</span></td></tr>
  <tr><td>915</td><td>		<span class="codeReserved">this</span>._requires_ack(wireMessage);</td></tr>
  <tr><td>916</td><td>		<span class="codeReserved">this</span>._schedule_message(wireMessage);</td></tr>
  <tr><td>917</td><td>	};</td></tr>
  <tr><td>918</td><td></td></tr>
  <tr><td>919</td><td>	<span class="codeComment">/** <span class="codeReserved">@ignore</span> */</span></td></tr>
  <tr><td>920</td><td>	ClientImpl.prototype.unsubscribe = <span class="codeReserved">function</span>(filter, unsubscribeOptions) {</td></tr>
  <tr><td>921</td><td>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client.unsubscribe"</span>, filter, unsubscribeOptions);</td></tr>
  <tr><td>922</td><td></td></tr>
  <tr><td>923</td><td>		<span class="codeReserved">if</span> (!<span class="codeReserved">this</span>.connected)</td></tr>
  <tr><td>924</td><td>		   <span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_STATE, [<span class="codeString">"not connected"</span>]));</td></tr>
  <tr><td>925</td><td></td></tr>
  <tr><td>926</td><td>		<span class="codeReserved">var</span> wireMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.UNSUBSCRIBE);</td></tr>
  <tr><td>927</td><td>		wireMessage.topics = [filter];</td></tr>
  <tr><td>928</td><td></td></tr>
  <tr><td>929</td><td>		<span class="codeReserved">if</span> (unsubscribeOptions.onSuccess) {</td></tr>
  <tr><td>930</td><td>			wireMessage.callback = <span class="codeReserved">function</span>() {unsubscribeOptions.onSuccess({invocationContext:unsubscribeOptions.invocationContext});};</td></tr>
  <tr><td>931</td><td>		}</td></tr>
  <tr><td>932</td><td>		<span class="codeReserved">if</span> (unsubscribeOptions.timeout) {</td></tr>
  <tr><td>933</td><td>			wireMessage.timeOut = <span class="codeReserved">new</span> Timeout(<span class="codeReserved">this</span>, window, unsubscribeOptions.timeout, unsubscribeOptions.onFailure,</td></tr>
  <tr><td>934</td><td>					  [{invocationContext:unsubscribeOptions.invocationContext,</td></tr>
  <tr><td>935</td><td>						errorCode:ERROR.UNSUBSCRIBE_TIMEOUT.code,</td></tr>
  <tr><td>936</td><td>						errorMessage:format(ERROR.UNSUBSCRIBE_TIMEOUT)}]);</td></tr>
  <tr><td>937</td><td>		}</td></tr>
  <tr><td>938</td><td></td></tr>
  <tr><td>939</td><td>		<span class="codeComment">// All unsubscribes return a SUBACK.</span></td></tr>
  <tr><td>940</td><td>		<span class="codeReserved">this</span>._requires_ack(wireMessage);</td></tr>
  <tr><td>941</td><td>		<span class="codeReserved">this</span>._schedule_message(wireMessage);</td></tr>
  <tr><td>942</td><td>	};</td></tr>
  <tr><td>943</td><td></td></tr>
  <tr><td>944</td><td>	ClientImpl.prototype.send = <span class="codeReserved">function</span> (message) {</td></tr>
  <tr><td>945</td><td>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client.send"</span>, message);</td></tr>
  <tr><td>946</td><td></td></tr>
  <tr><td>947</td><td>		wireMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.PUBLISH);</td></tr>
  <tr><td>948</td><td>		wireMessage.payloadMessage = message;</td></tr>
  <tr><td>949</td><td></td></tr>
  <tr><td>950</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connected) {</td></tr>
  <tr><td>951</td><td>			<span class="codeComment">// Mark qos 1 & 2 message as &quot;ACK required&quot;</span></td></tr>
  <tr><td>952</td><td>			<span class="codeComment">// For qos 0 message, invoke onMessageDelivered callback if there is one.</span></td></tr>
  <tr><td>953</td><td>			<span class="codeComment">// Then schedule the message.</span></td></tr>
  <tr><td>954</td><td>			<span class="codeReserved">if</span> (message.qos &gt; 0) {</td></tr>
  <tr><td>955</td><td>			<span class="codeReserved">this</span>._requires_ack(wireMessage);</td></tr>
  <tr><td>956</td><td>			} <span class="codeReserved">else</span> <span class="codeReserved">if</span> (<span class="codeReserved">this</span>.onMessageDelivered) {</td></tr>
  <tr><td>957</td><td>			<span class="codeReserved">this</span>._notify_msg_sent[wireMessage] = <span class="codeReserved">this</span>.onMessageDelivered(wireMessage.payloadMessage);</td></tr>
  <tr><td>958</td><td>			}</td></tr>
  <tr><td>959</td><td>		<span class="codeReserved">this</span>._schedule_message(wireMessage);</td></tr>
  <tr><td>960</td><td>		} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>961</td><td>			<span class="codeComment">// Currently disconnected, will not schedule this message</span></td></tr>
  <tr><td>962</td><td>			<span class="codeComment">// Check if reconnecting is in progress and disconnected publish is enabled.</span></td></tr>
  <tr><td>963</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._reconnecting && <span class="codeReserved">this</span>.disconnectedPublishing) {</td></tr>
  <tr><td>964</td><td>				<span class="codeComment">// Check the limit which include the &quot;required ACK&quot; messages</span></td></tr>
  <tr><td>965</td><td>				<span class="codeReserved">var</span> messageCount = Object.keys(<span class="codeReserved">this</span>._sentMessages).length + <span class="codeReserved">this</span>._buffered_msg_queue.length;</td></tr>
  <tr><td>966</td><td>				<span class="codeReserved">if</span> (messageCount &gt; <span class="codeReserved">this</span>.disconnectedBufferSize) {</td></tr>
  <tr><td>967</td><td>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.BUFFER_FULL, [<span class="codeReserved">this</span>.disconnectedBufferSize]));</td></tr>
  <tr><td>968</td><td>				} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>969</td><td>					<span class="codeReserved">if</span> (message.qos &gt; 0) {</td></tr>
  <tr><td>970</td><td>						<span class="codeComment">// Mark this message as &quot;ACK required&quot;</span></td></tr>
  <tr><td>971</td><td>						<span class="codeReserved">this</span>._requires_ack(wireMessage);</td></tr>
  <tr><td>972</td><td>					} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>973</td><td>						wireMessage.sequence = ++<span class="codeReserved">this</span>._sequence;</td></tr>
  <tr><td>974</td><td>						<span class="codeReserved">this</span>._buffered_msg_queue.push(wireMessage);</td></tr>
  <tr><td>975</td><td>					}</td></tr>
  <tr><td>976</td><td>				}</td></tr>
  <tr><td>977</td><td>			} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>978</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_STATE, [<span class="codeString">"not connected"</span>]));</td></tr>
  <tr><td>979</td><td>			}</td></tr>
  <tr><td>980</td><td>		}</td></tr>
  <tr><td>981</td><td>	};</td></tr>
  <tr><td>982</td><td></td></tr>
  <tr><td>983</td><td>	ClientImpl.prototype.disconnect = <span class="codeReserved">function</span> () {</td></tr>
  <tr><td>984</td><td>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client.disconnect"</span>);</td></tr>
  <tr><td>985</td><td></td></tr>
  <tr><td>986</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._reconnecting) {</td></tr>
  <tr><td>987</td><td>			<span class="codeComment">// disconnect() function is called while reconnect is in progress.</span></td></tr>
  <tr><td>988</td><td>			<span class="codeComment">// Terminate the auto reconnect process.</span></td></tr>
  <tr><td>989</td><td>			<span class="codeReserved">this</span>._reconnectTimeout.cancel();</td></tr>
  <tr><td>990</td><td>			<span class="codeReserved">this</span>._reconnectTimeout = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>991</td><td>			<span class="codeReserved">this</span>._reconnecting = <span class="codeReserved">false</span>;</td></tr>
  <tr><td>992</td><td>		}</td></tr>
  <tr><td>993</td><td></td></tr>
  <tr><td>994</td><td>		<span class="codeReserved">if</span> (!<span class="codeReserved">this</span>.socket)</td></tr>
  <tr><td>995</td><td>			<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_STATE, [<span class="codeString">"not connecting or connected"</span>]));</td></tr>
  <tr><td>996</td><td></td></tr>
  <tr><td>997</td><td>		wireMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.DISCONNECT);</td></tr>
  <tr><td>998</td><td></td></tr>
  <tr><td>999</td><td>		<span class="codeComment">// Run the disconnected call back as soon as the message has been sent,</span></td></tr>
  <tr><td>1000</td><td>		<span class="codeComment">// in case of a failure later on in the disconnect processing.</span></td></tr>
  <tr><td>1001</td><td>		<span class="codeComment">// as a consequence, the _disconected call back may be run several times.</span></td></tr>
  <tr><td>1002</td><td>		<span class="codeReserved">this</span>._notify_msg_sent[wireMessage] = scope(<span class="codeReserved">this</span>._disconnected, <span class="codeReserved">this</span>);</td></tr>
  <tr><td>1003</td><td></td></tr>
  <tr><td>1004</td><td>		<span class="codeReserved">this</span>._schedule_message(wireMessage);</td></tr>
  <tr><td>1005</td><td>	};</td></tr>
  <tr><td>1006</td><td></td></tr>
  <tr><td>1007</td><td>	ClientImpl.prototype.getTraceLog = <span class="codeReserved">function</span> () {</td></tr>
  <tr><td>1008</td><td>		<span class="codeReserved">if</span> ( <span class="codeReserved">this</span>._traceBuffer !== <span class="codeReserved">null</span> ) {</td></tr>
  <tr><td>1009</td><td>			<span class="codeReserved">this</span>._trace(<span class="codeString">"Client.getTraceLog"</span>, <span class="codeReserved">new</span> Date());</td></tr>
  <tr><td>1010</td><td>			<span class="codeReserved">this</span>._trace(<span class="codeString">"Client.getTraceLog <span class="codeReserved">in</span> flight messages"</span>, <span class="codeReserved">this</span>._sentMessages.length);</td></tr>
  <tr><td>1011</td><td>			<span class="codeReserved">for</span> (<span class="codeReserved">var</span> key <span class="codeReserved">in</span> <span class="codeReserved">this</span>._sentMessages)</td></tr>
  <tr><td>1012</td><td>				<span class="codeReserved">this</span>._trace(<span class="codeString">"_sentMessages "</span>,key, <span class="codeReserved">this</span>._sentMessages[key]);</td></tr>
  <tr><td>1013</td><td>			<span class="codeReserved">for</span> (<span class="codeReserved">var</span> key <span class="codeReserved">in</span> <span class="codeReserved">this</span>._receivedMessages)</td></tr>
  <tr><td>1014</td><td>				<span class="codeReserved">this</span>._trace(<span class="codeString">"_receivedMessages "</span>,key, <span class="codeReserved">this</span>._receivedMessages[key]);</td></tr>
  <tr><td>1015</td><td></td></tr>
  <tr><td>1016</td><td>			<span class="codeReserved">return</span> <span class="codeReserved">this</span>._traceBuffer;</td></tr>
  <tr><td>1017</td><td>		}</td></tr>
  <tr><td>1018</td><td>	};</td></tr>
  <tr><td>1019</td><td></td></tr>
  <tr><td>1020</td><td>	ClientImpl.prototype.startTrace = <span class="codeReserved">function</span> () {</td></tr>
  <tr><td>1021</td><td>		<span class="codeReserved">if</span> ( <span class="codeReserved">this</span>._traceBuffer === <span class="codeReserved">null</span> ) {</td></tr>
  <tr><td>1022</td><td>			<span class="codeReserved">this</span>._traceBuffer = [];</td></tr>
  <tr><td>1023</td><td>		}</td></tr>
  <tr><td>1024</td><td>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client.startTrace"</span>, <span class="codeReserved">new</span> Date(), version);</td></tr>
  <tr><td>1025</td><td>	};</td></tr>
  <tr><td>1026</td><td></td></tr>
  <tr><td>1027</td><td>	ClientImpl.prototype.stopTrace = <span class="codeReserved">function</span> () {</td></tr>
  <tr><td>1028</td><td>		delete <span class="codeReserved">this</span>._traceBuffer;</td></tr>
  <tr><td>1029</td><td>	};</td></tr>
  <tr><td>1030</td><td></td></tr>
  <tr><td>1031</td><td>	ClientImpl.prototype._doConnect = <span class="codeReserved">function</span> (wsurl) {</td></tr>
  <tr><td>1032</td><td>		<span class="codeComment">// When the socket is open, this client will send the CONNECT WireMessage using the saved parameters.</span></td></tr>
  <tr><td>1033</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connectOptions.useSSL) {</td></tr>
  <tr><td>1034</td><td>		    <span class="codeReserved">var</span> uriParts = wsurl.split(<span class="codeString">":"</span>);</td></tr>
  <tr><td>1035</td><td>		    uriParts[0] = <span class="codeString">"wss"</span>;</td></tr>
  <tr><td>1036</td><td>		    wsurl = uriParts.join(<span class="codeString">":"</span>);</td></tr>
  <tr><td>1037</td><td>		}</td></tr>
  <tr><td>1038</td><td>		<span class="codeReserved">this</span>._wsuri = wsurl;</td></tr>
  <tr><td>1039</td><td>		<span class="codeReserved">this</span>.connected = <span class="codeReserved">false</span>;</td></tr>
  <tr><td>1040</td><td></td></tr>
  <tr><td>1041</td><td></td></tr>
  <tr><td>1042</td><td></td></tr>
  <tr><td>1043</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connectOptions.mqttVersion &lt; 4) {</td></tr>
  <tr><td>1044</td><td>			<span class="codeReserved">this</span>.socket = <span class="codeReserved">new</span> WebSocket(wsurl, [<span class="codeString">"mqttv3.1"</span>]);</td></tr>
  <tr><td>1045</td><td>		} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>1046</td><td>			<span class="codeReserved">this</span>.socket = <span class="codeReserved">new</span> WebSocket(wsurl, [<span class="codeString">"mqtt"</span>]);</td></tr>
  <tr><td>1047</td><td>		}</td></tr>
  <tr><td>1048</td><td>		<span class="codeReserved">this</span>.socket.binaryType = <span class="codeString">'arraybuffer'</span>;</td></tr>
  <tr><td>1049</td><td>		<span class="codeReserved">this</span>.socket.onopen = scope(<span class="codeReserved">this</span>._on_socket_open, <span class="codeReserved">this</span>);</td></tr>
  <tr><td>1050</td><td>		<span class="codeReserved">this</span>.socket.onmessage = scope(<span class="codeReserved">this</span>._on_socket_message, <span class="codeReserved">this</span>);</td></tr>
  <tr><td>1051</td><td>		<span class="codeReserved">this</span>.socket.onerror = scope(<span class="codeReserved">this</span>._on_socket_error, <span class="codeReserved">this</span>);</td></tr>
  <tr><td>1052</td><td>		<span class="codeReserved">this</span>.socket.onclose = scope(<span class="codeReserved">this</span>._on_socket_close, <span class="codeReserved">this</span>);</td></tr>
  <tr><td>1053</td><td></td></tr>
  <tr><td>1054</td><td>		<span class="codeReserved">this</span>.sendPinger = <span class="codeReserved">new</span> Pinger(<span class="codeReserved">this</span>, window, <span class="codeReserved">this</span>.connectOptions.keepAliveInterval);</td></tr>
  <tr><td>1055</td><td>		<span class="codeReserved">this</span>.receivePinger = <span class="codeReserved">new</span> Pinger(<span class="codeReserved">this</span>, window, <span class="codeReserved">this</span>.connectOptions.keepAliveInterval);</td></tr>
  <tr><td>1056</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._connectTimeout) {</td></tr>
  <tr><td>1057</td><td>			<span class="codeReserved">this</span>._connectTimeout.cancel();</td></tr>
  <tr><td>1058</td><td>			<span class="codeReserved">this</span>._connectTimeout = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>1059</td><td>		}</td></tr>
  <tr><td>1060</td><td>		<span class="codeReserved">this</span>._connectTimeout = <span class="codeReserved">new</span> Timeout(<span class="codeReserved">this</span>, window, <span class="codeReserved">this</span>.connectOptions.timeout, <span class="codeReserved">this</span>._disconnected,  [ERROR.CONNECT_TIMEOUT.code, format(ERROR.CONNECT_TIMEOUT)]);</td></tr>
  <tr><td>1061</td><td>	};</td></tr>
  <tr><td>1062</td><td></td></tr>
  <tr><td>1063</td><td></td></tr>
  <tr><td>1064</td><td>	<span class="codeComment">// Schedule a new message to be sent over the WebSockets</span></td></tr>
  <tr><td>1065</td><td>	<span class="codeComment">// connection. CONNECT messages cause WebSocket connection</span></td></tr>
  <tr><td>1066</td><td>	<span class="codeComment">// to be started. All other messages are queued internally</span></td></tr>
  <tr><td>1067</td><td>	<span class="codeComment">// until this has happened. When WS connection starts, process</span></td></tr>
  <tr><td>1068</td><td>	<span class="codeComment">// all outstanding messages.</span></td></tr>
  <tr><td>1069</td><td>	ClientImpl.prototype._schedule_message = <span class="codeReserved">function</span> (message) {</td></tr>
  <tr><td>1070</td><td>		<span class="codeReserved">this</span>._msg_queue.push(message);</td></tr>
  <tr><td>1071</td><td>		<span class="codeComment">// Process outstanding messages in the queue if we have an  open socket, and have received CONNACK.</span></td></tr>
  <tr><td>1072</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connected) {</td></tr>
  <tr><td>1073</td><td>			<span class="codeReserved">this</span>._process_queue();</td></tr>
  <tr><td>1074</td><td>		}</td></tr>
  <tr><td>1075</td><td>	};</td></tr>
  <tr><td>1076</td><td></td></tr>
  <tr><td>1077</td><td>	ClientImpl.prototype.store = <span class="codeReserved">function</span>(prefix, wireMessage) {</td></tr>
  <tr><td>1078</td><td>		<span class="codeReserved">var</span> storedMessage = {type:wireMessage.type, messageIdentifier:wireMessage.messageIdentifier, version:1};</td></tr>
  <tr><td>1079</td><td></td></tr>
  <tr><td>1080</td><td>		<span class="codeReserved">switch</span>(wireMessage.type) {</td></tr>
  <tr><td>1081</td><td>		  <span class="codeReserved">case</span> MESSAGE_TYPE.PUBLISH:</td></tr>
  <tr><td>1082</td><td>			  <span class="codeReserved">if</span>(wireMessage.pubRecReceived)</td></tr>
  <tr><td>1083</td><td>				  storedMessage.pubRecReceived = <span class="codeReserved">true</span>;</td></tr>
  <tr><td>1084</td><td></td></tr>
  <tr><td>1085</td><td>			  <span class="codeComment">// Convert the payload to a hex string.</span></td></tr>
  <tr><td>1086</td><td>			  storedMessage.payloadMessage = {};</td></tr>
  <tr><td>1087</td><td>			  <span class="codeReserved">var</span> hex = <span class="codeString">""</span>;</td></tr>
  <tr><td>1088</td><td>			  <span class="codeReserved">var</span> messageBytes = wireMessage.payloadMessage.payloadBytes;</td></tr>
  <tr><td>1089</td><td>			  <span class="codeReserved">for</span> (<span class="codeReserved">var</span> i=0; i&lt;<span class="codeReserved">messageBytes</span>.length; i++) {</td></tr>
  <tr><td>1090</td><td>				<span class="codeReserved">if</span> (messageBytes[i] &lt;= 0xF)</td></tr>
  <tr><td>1091</td><td>				  hex = hex+<span class="codeString">"0"</span>+messageBytes[i].toString(16);</td></tr>
  <tr><td>1092</td><td>				<span class="codeReserved">else</span></td></tr>
  <tr><td>1093</td><td>				  hex = hex+messageBytes[i].toString(16);</td></tr>
  <tr><td>1094</td><td>			  }</td></tr>
  <tr><td>1095</td><td>			  storedMessage.payloadMessage.payloadHex = hex;</td></tr>
  <tr><td>1096</td><td></td></tr>
  <tr><td>1097</td><td>			  storedMessage.payloadMessage.qos = wireMessage.payloadMessage.qos;</td></tr>
  <tr><td>1098</td><td>			  storedMessage.payloadMessage.destinationName = wireMessage.payloadMessage.destinationName;</td></tr>
  <tr><td>1099</td><td>			  <span class="codeReserved">if</span> (wireMessage.payloadMessage.duplicate)</td></tr>
  <tr><td>1100</td><td>				  storedMessage.payloadMessage.duplicate = <span class="codeReserved">true</span>;</td></tr>
  <tr><td>1101</td><td>			  <span class="codeReserved">if</span> (wireMessage.payloadMessage.retained)</td></tr>
  <tr><td>1102</td><td>				  storedMessage.payloadMessage.retained = <span class="codeReserved">true</span>;</td></tr>
  <tr><td>1103</td><td></td></tr>
  <tr><td>1104</td><td>			  <span class="codeComment">// Add a sequence number to sent messages.</span></td></tr>
  <tr><td>1105</td><td>			  <span class="codeReserved">if</span> ( prefix.indexOf(<span class="codeString">"Sent:"</span>) === 0 ) {</td></tr>
  <tr><td>1106</td><td>				  <span class="codeReserved">if</span> ( wireMessage.sequence === undefined )</td></tr>
  <tr><td>1107</td><td>					  wireMessage.sequence = ++<span class="codeReserved">this</span>._sequence;</td></tr>
  <tr><td>1108</td><td>				  storedMessage.sequence = wireMessage.sequence;</td></tr>
  <tr><td>1109</td><td>			  }</td></tr>
  <tr><td>1110</td><td>			  <span class="codeReserved">break</span>;</td></tr>
  <tr><td>1111</td><td></td></tr>
  <tr><td>1112</td><td>			<span class="codeReserved">default</span>:</td></tr>
  <tr><td>1113</td><td>				<span class="codeReserved">throw</span> Error(format(ERROR.INVALID_STORED_DATA, [key, storedMessage]));</td></tr>
  <tr><td>1114</td><td>		}</td></tr>
  <tr><td>1115</td><td>		localStorage.setItem(prefix+<span class="codeReserved">this</span>._localKey+wireMessage.messageIdentifier, JSON.stringify(storedMessage));</td></tr>
  <tr><td>1116</td><td>	};</td></tr>
  <tr><td>1117</td><td></td></tr>
  <tr><td>1118</td><td>	ClientImpl.prototype.restore = <span class="codeReserved">function</span>(key) {</td></tr>
  <tr><td>1119</td><td>		<span class="codeReserved">var</span> value = localStorage.getItem(key);</td></tr>
  <tr><td>1120</td><td>		<span class="codeReserved">var</span> storedMessage = JSON.parse(value);</td></tr>
  <tr><td>1121</td><td></td></tr>
  <tr><td>1122</td><td>		<span class="codeReserved">var</span> wireMessage = <span class="codeReserved">new</span> WireMessage(storedMessage.type, storedMessage);</td></tr>
  <tr><td>1123</td><td></td></tr>
  <tr><td>1124</td><td>		<span class="codeReserved">switch</span>(storedMessage.type) {</td></tr>
  <tr><td>1125</td><td>		  <span class="codeReserved">case</span> MESSAGE_TYPE.PUBLISH:</td></tr>
  <tr><td>1126</td><td>			  <span class="codeComment">// Replace the payload message with a Message object.</span></td></tr>
  <tr><td>1127</td><td>			  <span class="codeReserved">var</span> hex = storedMessage.payloadMessage.payloadHex;</td></tr>
  <tr><td>1128</td><td>			  <span class="codeReserved">var</span> buffer = <span class="codeReserved">new</span> ArrayBuffer((hex.length)/2);</td></tr>
  <tr><td>1129</td><td>			  <span class="codeReserved">var</span> byteStream = <span class="codeReserved">new</span> Uint8Array(buffer);</td></tr>
  <tr><td>1130</td><td>			  <span class="codeReserved">var</span> i = 0;</td></tr>
  <tr><td>1131</td><td>			  <span class="codeReserved">while</span> (hex.length &gt;= 2) {</td></tr>
  <tr><td>1132</td><td>				  <span class="codeReserved">var</span> x = parseInt(hex.substring(0, 2), 16);</td></tr>
  <tr><td>1133</td><td>				  hex = hex.substring(2, hex.length);</td></tr>
  <tr><td>1134</td><td>				  byteStream[i++] = x;</td></tr>
  <tr><td>1135</td><td>			  }</td></tr>
  <tr><td>1136</td><td>			  <span class="codeReserved">var</span> payloadMessage = <span class="codeReserved">new</span> Paho.MQTT.Message(byteStream);</td></tr>
  <tr><td>1137</td><td></td></tr>
  <tr><td>1138</td><td>			  payloadMessage.qos = storedMessage.payloadMessage.qos;</td></tr>
  <tr><td>1139</td><td>			  payloadMessage.destinationName = storedMessage.payloadMessage.destinationName;</td></tr>
  <tr><td>1140</td><td>			  <span class="codeReserved">if</span> (storedMessage.payloadMessage.duplicate)</td></tr>
  <tr><td>1141</td><td>				  payloadMessage.duplicate = <span class="codeReserved">true</span>;</td></tr>
  <tr><td>1142</td><td>			  <span class="codeReserved">if</span> (storedMessage.payloadMessage.retained)</td></tr>
  <tr><td>1143</td><td>				  payloadMessage.retained = <span class="codeReserved">true</span>;</td></tr>
  <tr><td>1144</td><td>			  wireMessage.payloadMessage = payloadMessage;</td></tr>
  <tr><td>1145</td><td></td></tr>
  <tr><td>1146</td><td>			  <span class="codeReserved">break</span>;</td></tr>
  <tr><td>1147</td><td></td></tr>
  <tr><td>1148</td><td>			<span class="codeReserved">default</span>:</td></tr>
  <tr><td>1149</td><td>			  <span class="codeReserved">throw</span> Error(format(ERROR.INVALID_STORED_DATA, [key, value]));</td></tr>
  <tr><td>1150</td><td>		}</td></tr>
  <tr><td>1151</td><td></td></tr>
  <tr><td>1152</td><td>		<span class="codeReserved">if</span> (key.indexOf(<span class="codeString">"Sent:"</span>+<span class="codeReserved">this</span>._localKey) === 0) {</td></tr>
  <tr><td>1153</td><td>			wireMessage.payloadMessage.duplicate = <span class="codeReserved">true</span>;</td></tr>
  <tr><td>1154</td><td>			<span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier] = wireMessage;</td></tr>
  <tr><td>1155</td><td>		} <span class="codeReserved">else</span> <span class="codeReserved">if</span> (key.indexOf(<span class="codeString">"Received:"</span>+<span class="codeReserved">this</span>._localKey) === 0) {</td></tr>
  <tr><td>1156</td><td>			<span class="codeReserved">this</span>._receivedMessages[wireMessage.messageIdentifier] = wireMessage;</td></tr>
  <tr><td>1157</td><td>		}</td></tr>
  <tr><td>1158</td><td>	};</td></tr>
  <tr><td>1159</td><td></td></tr>
  <tr><td>1160</td><td>	ClientImpl.prototype._process_queue = <span class="codeReserved">function</span> () {</td></tr>
  <tr><td>1161</td><td>		<span class="codeReserved">var</span> message = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>1162</td><td>		<span class="codeComment">// Process messages in order they were added</span></td></tr>
  <tr><td>1163</td><td>		<span class="codeReserved">var</span> fifo = <span class="codeReserved">this</span>._msg_queue.reverse();</td></tr>
  <tr><td>1164</td><td></td></tr>
  <tr><td>1165</td><td>		<span class="codeComment">// Send all queued messages down socket connection</span></td></tr>
  <tr><td>1166</td><td>		<span class="codeReserved">while</span> ((message = fifo.pop())) {</td></tr>
  <tr><td>1167</td><td>			<span class="codeReserved">this</span>._socket_send(message);</td></tr>
  <tr><td>1168</td><td>			<span class="codeComment">// Notify listeners that message was successfully sent</span></td></tr>
  <tr><td>1169</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._notify_msg_sent[message]) {</td></tr>
  <tr><td>1170</td><td>				<span class="codeReserved">this</span>._notify_msg_sent[message]();</td></tr>
  <tr><td>1171</td><td>				delete <span class="codeReserved">this</span>._notify_msg_sent[message];</td></tr>
  <tr><td>1172</td><td>			}</td></tr>
  <tr><td>1173</td><td>		}</td></tr>
  <tr><td>1174</td><td>	};</td></tr>
  <tr><td>1175</td><td></td></tr>
  <tr><td>1176</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>1177</td><td><span class="codeComment">	 * Expect an ACK response <span class="codeReserved">for</span> <span class="codeReserved">this</span> message. Add message <span class="codeReserved">to</span> the set of <span class="codeReserved">in</span> progress</span></td></tr>
  <tr><td>1178</td><td><span class="codeComment">	 * messages and set an unused identifier <span class="codeReserved">in</span> <span class="codeReserved">this</span> message.</span></td></tr>
  <tr><td>1179</td><td><span class="codeComment">	 * <span class="codeReserved">@ignore</span></span></td></tr>
  <tr><td>1180</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>1181</td><td>	ClientImpl.prototype._requires_ack = <span class="codeReserved">function</span> (wireMessage) {</td></tr>
  <tr><td>1182</td><td>		<span class="codeReserved">var</span> messageCount = Object.keys(<span class="codeReserved">this</span>._sentMessages).length;</td></tr>
  <tr><td>1183</td><td>		<span class="codeReserved">if</span> (messageCount &gt; <span class="codeReserved">this</span>.maxMessageIdentifier)</td></tr>
  <tr><td>1184</td><td>			<span class="codeReserved">throw</span> Error (<span class="codeString">"Too many messages:"</span>+messageCount);</td></tr>
  <tr><td>1185</td><td></td></tr>
  <tr><td>1186</td><td>		<span class="codeReserved">while</span>(<span class="codeReserved">this</span>._sentMessages[<span class="codeReserved">this</span>._message_identifier] !== undefined) {</td></tr>
  <tr><td>1187</td><td>			<span class="codeReserved">this</span>._message_identifier++;</td></tr>
  <tr><td>1188</td><td>		}</td></tr>
  <tr><td>1189</td><td>		wireMessage.messageIdentifier = <span class="codeReserved">this</span>._message_identifier;</td></tr>
  <tr><td>1190</td><td>		<span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier] = wireMessage;</td></tr>
  <tr><td>1191</td><td>		<span class="codeReserved">if</span> (wireMessage.type === MESSAGE_TYPE.PUBLISH) {</td></tr>
  <tr><td>1192</td><td>			<span class="codeReserved">this</span>.store(<span class="codeString">"Sent:"</span>, wireMessage);</td></tr>
  <tr><td>1193</td><td>		}</td></tr>
  <tr><td>1194</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._message_identifier === <span class="codeReserved">this</span>.maxMessageIdentifier) {</td></tr>
  <tr><td>1195</td><td>			<span class="codeReserved">this</span>._message_identifier = 1;</td></tr>
  <tr><td>1196</td><td>		}</td></tr>
  <tr><td>1197</td><td>	};</td></tr>
  <tr><td>1198</td><td></td></tr>
  <tr><td>1199</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>1200</td><td><span class="codeComment">	 * Called when the underlying websocket has been opened.</span></td></tr>
  <tr><td>1201</td><td><span class="codeComment">	 * <span class="codeReserved">@ignore</span></span></td></tr>
  <tr><td>1202</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>1203</td><td>	ClientImpl.prototype._on_socket_open = <span class="codeReserved">function</span> () {</td></tr>
  <tr><td>1204</td><td>		<span class="codeComment">// Create the CONNECT message object.</span></td></tr>
  <tr><td>1205</td><td>		<span class="codeReserved">var</span> wireMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.CONNECT, <span class="codeReserved">this</span>.connectOptions);</td></tr>
  <tr><td>1206</td><td>		wireMessage.clientId = <span class="codeReserved">this</span>.clientId;</td></tr>
  <tr><td>1207</td><td>		<span class="codeReserved">this</span>._socket_send(wireMessage);</td></tr>
  <tr><td>1208</td><td>	};</td></tr>
  <tr><td>1209</td><td></td></tr>
  <tr><td>1210</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>1211</td><td><span class="codeComment">	 * Called when the underlying websocket has received a complete packet.</span></td></tr>
  <tr><td>1212</td><td><span class="codeComment">	 * <span class="codeReserved">@ignore</span></span></td></tr>
  <tr><td>1213</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>1214</td><td>	ClientImpl.prototype._on_socket_message = <span class="codeReserved">function</span> (event) {</td></tr>
  <tr><td>1215</td><td>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client._on_socket_message"</span>, event.data);</td></tr>
  <tr><td>1216</td><td>		<span class="codeReserved">var</span> messages = <span class="codeReserved">this</span>._deframeMessages(event.data);</td></tr>
  <tr><td>1217</td><td>		<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i = 0; i &lt; messages.length; i+=1) {</td></tr>
  <tr><td>1218</td><td>		    <span class="codeReserved">this</span>._handleMessage(messages[i]);</td></tr>
  <tr><td>1219</td><td>		}</td></tr>
  <tr><td>1220</td><td>	};</td></tr>
  <tr><td>1221</td><td></td></tr>
  <tr><td>1222</td><td>	ClientImpl.prototype._deframeMessages = <span class="codeReserved">function</span>(data) {</td></tr>
  <tr><td>1223</td><td>		<span class="codeReserved">var</span> byteArray = <span class="codeReserved">new</span> Uint8Array(data);</td></tr>
  <tr><td>1224</td><td>		<span class="codeReserved">var</span> messages = [];</td></tr>
  <tr><td>1225</td><td>	    <span class="codeReserved">if</span> (<span class="codeReserved">this</span>.receiveBuffer) {</td></tr>
  <tr><td>1226</td><td>	        <span class="codeReserved">var</span> newData = <span class="codeReserved">new</span> Uint8Array(<span class="codeReserved">this</span>.receiveBuffer.length+byteArray.length);</td></tr>
  <tr><td>1227</td><td>	        newData.set(<span class="codeReserved">this</span>.receiveBuffer);</td></tr>
  <tr><td>1228</td><td>	        newData.set(byteArray,<span class="codeReserved">this</span>.receiveBuffer.length);</td></tr>
  <tr><td>1229</td><td>	        byteArray = newData;</td></tr>
  <tr><td>1230</td><td>	        delete <span class="codeReserved">this</span>.receiveBuffer;</td></tr>
  <tr><td>1231</td><td>	    }</td></tr>
  <tr><td>1232</td><td>		<span class="codeReserved">try</span> {</td></tr>
  <tr><td>1233</td><td>		    <span class="codeReserved">var</span> offset = 0;</td></tr>
  <tr><td>1234</td><td>		    <span class="codeReserved">while</span>(offset &lt; byteArray.length) {</td></tr>
  <tr><td>1235</td><td>		        <span class="codeReserved">var</span> result = decodeMessage(byteArray,offset);</td></tr>
  <tr><td>1236</td><td>		        <span class="codeReserved">var</span> wireMessage = result[0];</td></tr>
  <tr><td>1237</td><td>		        offset = result[1];</td></tr>
  <tr><td>1238</td><td>		        <span class="codeReserved">if</span> (wireMessage !== <span class="codeReserved">null</span>) {</td></tr>
  <tr><td>1239</td><td>		            messages.push(wireMessage);</td></tr>
  <tr><td>1240</td><td>		        } <span class="codeReserved">else</span> {</td></tr>
  <tr><td>1241</td><td>		            <span class="codeReserved">break</span>;</td></tr>
  <tr><td>1242</td><td>		        }</td></tr>
  <tr><td>1243</td><td>		    }</td></tr>
  <tr><td>1244</td><td>		    <span class="codeReserved">if</span> (offset &lt; byteArray.length) {</td></tr>
  <tr><td>1245</td><td>		    	<span class="codeReserved">this</span>.receiveBuffer = byteArray.subarray(offset);</td></tr>
  <tr><td>1246</td><td>		    }</td></tr>
  <tr><td>1247</td><td>		} <span class="codeReserved">catch</span> (error) {</td></tr>
  <tr><td>1248</td><td>			<span class="codeReserved">var</span> errorStack = ((error.hasOwnProperty(<span class="codeString">'stack'</span>) == <span class="codeString">'undefined'</span>) ? error.stack.toString() : <span class="codeString">"No Error Stack Available"</span>);</td></tr>
  <tr><td>1249</td><td>			<span class="codeReserved">this</span>._disconnected(ERROR.INTERNAL_ERROR.code , format(ERROR.INTERNAL_ERROR, [error.message,errorStack]));</td></tr>
  <tr><td>1250</td><td>			<span class="codeReserved">return</span>;</td></tr>
  <tr><td>1251</td><td>		}</td></tr>
  <tr><td>1252</td><td>		<span class="codeReserved">return</span> messages;</td></tr>
  <tr><td>1253</td><td>	};</td></tr>
  <tr><td>1254</td><td></td></tr>
  <tr><td>1255</td><td>	ClientImpl.prototype._handleMessage = <span class="codeReserved">function</span>(wireMessage) {</td></tr>
  <tr><td>1256</td><td></td></tr>
  <tr><td>1257</td><td>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client._handleMessage"</span>, wireMessage);</td></tr>
  <tr><td>1258</td><td></td></tr>
  <tr><td>1259</td><td>		<span class="codeReserved">try</span> {</td></tr>
  <tr><td>1260</td><td>			<span class="codeReserved">switch</span>(wireMessage.type) {</td></tr>
  <tr><td>1261</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.CONNACK:</td></tr>
  <tr><td>1262</td><td>				<span class="codeReserved">this</span>._connectTimeout.cancel();</td></tr>
  <tr><td>1263</td><td>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._reconnectTimeout)</td></tr>
  <tr><td>1264</td><td>					<span class="codeReserved">this</span>._reconnectTimeout.cancel();</td></tr>
  <tr><td>1265</td><td></td></tr>
  <tr><td>1266</td><td>				<span class="codeComment">// If we have started using clean session then clear up the local state.</span></td></tr>
  <tr><td>1267</td><td>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connectOptions.cleanSession) {</td></tr>
  <tr><td>1268</td><td>					<span class="codeReserved">for</span> (<span class="codeReserved">var</span> key <span class="codeReserved">in</span> <span class="codeReserved">this</span>._sentMessages) {</td></tr>
  <tr><td>1269</td><td>						<span class="codeReserved">var</span> sentMessage = <span class="codeReserved">this</span>._sentMessages[key];</td></tr>
  <tr><td>1270</td><td>						localStorage.removeItem(<span class="codeString">"Sent:"</span>+<span class="codeReserved">this</span>._localKey+sentMessage.messageIdentifier);</td></tr>
  <tr><td>1271</td><td>					}</td></tr>
  <tr><td>1272</td><td>					<span class="codeReserved">this</span>._sentMessages = {};</td></tr>
  <tr><td>1273</td><td></td></tr>
  <tr><td>1274</td><td>					<span class="codeReserved">for</span> (<span class="codeReserved">var</span> key <span class="codeReserved">in</span> <span class="codeReserved">this</span>._receivedMessages) {</td></tr>
  <tr><td>1275</td><td>						<span class="codeReserved">var</span> receivedMessage = <span class="codeReserved">this</span>._receivedMessages[key];</td></tr>
  <tr><td>1276</td><td>						localStorage.removeItem(<span class="codeString">"Received:"</span>+<span class="codeReserved">this</span>._localKey+receivedMessage.messageIdentifier);</td></tr>
  <tr><td>1277</td><td>					}</td></tr>
  <tr><td>1278</td><td>					<span class="codeReserved">this</span>._receivedMessages = {};</td></tr>
  <tr><td>1279</td><td>				}</td></tr>
  <tr><td>1280</td><td>				<span class="codeComment">// Client connected and ready for business.</span></td></tr>
  <tr><td>1281</td><td>				<span class="codeReserved">if</span> (wireMessage.returnCode === 0) {</td></tr>
  <tr><td>1282</td><td></td></tr>
  <tr><td>1283</td><td>					<span class="codeReserved">this</span>.connected = <span class="codeReserved">true</span>;</td></tr>
  <tr><td>1284</td><td>					<span class="codeComment">// Jump to the end of the list of uris and stop looking for a good host.</span></td></tr>
  <tr><td>1285</td><td></td></tr>
  <tr><td>1286</td><td>					<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connectOptions.uris)</td></tr>
  <tr><td>1287</td><td>            <span class="codeReserved">this</span>.hostIndex = <span class="codeReserved">this</span>.connectOptions.uris.length;</td></tr>
  <tr><td>1288</td><td></td></tr>
  <tr><td>1289</td><td>				} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>1290</td><td>					<span class="codeReserved">this</span>._disconnected(ERROR.CONNACK_RETURNCODE.code , format(ERROR.CONNACK_RETURNCODE, [wireMessage.returnCode, CONNACK_RC[wireMessage.returnCode]]));</td></tr>
  <tr><td>1291</td><td>					<span class="codeReserved">break</span>;</td></tr>
  <tr><td>1292</td><td>				}</td></tr>
  <tr><td>1293</td><td></td></tr>
  <tr><td>1294</td><td>				<span class="codeComment">// Resend messages.</span></td></tr>
  <tr><td>1295</td><td>				<span class="codeReserved">var</span> sequencedMessages = [];</td></tr>
  <tr><td>1296</td><td>				<span class="codeReserved">for</span> (<span class="codeReserved">var</span> msgId <span class="codeReserved">in</span> <span class="codeReserved">this</span>._sentMessages) {</td></tr>
  <tr><td>1297</td><td>					<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._sentMessages.hasOwnProperty(msgId))</td></tr>
  <tr><td>1298</td><td>						sequencedMessages.push(<span class="codeReserved">this</span>._sentMessages[msgId]);</td></tr>
  <tr><td>1299</td><td>				}</td></tr>
  <tr><td>1300</td><td></td></tr>
  <tr><td>1301</td><td>				<span class="codeComment">// Also schedule qos 0 buffered messages if any</span></td></tr>
  <tr><td>1302</td><td>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._buffered_msg_queue.length &gt; 0) {</td></tr>
  <tr><td>1303</td><td>					<span class="codeReserved">var</span> msg = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>1304</td><td>					<span class="codeReserved">var</span> fifo = <span class="codeReserved">this</span>._buffered_msg_queue.reverse();</td></tr>
  <tr><td>1305</td><td>					<span class="codeReserved">while</span> ((msg = fifo.pop())) {</td></tr>
  <tr><td>1306</td><td>						sequencedMessages.push(msg);</td></tr>
  <tr><td>1307</td><td>						<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.onMessageDelivered)</td></tr>
  <tr><td>1308</td><td>							<span class="codeReserved">this</span>._notify_msg_sent[msg] = <span class="codeReserved">this</span>.onMessageDelivered(msg.payloadMessage);</td></tr>
  <tr><td>1309</td><td>					}</td></tr>
  <tr><td>1310</td><td>				}</td></tr>
  <tr><td>1311</td><td></td></tr>
  <tr><td>1312</td><td>				<span class="codeComment">// Sort sentMessages into the original sent order.</span></td></tr>
  <tr><td>1313</td><td>				<span class="codeReserved">var</span> sequencedMessages = sequencedMessages.sort(<span class="codeReserved">function</span>(a,b) {<span class="codeReserved">return</span> a.sequence - b.sequence;} );</td></tr>
  <tr><td>1314</td><td>				<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i=0, len=sequencedMessages.length; i&lt;<span class="codeReserved">len</span>; i++) {</td></tr>
  <tr><td>1315</td><td>					<span class="codeReserved">var</span> sentMessage = sequencedMessages[i];</td></tr>
  <tr><td>1316</td><td>					<span class="codeReserved">if</span> (sentMessage.type == MESSAGE_TYPE.PUBLISH && sentMessage.pubRecReceived) {</td></tr>
  <tr><td>1317</td><td>						<span class="codeReserved">var</span> pubRelMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.PUBREL, {messageIdentifier:sentMessage.messageIdentifier});</td></tr>
  <tr><td>1318</td><td>						<span class="codeReserved">this</span>._schedule_message(pubRelMessage);</td></tr>
  <tr><td>1319</td><td>					} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>1320</td><td>						<span class="codeReserved">this</span>._schedule_message(sentMessage);</td></tr>
  <tr><td>1321</td><td>				}</td></tr>
  <tr><td>1322</td><td>				}</td></tr>
  <tr><td>1323</td><td></td></tr>
  <tr><td>1324</td><td>				<span class="codeComment">// Execute the connectOptions.onSuccess callback if there is one.</span></td></tr>
  <tr><td>1325</td><td>        <span class="codeComment">// Will also now return if this connection was the result of an automatic</span></td></tr>
  <tr><td>1326</td><td>        <span class="codeComment">// reconnect and which URI was successfully connected to.</span></td></tr>
  <tr><td>1327</td><td>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connectOptions.onSuccess) {</td></tr>
  <tr><td>1328</td><td>					<span class="codeReserved">this</span>.connectOptions.onSuccess({invocationContext:<span class="codeReserved">this</span>.connectOptions.invocationContext});</td></tr>
  <tr><td>1329</td><td>				}</td></tr>
  <tr><td>1330</td><td></td></tr>
  <tr><td>1331</td><td>				<span class="codeReserved">var</span> reconnected = <span class="codeReserved">false</span>;</td></tr>
  <tr><td>1332</td><td>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._reconnecting) {</td></tr>
  <tr><td>1333</td><td>					reconnected = <span class="codeReserved">true</span>;</td></tr>
  <tr><td>1334</td><td>					<span class="codeReserved">this</span>._reconnectInterval = 1;</td></tr>
  <tr><td>1335</td><td>					<span class="codeReserved">this</span>._reconnecting = <span class="codeReserved">false</span>;</td></tr>
  <tr><td>1336</td><td>				}</td></tr>
  <tr><td>1337</td><td></td></tr>
  <tr><td>1338</td><td>				<span class="codeComment">// Execute the onConnected callback if there is one.</span></td></tr>
  <tr><td>1339</td><td>				<span class="codeReserved">this</span>._connected(reconnected, <span class="codeReserved">this</span>._wsuri);</td></tr>
  <tr><td>1340</td><td></td></tr>
  <tr><td>1341</td><td>				<span class="codeComment">// Process all queued messages now that the connection is established.</span></td></tr>
  <tr><td>1342</td><td>				<span class="codeReserved">this</span>._process_queue();</td></tr>
  <tr><td>1343</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>1344</td><td></td></tr>
  <tr><td>1345</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.PUBLISH:</td></tr>
  <tr><td>1346</td><td>				<span class="codeReserved">this</span>._receivePublish(wireMessage);</td></tr>
  <tr><td>1347</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>1348</td><td></td></tr>
  <tr><td>1349</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.PUBACK:</td></tr>
  <tr><td>1350</td><td>				<span class="codeReserved">var</span> sentMessage = <span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier];</td></tr>
  <tr><td>1351</td><td>				 <span class="codeComment">// If this is a re flow of a PUBACK after we have restarted receivedMessage will not exist.</span></td></tr>
  <tr><td>1352</td><td>				<span class="codeReserved">if</span> (sentMessage) {</td></tr>
  <tr><td>1353</td><td>					delete <span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier];</td></tr>
  <tr><td>1354</td><td>					localStorage.removeItem(<span class="codeString">"Sent:"</span>+<span class="codeReserved">this</span>._localKey+wireMessage.messageIdentifier);</td></tr>
  <tr><td>1355</td><td>					<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.onMessageDelivered)</td></tr>
  <tr><td>1356</td><td>						<span class="codeReserved">this</span>.onMessageDelivered(sentMessage.payloadMessage);</td></tr>
  <tr><td>1357</td><td>				}</td></tr>
  <tr><td>1358</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>1359</td><td></td></tr>
  <tr><td>1360</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.PUBREC:</td></tr>
  <tr><td>1361</td><td>				<span class="codeReserved">var</span> sentMessage = <span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier];</td></tr>
  <tr><td>1362</td><td>				<span class="codeComment">// If this is a re flow of a PUBREC after we have restarted receivedMessage will not exist.</span></td></tr>
  <tr><td>1363</td><td>				<span class="codeReserved">if</span> (sentMessage) {</td></tr>
  <tr><td>1364</td><td>					sentMessage.pubRecReceived = <span class="codeReserved">true</span>;</td></tr>
  <tr><td>1365</td><td>					<span class="codeReserved">var</span> pubRelMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.PUBREL, {messageIdentifier:wireMessage.messageIdentifier});</td></tr>
  <tr><td>1366</td><td>					<span class="codeReserved">this</span>.store(<span class="codeString">"Sent:"</span>, sentMessage);</td></tr>
  <tr><td>1367</td><td>					<span class="codeReserved">this</span>._schedule_message(pubRelMessage);</td></tr>
  <tr><td>1368</td><td>				}</td></tr>
  <tr><td>1369</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>1370</td><td></td></tr>
  <tr><td>1371</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.PUBREL:</td></tr>
  <tr><td>1372</td><td>				<span class="codeReserved">var</span> receivedMessage = <span class="codeReserved">this</span>._receivedMessages[wireMessage.messageIdentifier];</td></tr>
  <tr><td>1373</td><td>				localStorage.removeItem(<span class="codeString">"Received:"</span>+<span class="codeReserved">this</span>._localKey+wireMessage.messageIdentifier);</td></tr>
  <tr><td>1374</td><td>				<span class="codeComment">// If this is a re flow of a PUBREL after we have restarted receivedMessage will not exist.</span></td></tr>
  <tr><td>1375</td><td>				<span class="codeReserved">if</span> (receivedMessage) {</td></tr>
  <tr><td>1376</td><td>					<span class="codeReserved">this</span>._receiveMessage(receivedMessage);</td></tr>
  <tr><td>1377</td><td>					delete <span class="codeReserved">this</span>._receivedMessages[wireMessage.messageIdentifier];</td></tr>
  <tr><td>1378</td><td>				}</td></tr>
  <tr><td>1379</td><td>				<span class="codeComment">// Always flow PubComp, we may have previously flowed PubComp but the server lost it and restarted.</span></td></tr>
  <tr><td>1380</td><td>				<span class="codeReserved">var</span> pubCompMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.PUBCOMP, {messageIdentifier:wireMessage.messageIdentifier});</td></tr>
  <tr><td>1381</td><td>				<span class="codeReserved">this</span>._schedule_message(pubCompMessage);</td></tr>
  <tr><td>1382</td><td></td></tr>
  <tr><td>1383</td><td></td></tr>
  <tr><td>1384</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>1385</td><td></td></tr>
  <tr><td>1386</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.PUBCOMP:</td></tr>
  <tr><td>1387</td><td>				<span class="codeReserved">var</span> sentMessage = <span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier];</td></tr>
  <tr><td>1388</td><td>				delete <span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier];</td></tr>
  <tr><td>1389</td><td>				localStorage.removeItem(<span class="codeString">"Sent:"</span>+<span class="codeReserved">this</span>._localKey+wireMessage.messageIdentifier);</td></tr>
  <tr><td>1390</td><td>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.onMessageDelivered)</td></tr>
  <tr><td>1391</td><td>					<span class="codeReserved">this</span>.onMessageDelivered(sentMessage.payloadMessage);</td></tr>
  <tr><td>1392</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>1393</td><td></td></tr>
  <tr><td>1394</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.SUBACK:</td></tr>
  <tr><td>1395</td><td>				<span class="codeReserved">var</span> sentMessage = <span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier];</td></tr>
  <tr><td>1396</td><td>				<span class="codeReserved">if</span> (sentMessage) {</td></tr>
  <tr><td>1397</td><td>					<span class="codeReserved">if</span>(sentMessage.timeOut)</td></tr>
  <tr><td>1398</td><td>						sentMessage.timeOut.cancel();</td></tr>
  <tr><td>1399</td><td>					<span class="codeComment">// This will need to be fixed when we add multiple topic support</span></td></tr>
  <tr><td>1400</td><td>          			<span class="codeReserved">if</span> (wireMessage.returnCode[0] === 0x80) {</td></tr>
  <tr><td>1401</td><td>						<span class="codeReserved">if</span> (sentMessage.onFailure) {</td></tr>
  <tr><td>1402</td><td>							sentMessage.onFailure(wireMessage.returnCode);</td></tr>
  <tr><td>1403</td><td>						}</td></tr>
  <tr><td>1404</td><td>					} <span class="codeReserved">else</span> <span class="codeReserved">if</span> (sentMessage.onSuccess) {</td></tr>
  <tr><td>1405</td><td>						sentMessage.onSuccess(wireMessage.returnCode);</td></tr>
  <tr><td>1406</td><td>					}</td></tr>
  <tr><td>1407</td><td>					delete <span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier];</td></tr>
  <tr><td>1408</td><td>				}</td></tr>
  <tr><td>1409</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>1410</td><td></td></tr>
  <tr><td>1411</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.UNSUBACK:</td></tr>
  <tr><td>1412</td><td>				<span class="codeReserved">var</span> sentMessage = <span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier];</td></tr>
  <tr><td>1413</td><td>				<span class="codeReserved">if</span> (sentMessage) {</td></tr>
  <tr><td>1414</td><td>					<span class="codeReserved">if</span> (sentMessage.timeOut)</td></tr>
  <tr><td>1415</td><td>						sentMessage.timeOut.cancel();</td></tr>
  <tr><td>1416</td><td>					<span class="codeReserved">if</span> (sentMessage.callback) {</td></tr>
  <tr><td>1417</td><td>						sentMessage.callback();</td></tr>
  <tr><td>1418</td><td>					}</td></tr>
  <tr><td>1419</td><td>					delete <span class="codeReserved">this</span>._sentMessages[wireMessage.messageIdentifier];</td></tr>
  <tr><td>1420</td><td>				}</td></tr>
  <tr><td>1421</td><td></td></tr>
  <tr><td>1422</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>1423</td><td></td></tr>
  <tr><td>1424</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.PINGRESP:</td></tr>
  <tr><td>1425</td><td>				<span class="codeComment">/* The sendPinger or receivePinger may have sent a ping, the receivePinger has already been reset. */</span></td></tr>
  <tr><td>1426</td><td>				<span class="codeReserved">this</span>.sendPinger.reset();</td></tr>
  <tr><td>1427</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>1428</td><td></td></tr>
  <tr><td>1429</td><td>			<span class="codeReserved">case</span> MESSAGE_TYPE.DISCONNECT:</td></tr>
  <tr><td>1430</td><td>				<span class="codeComment">// Clients do not expect to receive disconnect packets.</span></td></tr>
  <tr><td>1431</td><td>				<span class="codeReserved">this</span>._disconnected(ERROR.INVALID_MQTT_MESSAGE_TYPE.code , format(ERROR.INVALID_MQTT_MESSAGE_TYPE, [wireMessage.type]));</td></tr>
  <tr><td>1432</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>1433</td><td></td></tr>
  <tr><td>1434</td><td>			<span class="codeReserved">default</span>:</td></tr>
  <tr><td>1435</td><td>				<span class="codeReserved">this</span>._disconnected(ERROR.INVALID_MQTT_MESSAGE_TYPE.code , format(ERROR.INVALID_MQTT_MESSAGE_TYPE, [wireMessage.type]));</td></tr>
  <tr><td>1436</td><td>			}</td></tr>
  <tr><td>1437</td><td>		} <span class="codeReserved">catch</span> (error) {</td></tr>
  <tr><td>1438</td><td>			<span class="codeReserved">var</span> errorStack = ((error.hasOwnProperty(<span class="codeString">'stack'</span>) == <span class="codeString">'undefined'</span>) ? error.stack.toString() : <span class="codeString">"No Error Stack Available"</span>);</td></tr>
  <tr><td>1439</td><td>			<span class="codeReserved">this</span>._disconnected(ERROR.INTERNAL_ERROR.code , format(ERROR.INTERNAL_ERROR, [error.message,errorStack]));</td></tr>
  <tr><td>1440</td><td>			<span class="codeReserved">return</span>;</td></tr>
  <tr><td>1441</td><td>		}</td></tr>
  <tr><td>1442</td><td>	};</td></tr>
  <tr><td>1443</td><td></td></tr>
  <tr><td>1444</td><td>	<span class="codeComment">/** <span class="codeReserved">@ignore</span> */</span></td></tr>
  <tr><td>1445</td><td>	ClientImpl.prototype._on_socket_error = <span class="codeReserved">function</span> (error) {</td></tr>
  <tr><td>1446</td><td>		<span class="codeReserved">if</span> (!<span class="codeReserved">this</span>._reconnecting) {</td></tr>
  <tr><td>1447</td><td>		<span class="codeReserved">this</span>._disconnected(ERROR.SOCKET_ERROR.code , format(ERROR.SOCKET_ERROR, [error.data]));</td></tr>
  <tr><td>1448</td><td>		}</td></tr>
  <tr><td>1449</td><td>	};</td></tr>
  <tr><td>1450</td><td></td></tr>
  <tr><td>1451</td><td>	<span class="codeComment">/** <span class="codeReserved">@ignore</span> */</span></td></tr>
  <tr><td>1452</td><td>	ClientImpl.prototype._on_socket_close = <span class="codeReserved">function</span> () {</td></tr>
  <tr><td>1453</td><td>		<span class="codeReserved">if</span> (!<span class="codeReserved">this</span>._reconnecting) {</td></tr>
  <tr><td>1454</td><td>		<span class="codeReserved">this</span>._disconnected(ERROR.SOCKET_CLOSE.code , format(ERROR.SOCKET_CLOSE));</td></tr>
  <tr><td>1455</td><td>		}</td></tr>
  <tr><td>1456</td><td>	};</td></tr>
  <tr><td>1457</td><td></td></tr>
  <tr><td>1458</td><td>	<span class="codeComment">/** <span class="codeReserved">@ignore</span> */</span></td></tr>
  <tr><td>1459</td><td>	ClientImpl.prototype._socket_send = <span class="codeReserved">function</span> (wireMessage) {</td></tr>
  <tr><td>1460</td><td></td></tr>
  <tr><td>1461</td><td>		<span class="codeReserved">if</span> (wireMessage.type == 1) {</td></tr>
  <tr><td>1462</td><td>			<span class="codeReserved">var</span> wireMessageMasked = <span class="codeReserved">this</span>._traceMask(wireMessage, <span class="codeString">"password"</span>);</td></tr>
  <tr><td>1463</td><td>			<span class="codeReserved">this</span>._trace(<span class="codeString">"Client._socket_send"</span>, wireMessageMasked);</td></tr>
  <tr><td>1464</td><td>		}</td></tr>
  <tr><td>1465</td><td>		<span class="codeReserved">else</span> <span class="codeReserved">this</span>._trace(<span class="codeString">"Client._socket_send"</span>, wireMessage);</td></tr>
  <tr><td>1466</td><td></td></tr>
  <tr><td>1467</td><td>		<span class="codeReserved">this</span>.socket.send(wireMessage.encode());</td></tr>
  <tr><td>1468</td><td>		<span class="codeComment">/* We have proved <span class="codeReserved">to</span> the server we are alive. */</span></td></tr>
  <tr><td>1469</td><td>		<span class="codeReserved">this</span>.sendPinger.reset();</td></tr>
  <tr><td>1470</td><td>	};</td></tr>
  <tr><td>1471</td><td></td></tr>
  <tr><td>1472</td><td>	<span class="codeComment">/** <span class="codeReserved">@ignore</span> */</span></td></tr>
  <tr><td>1473</td><td>	ClientImpl.prototype._receivePublish = <span class="codeReserved">function</span> (wireMessage) {</td></tr>
  <tr><td>1474</td><td>		<span class="codeReserved">switch</span>(wireMessage.payloadMessage.qos) {</td></tr>
  <tr><td>1475</td><td>			<span class="codeReserved">case</span> <span class="codeString">"undefined"</span>:</td></tr>
  <tr><td>1476</td><td>			<span class="codeReserved">case</span> 0:</td></tr>
  <tr><td>1477</td><td>				<span class="codeReserved">this</span>._receiveMessage(wireMessage);</td></tr>
  <tr><td>1478</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>1479</td><td></td></tr>
  <tr><td>1480</td><td>			<span class="codeReserved">case</span> 1:</td></tr>
  <tr><td>1481</td><td>				<span class="codeReserved">var</span> pubAckMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.PUBACK, {messageIdentifier:wireMessage.messageIdentifier});</td></tr>
  <tr><td>1482</td><td>				<span class="codeReserved">this</span>._schedule_message(pubAckMessage);</td></tr>
  <tr><td>1483</td><td>				<span class="codeReserved">this</span>._receiveMessage(wireMessage);</td></tr>
  <tr><td>1484</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>1485</td><td></td></tr>
  <tr><td>1486</td><td>			<span class="codeReserved">case</span> 2:</td></tr>
  <tr><td>1487</td><td>				<span class="codeReserved">this</span>._receivedMessages[wireMessage.messageIdentifier] = wireMessage;</td></tr>
  <tr><td>1488</td><td>				<span class="codeReserved">this</span>.store(<span class="codeString">"Received:"</span>, wireMessage);</td></tr>
  <tr><td>1489</td><td>				<span class="codeReserved">var</span> pubRecMessage = <span class="codeReserved">new</span> WireMessage(MESSAGE_TYPE.PUBREC, {messageIdentifier:wireMessage.messageIdentifier});</td></tr>
  <tr><td>1490</td><td>				<span class="codeReserved">this</span>._schedule_message(pubRecMessage);</td></tr>
  <tr><td>1491</td><td></td></tr>
  <tr><td>1492</td><td>				<span class="codeReserved">break</span>;</td></tr>
  <tr><td>1493</td><td></td></tr>
  <tr><td>1494</td><td>			<span class="codeReserved">default</span>:</td></tr>
  <tr><td>1495</td><td>				<span class="codeReserved">throw</span> Error(<span class="codeString">"Invaild qos="</span>+wireMmessage.payloadMessage.qos);</td></tr>
  <tr><td>1496</td><td>		}</td></tr>
  <tr><td>1497</td><td>	};</td></tr>
  <tr><td>1498</td><td></td></tr>
  <tr><td>1499</td><td>	<span class="codeComment">/** <span class="codeReserved">@ignore</span> */</span></td></tr>
  <tr><td>1500</td><td>	ClientImpl.prototype._receiveMessage = <span class="codeReserved">function</span> (wireMessage) {</td></tr>
  <tr><td>1501</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.onMessageArrived) {</td></tr>
  <tr><td>1502</td><td>			<span class="codeReserved">this</span>.onMessageArrived(wireMessage.payloadMessage);</td></tr>
  <tr><td>1503</td><td>		}</td></tr>
  <tr><td>1504</td><td>	};</td></tr>
  <tr><td>1505</td><td></td></tr>
  <tr><td>1506</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>1507</td><td><span class="codeComment">	 * Client has connected.</span></td></tr>
  <tr><td>1508</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> {reconnect} [boolean] indicate <span class="codeReserved">if</span> <span class="codeReserved">this</span> was a result of reconnect operation.</span></td></tr>
  <tr><td>1509</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> {uri} [string] fully qualified WebSocket URI of the server.</span></td></tr>
  <tr><td>1510</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>1511</td><td>	ClientImpl.prototype._connected = <span class="codeReserved">function</span> (reconnect, uri) {</td></tr>
  <tr><td>1512</td><td>		<span class="codeComment">// Execute the onConnected callback if there is one.</span></td></tr>
  <tr><td>1513</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.onConnected)</td></tr>
  <tr><td>1514</td><td>			<span class="codeReserved">this</span>.onConnected(reconnect, uri);</td></tr>
  <tr><td>1515</td><td>	};</td></tr>
  <tr><td>1516</td><td></td></tr>
  <tr><td>1517</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>1518</td><td><span class="codeComment">	 * Attempts <span class="codeReserved">to</span> reconnect the client <span class="codeReserved">to</span> the server.</span></td></tr>
  <tr><td>1519</td><td><span class="codeComment">   * For each reconnect attempt, will double the reconnect interval</span></td></tr>
  <tr><td>1520</td><td><span class="codeComment">   * up <span class="codeReserved">to</span> 128 seconds.</span></td></tr>
  <tr><td>1521</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>1522</td><td>	ClientImpl.prototype._reconnect = <span class="codeReserved">function</span> () {</td></tr>
  <tr><td>1523</td><td>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client._reconnect"</span>);</td></tr>
  <tr><td>1524</td><td>		<span class="codeReserved">if</span> (!<span class="codeReserved">this</span>.connected) {</td></tr>
  <tr><td>1525</td><td>			<span class="codeReserved">this</span>._reconnecting = <span class="codeReserved">true</span>;</td></tr>
  <tr><td>1526</td><td>			<span class="codeReserved">this</span>.sendPinger.cancel();</td></tr>
  <tr><td>1527</td><td>			<span class="codeReserved">this</span>.receivePinger.cancel();</td></tr>
  <tr><td>1528</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._reconnectInterval &lt; 128)</td></tr>
  <tr><td>1529</td><td>				<span class="codeReserved">this</span>._reconnectInterval = <span class="codeReserved">this</span>._reconnectInterval * 2;</td></tr>
  <tr><td>1530</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connectOptions.uris) {</td></tr>
  <tr><td>1531</td><td>				<span class="codeReserved">this</span>.hostIndex = 0;</td></tr>
  <tr><td>1532</td><td>				<span class="codeReserved">this</span>._doConnect(<span class="codeReserved">this</span>.connectOptions.uris[0]);</td></tr>
  <tr><td>1533</td><td>			} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>1534</td><td>				<span class="codeReserved">this</span>._doConnect(<span class="codeReserved">this</span>.uri);</td></tr>
  <tr><td>1535</td><td>			}</td></tr>
  <tr><td>1536</td><td>		}</td></tr>
  <tr><td>1537</td><td>	};</td></tr>
  <tr><td>1538</td><td></td></tr>
  <tr><td>1539</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>1540</td><td><span class="codeComment">	 * Client has disconnected either at its own request or because the server</span></td></tr>
  <tr><td>1541</td><td><span class="codeComment">	 * or network disconnected it. Remove all non-durable state.</span></td></tr>
  <tr><td>1542</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> {errorCode} [number] the error number.</span></td></tr>
  <tr><td>1543</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> {errorText} [string] the error text.</span></td></tr>
  <tr><td>1544</td><td><span class="codeComment">	 * <span class="codeReserved">@ignore</span></span></td></tr>
  <tr><td>1545</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>1546</td><td>	ClientImpl.prototype._disconnected = <span class="codeReserved">function</span> (errorCode, errorText) {</td></tr>
  <tr><td>1547</td><td>		<span class="codeReserved">this</span>._trace(<span class="codeString">"Client._disconnected"</span>, errorCode, errorText);</td></tr>
  <tr><td>1548</td><td></td></tr>
  <tr><td>1549</td><td>		<span class="codeReserved">if</span> (errorCode !== undefined && <span class="codeReserved">this</span>._reconnecting) {</td></tr>
  <tr><td>1550</td><td>      <span class="codeComment">//Continue automatic reconnect process</span></td></tr>
  <tr><td>1551</td><td>  		<span class="codeReserved">this</span>._reconnectTimeout = <span class="codeReserved">new</span> Timeout(<span class="codeReserved">this</span>, window, <span class="codeReserved">this</span>._reconnectInterval, <span class="codeReserved">this</span>._reconnect);</td></tr>
  <tr><td>1552</td><td>			<span class="codeReserved">return</span>;</td></tr>
  <tr><td>1553</td><td>		}</td></tr>
  <tr><td>1554</td><td></td></tr>
  <tr><td>1555</td><td>		<span class="codeReserved">this</span>.sendPinger.cancel();</td></tr>
  <tr><td>1556</td><td>		<span class="codeReserved">this</span>.receivePinger.cancel();</td></tr>
  <tr><td>1557</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>._connectTimeout) {</td></tr>
  <tr><td>1558</td><td>			<span class="codeReserved">this</span>._connectTimeout.cancel();</td></tr>
  <tr><td>1559</td><td>			<span class="codeReserved">this</span>._connectTimeout = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>1560</td><td>		}</td></tr>
  <tr><td>1561</td><td></td></tr>
  <tr><td>1562</td><td>		<span class="codeComment">// Clear message buffers.</span></td></tr>
  <tr><td>1563</td><td>		<span class="codeReserved">this</span>._msg_queue = [];</td></tr>
  <tr><td>1564</td><td>		<span class="codeReserved">this</span>._buffered_msg_queue = [];</td></tr>
  <tr><td>1565</td><td>		<span class="codeReserved">this</span>._notify_msg_sent = {};</td></tr>
  <tr><td>1566</td><td></td></tr>
  <tr><td>1567</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.socket) {</td></tr>
  <tr><td>1568</td><td>			<span class="codeComment">// Cancel all socket callbacks so that they cannot be driven again by this socket.</span></td></tr>
  <tr><td>1569</td><td>			<span class="codeReserved">this</span>.socket.onopen = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>1570</td><td>			<span class="codeReserved">this</span>.socket.onmessage = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>1571</td><td>			<span class="codeReserved">this</span>.socket.onerror = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>1572</td><td>			<span class="codeReserved">this</span>.socket.onclose = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>1573</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.socket.readyState === 1)</td></tr>
  <tr><td>1574</td><td>				<span class="codeReserved">this</span>.socket.close();</td></tr>
  <tr><td>1575</td><td>			delete <span class="codeReserved">this</span>.socket;</td></tr>
  <tr><td>1576</td><td>		}</td></tr>
  <tr><td>1577</td><td></td></tr>
  <tr><td>1578</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connectOptions.uris && <span class="codeReserved">this</span>.hostIndex &lt; <span class="codeReserved">this</span>.connectOptions.uris.length-1) {</td></tr>
  <tr><td>1579</td><td>			<span class="codeComment">// Try the next host.</span></td></tr>
  <tr><td>1580</td><td>			<span class="codeReserved">this</span>.hostIndex++;</td></tr>
  <tr><td>1581</td><td>			<span class="codeReserved">this</span>._doConnect(<span class="codeReserved">this</span>.connectOptions.uris[<span class="codeReserved">this</span>.hostIndex]);</td></tr>
  <tr><td>1582</td><td>		} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>1583</td><td></td></tr>
  <tr><td>1584</td><td>			<span class="codeReserved">if</span> (errorCode === undefined) {</td></tr>
  <tr><td>1585</td><td>				errorCode = ERROR.OK.code;</td></tr>
  <tr><td>1586</td><td>				errorText = format(ERROR.OK);</td></tr>
  <tr><td>1587</td><td>			}</td></tr>
  <tr><td>1588</td><td></td></tr>
  <tr><td>1589</td><td>			<span class="codeComment">// Run any application callbacks last as they may attempt to reconnect and hence create a new socket.</span></td></tr>
  <tr><td>1590</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connected) {</td></tr>
  <tr><td>1591</td><td>				<span class="codeReserved">this</span>.connected = <span class="codeReserved">false</span>;</td></tr>
  <tr><td>1592</td><td>				<span class="codeComment">// Execute the connectionLostCallback if there is one, and we were connected.</span></td></tr>
  <tr><td>1593</td><td>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.onConnectionLost) {</td></tr>
  <tr><td>1594</td><td>					<span class="codeReserved">this</span>.onConnectionLost({errorCode:errorCode, errorMessage:errorText, reconnect:<span class="codeReserved">this</span>.connectOptions.reconnect, uri:<span class="codeReserved">this</span>._wsuri});</td></tr>
  <tr><td>1595</td><td>				}</td></tr>
  <tr><td>1596</td><td>				<span class="codeReserved">if</span> (errorCode !== ERROR.OK.code && <span class="codeReserved">this</span>.connectOptions.reconnect) {</td></tr>
  <tr><td>1597</td><td>					<span class="codeComment">// Start automatic reconnect process for the very first time since last successful connect.</span></td></tr>
  <tr><td>1598</td><td>					<span class="codeReserved">this</span>._reconnectInterval = 1;</td></tr>
  <tr><td>1599</td><td>					<span class="codeReserved">this</span>._reconnect();</td></tr>
  <tr><td>1600</td><td>					<span class="codeReserved">return</span>;</td></tr>
  <tr><td>1601</td><td>				}</td></tr>
  <tr><td>1602</td><td>			} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>1603</td><td>				<span class="codeComment">// Otherwise we never had a connection, so indicate that the connect has failed.</span></td></tr>
  <tr><td>1604</td><td>				<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connectOptions.mqttVersion === 4 && <span class="codeReserved">this</span>.connectOptions.mqttVersionExplicit === <span class="codeReserved">false</span>) {</td></tr>
  <tr><td>1605</td><td>					<span class="codeReserved">this</span>._trace(<span class="codeString">"Failed <span class="codeReserved">to</span> connect V4, dropping back <span class="codeReserved">to</span> V3"</span>);</td></tr>
  <tr><td>1606</td><td>					<span class="codeReserved">this</span>.connectOptions.mqttVersion = 3;</td></tr>
  <tr><td>1607</td><td>					<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.connectOptions.uris) {</td></tr>
  <tr><td>1608</td><td>						<span class="codeReserved">this</span>.hostIndex = 0;</td></tr>
  <tr><td>1609</td><td>						<span class="codeReserved">this</span>._doConnect(<span class="codeReserved">this</span>.connectOptions.uris[0]);</td></tr>
  <tr><td>1610</td><td>					} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>1611</td><td>						<span class="codeReserved">this</span>._doConnect(<span class="codeReserved">this</span>.uri);</td></tr>
  <tr><td>1612</td><td>					}</td></tr>
  <tr><td>1613</td><td>				} <span class="codeReserved">else</span> <span class="codeReserved">if</span>(<span class="codeReserved">this</span>.connectOptions.onFailure) {</td></tr>
  <tr><td>1614</td><td>					<span class="codeReserved">this</span>.connectOptions.onFailure({invocationContext:<span class="codeReserved">this</span>.connectOptions.invocationContext, errorCode:errorCode, errorMessage:errorText});</td></tr>
  <tr><td>1615</td><td>				}</td></tr>
  <tr><td>1616</td><td>			}</td></tr>
  <tr><td>1617</td><td>		}</td></tr>
  <tr><td>1618</td><td>	};</td></tr>
  <tr><td>1619</td><td></td></tr>
  <tr><td>1620</td><td>	<span class="codeComment">/** <span class="codeReserved">@ignore</span> */</span></td></tr>
  <tr><td>1621</td><td>	ClientImpl.prototype._trace = <span class="codeReserved">function</span> () {</td></tr>
  <tr><td>1622</td><td>		<span class="codeComment">// Pass trace message back to client&#039;s callback function</span></td></tr>
  <tr><td>1623</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">this</span>.traceFunction) {</td></tr>
  <tr><td>1624</td><td>			<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i <span class="codeReserved">in</span> arguments)</td></tr>
  <tr><td>1625</td><td>			{</td></tr>
  <tr><td>1626</td><td>				<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> arguments[i] !== <span class="codeString">"undefined"</span>)</td></tr>
  <tr><td>1627</td><td>					arguments.splice(i, 1, JSON.stringify(arguments[i]));</td></tr>
  <tr><td>1628</td><td>			}</td></tr>
  <tr><td>1629</td><td>			<span class="codeReserved">var</span> record = Array.prototype.slice.call(arguments).join(<span class="codeString">""</span>);</td></tr>
  <tr><td>1630</td><td>			<span class="codeReserved">this</span>.traceFunction ({severity: <span class="codeString">"Debug"</span>, message: record	});</td></tr>
  <tr><td>1631</td><td>		}</td></tr>
  <tr><td>1632</td><td></td></tr>
  <tr><td>1633</td><td>		<span class="codeComment">//buffer style trace</span></td></tr>
  <tr><td>1634</td><td>		<span class="codeReserved">if</span> ( <span class="codeReserved">this</span>._traceBuffer !== <span class="codeReserved">null</span> ) {</td></tr>
  <tr><td>1635</td><td>			<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i = 0, max = arguments.length; i &lt; max; i++) {</td></tr>
  <tr><td>1636</td><td>				<span class="codeReserved">if</span> ( <span class="codeReserved">this</span>._traceBuffer.length == <span class="codeReserved">this</span>._MAX_TRACE_ENTRIES ) {</td></tr>
  <tr><td>1637</td><td>					<span class="codeReserved">this</span>._traceBuffer.shift();</td></tr>
  <tr><td>1638</td><td>				}</td></tr>
  <tr><td>1639</td><td>				<span class="codeReserved">if</span> (i === 0) <span class="codeReserved">this</span>._traceBuffer.push(arguments[i]);</td></tr>
  <tr><td>1640</td><td>				<span class="codeReserved">else</span> <span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> arguments[i] === <span class="codeString">"undefined"</span> ) <span class="codeReserved">this</span>._traceBuffer.push(arguments[i]);</td></tr>
  <tr><td>1641</td><td>				<span class="codeReserved">else</span> <span class="codeReserved">this</span>._traceBuffer.push(<span class="codeString">"  "</span>+JSON.stringify(arguments[i]));</td></tr>
  <tr><td>1642</td><td>		   }</td></tr>
  <tr><td>1643</td><td>		}</td></tr>
  <tr><td>1644</td><td>	};</td></tr>
  <tr><td>1645</td><td></td></tr>
  <tr><td>1646</td><td>	<span class="codeComment">/** <span class="codeReserved">@ignore</span> */</span></td></tr>
  <tr><td>1647</td><td>	ClientImpl.prototype._traceMask = <span class="codeReserved">function</span> (traceObject, masked) {</td></tr>
  <tr><td>1648</td><td>		<span class="codeReserved">var</span> traceObjectMasked = {};</td></tr>
  <tr><td>1649</td><td>		<span class="codeReserved">for</span> (<span class="codeReserved">var</span> attr <span class="codeReserved">in</span> traceObject) {</td></tr>
  <tr><td>1650</td><td>			<span class="codeReserved">if</span> (traceObject.hasOwnProperty(attr)) {</td></tr>
  <tr><td>1651</td><td>				<span class="codeReserved">if</span> (attr == masked)</td></tr>
  <tr><td>1652</td><td>					traceObjectMasked[attr] = <span class="codeString">"******"</span>;</td></tr>
  <tr><td>1653</td><td>				<span class="codeReserved">else</span></td></tr>
  <tr><td>1654</td><td>					traceObjectMasked[attr] = traceObject[attr];</td></tr>
  <tr><td>1655</td><td>			}</td></tr>
  <tr><td>1656</td><td>		}</td></tr>
  <tr><td>1657</td><td>		<span class="codeReserved">return</span> traceObjectMasked;</td></tr>
  <tr><td>1658</td><td>	};</td></tr>
  <tr><td>1659</td><td></td></tr>
  <tr><td>1660</td><td>	<span class="codeComment">// ------------------------------------------------------------------------</span></td></tr>
  <tr><td>1661</td><td>	<span class="codeComment">// Public Programming interface.</span></td></tr>
  <tr><td>1662</td><td>	<span class="codeComment">// ------------------------------------------------------------------------</span></td></tr>
  <tr><td>1663</td><td></td></tr>
  <tr><td>1664</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>1665</td><td><span class="codeComment">	 * The JavaScript application communicates <span class="codeReserved">to</span> the server using a {<span class="codeReserved">@link</span> Paho.MQTT.Client} object.</span></td></tr>
  <tr><td>1666</td><td><span class="codeComment">	 * &lt;p&gt;</span></td></tr>
  <tr><td>1667</td><td><span class="codeComment">	 * Most applications will create just one Client object and then call its connect() method,</span></td></tr>
  <tr><td>1668</td><td><span class="codeComment">	 * however applications can create more than one Client object <span class="codeReserved">if</span> they wish.</span></td></tr>
  <tr><td>1669</td><td><span class="codeComment">	 * In <span class="codeReserved">this</span> <span class="codeReserved">case</span> the combination of host, port and clientId attributes must be different <span class="codeReserved">for</span> each Client object.</span></td></tr>
  <tr><td>1670</td><td><span class="codeComment">	 * &lt;p&gt;</span></td></tr>
  <tr><td>1671</td><td><span class="codeComment">	 * The send, subscribe and unsubscribe methods are implemented <span class="codeReserved">as</span> asynchronous JavaScript methods</span></td></tr>
  <tr><td>1672</td><td><span class="codeComment">	 * (even though the underlying protocol exchange might be synchronous <span class="codeReserved">in</span> nature).</span></td></tr>
  <tr><td>1673</td><td><span class="codeComment">	 * This means they signal their completion by calling back <span class="codeReserved">to</span> the application,</span></td></tr>
  <tr><td>1674</td><td><span class="codeComment">	 * via Success or Failure callback functions provided by the application on the method <span class="codeReserved">in</span> question.</span></td></tr>
  <tr><td>1675</td><td><span class="codeComment">	 * Such callbacks are called at most once per method invocation and <span class="codeReserved">do</span> not persist beyond the lifetime</span></td></tr>
  <tr><td>1676</td><td><span class="codeComment">	 * of the script that made the invocation.</span></td></tr>
  <tr><td>1677</td><td><span class="codeComment">	 * &lt;p&gt;</span></td></tr>
  <tr><td>1678</td><td><span class="codeComment">	 * In contrast there are some callback functions, most notably &lt;i&gt;onMessageArrived&lt;/i&gt;,</span></td></tr>
  <tr><td>1679</td><td><span class="codeComment">	 * that are defined on the {<span class="codeReserved">@link</span> Paho.MQTT.Client} object.</span></td></tr>
  <tr><td>1680</td><td><span class="codeComment">	 * These may get called multiple times, and aren&#039;t directly related <span class="codeReserved">to</span> specific method invocations made by the client.</span></td></tr>
  <tr><td>1681</td><td><span class="codeComment">	 *</span></td></tr>
  <tr><td>1682</td><td><span class="codeComment">	 * <span class="codeReserved">@name</span> Paho.MQTT.Client</span></td></tr>
  <tr><td>1683</td><td><span class="codeComment">	 *</span></td></tr>
  <tr><td>1684</td><td><span class="codeComment">	 * <span class="codeReserved">@constructor</span></span></td></tr>
  <tr><td>1685</td><td><span class="codeComment">	 *</span></td></tr>
  <tr><td>1686</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> {string} host - the address of the messaging server, <span class="codeReserved">as</span> a fully qualified WebSocket URI, <span class="codeReserved">as</span> a DNS name or dotted decimal IP address.</span></td></tr>
  <tr><td>1687</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> {number} port - the port number <span class="codeReserved">to</span> connect <span class="codeReserved">to</span> - only required <span class="codeReserved">if</span> host is not a URI</span></td></tr>
  <tr><td>1688</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> {string} path - the path on the host <span class="codeReserved">to</span> connect <span class="codeReserved">to</span> - only used <span class="codeReserved">if</span> host is not a URI. Default: &#039;/mqtt&#039;.</span></td></tr>
  <tr><td>1689</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> {string} clientId - the Messaging client identifier, between 1 and 23 characters <span class="codeReserved">in</span> length.</span></td></tr>
  <tr><td>1690</td><td><span class="codeComment">	 *</span></td></tr>
  <tr><td>1691</td><td><span class="codeComment">	 * <span class="codeReserved">@property</span> {string} host - &lt;i&gt;read only&lt;/i&gt; the server&#039;s DNS hostname or dotted decimal IP address.</span></td></tr>
  <tr><td>1692</td><td><span class="codeComment">	 * <span class="codeReserved">@property</span> {number} port - &lt;i&gt;read only&lt;/i&gt; the server&#039;s port.</span></td></tr>
  <tr><td>1693</td><td><span class="codeComment">	 * <span class="codeReserved">@property</span> {string} path - &lt;i&gt;read only&lt;/i&gt; the server&#039;s path.</span></td></tr>
  <tr><td>1694</td><td><span class="codeComment">	 * <span class="codeReserved">@property</span> {string} clientId - &lt;i&gt;read only&lt;/i&gt; used when connecting <span class="codeReserved">to</span> the server.</span></td></tr>
  <tr><td>1695</td><td><span class="codeComment">	 * <span class="codeReserved">@property</span> {<span class="codeReserved">function</span>} onConnectionLost - called when a connection has been lost.</span></td></tr>
  <tr><td>1696</td><td><span class="codeComment">	 *                            after a connect() method has succeeded.</span></td></tr>
  <tr><td>1697</td><td><span class="codeComment">	 *                            Establish the call back used when a connection has been lost. The connection may be</span></td></tr>
  <tr><td>1698</td><td><span class="codeComment">	 *                            lost because the client initiates a disconnect or because the server or network</span></td></tr>
  <tr><td>1699</td><td><span class="codeComment">	 *                            cause the client <span class="codeReserved">to</span> be disconnected. The disconnect call back may be called without</span></td></tr>
  <tr><td>1700</td><td><span class="codeComment">	 *                            the connectionComplete call back being invoked <span class="codeReserved">if</span>, <span class="codeReserved">for</span> example the client fails <span class="codeReserved">to</span></span></td></tr>
  <tr><td>1701</td><td><span class="codeComment">	 *                            connect.</span></td></tr>
  <tr><td>1702</td><td><span class="codeComment">	 *                            A single response object parameter is passed <span class="codeReserved">to</span> the onConnectionLost callback containing the following fields:</span></td></tr>
  <tr><td>1703</td><td><span class="codeComment">	 *                            &lt;ol&gt;</span></td></tr>
  <tr><td>1704</td><td><span class="codeComment">	 *                            &lt;li&gt;errorCode</span></td></tr>
  <tr><td>1705</td><td><span class="codeComment">	 *                            &lt;li&gt;errorMessage</span></td></tr>
  <tr><td>1706</td><td><span class="codeComment">	 *                            &lt;/ol&gt;</span></td></tr>
  <tr><td>1707</td><td><span class="codeComment">	 * <span class="codeReserved">@property</span> {<span class="codeReserved">function</span>} onMessageDelivered - called when a message has been delivered.</span></td></tr>
  <tr><td>1708</td><td><span class="codeComment">	 *                            All processing that <span class="codeReserved">this</span> Client will ever <span class="codeReserved">do</span> has been completed. So, <span class="codeReserved">for</span> example,</span></td></tr>
  <tr><td>1709</td><td><span class="codeComment">	 *                            <span class="codeReserved">in</span> the <span class="codeReserved">case</span> of a Qos=2 message sent by <span class="codeReserved">this</span> client, the PubComp flow has been received <span class="codeReserved">from</span> the server</span></td></tr>
  <tr><td>1710</td><td><span class="codeComment">	 *                            and the message has been removed <span class="codeReserved">from</span> persistent storage before <span class="codeReserved">this</span> callback is invoked.</span></td></tr>
  <tr><td>1711</td><td><span class="codeComment">	 *                            Parameters passed <span class="codeReserved">to</span> the onMessageDelivered callback are:</span></td></tr>
  <tr><td>1712</td><td><span class="codeComment">	 *                            &lt;ol&gt;</span></td></tr>
  <tr><td>1713</td><td><span class="codeComment">	 *                            &lt;li&gt;{<span class="codeReserved">@link</span> Paho.MQTT.Message} that was delivered.</span></td></tr>
  <tr><td>1714</td><td><span class="codeComment">	 *                            &lt;/ol&gt;</span></td></tr>
  <tr><td>1715</td><td><span class="codeComment">	 * <span class="codeReserved">@property</span> {<span class="codeReserved">function</span>} onMessageArrived - called when a message has arrived <span class="codeReserved">in</span> <span class="codeReserved">this</span> Paho.MQTT.client.</span></td></tr>
  <tr><td>1716</td><td><span class="codeComment">	 *                            Parameters passed <span class="codeReserved">to</span> the onMessageArrived callback are:</span></td></tr>
  <tr><td>1717</td><td><span class="codeComment">	 *                            &lt;ol&gt;</span></td></tr>
  <tr><td>1718</td><td><span class="codeComment">	 *                            &lt;li&gt;{<span class="codeReserved">@link</span> Paho.MQTT.Message} that has arrived.</span></td></tr>
  <tr><td>1719</td><td><span class="codeComment">	 *                            &lt;/ol&gt;</span></td></tr>
  <tr><td>1720</td><td><span class="codeComment">	 * <span class="codeReserved">@property</span> {<span class="codeReserved">function</span>} onConnected - called when a connection is successfully made <span class="codeReserved">to</span> the server.</span></td></tr>
  <tr><td>1721</td><td><span class="codeComment">	 *                                  after a connect() method.</span></td></tr>
  <tr><td>1722</td><td><span class="codeComment">	 *                                  Parameters passed <span class="codeReserved">to</span> the onConnected callback are:</span></td></tr>
  <tr><td>1723</td><td><span class="codeComment">	 *                                  &lt;ol&gt;</span></td></tr>
  <tr><td>1724</td><td><span class="codeComment">	 *                                  &lt;li&gt;reconnect (boolean) - If <span class="codeReserved">true</span>, the connection was the result of a reconnect.&lt;/li&gt;</span></td></tr>
  <tr><td>1725</td><td><span class="codeComment">	 *                                  &lt;li&gt;URI (string) - The URI used <span class="codeReserved">to</span> connect <span class="codeReserved">to</span> the server.&lt;/li&gt;</span></td></tr>
  <tr><td>1726</td><td><span class="codeComment">	 *                                  &lt;/ol&gt;</span></td></tr>
  <tr><td>1727</td><td><span class="codeComment">	 * <span class="codeReserved">@property</span> {boolean} disconnectedPublishing - <span class="codeReserved">if</span> set, will enable disconnected publishing <span class="codeReserved">in</span></span></td></tr>
  <tr><td>1728</td><td><span class="codeComment">	 *                                            <span class="codeReserved">in</span> the event that the connection <span class="codeReserved">to</span> the server is lost.</span></td></tr>
  <tr><td>1729</td><td><span class="codeComment">	 * <span class="codeReserved">@property</span> {number} disconnectedBufferSize - Used <span class="codeReserved">to</span> set the maximum number of messages that the disconnected</span></td></tr>
  <tr><td>1730</td><td><span class="codeComment">	 *                                             buffer will hold before rejecting <span class="codeReserved">new</span> messages. Default size: 5000 messages</span></td></tr>
  <tr><td>1731</td><td><span class="codeComment">	 * <span class="codeReserved">@property</span> {<span class="codeReserved">function</span>} trace - called whenever trace is called. TODO</span></td></tr>
  <tr><td>1732</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>1733</td><td>	<span class="codeReserved">var</span> Client = <span class="codeReserved">function</span> (host, port, path, clientId) {</td></tr>
  <tr><td>1734</td><td></td></tr>
  <tr><td>1735</td><td>	    <span class="codeReserved">var</span> uri;</td></tr>
  <tr><td>1736</td><td></td></tr>
  <tr><td>1737</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> host !== <span class="codeString">"string"</span>)</td></tr>
  <tr><td>1738</td><td>			<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> host, <span class="codeString">"host"</span>]));</td></tr>
  <tr><td>1739</td><td></td></tr>
  <tr><td>1740</td><td>	    <span class="codeReserved">if</span> (arguments.length == 2) {</td></tr>
  <tr><td>1741</td><td>	        <span class="codeComment">// host: must be full ws:// uri</span></td></tr>
  <tr><td>1742</td><td>	        <span class="codeComment">// port: clientId</span></td></tr>
  <tr><td>1743</td><td>	        clientId = port;</td></tr>
  <tr><td>1744</td><td>	        uri = host;</td></tr>
  <tr><td>1745</td><td>	        <span class="codeReserved">var</span> match = uri.match(<span class="codeString">/^(wss?):\/</span>\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/);</td></tr>
  <tr><td>1746</td><td>	        <span class="codeReserved">if</span> (match) {</td></tr>
  <tr><td>1747</td><td>	            host = match[4]||match[2];</td></tr>
  <tr><td>1748</td><td>	            port = parseInt(match[7]);</td></tr>
  <tr><td>1749</td><td>	            path = match[8];</td></tr>
  <tr><td>1750</td><td>	        } <span class="codeReserved">else</span> {</td></tr>
  <tr><td>1751</td><td>	            <span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT,[host,<span class="codeString">"host"</span>]));</td></tr>
  <tr><td>1752</td><td>	        }</td></tr>
  <tr><td>1753</td><td>	    } <span class="codeReserved">else</span> {</td></tr>
  <tr><td>1754</td><td>	        <span class="codeReserved">if</span> (arguments.length == 3) {</td></tr>
  <tr><td>1755</td><td>				clientId = path;</td></tr>
  <tr><td>1756</td><td>				path = <span class="codeString">"/mqtt"</span>;</td></tr>
  <tr><td>1757</td><td>			}</td></tr>
  <tr><td>1758</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> port !== <span class="codeString">"number"</span> || port &lt; 0)</td></tr>
  <tr><td>1759</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> port, <span class="codeString">"port"</span>]));</td></tr>
  <tr><td>1760</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> path !== <span class="codeString">"string"</span>)</td></tr>
  <tr><td>1761</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> path, <span class="codeString">"path"</span>]));</td></tr>
  <tr><td>1762</td><td></td></tr>
  <tr><td>1763</td><td>			<span class="codeReserved">var</span> ipv6AddSBracket = (host.indexOf(<span class="codeString">":"</span>) !== -1 && host.slice(0,1) !== <span class="codeString">"["</span> && host.slice(-1) !== <span class="codeString">"]"</span>);</td></tr>
  <tr><td>1764</td><td>			uri = <span class="codeString">"ws://"</span>+(ipv6AddSBracket?<span class="codeString">"["</span>+host+<span class="codeString">"]"</span>:host)+<span class="codeString">":"</span>+port+path;</td></tr>
  <tr><td>1765</td><td>		}</td></tr>
  <tr><td>1766</td><td></td></tr>
  <tr><td>1767</td><td>		<span class="codeReserved">var</span> clientIdLength = 0;</td></tr>
  <tr><td>1768</td><td>		<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i = 0; i&lt;<span class="codeReserved">clientId</span>.length; i++) {</td></tr>
  <tr><td>1769</td><td>			<span class="codeReserved">var</span> charCode = clientId.charCodeAt(i);</td></tr>
  <tr><td>1770</td><td>			<span class="codeReserved">if</span> (0xD800 &lt;= charCode && charCode &lt;= 0xDBFF)  {</td></tr>
  <tr><td>1771</td><td>				 i++; <span class="codeComment">// Surrogate pair.</span></td></tr>
  <tr><td>1772</td><td>			}</td></tr>
  <tr><td>1773</td><td>			clientIdLength++;</td></tr>
  <tr><td>1774</td><td>		}</td></tr>
  <tr><td>1775</td><td>		<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> clientId !== <span class="codeString">"string"</span> || clientIdLength &gt; 65535)</td></tr>
  <tr><td>1776</td><td>			<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [clientId, <span class="codeString">"clientId"</span>]));</td></tr>
  <tr><td>1777</td><td></td></tr>
  <tr><td>1778</td><td>		<span class="codeReserved">var</span> client = <span class="codeReserved">new</span> ClientImpl(uri, host, port, path, clientId);</td></tr>
  <tr><td>1779</td><td>		<span class="codeReserved">this</span>._getHost =  <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> host; };</td></tr>
  <tr><td>1780</td><td>		<span class="codeReserved">this</span>._setHost = <span class="codeReserved">function</span>() { <span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.UNSUPPORTED_OPERATION)); };</td></tr>
  <tr><td>1781</td><td></td></tr>
  <tr><td>1782</td><td>		<span class="codeReserved">this</span>._getPort = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> port; };</td></tr>
  <tr><td>1783</td><td>		<span class="codeReserved">this</span>._setPort = <span class="codeReserved">function</span>() { <span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.UNSUPPORTED_OPERATION)); };</td></tr>
  <tr><td>1784</td><td></td></tr>
  <tr><td>1785</td><td>		<span class="codeReserved">this</span>._getPath = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> path; };</td></tr>
  <tr><td>1786</td><td>		<span class="codeReserved">this</span>._setPath = <span class="codeReserved">function</span>() { <span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.UNSUPPORTED_OPERATION)); };</td></tr>
  <tr><td>1787</td><td></td></tr>
  <tr><td>1788</td><td>		<span class="codeReserved">this</span>._getURI = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> uri; };</td></tr>
  <tr><td>1789</td><td>		<span class="codeReserved">this</span>._setURI = <span class="codeReserved">function</span>() { <span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.UNSUPPORTED_OPERATION)); };</td></tr>
  <tr><td>1790</td><td></td></tr>
  <tr><td>1791</td><td>		<span class="codeReserved">this</span>._getClientId = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> client.clientId; };</td></tr>
  <tr><td>1792</td><td>		<span class="codeReserved">this</span>._setClientId = <span class="codeReserved">function</span>() { <span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.UNSUPPORTED_OPERATION)); };</td></tr>
  <tr><td>1793</td><td></td></tr>
  <tr><td>1794</td><td>		<span class="codeReserved">this</span>._getOnConnected = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> client.onConnected; };</td></tr>
  <tr><td>1795</td><td>		<span class="codeReserved">this</span>._setOnConnected = <span class="codeReserved">function</span>(newOnConnected) {</td></tr>
  <tr><td>1796</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> newOnConnected === <span class="codeString">"<span class="codeReserved">function</span>"</span>)</td></tr>
  <tr><td>1797</td><td>				client.onConnected = newOnConnected;</td></tr>
  <tr><td>1798</td><td>			<span class="codeReserved">else</span></td></tr>
  <tr><td>1799</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> newOnConnected, <span class="codeString">"onConnected"</span>]));</td></tr>
  <tr><td>1800</td><td>		};</td></tr>
  <tr><td>1801</td><td></td></tr>
  <tr><td>1802</td><td>		<span class="codeReserved">this</span>._getDisconnectedPublishing = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> client.disconnectedPublishing; };</td></tr>
  <tr><td>1803</td><td>		<span class="codeReserved">this</span>._setDisconnectedPublishing = <span class="codeReserved">function</span>(newDisconnectedPublishing) {</td></tr>
  <tr><td>1804</td><td>			client.disconnectedPublishing = newDisconnectedPublishing;</td></tr>
  <tr><td>1805</td><td>		};</td></tr>
  <tr><td>1806</td><td></td></tr>
  <tr><td>1807</td><td>		<span class="codeReserved">this</span>._getDisconnectedBufferSize = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> client.disconnectedBufferSize; };</td></tr>
  <tr><td>1808</td><td>		<span class="codeReserved">this</span>._setDisconnectedBufferSize = <span class="codeReserved">function</span>(newDisconnectedBufferSize) {</td></tr>
  <tr><td>1809</td><td>			client.disconnectedBufferSize = newDisconnectedBufferSize;</td></tr>
  <tr><td>1810</td><td>		};</td></tr>
  <tr><td>1811</td><td></td></tr>
  <tr><td>1812</td><td>		<span class="codeReserved">this</span>._getOnConnectionLost = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> client.onConnectionLost; };</td></tr>
  <tr><td>1813</td><td>		<span class="codeReserved">this</span>._setOnConnectionLost = <span class="codeReserved">function</span>(newOnConnectionLost) {</td></tr>
  <tr><td>1814</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> newOnConnectionLost === <span class="codeString">"<span class="codeReserved">function</span>"</span>)</td></tr>
  <tr><td>1815</td><td>				client.onConnectionLost = newOnConnectionLost;</td></tr>
  <tr><td>1816</td><td>			<span class="codeReserved">else</span></td></tr>
  <tr><td>1817</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> newOnConnectionLost, <span class="codeString">"onConnectionLost"</span>]));</td></tr>
  <tr><td>1818</td><td>		};</td></tr>
  <tr><td>1819</td><td></td></tr>
  <tr><td>1820</td><td>		<span class="codeReserved">this</span>._getOnMessageDelivered = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> client.onMessageDelivered; };</td></tr>
  <tr><td>1821</td><td>		<span class="codeReserved">this</span>._setOnMessageDelivered = <span class="codeReserved">function</span>(newOnMessageDelivered) {</td></tr>
  <tr><td>1822</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> newOnMessageDelivered === <span class="codeString">"<span class="codeReserved">function</span>"</span>)</td></tr>
  <tr><td>1823</td><td>				client.onMessageDelivered = newOnMessageDelivered;</td></tr>
  <tr><td>1824</td><td>			<span class="codeReserved">else</span></td></tr>
  <tr><td>1825</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> newOnMessageDelivered, <span class="codeString">"onMessageDelivered"</span>]));</td></tr>
  <tr><td>1826</td><td>		};</td></tr>
  <tr><td>1827</td><td></td></tr>
  <tr><td>1828</td><td>		<span class="codeReserved">this</span>._getOnMessageArrived = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> client.onMessageArrived; };</td></tr>
  <tr><td>1829</td><td>		<span class="codeReserved">this</span>._setOnMessageArrived = <span class="codeReserved">function</span>(newOnMessageArrived) {</td></tr>
  <tr><td>1830</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> newOnMessageArrived === <span class="codeString">"<span class="codeReserved">function</span>"</span>)</td></tr>
  <tr><td>1831</td><td>				client.onMessageArrived = newOnMessageArrived;</td></tr>
  <tr><td>1832</td><td>			<span class="codeReserved">else</span></td></tr>
  <tr><td>1833</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> newOnMessageArrived, <span class="codeString">"onMessageArrived"</span>]));</td></tr>
  <tr><td>1834</td><td>		};</td></tr>
  <tr><td>1835</td><td></td></tr>
  <tr><td>1836</td><td>		<span class="codeReserved">this</span>._getTrace = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> client.traceFunction; };</td></tr>
  <tr><td>1837</td><td>		<span class="codeReserved">this</span>._setTrace = <span class="codeReserved">function</span>(trace) {</td></tr>
  <tr><td>1838</td><td>			<span class="codeReserved">if</span>(<span class="codeReserved">typeof</span> trace === <span class="codeString">"<span class="codeReserved">function</span>"</span>){</td></tr>
  <tr><td>1839</td><td>				client.traceFunction = trace;</td></tr>
  <tr><td>1840</td><td>			}<span class="codeReserved">else</span>{</td></tr>
  <tr><td>1841</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> trace, <span class="codeString">"onTrace"</span>]));</td></tr>
  <tr><td>1842</td><td>			}</td></tr>
  <tr><td>1843</td><td>		};</td></tr>
  <tr><td>1844</td><td></td></tr>
  <tr><td>1845</td><td>		<span class="codeComment">/**</span></td></tr>
  <tr><td>1846</td><td><span class="codeComment">		 * Connect <span class="codeReserved">this</span> Messaging client <span class="codeReserved">to</span> its server.</span></td></tr>
  <tr><td>1847</td><td><span class="codeComment">		 *</span></td></tr>
  <tr><td>1848</td><td><span class="codeComment">		 * <span class="codeReserved">@name</span> Paho.MQTT.Client#connect</span></td></tr>
  <tr><td>1849</td><td><span class="codeComment">		 * <span class="codeReserved">@function</span></span></td></tr>
  <tr><td>1850</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {object} connectOptions - Attributes used with the connection.</span></td></tr>
  <tr><td>1851</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {number} connectOptions.timeout - If the connect has not succeeded within <span class="codeReserved">this</span></span></td></tr>
  <tr><td>1852</td><td><span class="codeComment">		 *                    number of seconds, it is deemed <span class="codeReserved">to</span> have failed.</span></td></tr>
  <tr><td>1853</td><td><span class="codeComment">		 *                    The <span class="codeReserved">default</span> is 30 seconds.</span></td></tr>
  <tr><td>1854</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {string} connectOptions.userName - Authentication username <span class="codeReserved">for</span> <span class="codeReserved">this</span> connection.</span></td></tr>
  <tr><td>1855</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {string} connectOptions.password - Authentication password <span class="codeReserved">for</span> <span class="codeReserved">this</span> connection.</span></td></tr>
  <tr><td>1856</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {Paho.MQTT.Message} connectOptions.willMessage - sent by the server when the client</span></td></tr>
  <tr><td>1857</td><td><span class="codeComment">		 *                    disconnects abnormally.</span></td></tr>
  <tr><td>1858</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {number} connectOptions.keepAliveInterval - the server disconnects <span class="codeReserved">this</span> client <span class="codeReserved">if</span></span></td></tr>
  <tr><td>1859</td><td><span class="codeComment">		 *                    there is no activity <span class="codeReserved">for</span> <span class="codeReserved">this</span> number of seconds.</span></td></tr>
  <tr><td>1860</td><td><span class="codeComment">		 *                    The <span class="codeReserved">default</span> value of 60 seconds is assumed <span class="codeReserved">if</span> not set.</span></td></tr>
  <tr><td>1861</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {boolean} connectOptions.cleanSession - <span class="codeReserved">if</span> <span class="codeReserved">true</span>(<span class="codeReserved">default</span>) the client and server</span></td></tr>
  <tr><td>1862</td><td><span class="codeComment">		 *                    persistent state is deleted on successful connect.</span></td></tr>
  <tr><td>1863</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {boolean} connectOptions.useSSL - <span class="codeReserved">if</span> present and <span class="codeReserved">true</span>, use an SSL Websocket connection.</span></td></tr>
  <tr><td>1864</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {object} connectOptions.invocationContext - passed <span class="codeReserved">to</span> the onSuccess callback or onFailure callback.</span></td></tr>
  <tr><td>1865</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {<span class="codeReserved">function</span>} connectOptions.onSuccess - called when the connect acknowledgement</span></td></tr>
  <tr><td>1866</td><td><span class="codeComment">		 *                    has been received <span class="codeReserved">from</span> the server.</span></td></tr>
  <tr><td>1867</td><td><span class="codeComment">		 * A single response object parameter is passed <span class="codeReserved">to</span> the onSuccess callback containing the following fields:</span></td></tr>
  <tr><td>1868</td><td><span class="codeComment">		 * &lt;ol&gt;</span></td></tr>
  <tr><td>1869</td><td><span class="codeComment">		 * &lt;li&gt;invocationContext <span class="codeReserved">as</span> passed <span class="codeReserved">in</span> <span class="codeReserved">to</span> the onSuccess method <span class="codeReserved">in</span> the connectOptions.</span></td></tr>
  <tr><td>1870</td><td><span class="codeComment">		 * &lt;/ol&gt;</span></td></tr>
  <tr><td>1871</td><td><span class="codeComment">     * <span class="codeReserved">@param</span> {<span class="codeReserved">function</span>} connectOptions.onFailure - called when the connect request has failed or timed out.</span></td></tr>
  <tr><td>1872</td><td><span class="codeComment">		 * A single response object parameter is passed <span class="codeReserved">to</span> the onFailure callback containing the following fields:</span></td></tr>
  <tr><td>1873</td><td><span class="codeComment">		 * &lt;ol&gt;</span></td></tr>
  <tr><td>1874</td><td><span class="codeComment">		 * &lt;li&gt;invocationContext <span class="codeReserved">as</span> passed <span class="codeReserved">in</span> <span class="codeReserved">to</span> the onFailure method <span class="codeReserved">in</span> the connectOptions.</span></td></tr>
  <tr><td>1875</td><td><span class="codeComment">		 * &lt;li&gt;errorCode a number indicating the nature of the error.</span></td></tr>
  <tr><td>1876</td><td><span class="codeComment">		 * &lt;li&gt;errorMessage text describing the error.</span></td></tr>
  <tr><td>1877</td><td><span class="codeComment">		 * &lt;/ol&gt;</span></td></tr>
  <tr><td>1878</td><td><span class="codeComment">     * <span class="codeReserved">@param</span> {array} connectOptions.hosts - If present <span class="codeReserved">this</span> contains either a set of hostnames or fully qualified</span></td></tr>
  <tr><td>1879</td><td><span class="codeComment">		 * WebSocket URIs (ws://iot.eclipse.org:80/ws), that are tried <span class="codeReserved">in</span> order <span class="codeReserved">in</span> place</span></td></tr>
  <tr><td>1880</td><td><span class="codeComment">		 * of the host and port paramater on the construtor. The hosts are tried one at at time <span class="codeReserved">in</span> order until</span></td></tr>
  <tr><td>1881</td><td><span class="codeComment">		 * one of then succeeds.</span></td></tr>
  <tr><td>1882</td><td><span class="codeComment">     * <span class="codeReserved">@param</span> {array} connectOptions.ports - If present the set of ports matching the hosts. If hosts contains URIs, <span class="codeReserved">this</span> property</span></td></tr>
  <tr><td>1883</td><td><span class="codeComment">		 * is not used.</span></td></tr>
  <tr><td>1884</td><td><span class="codeComment">     * <span class="codeReserved">@param</span> {boolean} connectOptions.reconnect - Sets whether the client will automatically attempt <span class="codeReserved">to</span> reconnect</span></td></tr>
  <tr><td>1885</td><td><span class="codeComment">     * <span class="codeReserved">to</span> the server <span class="codeReserved">if</span> the connection is lost.</span></td></tr>
  <tr><td>1886</td><td><span class="codeComment">     *&lt;ul&gt;</span></td></tr>
  <tr><td>1887</td><td><span class="codeComment">     *&lt;li&gt;If set <span class="codeReserved">to</span> <span class="codeReserved">false</span>, the client will not attempt <span class="codeReserved">to</span> automatically reconnect <span class="codeReserved">to</span> the server <span class="codeReserved">in</span> the event that the</span></td></tr>
  <tr><td>1888</td><td><span class="codeComment">     * connection is lost.&lt;/li&gt;</span></td></tr>
  <tr><td>1889</td><td><span class="codeComment">     *&lt;li&gt;If set <span class="codeReserved">to</span> <span class="codeReserved">true</span>, <span class="codeReserved">in</span> the event that the connection is lost, the client will attempt <span class="codeReserved">to</span> reconnect <span class="codeReserved">to</span> the server.</span></td></tr>
  <tr><td>1890</td><td><span class="codeComment">     * It will initially wait 1 second before it attempts <span class="codeReserved">to</span> reconnect, <span class="codeReserved">for</span> every failed reconnect attempt, the delay</span></td></tr>
  <tr><td>1891</td><td><span class="codeComment">     * will double until it is at 2 minutes at which point the delay will stay at 2 minutes.&lt;/li&gt;</span></td></tr>
  <tr><td>1892</td><td><span class="codeComment">     *&lt;/ul&gt;</span></td></tr>
  <tr><td>1893</td><td><span class="codeComment">     * <span class="codeReserved">@param</span> {number} connectOptions.mqttVersion - The version of MQTT <span class="codeReserved">to</span> use <span class="codeReserved">to</span> connect <span class="codeReserved">to</span> the MQTT Broker.</span></td></tr>
  <tr><td>1894</td><td><span class="codeComment">     *&lt;ul&gt;</span></td></tr>
  <tr><td>1895</td><td><span class="codeComment">     *&lt;li&gt;3 - MQTT V3.1&lt;/li&gt;</span></td></tr>
  <tr><td>1896</td><td><span class="codeComment">     *&lt;li&gt;4 - MQTT V3.1.1&lt;/li&gt;</span></td></tr>
  <tr><td>1897</td><td><span class="codeComment">     *&lt;/ul&gt;</span></td></tr>
  <tr><td>1898</td><td><span class="codeComment">     * <span class="codeReserved">@param</span> {boolean} connectOptions.mqttVersionExplicit - If set <span class="codeReserved">to</span> <span class="codeReserved">true</span>, will force the connection <span class="codeReserved">to</span> use the</span></td></tr>
  <tr><td>1899</td><td><span class="codeComment">     * selected MQTT Version or will fail <span class="codeReserved">to</span> connect.</span></td></tr>
  <tr><td>1900</td><td><span class="codeComment">     * <span class="codeReserved">@param</span> {array} connectOptions.uris - If present, should contain a list of fully qualified WebSocket uris</span></td></tr>
  <tr><td>1901</td><td><span class="codeComment">     * (e.g. ws://iot.eclipse.org:80/ws), that are tried <span class="codeReserved">in</span> order <span class="codeReserved">in</span> place of the host and port parameter of the construtor.</span></td></tr>
  <tr><td>1902</td><td><span class="codeComment">     * The uris are tried one at a time <span class="codeReserved">in</span> order until one of them succeeds. Do not use <span class="codeReserved">this</span> <span class="codeReserved">in</span> conjunction with hosts <span class="codeReserved">as</span></span></td></tr>
  <tr><td>1903</td><td><span class="codeComment">     * the hosts array will be converted <span class="codeReserved">to</span> uris and will overwrite <span class="codeReserved">this</span> property.</span></td></tr>
  <tr><td>1904</td><td><span class="codeComment">		 * <span class="codeReserved">@throws</span> {InvalidState} If the client is not <span class="codeReserved">in</span> disconnected state. The client must have received connectionLost</span></td></tr>
  <tr><td>1905</td><td><span class="codeComment">		 * or disconnected before calling connect <span class="codeReserved">for</span> a second or subsequent time.</span></td></tr>
  <tr><td>1906</td><td><span class="codeComment">		 */</span></td></tr>
  <tr><td>1907</td><td>		<span class="codeReserved">this</span>.connect = <span class="codeReserved">function</span> (connectOptions) {</td></tr>
  <tr><td>1908</td><td>			connectOptions = connectOptions || {} ;</td></tr>
  <tr><td>1909</td><td>			validate(connectOptions,  {timeout:<span class="codeString">"number"</span>,</td></tr>
  <tr><td>1910</td><td>									   userName:<span class="codeString">"string"</span>,</td></tr>
  <tr><td>1911</td><td>									   password:<span class="codeString">"string"</span>,</td></tr>
  <tr><td>1912</td><td>									   willMessage:<span class="codeString">"object"</span>,</td></tr>
  <tr><td>1913</td><td>									   keepAliveInterval:<span class="codeString">"number"</span>,</td></tr>
  <tr><td>1914</td><td>									   cleanSession:<span class="codeString">"boolean"</span>,</td></tr>
  <tr><td>1915</td><td>									   useSSL:<span class="codeString">"boolean"</span>,</td></tr>
  <tr><td>1916</td><td>									   invocationContext:<span class="codeString">"object"</span>,</td></tr>
  <tr><td>1917</td><td>									   onSuccess:<span class="codeString">"<span class="codeReserved">function</span>"</span>,</td></tr>
  <tr><td>1918</td><td>									   onFailure:<span class="codeString">"<span class="codeReserved">function</span>"</span>,</td></tr>
  <tr><td>1919</td><td>									   hosts:<span class="codeString">"object"</span>,</td></tr>
  <tr><td>1920</td><td>									   ports:<span class="codeString">"object"</span>,</td></tr>
  <tr><td>1921</td><td>									   reconnect:<span class="codeString">"boolean"</span>,</td></tr>
  <tr><td>1922</td><td>									   mqttVersion:<span class="codeString">"number"</span>,</td></tr>
  <tr><td>1923</td><td>									   mqttVersionExplicit:<span class="codeString">"boolean"</span>,</td></tr>
  <tr><td>1924</td><td>									   uris: <span class="codeString">"object"</span>});</td></tr>
  <tr><td>1925</td><td></td></tr>
  <tr><td>1926</td><td>			<span class="codeComment">// If no keep alive interval is set, assume 60 seconds.</span></td></tr>
  <tr><td>1927</td><td>			<span class="codeReserved">if</span> (connectOptions.keepAliveInterval === undefined)</td></tr>
  <tr><td>1928</td><td>				connectOptions.keepAliveInterval = 60;</td></tr>
  <tr><td>1929</td><td></td></tr>
  <tr><td>1930</td><td>			<span class="codeReserved">if</span> (connectOptions.mqttVersion &gt; 4 || connectOptions.mqttVersion &lt; 3) {</td></tr>
  <tr><td>1931</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.mqttVersion, <span class="codeString">"connectOptions.mqttVersion"</span>]));</td></tr>
  <tr><td>1932</td><td>			}</td></tr>
  <tr><td>1933</td><td></td></tr>
  <tr><td>1934</td><td>			<span class="codeReserved">if</span> (connectOptions.mqttVersion === undefined) {</td></tr>
  <tr><td>1935</td><td>				connectOptions.mqttVersionExplicit = <span class="codeReserved">false</span>;</td></tr>
  <tr><td>1936</td><td>				connectOptions.mqttVersion = 4;</td></tr>
  <tr><td>1937</td><td>			} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>1938</td><td>				connectOptions.mqttVersionExplicit = <span class="codeReserved">true</span>;</td></tr>
  <tr><td>1939</td><td>			}</td></tr>
  <tr><td>1940</td><td></td></tr>
  <tr><td>1941</td><td>			<span class="codeComment">//Check that if password is set, so is username</span></td></tr>
  <tr><td>1942</td><td>			<span class="codeReserved">if</span> (connectOptions.password !== undefined && connectOptions.userName === undefined)</td></tr>
  <tr><td>1943</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.password, <span class="codeString">"connectOptions.password"</span>]));</td></tr>
  <tr><td>1944</td><td></td></tr>
  <tr><td>1945</td><td>			<span class="codeReserved">if</span> (connectOptions.willMessage) {</td></tr>
  <tr><td>1946</td><td>				<span class="codeReserved">if</span> (!(connectOptions.willMessage <span class="codeReserved">instanceof</span> Message))</td></tr>
  <tr><td>1947</td><td>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [connectOptions.willMessage, <span class="codeString">"connectOptions.willMessage"</span>]));</td></tr>
  <tr><td>1948</td><td>				<span class="codeComment">// The will message must have a payload that can be represented as a string.</span></td></tr>
  <tr><td>1949</td><td>				<span class="codeComment">// Cause the willMessage to throw an exception if this is not the case.</span></td></tr>
  <tr><td>1950</td><td>				connectOptions.willMessage.stringPayload = <span class="codeReserved">null</span>;</td></tr>
  <tr><td>1951</td><td></td></tr>
  <tr><td>1952</td><td>				<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> connectOptions.willMessage.destinationName === <span class="codeString">"undefined"</span>)</td></tr>
  <tr><td>1953</td><td>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> connectOptions.willMessage.destinationName, <span class="codeString">"connectOptions.willMessage.destinationName"</span>]));</td></tr>
  <tr><td>1954</td><td>			}</td></tr>
  <tr><td>1955</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> connectOptions.cleanSession === <span class="codeString">"undefined"</span>)</td></tr>
  <tr><td>1956</td><td>				connectOptions.cleanSession = <span class="codeReserved">true</span>;</td></tr>
  <tr><td>1957</td><td>			<span class="codeReserved">if</span> (connectOptions.hosts) {</td></tr>
  <tr><td>1958</td><td></td></tr>
  <tr><td>1959</td><td>				<span class="codeReserved">if</span> (!(connectOptions.hosts <span class="codeReserved">instanceof</span> Array) )</td></tr>
  <tr><td>1960</td><td>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.hosts, <span class="codeString">"connectOptions.hosts"</span>]));</td></tr>
  <tr><td>1961</td><td>				<span class="codeReserved">if</span> (connectOptions.hosts.length &lt;1 )</td></tr>
  <tr><td>1962</td><td>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.hosts, <span class="codeString">"connectOptions.hosts"</span>]));</td></tr>
  <tr><td>1963</td><td></td></tr>
  <tr><td>1964</td><td>				<span class="codeReserved">var</span> usingURIs = <span class="codeReserved">false</span>;</td></tr>
  <tr><td>1965</td><td>				<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i = 0; i&lt;<span class="codeReserved">connectOptions</span>.hosts.length; i++) {</td></tr>
  <tr><td>1966</td><td>					<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> connectOptions.hosts[i] !== <span class="codeString">"string"</span>)</td></tr>
  <tr><td>1967</td><td>						<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> connectOptions.hosts[i], <span class="codeString">"connectOptions.hosts["</span>+i+<span class="codeString">"]"</span>]));</td></tr>
  <tr><td>1968</td><td>					<span class="codeReserved">if</span> (<span class="codeString">/^(wss?):\/</span>\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/.test(connectOptions.hosts[i])) {</td></tr>
  <tr><td>1969</td><td>						<span class="codeReserved">if</span> (i === 0) {</td></tr>
  <tr><td>1970</td><td>							usingURIs = <span class="codeReserved">true</span>;</td></tr>
  <tr><td>1971</td><td>						} <span class="codeReserved">else</span> <span class="codeReserved">if</span> (!usingURIs) {</td></tr>
  <tr><td>1972</td><td>							<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.hosts[i], <span class="codeString">"connectOptions.hosts["</span>+i+<span class="codeString">"]"</span>]));</td></tr>
  <tr><td>1973</td><td>						}</td></tr>
  <tr><td>1974</td><td>					} <span class="codeReserved">else</span> <span class="codeReserved">if</span> (usingURIs) {</td></tr>
  <tr><td>1975</td><td>						<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.hosts[i], <span class="codeString">"connectOptions.hosts["</span>+i+<span class="codeString">"]"</span>]));</td></tr>
  <tr><td>1976</td><td>					}</td></tr>
  <tr><td>1977</td><td>				}</td></tr>
  <tr><td>1978</td><td></td></tr>
  <tr><td>1979</td><td>				<span class="codeReserved">if</span> (!usingURIs) {</td></tr>
  <tr><td>1980</td><td>					<span class="codeReserved">if</span> (!connectOptions.ports)</td></tr>
  <tr><td>1981</td><td>						<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.ports, <span class="codeString">"connectOptions.ports"</span>]));</td></tr>
  <tr><td>1982</td><td>					<span class="codeReserved">if</span> (!(connectOptions.ports <span class="codeReserved">instanceof</span> Array) )</td></tr>
  <tr><td>1983</td><td>						<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.ports, <span class="codeString">"connectOptions.ports"</span>]));</td></tr>
  <tr><td>1984</td><td>					<span class="codeReserved">if</span> (connectOptions.hosts.length !== connectOptions.ports.length)</td></tr>
  <tr><td>1985</td><td>						<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.ports, <span class="codeString">"connectOptions.ports"</span>]));</td></tr>
  <tr><td>1986</td><td></td></tr>
  <tr><td>1987</td><td>					connectOptions.uris = [];</td></tr>
  <tr><td>1988</td><td></td></tr>
  <tr><td>1989</td><td>					<span class="codeReserved">for</span> (<span class="codeReserved">var</span> i = 0; i&lt;<span class="codeReserved">connectOptions</span>.hosts.length; i++) {</td></tr>
  <tr><td>1990</td><td>						<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> connectOptions.ports[i] !== <span class="codeString">"number"</span> || connectOptions.ports[i] &lt; 0)</td></tr>
  <tr><td>1991</td><td>							<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_TYPE, [<span class="codeReserved">typeof</span> connectOptions.ports[i], <span class="codeString">"connectOptions.ports["</span>+i+<span class="codeString">"]"</span>]));</td></tr>
  <tr><td>1992</td><td>						<span class="codeReserved">var</span> host = connectOptions.hosts[i];</td></tr>
  <tr><td>1993</td><td>						<span class="codeReserved">var</span> port = connectOptions.ports[i];</td></tr>
  <tr><td>1994</td><td></td></tr>
  <tr><td>1995</td><td>						<span class="codeReserved">var</span> ipv6 = (host.indexOf(<span class="codeString">":"</span>) !== -1);</td></tr>
  <tr><td>1996</td><td>						uri = <span class="codeString">"ws://"</span>+(ipv6?<span class="codeString">"["</span>+host+<span class="codeString">"]"</span>:host)+<span class="codeString">":"</span>+port+path;</td></tr>
  <tr><td>1997</td><td>						connectOptions.uris.push(uri);</td></tr>
  <tr><td>1998</td><td>					}</td></tr>
  <tr><td>1999</td><td>				} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>2000</td><td>					connectOptions.uris = connectOptions.hosts;</td></tr>
  <tr><td>2001</td><td>				}</td></tr>
  <tr><td>2002</td><td>			}</td></tr>
  <tr><td>2003</td><td></td></tr>
  <tr><td>2004</td><td>			client.connect(connectOptions);</td></tr>
  <tr><td>2005</td><td>		};</td></tr>
  <tr><td>2006</td><td></td></tr>
  <tr><td>2007</td><td>		<span class="codeComment">/**</span></td></tr>
  <tr><td>2008</td><td><span class="codeComment">		 * Subscribe <span class="codeReserved">for</span> messages, request receipt of a copy of messages sent <span class="codeReserved">to</span> the destinations described by the filter.</span></td></tr>
  <tr><td>2009</td><td><span class="codeComment">		 *</span></td></tr>
  <tr><td>2010</td><td><span class="codeComment">		 * <span class="codeReserved">@name</span> Paho.MQTT.Client#subscribe</span></td></tr>
  <tr><td>2011</td><td><span class="codeComment">		 * <span class="codeReserved">@function</span></span></td></tr>
  <tr><td>2012</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {string} filter describing the destinations <span class="codeReserved">to</span> receive messages <span class="codeReserved">from</span>.</span></td></tr>
  <tr><td>2013</td><td><span class="codeComment">		 * &lt;br&gt;</span></td></tr>
  <tr><td>2014</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {object} subscribeOptions - used <span class="codeReserved">to</span> control the subscription</span></td></tr>
  <tr><td>2015</td><td><span class="codeComment">		 *</span></td></tr>
  <tr><td>2016</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {number} subscribeOptions.qos - the maiximum qos of any publications sent</span></td></tr>
  <tr><td>2017</td><td><span class="codeComment">		 *                                  <span class="codeReserved">as</span> a result of making <span class="codeReserved">this</span> subscription.</span></td></tr>
  <tr><td>2018</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {object} subscribeOptions.invocationContext - passed <span class="codeReserved">to</span> the onSuccess callback</span></td></tr>
  <tr><td>2019</td><td><span class="codeComment">		 *                                  or onFailure callback.</span></td></tr>
  <tr><td>2020</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {<span class="codeReserved">function</span>} subscribeOptions.onSuccess - called when the subscribe acknowledgement</span></td></tr>
  <tr><td>2021</td><td><span class="codeComment">		 *                                  has been received <span class="codeReserved">from</span> the server.</span></td></tr>
  <tr><td>2022</td><td><span class="codeComment">		 *                                  A single response object parameter is passed <span class="codeReserved">to</span> the onSuccess callback containing the following fields:</span></td></tr>
  <tr><td>2023</td><td><span class="codeComment">		 *                                  &lt;ol&gt;</span></td></tr>
  <tr><td>2024</td><td><span class="codeComment">		 *                                  &lt;li&gt;invocationContext <span class="codeReserved">if</span> set <span class="codeReserved">in</span> the subscribeOptions.</span></td></tr>
  <tr><td>2025</td><td><span class="codeComment">		 *                                  &lt;/ol&gt;</span></td></tr>
  <tr><td>2026</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {<span class="codeReserved">function</span>} subscribeOptions.onFailure - called when the subscribe request has failed or timed out.</span></td></tr>
  <tr><td>2027</td><td><span class="codeComment">		 *                                  A single response object parameter is passed <span class="codeReserved">to</span> the onFailure callback containing the following fields:</span></td></tr>
  <tr><td>2028</td><td><span class="codeComment">		 *                                  &lt;ol&gt;</span></td></tr>
  <tr><td>2029</td><td><span class="codeComment">		 *                                  &lt;li&gt;invocationContext - <span class="codeReserved">if</span> set <span class="codeReserved">in</span> the subscribeOptions.</span></td></tr>
  <tr><td>2030</td><td><span class="codeComment">		 *                                  &lt;li&gt;errorCode - a number indicating the nature of the error.</span></td></tr>
  <tr><td>2031</td><td><span class="codeComment">		 *                                  &lt;li&gt;errorMessage - text describing the error.</span></td></tr>
  <tr><td>2032</td><td><span class="codeComment">		 *                                  &lt;/ol&gt;</span></td></tr>
  <tr><td>2033</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {number} subscribeOptions.timeout - which, <span class="codeReserved">if</span> present, determines the number of</span></td></tr>
  <tr><td>2034</td><td><span class="codeComment">		 *                                  seconds after which the onFailure calback is called.</span></td></tr>
  <tr><td>2035</td><td><span class="codeComment">		 *                                  The presence of a timeout does not prevent the onSuccess</span></td></tr>
  <tr><td>2036</td><td><span class="codeComment">		 *                                  callback <span class="codeReserved">from</span> being called when the subscribe completes.</span></td></tr>
  <tr><td>2037</td><td><span class="codeComment">		 * <span class="codeReserved">@throws</span> {InvalidState} <span class="codeReserved">if</span> the client is not <span class="codeReserved">in</span> connected state.</span></td></tr>
  <tr><td>2038</td><td><span class="codeComment">		 */</span></td></tr>
  <tr><td>2039</td><td>		<span class="codeReserved">this</span>.subscribe = <span class="codeReserved">function</span> (filter, subscribeOptions) {</td></tr>
  <tr><td>2040</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> filter !== <span class="codeString">"string"</span>)</td></tr>
  <tr><td>2041</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(<span class="codeString">"Invalid argument:"</span>+filter);</td></tr>
  <tr><td>2042</td><td>			subscribeOptions = subscribeOptions || {} ;</td></tr>
  <tr><td>2043</td><td>			validate(subscribeOptions,  {qos:<span class="codeString">"number"</span>,</td></tr>
  <tr><td>2044</td><td>										 invocationContext:<span class="codeString">"object"</span>,</td></tr>
  <tr><td>2045</td><td>										 onSuccess:<span class="codeString">"<span class="codeReserved">function</span>"</span>,</td></tr>
  <tr><td>2046</td><td>										 onFailure:<span class="codeString">"<span class="codeReserved">function</span>"</span>,</td></tr>
  <tr><td>2047</td><td>										 timeout:<span class="codeString">"number"</span></td></tr>
  <tr><td>2048</td><td>										});</td></tr>
  <tr><td>2049</td><td>			<span class="codeReserved">if</span> (subscribeOptions.timeout && !subscribeOptions.onFailure)</td></tr>
  <tr><td>2050</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(<span class="codeString">"subscribeOptions.timeout specified with no onFailure callback."</span>);</td></tr>
  <tr><td>2051</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> subscribeOptions.qos !== <span class="codeString">"undefined"</span> && !(subscribeOptions.qos === 0 || subscribeOptions.qos === 1 || subscribeOptions.qos === 2 ))</td></tr>
  <tr><td>2052</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [subscribeOptions.qos, <span class="codeString">"subscribeOptions.qos"</span>]));</td></tr>
  <tr><td>2053</td><td>			client.subscribe(filter, subscribeOptions);</td></tr>
  <tr><td>2054</td><td>		};</td></tr>
  <tr><td>2055</td><td></td></tr>
  <tr><td>2056</td><td>		<span class="codeComment">/**</span></td></tr>
  <tr><td>2057</td><td><span class="codeComment">		 * Unsubscribe <span class="codeReserved">for</span> messages, stop receiving messages sent <span class="codeReserved">to</span> destinations described by the filter.</span></td></tr>
  <tr><td>2058</td><td><span class="codeComment">		 *</span></td></tr>
  <tr><td>2059</td><td><span class="codeComment">		 * <span class="codeReserved">@name</span> Paho.MQTT.Client#unsubscribe</span></td></tr>
  <tr><td>2060</td><td><span class="codeComment">		 * <span class="codeReserved">@function</span></span></td></tr>
  <tr><td>2061</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {string} filter - describing the destinations <span class="codeReserved">to</span> receive messages <span class="codeReserved">from</span>.</span></td></tr>
  <tr><td>2062</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {object} unsubscribeOptions - used <span class="codeReserved">to</span> control the subscription</span></td></tr>
  <tr><td>2063</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {object} unsubscribeOptions.invocationContext - passed <span class="codeReserved">to</span> the onSuccess callback</span></td></tr>
  <tr><td>2064</td><td><span class="codeComment">		                                      or onFailure callback.</span></td></tr>
  <tr><td>2065</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {<span class="codeReserved">function</span>} unsubscribeOptions.onSuccess - called when the unsubscribe acknowledgement has been received <span class="codeReserved">from</span> the server.</span></td></tr>
  <tr><td>2066</td><td><span class="codeComment">		 *                                    A single response object parameter is passed <span class="codeReserved">to</span> the</span></td></tr>
  <tr><td>2067</td><td><span class="codeComment">		 *                                    onSuccess callback containing the following fields:</span></td></tr>
  <tr><td>2068</td><td><span class="codeComment">		 *                                    &lt;ol&gt;</span></td></tr>
  <tr><td>2069</td><td><span class="codeComment">		 *                                    &lt;li&gt;invocationContext - <span class="codeReserved">if</span> set <span class="codeReserved">in</span> the unsubscribeOptions.</span></td></tr>
  <tr><td>2070</td><td><span class="codeComment">		 *                                    &lt;/ol&gt;</span></td></tr>
  <tr><td>2071</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {<span class="codeReserved">function</span>} unsubscribeOptions.onFailure called when the unsubscribe request has failed or timed out.</span></td></tr>
  <tr><td>2072</td><td><span class="codeComment">		 *                                    A single response object parameter is passed <span class="codeReserved">to</span> the onFailure callback containing the following fields:</span></td></tr>
  <tr><td>2073</td><td><span class="codeComment">		 *                                    &lt;ol&gt;</span></td></tr>
  <tr><td>2074</td><td><span class="codeComment">		 *                                    &lt;li&gt;invocationContext - <span class="codeReserved">if</span> set <span class="codeReserved">in</span> the unsubscribeOptions.</span></td></tr>
  <tr><td>2075</td><td><span class="codeComment">		 *                                    &lt;li&gt;errorCode - a number indicating the nature of the error.</span></td></tr>
  <tr><td>2076</td><td><span class="codeComment">		 *                                    &lt;li&gt;errorMessage - text describing the error.</span></td></tr>
  <tr><td>2077</td><td><span class="codeComment">		 *                                    &lt;/ol&gt;</span></td></tr>
  <tr><td>2078</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {number} unsubscribeOptions.timeout - which, <span class="codeReserved">if</span> present, determines the number of seconds</span></td></tr>
  <tr><td>2079</td><td><span class="codeComment">		 *                                    after which the onFailure callback is called. The presence of</span></td></tr>
  <tr><td>2080</td><td><span class="codeComment">		 *                                    a timeout does not prevent the onSuccess callback <span class="codeReserved">from</span> being</span></td></tr>
  <tr><td>2081</td><td><span class="codeComment">		 *                                    called when the unsubscribe completes</span></td></tr>
  <tr><td>2082</td><td><span class="codeComment">		 * <span class="codeReserved">@throws</span> {InvalidState} <span class="codeReserved">if</span> the client is not <span class="codeReserved">in</span> connected state.</span></td></tr>
  <tr><td>2083</td><td><span class="codeComment">		 */</span></td></tr>
  <tr><td>2084</td><td>		<span class="codeReserved">this</span>.unsubscribe = <span class="codeReserved">function</span> (filter, unsubscribeOptions) {</td></tr>
  <tr><td>2085</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> filter !== <span class="codeString">"string"</span>)</td></tr>
  <tr><td>2086</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(<span class="codeString">"Invalid argument:"</span>+filter);</td></tr>
  <tr><td>2087</td><td>			unsubscribeOptions = unsubscribeOptions || {} ;</td></tr>
  <tr><td>2088</td><td>			validate(unsubscribeOptions,  {invocationContext:<span class="codeString">"object"</span>,</td></tr>
  <tr><td>2089</td><td>										   onSuccess:<span class="codeString">"<span class="codeReserved">function</span>"</span>,</td></tr>
  <tr><td>2090</td><td>										   onFailure:<span class="codeString">"<span class="codeReserved">function</span>"</span>,</td></tr>
  <tr><td>2091</td><td>										   timeout:<span class="codeString">"number"</span></td></tr>
  <tr><td>2092</td><td>										  });</td></tr>
  <tr><td>2093</td><td>			<span class="codeReserved">if</span> (unsubscribeOptions.timeout && !unsubscribeOptions.onFailure)</td></tr>
  <tr><td>2094</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(<span class="codeString">"unsubscribeOptions.timeout specified with no onFailure callback."</span>);</td></tr>
  <tr><td>2095</td><td>			client.unsubscribe(filter, unsubscribeOptions);</td></tr>
  <tr><td>2096</td><td>		};</td></tr>
  <tr><td>2097</td><td></td></tr>
  <tr><td>2098</td><td>		<span class="codeComment">/**</span></td></tr>
  <tr><td>2099</td><td><span class="codeComment">		 * Send a message <span class="codeReserved">to</span> the consumers of the destination <span class="codeReserved">in</span> the Message.</span></td></tr>
  <tr><td>2100</td><td><span class="codeComment">		 *</span></td></tr>
  <tr><td>2101</td><td><span class="codeComment">		 * <span class="codeReserved">@name</span> Paho.MQTT.Client#send</span></td></tr>
  <tr><td>2102</td><td><span class="codeComment">		 * <span class="codeReserved">@function</span></span></td></tr>
  <tr><td>2103</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {string|Paho.MQTT.Message} topic - &lt;b&gt;mandatory&lt;/b&gt; The name of the destination <span class="codeReserved">to</span> which the message is <span class="codeReserved">to</span> be sent.</span></td></tr>
  <tr><td>2104</td><td><span class="codeComment">		 * 					   - If it is the only parameter, used <span class="codeReserved">as</span> Paho.MQTT.Message object.</span></td></tr>
  <tr><td>2105</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {String|ArrayBuffer} payload - The message data <span class="codeReserved">to</span> be sent.</span></td></tr>
  <tr><td>2106</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {number} qos The Quality of Service used <span class="codeReserved">to</span> deliver the message.</span></td></tr>
  <tr><td>2107</td><td><span class="codeComment">		 * 		&lt;dl&gt;</span></td></tr>
  <tr><td>2108</td><td><span class="codeComment">		 * 			&lt;dt&gt;0 Best effort (<span class="codeReserved">default</span>).</span></td></tr>
  <tr><td>2109</td><td><span class="codeComment">		 *     			&lt;dt&gt;1 At least once.</span></td></tr>
  <tr><td>2110</td><td><span class="codeComment">		 *     			&lt;dt&gt;2 Exactly once.</span></td></tr>
  <tr><td>2111</td><td><span class="codeComment">		 * 		&lt;/dl&gt;</span></td></tr>
  <tr><td>2112</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {Boolean} retained If <span class="codeReserved">true</span>, the message is <span class="codeReserved">to</span> be retained by the server and delivered</span></td></tr>
  <tr><td>2113</td><td><span class="codeComment">		 *                     <span class="codeReserved">to</span> both current and future subscriptions.</span></td></tr>
  <tr><td>2114</td><td><span class="codeComment">		 *                     If <span class="codeReserved">false</span> the server only delivers the message <span class="codeReserved">to</span> current subscribers, <span class="codeReserved">this</span> is the <span class="codeReserved">default</span> <span class="codeReserved">for</span> <span class="codeReserved">new</span> Messages.</span></td></tr>
  <tr><td>2115</td><td><span class="codeComment">		 *                     A received message has the retained boolean set <span class="codeReserved">to</span> <span class="codeReserved">true</span> <span class="codeReserved">if</span> the message was published</span></td></tr>
  <tr><td>2116</td><td><span class="codeComment">		 *                     with the retained boolean set <span class="codeReserved">to</span> <span class="codeReserved">true</span></span></td></tr>
  <tr><td>2117</td><td><span class="codeComment">		 *                     and the subscrption was made after the message has been published.</span></td></tr>
  <tr><td>2118</td><td><span class="codeComment">		 * <span class="codeReserved">@throws</span> {InvalidState} <span class="codeReserved">if</span> the client is not connected.</span></td></tr>
  <tr><td>2119</td><td><span class="codeComment">		 */</span></td></tr>
  <tr><td>2120</td><td>		<span class="codeReserved">this</span>.send = <span class="codeReserved">function</span> (topic,payload,qos,retained) {</td></tr>
  <tr><td>2121</td><td>			<span class="codeReserved">var</span> message ;</td></tr>
  <tr><td>2122</td><td></td></tr>
  <tr><td>2123</td><td>			<span class="codeReserved">if</span>(arguments.length === 0){</td></tr>
  <tr><td>2124</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(<span class="codeString">"Invalid argument."</span>+<span class="codeString">"length"</span>);</td></tr>
  <tr><td>2125</td><td></td></tr>
  <tr><td>2126</td><td>			}<span class="codeReserved">else</span> <span class="codeReserved">if</span>(arguments.length == 1) {</td></tr>
  <tr><td>2127</td><td></td></tr>
  <tr><td>2128</td><td>				<span class="codeReserved">if</span> (!(topic <span class="codeReserved">instanceof</span> Message) && (<span class="codeReserved">typeof</span> topic !== <span class="codeString">"string"</span>))</td></tr>
  <tr><td>2129</td><td>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(<span class="codeString">"Invalid argument:"</span>+ <span class="codeReserved">typeof</span> topic);</td></tr>
  <tr><td>2130</td><td></td></tr>
  <tr><td>2131</td><td>				message = topic;</td></tr>
  <tr><td>2132</td><td>				<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> message.destinationName === <span class="codeString">"undefined"</span>)</td></tr>
  <tr><td>2133</td><td>					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT,[message.destinationName,<span class="codeString">"Message.destinationName"</span>]));</td></tr>
  <tr><td>2134</td><td>				client.send(message);</td></tr>
  <tr><td>2135</td><td></td></tr>
  <tr><td>2136</td><td>			}<span class="codeReserved">else</span> {</td></tr>
  <tr><td>2137</td><td>				<span class="codeComment">//parameter checking in Message object</span></td></tr>
  <tr><td>2138</td><td>				message = <span class="codeReserved">new</span> Message(payload);</td></tr>
  <tr><td>2139</td><td>				message.destinationName = topic;</td></tr>
  <tr><td>2140</td><td>				<span class="codeReserved">if</span>(arguments.length &gt;= 3)</td></tr>
  <tr><td>2141</td><td>					message.qos = qos;</td></tr>
  <tr><td>2142</td><td>				<span class="codeReserved">if</span>(arguments.length &gt;= 4)</td></tr>
  <tr><td>2143</td><td>					message.retained = retained;</td></tr>
  <tr><td>2144</td><td>				client.send(message);</td></tr>
  <tr><td>2145</td><td>			}</td></tr>
  <tr><td>2146</td><td>		};</td></tr>
  <tr><td>2147</td><td></td></tr>
  <tr><td>2148</td><td>		<span class="codeComment">/**</span></td></tr>
  <tr><td>2149</td><td><span class="codeComment">		 * Publish a message <span class="codeReserved">to</span> the consumers of the destination <span class="codeReserved">in</span> the Message.</span></td></tr>
  <tr><td>2150</td><td><span class="codeComment">		 * Synonym <span class="codeReserved">for</span> Paho.Mqtt.Client#send</span></td></tr>
  <tr><td>2151</td><td><span class="codeComment">		 *</span></td></tr>
  <tr><td>2152</td><td><span class="codeComment">		 * <span class="codeReserved">@name</span> Paho.MQTT.Client#publish</span></td></tr>
  <tr><td>2153</td><td><span class="codeComment">		 * <span class="codeReserved">@function</span></span></td></tr>
  <tr><td>2154</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {string|Paho.MQTT.Message} topic - &lt;b&gt;mandatory&lt;/b&gt; The name of the topic <span class="codeReserved">to</span> which the message is <span class="codeReserved">to</span> be published.</span></td></tr>
  <tr><td>2155</td><td><span class="codeComment">		 * 					   - If it is the only parameter, used <span class="codeReserved">as</span> Paho.MQTT.Message object.</span></td></tr>
  <tr><td>2156</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {String|ArrayBuffer} payload - The message data <span class="codeReserved">to</span> be published.</span></td></tr>
  <tr><td>2157</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {number} qos The Quality of Service used <span class="codeReserved">to</span> deliver the message.</span></td></tr>
  <tr><td>2158</td><td><span class="codeComment">		 * 		&lt;dl&gt;</span></td></tr>
  <tr><td>2159</td><td><span class="codeComment">		 * 			&lt;dt&gt;0 Best effort (<span class="codeReserved">default</span>).</span></td></tr>
  <tr><td>2160</td><td><span class="codeComment">		 *     			&lt;dt&gt;1 At least once.</span></td></tr>
  <tr><td>2161</td><td><span class="codeComment">		 *     			&lt;dt&gt;2 Exactly once.</span></td></tr>
  <tr><td>2162</td><td><span class="codeComment">		 * 		&lt;/dl&gt;</span></td></tr>
  <tr><td>2163</td><td><span class="codeComment">		 * <span class="codeReserved">@param</span> {Boolean} retained If <span class="codeReserved">true</span>, the message is <span class="codeReserved">to</span> be retained by the server and delivered</span></td></tr>
  <tr><td>2164</td><td><span class="codeComment">		 *                     <span class="codeReserved">to</span> both current and future subscriptions.</span></td></tr>
  <tr><td>2165</td><td><span class="codeComment">		 *                     If <span class="codeReserved">false</span> the server only delivers the message <span class="codeReserved">to</span> current subscribers, <span class="codeReserved">this</span> is the <span class="codeReserved">default</span> <span class="codeReserved">for</span> <span class="codeReserved">new</span> Messages.</span></td></tr>
  <tr><td>2166</td><td><span class="codeComment">		 *                     A received message has the retained boolean set <span class="codeReserved">to</span> <span class="codeReserved">true</span> <span class="codeReserved">if</span> the message was published</span></td></tr>
  <tr><td>2167</td><td><span class="codeComment">		 *                     with the retained boolean set <span class="codeReserved">to</span> <span class="codeReserved">true</span></span></td></tr>
  <tr><td>2168</td><td><span class="codeComment">		 *                     and the subscrption was made after the message has been published.</span></td></tr>
  <tr><td>2169</td><td><span class="codeComment">		 * <span class="codeReserved">@throws</span> {InvalidState} <span class="codeReserved">if</span> the client is not connected.</span></td></tr>
  <tr><td>2170</td><td><span class="codeComment">		 */</span></td></tr>
  <tr><td>2171</td><td>		 <span class="codeReserved">this</span>.publish = <span class="codeReserved">function</span>(topic,payload,qos,retained) {</td></tr>
  <tr><td>2172</td><td>			 console.log(<span class="codeString">"Publising message <span class="codeReserved">to</span>: "</span>, topic);</td></tr>
  <tr><td>2173</td><td>			 <span class="codeReserved">var</span> message ;</td></tr>
  <tr><td>2174</td><td></td></tr>
  <tr><td>2175</td><td> 			<span class="codeReserved">if</span>(arguments.length === 0){</td></tr>
  <tr><td>2176</td><td> 				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(<span class="codeString">"Invalid argument."</span>+<span class="codeString">"length"</span>);</td></tr>
  <tr><td>2177</td><td></td></tr>
  <tr><td>2178</td><td> 			}<span class="codeReserved">else</span> <span class="codeReserved">if</span>(arguments.length == 1) {</td></tr>
  <tr><td>2179</td><td></td></tr>
  <tr><td>2180</td><td> 				<span class="codeReserved">if</span> (!(topic <span class="codeReserved">instanceof</span> Message) && (<span class="codeReserved">typeof</span> topic !== <span class="codeString">"string"</span>))</td></tr>
  <tr><td>2181</td><td> 					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(<span class="codeString">"Invalid argument:"</span>+ <span class="codeReserved">typeof</span> topic);</td></tr>
  <tr><td>2182</td><td></td></tr>
  <tr><td>2183</td><td> 				message = topic;</td></tr>
  <tr><td>2184</td><td> 				<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> message.destinationName === <span class="codeString">"undefined"</span>)</td></tr>
  <tr><td>2185</td><td> 					<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT,[message.destinationName,<span class="codeString">"Message.destinationName"</span>]));</td></tr>
  <tr><td>2186</td><td> 				client.send(message);</td></tr>
  <tr><td>2187</td><td></td></tr>
  <tr><td>2188</td><td> 			}<span class="codeReserved">else</span> {</td></tr>
  <tr><td>2189</td><td> 				<span class="codeComment">//parameter checking in Message object</span></td></tr>
  <tr><td>2190</td><td> 				message = <span class="codeReserved">new</span> Message(payload);</td></tr>
  <tr><td>2191</td><td> 				message.destinationName = topic;</td></tr>
  <tr><td>2192</td><td> 				<span class="codeReserved">if</span>(arguments.length &gt;= 3)</td></tr>
  <tr><td>2193</td><td> 					message.qos = qos;</td></tr>
  <tr><td>2194</td><td> 				<span class="codeReserved">if</span>(arguments.length &gt;= 4)</td></tr>
  <tr><td>2195</td><td> 					message.retained = retained;</td></tr>
  <tr><td>2196</td><td> 				client.send(message);</td></tr>
  <tr><td>2197</td><td> 			}</td></tr>
  <tr><td>2198</td><td>		};</td></tr>
  <tr><td>2199</td><td></td></tr>
  <tr><td>2200</td><td>		<span class="codeComment">/**</span></td></tr>
  <tr><td>2201</td><td><span class="codeComment">		 * Normal disconnect of <span class="codeReserved">this</span> Messaging client <span class="codeReserved">from</span> its server.</span></td></tr>
  <tr><td>2202</td><td><span class="codeComment">		 *</span></td></tr>
  <tr><td>2203</td><td><span class="codeComment">		 * <span class="codeReserved">@name</span> Paho.MQTT.Client#disconnect</span></td></tr>
  <tr><td>2204</td><td><span class="codeComment">		 * <span class="codeReserved">@function</span></span></td></tr>
  <tr><td>2205</td><td><span class="codeComment">		 * <span class="codeReserved">@throws</span> {InvalidState} <span class="codeReserved">if</span> the client is already disconnected.</span></td></tr>
  <tr><td>2206</td><td><span class="codeComment">		 */</span></td></tr>
  <tr><td>2207</td><td>		<span class="codeReserved">this</span>.disconnect = <span class="codeReserved">function</span> () {</td></tr>
  <tr><td>2208</td><td>			client.disconnect();</td></tr>
  <tr><td>2209</td><td>		};</td></tr>
  <tr><td>2210</td><td></td></tr>
  <tr><td>2211</td><td>		<span class="codeComment">/**</span></td></tr>
  <tr><td>2212</td><td><span class="codeComment">		 * Get the contents of the trace log.</span></td></tr>
  <tr><td>2213</td><td><span class="codeComment">		 *</span></td></tr>
  <tr><td>2214</td><td><span class="codeComment">		 * <span class="codeReserved">@name</span> Paho.MQTT.Client#getTraceLog</span></td></tr>
  <tr><td>2215</td><td><span class="codeComment">		 * <span class="codeReserved">@function</span></span></td></tr>
  <tr><td>2216</td><td><span class="codeComment">		 * <span class="codeReserved">@return</span> {Object[]} tracebuffer containing the time ordered trace records.</span></td></tr>
  <tr><td>2217</td><td><span class="codeComment">		 */</span></td></tr>
  <tr><td>2218</td><td>		<span class="codeReserved">this</span>.getTraceLog = <span class="codeReserved">function</span> () {</td></tr>
  <tr><td>2219</td><td>			<span class="codeReserved">return</span> client.getTraceLog();</td></tr>
  <tr><td>2220</td><td>		};</td></tr>
  <tr><td>2221</td><td></td></tr>
  <tr><td>2222</td><td>		<span class="codeComment">/**</span></td></tr>
  <tr><td>2223</td><td><span class="codeComment">		 * Start tracing.</span></td></tr>
  <tr><td>2224</td><td><span class="codeComment">		 *</span></td></tr>
  <tr><td>2225</td><td><span class="codeComment">		 * <span class="codeReserved">@name</span> Paho.MQTT.Client#startTrace</span></td></tr>
  <tr><td>2226</td><td><span class="codeComment">		 * <span class="codeReserved">@function</span></span></td></tr>
  <tr><td>2227</td><td><span class="codeComment">		 */</span></td></tr>
  <tr><td>2228</td><td>		<span class="codeReserved">this</span>.startTrace = <span class="codeReserved">function</span> () {</td></tr>
  <tr><td>2229</td><td>			client.startTrace();</td></tr>
  <tr><td>2230</td><td>		};</td></tr>
  <tr><td>2231</td><td></td></tr>
  <tr><td>2232</td><td>		<span class="codeComment">/**</span></td></tr>
  <tr><td>2233</td><td><span class="codeComment">		 * Stop tracing.</span></td></tr>
  <tr><td>2234</td><td><span class="codeComment">		 *</span></td></tr>
  <tr><td>2235</td><td><span class="codeComment">		 * <span class="codeReserved">@name</span> Paho.MQTT.Client#stopTrace</span></td></tr>
  <tr><td>2236</td><td><span class="codeComment">		 * <span class="codeReserved">@function</span></span></td></tr>
  <tr><td>2237</td><td><span class="codeComment">		 */</span></td></tr>
  <tr><td>2238</td><td>		<span class="codeReserved">this</span>.stopTrace = <span class="codeReserved">function</span> () {</td></tr>
  <tr><td>2239</td><td>			client.stopTrace();</td></tr>
  <tr><td>2240</td><td>		};</td></tr>
  <tr><td>2241</td><td></td></tr>
  <tr><td>2242</td><td>		<span class="codeReserved">this</span>.isConnected = <span class="codeReserved">function</span>() {</td></tr>
  <tr><td>2243</td><td>			<span class="codeReserved">return</span> client.connected;</td></tr>
  <tr><td>2244</td><td>		};</td></tr>
  <tr><td>2245</td><td>	};</td></tr>
  <tr><td>2246</td><td></td></tr>
  <tr><td>2247</td><td>	Client.prototype = {</td></tr>
  <tr><td>2248</td><td>		get host() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getHost(); },</td></tr>
  <tr><td>2249</td><td>		set host(newHost) { <span class="codeReserved">this</span>._setHost(newHost); },</td></tr>
  <tr><td>2250</td><td></td></tr>
  <tr><td>2251</td><td>		get port() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getPort(); },</td></tr>
  <tr><td>2252</td><td>		set port(newPort) { <span class="codeReserved">this</span>._setPort(newPort); },</td></tr>
  <tr><td>2253</td><td></td></tr>
  <tr><td>2254</td><td>		get path() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getPath(); },</td></tr>
  <tr><td>2255</td><td>		set path(newPath) { <span class="codeReserved">this</span>._setPath(newPath); },</td></tr>
  <tr><td>2256</td><td></td></tr>
  <tr><td>2257</td><td>		get clientId() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getClientId(); },</td></tr>
  <tr><td>2258</td><td>		set clientId(newClientId) { <span class="codeReserved">this</span>._setClientId(newClientId); },</td></tr>
  <tr><td>2259</td><td></td></tr>
  <tr><td>2260</td><td>		get onConnected() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getOnConnected(); },</td></tr>
  <tr><td>2261</td><td>		set onConnected(newOnConnected) { <span class="codeReserved">this</span>._setOnConnected(newOnConnected); },</td></tr>
  <tr><td>2262</td><td></td></tr>
  <tr><td>2263</td><td>		get disconnectedPublishing() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getDisconnectedPublishing(); },</td></tr>
  <tr><td>2264</td><td>		set disconnectedPublishing(newDisconnectedPublishing) { <span class="codeReserved">this</span>._setDisconnectedPublishing(newDisconnectedPublishing); },</td></tr>
  <tr><td>2265</td><td></td></tr>
  <tr><td>2266</td><td>		get disconnectedBufferSize() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getDisconnectedBufferSize(); },</td></tr>
  <tr><td>2267</td><td>		set disconnectedBufferSize(newDisconnectedBufferSize) { <span class="codeReserved">this</span>._setDisconnectedBufferSize(newDisconnectedBufferSize); },</td></tr>
  <tr><td>2268</td><td></td></tr>
  <tr><td>2269</td><td>		get onConnectionLost() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getOnConnectionLost(); },</td></tr>
  <tr><td>2270</td><td>		set onConnectionLost(newOnConnectionLost) { <span class="codeReserved">this</span>._setOnConnectionLost(newOnConnectionLost); },</td></tr>
  <tr><td>2271</td><td></td></tr>
  <tr><td>2272</td><td>		get onMessageDelivered() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getOnMessageDelivered(); },</td></tr>
  <tr><td>2273</td><td>		set onMessageDelivered(newOnMessageDelivered) { <span class="codeReserved">this</span>._setOnMessageDelivered(newOnMessageDelivered); },</td></tr>
  <tr><td>2274</td><td></td></tr>
  <tr><td>2275</td><td>		get onMessageArrived() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getOnMessageArrived(); },</td></tr>
  <tr><td>2276</td><td>		set onMessageArrived(newOnMessageArrived) { <span class="codeReserved">this</span>._setOnMessageArrived(newOnMessageArrived); },</td></tr>
  <tr><td>2277</td><td></td></tr>
  <tr><td>2278</td><td>		get trace() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getTrace(); },</td></tr>
  <tr><td>2279</td><td>		set trace(newTraceFunction) { <span class="codeReserved">this</span>._setTrace(newTraceFunction); }</td></tr>
  <tr><td>2280</td><td></td></tr>
  <tr><td>2281</td><td>	};</td></tr>
  <tr><td>2282</td><td></td></tr>
  <tr><td>2283</td><td>	<span class="codeComment">/**</span></td></tr>
  <tr><td>2284</td><td><span class="codeComment">	 * An application message, sent or received.</span></td></tr>
  <tr><td>2285</td><td><span class="codeComment">	 * &lt;p&gt;</span></td></tr>
  <tr><td>2286</td><td><span class="codeComment">	 * All attributes may be <span class="codeReserved">null</span>, which implies the <span class="codeReserved">default</span> values.</span></td></tr>
  <tr><td>2287</td><td><span class="codeComment">	 *</span></td></tr>
  <tr><td>2288</td><td><span class="codeComment">	 * <span class="codeReserved">@name</span> Paho.MQTT.Message</span></td></tr>
  <tr><td>2289</td><td><span class="codeComment">	 * <span class="codeReserved">@constructor</span></span></td></tr>
  <tr><td>2290</td><td><span class="codeComment">	 * <span class="codeReserved">@param</span> {String|ArrayBuffer} payload The message data <span class="codeReserved">to</span> be sent.</span></td></tr>
  <tr><td>2291</td><td><span class="codeComment">	 * &lt;p&gt;</span></td></tr>
  <tr><td>2292</td><td><span class="codeComment">	 * <span class="codeReserved">@property</span> {string} payloadString &lt;i&gt;read only&lt;/i&gt; The payload <span class="codeReserved">as</span> a string <span class="codeReserved">if</span> the payload consists of valid UTF-8 characters.</span></td></tr>
  <tr><td>2293</td><td><span class="codeComment">	 * <span class="codeReserved">@property</span> {ArrayBuffer} payloadBytes &lt;i&gt;read only&lt;/i&gt; The payload <span class="codeReserved">as</span> an ArrayBuffer.</span></td></tr>
  <tr><td>2294</td><td><span class="codeComment">	 * &lt;p&gt;</span></td></tr>
  <tr><td>2295</td><td><span class="codeComment">	 * <span class="codeReserved">@property</span> {string} destinationName &lt;b&gt;mandatory&lt;/b&gt; The name of the destination <span class="codeReserved">to</span> which the message is <span class="codeReserved">to</span> be sent</span></td></tr>
  <tr><td>2296</td><td><span class="codeComment">	 *                    (<span class="codeReserved">for</span> messages about <span class="codeReserved">to</span> be sent) or the name of the destination <span class="codeReserved">from</span> which the message has been received.</span></td></tr>
  <tr><td>2297</td><td><span class="codeComment">	 *                    (<span class="codeReserved">for</span> messages received by the onMessage <span class="codeReserved">function</span>).</span></td></tr>
  <tr><td>2298</td><td><span class="codeComment">	 * &lt;p&gt;</span></td></tr>
  <tr><td>2299</td><td><span class="codeComment">	 * <span class="codeReserved">@property</span> {number} qos The Quality of Service used <span class="codeReserved">to</span> deliver the message.</span></td></tr>
  <tr><td>2300</td><td><span class="codeComment">	 * &lt;dl&gt;</span></td></tr>
  <tr><td>2301</td><td><span class="codeComment">	 *     &lt;dt&gt;0 Best effort (<span class="codeReserved">default</span>).</span></td></tr>
  <tr><td>2302</td><td><span class="codeComment">	 *     &lt;dt&gt;1 At least once.</span></td></tr>
  <tr><td>2303</td><td><span class="codeComment">	 *     &lt;dt&gt;2 Exactly once.</span></td></tr>
  <tr><td>2304</td><td><span class="codeComment">	 * &lt;/dl&gt;</span></td></tr>
  <tr><td>2305</td><td><span class="codeComment">	 * &lt;p&gt;</span></td></tr>
  <tr><td>2306</td><td><span class="codeComment">	 * <span class="codeReserved">@property</span> {Boolean} retained If <span class="codeReserved">true</span>, the message is <span class="codeReserved">to</span> be retained by the server and delivered</span></td></tr>
  <tr><td>2307</td><td><span class="codeComment">	 *                     <span class="codeReserved">to</span> both current and future subscriptions.</span></td></tr>
  <tr><td>2308</td><td><span class="codeComment">	 *                     If <span class="codeReserved">false</span> the server only delivers the message <span class="codeReserved">to</span> current subscribers, <span class="codeReserved">this</span> is the <span class="codeReserved">default</span> <span class="codeReserved">for</span> <span class="codeReserved">new</span> Messages.</span></td></tr>
  <tr><td>2309</td><td><span class="codeComment">	 *                     A received message has the retained boolean set <span class="codeReserved">to</span> <span class="codeReserved">true</span> <span class="codeReserved">if</span> the message was published</span></td></tr>
  <tr><td>2310</td><td><span class="codeComment">	 *                     with the retained boolean set <span class="codeReserved">to</span> <span class="codeReserved">true</span></span></td></tr>
  <tr><td>2311</td><td><span class="codeComment">	 *                     and the subscrption was made after the message has been published.</span></td></tr>
  <tr><td>2312</td><td><span class="codeComment">	 * &lt;p&gt;</span></td></tr>
  <tr><td>2313</td><td><span class="codeComment">	 * <span class="codeReserved">@property</span> {Boolean} duplicate &lt;i&gt;read only&lt;/i&gt; If <span class="codeReserved">true</span>, <span class="codeReserved">this</span> message might be a duplicate of one which has already been received.</span></td></tr>
  <tr><td>2314</td><td><span class="codeComment">	 *                     This is only set on messages received <span class="codeReserved">from</span> the server.</span></td></tr>
  <tr><td>2315</td><td><span class="codeComment">	 *</span></td></tr>
  <tr><td>2316</td><td><span class="codeComment">	 */</span></td></tr>
  <tr><td>2317</td><td>	<span class="codeReserved">var</span> Message = <span class="codeReserved">function</span> (newPayload) {</td></tr>
  <tr><td>2318</td><td>		<span class="codeReserved">var</span> payload;</td></tr>
  <tr><td>2319</td><td>		<span class="codeReserved">if</span> (   <span class="codeReserved">typeof</span> newPayload === <span class="codeString">"string"</span> ||</td></tr>
  <tr><td>2320</td><td>		newPayload <span class="codeReserved">instanceof</span> ArrayBuffer ||</td></tr>
  <tr><td>2321</td><td>		newPayload <span class="codeReserved">instanceof</span> Int8Array   ||</td></tr>
  <tr><td>2322</td><td>		newPayload <span class="codeReserved">instanceof</span> Uint8Array  ||</td></tr>
  <tr><td>2323</td><td>		newPayload <span class="codeReserved">instanceof</span> Int16Array  ||</td></tr>
  <tr><td>2324</td><td>		newPayload <span class="codeReserved">instanceof</span> Uint16Array ||</td></tr>
  <tr><td>2325</td><td>		newPayload <span class="codeReserved">instanceof</span> Int32Array  ||</td></tr>
  <tr><td>2326</td><td>		newPayload <span class="codeReserved">instanceof</span> Uint32Array ||</td></tr>
  <tr><td>2327</td><td>		newPayload <span class="codeReserved">instanceof</span> Float32Array ||</td></tr>
  <tr><td>2328</td><td>		newPayload <span class="codeReserved">instanceof</span> Float64Array</td></tr>
  <tr><td>2329</td><td>		   ) {</td></tr>
  <tr><td>2330</td><td>			payload = newPayload;</td></tr>
  <tr><td>2331</td><td>		} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>2332</td><td>			<span class="codeReserved">throw</span> (format(ERROR.INVALID_ARGUMENT, [newPayload, <span class="codeString">"newPayload"</span>]));</td></tr>
  <tr><td>2333</td><td>		}</td></tr>
  <tr><td>2334</td><td></td></tr>
  <tr><td>2335</td><td>		<span class="codeReserved">this</span>._getPayloadString = <span class="codeReserved">function</span> () {</td></tr>
  <tr><td>2336</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> payload === <span class="codeString">"string"</span>)</td></tr>
  <tr><td>2337</td><td>				<span class="codeReserved">return</span> payload;</td></tr>
  <tr><td>2338</td><td>			<span class="codeReserved">else</span></td></tr>
  <tr><td>2339</td><td>				<span class="codeReserved">return</span> parseUTF8(payload, 0, payload.length);</td></tr>
  <tr><td>2340</td><td>		};</td></tr>
  <tr><td>2341</td><td></td></tr>
  <tr><td>2342</td><td>		<span class="codeReserved">this</span>._getPayloadBytes = <span class="codeReserved">function</span>() {</td></tr>
  <tr><td>2343</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> payload === <span class="codeString">"string"</span>) {</td></tr>
  <tr><td>2344</td><td>				<span class="codeReserved">var</span> buffer = <span class="codeReserved">new</span> ArrayBuffer(UTF8Length(payload));</td></tr>
  <tr><td>2345</td><td>				<span class="codeReserved">var</span> byteStream = <span class="codeReserved">new</span> Uint8Array(buffer);</td></tr>
  <tr><td>2346</td><td>				stringToUTF8(payload, byteStream, 0);</td></tr>
  <tr><td>2347</td><td></td></tr>
  <tr><td>2348</td><td>				<span class="codeReserved">return</span> byteStream;</td></tr>
  <tr><td>2349</td><td>			} <span class="codeReserved">else</span> {</td></tr>
  <tr><td>2350</td><td>				<span class="codeReserved">return</span> payload;</td></tr>
  <tr><td>2351</td><td>			}</td></tr>
  <tr><td>2352</td><td>		};</td></tr>
  <tr><td>2353</td><td></td></tr>
  <tr><td>2354</td><td>		<span class="codeReserved">var</span> destinationName;</td></tr>
  <tr><td>2355</td><td>		<span class="codeReserved">this</span>._getDestinationName = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> destinationName; };</td></tr>
  <tr><td>2356</td><td>		<span class="codeReserved">this</span>._setDestinationName = <span class="codeReserved">function</span>(newDestinationName) {</td></tr>
  <tr><td>2357</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> newDestinationName === <span class="codeString">"string"</span>)</td></tr>
  <tr><td>2358</td><td>				destinationName = newDestinationName;</td></tr>
  <tr><td>2359</td><td>			<span class="codeReserved">else</span></td></tr>
  <tr><td>2360</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [newDestinationName, <span class="codeString">"newDestinationName"</span>]));</td></tr>
  <tr><td>2361</td><td>		};</td></tr>
  <tr><td>2362</td><td></td></tr>
  <tr><td>2363</td><td>		<span class="codeReserved">var</span> qos = 0;</td></tr>
  <tr><td>2364</td><td>		<span class="codeReserved">this</span>._getQos = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> qos; };</td></tr>
  <tr><td>2365</td><td>		<span class="codeReserved">this</span>._setQos = <span class="codeReserved">function</span>(newQos) {</td></tr>
  <tr><td>2366</td><td>			<span class="codeReserved">if</span> (newQos === 0 || newQos === 1 || newQos === 2 )</td></tr>
  <tr><td>2367</td><td>				qos = newQos;</td></tr>
  <tr><td>2368</td><td>			<span class="codeReserved">else</span></td></tr>
  <tr><td>2369</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(<span class="codeString">"Invalid argument:"</span>+newQos);</td></tr>
  <tr><td>2370</td><td>		};</td></tr>
  <tr><td>2371</td><td></td></tr>
  <tr><td>2372</td><td>		<span class="codeReserved">var</span> retained = <span class="codeReserved">false</span>;</td></tr>
  <tr><td>2373</td><td>		<span class="codeReserved">this</span>._getRetained = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> retained; };</td></tr>
  <tr><td>2374</td><td>		<span class="codeReserved">this</span>._setRetained = <span class="codeReserved">function</span>(newRetained) {</td></tr>
  <tr><td>2375</td><td>			<span class="codeReserved">if</span> (<span class="codeReserved">typeof</span> newRetained === <span class="codeString">"boolean"</span>)</td></tr>
  <tr><td>2376</td><td>				retained = newRetained;</td></tr>
  <tr><td>2377</td><td>			<span class="codeReserved">else</span></td></tr>
  <tr><td>2378</td><td>				<span class="codeReserved">throw</span> <span class="codeReserved">new</span> Error(format(ERROR.INVALID_ARGUMENT, [newRetained, <span class="codeString">"newRetained"</span>]));</td></tr>
  <tr><td>2379</td><td>		};</td></tr>
  <tr><td>2380</td><td></td></tr>
  <tr><td>2381</td><td>		<span class="codeReserved">var</span> duplicate = <span class="codeReserved">false</span>;</td></tr>
  <tr><td>2382</td><td>		<span class="codeReserved">this</span>._getDuplicate = <span class="codeReserved">function</span>() { <span class="codeReserved">return</span> duplicate; };</td></tr>
  <tr><td>2383</td><td>		<span class="codeReserved">this</span>._setDuplicate = <span class="codeReserved">function</span>(newDuplicate) { duplicate = newDuplicate; };</td></tr>
  <tr><td>2384</td><td>	};</td></tr>
  <tr><td>2385</td><td></td></tr>
  <tr><td>2386</td><td>	Message.prototype = {</td></tr>
  <tr><td>2387</td><td>		get payloadString() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getPayloadString(); },</td></tr>
  <tr><td>2388</td><td>		get payloadBytes() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getPayloadBytes(); },</td></tr>
  <tr><td>2389</td><td></td></tr>
  <tr><td>2390</td><td>		get destinationName() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getDestinationName(); },</td></tr>
  <tr><td>2391</td><td>		set destinationName(newDestinationName) { <span class="codeReserved">this</span>._setDestinationName(newDestinationName); },</td></tr>
  <tr><td>2392</td><td></td></tr>
  <tr><td>2393</td><td>		get topic() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getDestinationName(); },</td></tr>
  <tr><td>2394</td><td>		set topic(newTopic) { <span class="codeReserved">this</span>._setDestinationName(newTopic); },</td></tr>
  <tr><td>2395</td><td></td></tr>
  <tr><td>2396</td><td>		get qos() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getQos(); },</td></tr>
  <tr><td>2397</td><td>		set qos(newQos) { <span class="codeReserved">this</span>._setQos(newQos); },</td></tr>
  <tr><td>2398</td><td></td></tr>
  <tr><td>2399</td><td>		get retained() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getRetained(); },</td></tr>
  <tr><td>2400</td><td>		set retained(newRetained) { <span class="codeReserved">this</span>._setRetained(newRetained); },</td></tr>
  <tr><td>2401</td><td></td></tr>
  <tr><td>2402</td><td>		get duplicate() { <span class="codeReserved">return</span> <span class="codeReserved">this</span>._getDuplicate(); },</td></tr>
  <tr><td>2403</td><td>		set duplicate(newDuplicate) { <span class="codeReserved">this</span>._setDuplicate(newDuplicate); }</td></tr>
  <tr><td>2404</td><td>	};</td></tr>
  <tr><td>2405</td><td></td></tr>
  <tr><td>2406</td><td>	<span class="codeComment">// Module contents.</span></td></tr>
  <tr><td>2407</td><td>	<span class="codeReserved">return</span> {</td></tr>
  <tr><td>2408</td><td>		Client: Client,</td></tr>
  <tr><td>2409</td><td>		Message: Message</td></tr>
  <tr><td>2410</td><td>	};</td></tr>
  <tr><td>2411</td><td>})(window);</td></tr>
  <tr><td>2412</td><td><span class="codeReserved">return</span> PahoMQTT;</td></tr>
  <tr><td>2413</td><td>});</td></tr>
  <tr><td>2414</td><td></td></tr>
 </tbody>
</table>
 <footer>
 <p>
  <a rel="license"
    href="http://creativecommons.org/licenses/by/4.0/"><img
     alt="Licencia Creative Commons" style="border-width:0"
     src="/img/icono/160x30.webp" width="80" height="15" /></a>
  <br />Esta
  <span xmlns:dct="http://purl.org/dc/terms/"
    href="http://purl.org/dc/dcmitype/InteractiveResource"
    rel="dct:type">obra</span>
  de
  <a xmlns:cc="http://creativecommons.org/ns#"
    href="https://gilpgijs.github.io" property="cc:attributionName"
    rel="cc:attributionURL">Gilberto Pacheco Gallegos</a>
  está bajo una
  <a rel="license"
    href="http://creativecommons.org/licenses/by/4.0/">Licencia
   Creative Commons Atribución 4.0 Internacional</a>.
 </p>
</footer>
 <button id="abre" type="button" title="Menú" class="cambiaMenu">
  <span class="material-symbols-outlined">
   menu
  </span>
 </button>
 <a class="anterior" href="/m05iot/m-paho.javascript-1.0.3/m-paho-mqtt-min-js.html" title="E. paho.javascript-1.0.3 / paho-mqtt-min.js"><span class="material-symbols-outlined">
     skip_previous
    </span></a>
 <a class="siguiente" href="/m05iot/m--htaccess.html" title="H. .htaccess"><span class="material-symbols-outlined">
     skip_next
     </span></a>
</div>
<div id="cierra" class="cambiaMenu"></div>
<nav id="nav">
 <button type="button" title="Cierra" class="cambiaMenu">
  <span class="material-symbols-outlined">
   close
  </span>
 </button>
 
   <p>
    <a href="/"
      data-logo="true">GilPG DM</a>
   </p>
   
   <p>
    <a href="/m05iot/">8. IoT</a>
   </p>
   
     <p>
      <a class="paginaAnterior" href="/m05iot/m-lib/m-js/m-ProblemDetails-js.html"
        title="6. lib / js / ProblemDetails.js"><span
        class="material-symbols-outlined">
         arrow_upward
        </span></a>
     </p>
   <h1><a href="/m05iot/m-paho.javascript-1.0.3/index.html">G. Carpeta « paho.javascript-1.0.3 »</a></h1>
   
   <ol type="A">
    
   <li>
    <p>
     <a href="/m05iot/m-paho.javascript-1.0.3/m-about-html.html">paho.javascript-1.0.3 / about.html</a>
    </p>
   </li>
   <li>
    <p>
     <a href="/m05iot/m-paho.javascript-1.0.3/m-CONTRIBUTING-md.html">paho.javascript-1.0.3 / CONTRIBUTING.md</a>
    </p>
   </li>
   <li>
    <p>
     <a href="/m05iot/m-paho.javascript-1.0.3/m-edl-v10.html">paho.javascript-1.0.3 / edl-v10</a>
    </p>
   </li>
   <li>
    <p>
     <a href="/m05iot/m-paho.javascript-1.0.3/m-epl-v10.html">paho.javascript-1.0.3 / epl-v10</a>
    </p>
   </li>
   <li>
    <p>
     <a href="/m05iot/m-paho.javascript-1.0.3/m-paho-mqtt-min-js.html">paho.javascript-1.0.3 / paho-mqtt-min.js</a>
    </p>
   </li>
   <li>
    <p>
     <a href="/m05iot/m-paho.javascript-1.0.3/m-paho-mqtt-js.html" class="actual">paho.javascript-1.0.3 / paho-mqtt.js</a>
    </p>
   </li>
   </ol>
   
    <p>
     <a class="paginaSiguiente" href="/m05iot/m--htaccess.html"
       title="H. .htaccess"><span
       class="material-symbols-outlined">
        arrow_downward
       </span></a>
    </p>
 
</nav>
 <script>
 registraServiceWorker("/sw.js")
 const LOCAL_STORAGE_MENU = "menu"
 const MENU = "menu"
 const XMENU = "xmenu"
 const SCROLL = "scroll"
 const nav = document.querySelector("#nav")
 const abre = document.querySelector("#abre")

 /**@type {string} */
 let urlAnterior = "/m05iot/m-paho.javascript-1.0.3/m-paho-mqtt-min-js.html"
 /**@type {string} */
 let urlSiguiente = "/m05iot/m--htaccess.html"
 /**@type {number|null} */
 let iniciaX = null
 /**@type {number|null} */
 let iniciaY = null
 /** @type {number} */
 let posY = 0
 /** @type {number} */
 let dy = 0
 /** @type {boolean} */
 let scrolling = false

 document.addEventListener("keydown", teclas)
 document.addEventListener("touchstart", iniciaTouch)
 document.addEventListener("touchmove", desplazaTouch)
 addEventListener("scroll", onScroll)
 if (abre) {
  abre.addEventListener("click", cambiaMenu)
 }
 const cambian = Array.from(document.querySelectorAll(".cambiaMenu"))
 for (const c of cambian) {
  c.addEventListener("click", cambiaMenu)
 }
 const menu = localStorage.getItem(LOCAL_STORAGE_MENU)
 if (menu) {
  if (menu === MENU) {
   document.body.classList.remove(XMENU)
   document.body.classList.add(MENU)
  } else {
   document.body.classList.remove(MENU)
   document.body.classList.add(XMENU)
  }
 }

 function registraServiceWorker(url) {
  if (navigator.serviceWorker) {
   navigator.serviceWorker.register(url).
    then(registro => {
     console.log("Service Worker registrado.")
     console.log(registro)
    }).
    catch(muestraError)
  }
 }

 function muestraError(e) {
  console.error(e)
  alert(e.message)
 }

 async function copyToClipboard(button) {
  try {
   const table = button.closest("table")
   if (table !== null) {
    const lineas = Array.from(table.querySelectorAll("td:nth-child(2)"))
    const codigo = lineas
     .map(linea => linea.textContent || "")
     .join("\n")
    if (codigo) {
     await navigator.clipboard.writeText(codigo)
     alert("Texto copiado al portapapeles.")
    }
   }
  } catch (e) {
   alert(e.message)
  }
 }

 function cambiaMenu() {
  document.body.classList.toggle(XMENU)
  document.body.classList.toggle(MENU)
  if (document.body.classList.contains(MENU)) {
   localStorage.setItem(LOCAL_STORAGE_MENU, MENU)
  } else {
   localStorage.setItem(LOCAL_STORAGE_MENU, XMENU)
  }
 }

 /** @param {KeyboardEvent} ev*/
 function teclas(ev) {
  switch (ev.key) {
   case "ArrowLeft":
    retrocede()
    break
   case "ArrowRight":
    avanza()
    break
  }
 }

 function retrocede() {
  if (urlAnterior) {
   location.href = urlAnterior
  }
 }

 function avanza() {
  if (urlSiguiente) {
   location.href = urlSiguiente
  }
 }

 /** @param {TouchEvent} ev*/
 function iniciaTouch(ev) {
  const toqueInicial = ev.touches[0]
  iniciaX = toqueInicial.clientX
  iniciaY = toqueInicial.clientY
 }

 /** @param {TouchEvent} ev*/
 function desplazaTouch(ev) {
  if (iniciaX && iniciaY) {
   const desplazamiento = ev.touches[0]
   var desplazamientoX = desplazamiento.clientX
   var desplazamientoY = desplazamiento.clientY
   var difX = desplazamientoX - iniciaX
   var difY = desplazamientoY - iniciaY
   // Checa que el movimiento no sea muy corto.
   if (Math.abs(difX) + Math.abs(difY) > 90) {
    if (Math.abs(difX) > Math.abs(difY)) {
     if (difX > 70) {
      retrocede()
     } else {
      avanza()
     }
     // Reinicia valores.
     iniciaX = null
     iniciaY = null
    }
   }
  }
 }

 function onScroll() {
  dy = scrollY - posY
  posY = scrollY
  if (!scrolling) {
   requestAnimationFrame(avanzaScroll)
  }
  scrolling = true
 }

 function avanzaScroll() {
  if (posY === 0) {
   document.body.classList.remove(SCROLL)
  } else if (dy < 0) {
   document.body.classList.remove(SCROLL)
  } else if (dy > 0) {
   document.body.classList.add(SCROLL)
  }
  scrolling = false
 }

</script>
</body>

</html>