<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no">
    <script type="module" src="cmp/base.js"></script>
    <script type="module" src="cmp/mi-presentacion.js"></script>
    <link rel="stylesheet" href="css/estilos.css">
    <link rel="stylesheet" href="css/presentacion.css">
    <script type="module">
      import { SelDiapositivaBase } from "./lib/SelDiapositivaBase.js";
      customElements.define("mi-selector", class extends SelDiapositivaBase {
        /** @override
         * @returns {string} */
        get html() {
          return (/* html */
            `<select>
              <option value=intro>Dispositivo Implementado</option>
              <option value=Archivos>Archivos</option>
              <option value=util>util.hpp</option>
              <option value=ResInt>ResInt</option>
              <option value=utilIoT>utilIoT</option>
              <option value=DaoEntradaDispositivo>DaoEntradaDispositivo</option>
              <option value=DaoHistorialDispositivo>DaoHistorialDispositivo</option>
              <option value=DaoSalidaDispositivo>DaoSalidaDispositivo</option>
              <option value=CtrlDispositivo>CtrlDispositivo</option>
              <option value=FabricaDispositivo>FabricaDispositivo</option>
              <option value=Dispositivo>Dispositivo.ino</option>
            </select>`);
        }
      });
    </script>
  </head>
  <body>
    <div class="cortina"></div>
    <mi-menu></mi-menu>
    <mi-presentacion class="desplaza">
      <mi-selector slot=selector></mi-selector>
      <div id=intro slot=diapositiva>
        <div class="cortina"></div>
        <header></header>
        <h1></h1>
        <div class="marco-lectura">
          <p>
            Implementación del Dispositivo IoT con ESP8266 de acuerdo al diseño
            de la <a href="23_IoT.html">presentación sobre IoT</a>.
          </p>
          <p>
            Es más fácil si creas una carpeta llamada <q>Dispositivo</q>, la
            abres con Visual Studio Code y ahí creas los archivos y el código.
            Debes tener instalado la extensión <q>C/C++</q> que te  sugiere vscode.
            No hagas caso de los errores que te marque. Cuando hayas terminado,
            abre el archivo <q>Dispositivo.ino</q> dándole doble clic y compila
            desde Arduino IDE para encontrar los errores.
          </p>
          <p>
            <a href="https://github.com/gilpgiot/Dispositivo"
              target="_blank"">Revisa el código en GitHub.</a>
          </p>
        </div>
      </div>
      <section id=Archivos slot=diapositiva>
        <div class="cortina"></div>
        <header></header>
        <h2></h2>
        <div class="marco-lectura">
          <ul>
            <li><p><a href=#util>util.hpp</a></li>
            <li><p><a href=#ResInt>ResInt.hpp</a></li>
            <li><p><a href=#ResInt>ResInt.cpp</a></li>
            <li><p><a href=#utilIoT>utilIoT.hpp</a></li>
            <li><p><a href=#utilIoT>utilIoT.cpp</a></li>
            <li><p><a href=#DaoEntradaDispositivo>DaoEntradaDispositivo.hpp</a></li>
            <li><p><a href=#DaoEntradaDispositivo>DaoEntradaDispositivo.cpp</a></li>
            <li><p><a href=#DaoHistorialDispositivo>DaoHistorialDispositivo.hpp</a></li>
            <li><p><a href=#DaoHistorialDispositivo>DaoHistorialDispositivo.cpp</a></li>
            <li><p><a href=#DaoSalidaDispositivo>DaoSalidaDispositivo.hpp</a></li>
            <li><p><a href=#DaoSalidaDispositivo>DaoSalidaDispositivo.cpp</a></li>
            <li><p><a href=#CtrlDispositivo>CtrlDispositivo.hpp</a></li>
            <li><p><a href=#CtrlDispositivo>CtrlDispositivo.cpp</a></li>
            <li><p><a href=#FabricaDispositivo>FabricaDispositivo.hpp</a></li>
            <li><p><a href=#FabricaDispositivo>FabricaDispositivo.cpp</a></li>
            <li><p><a href=#Dispositivo>Dispositivo.ino</a></li>
          </ul>
        </div>
      </section>
      <section id=util slot=diapositiva>
        <div class="cortina"></div>
        <header></header>
        <h2></h2>
        <table>
          <tr>
            <td class=nums data-total="6"></td>
            <td class=cod><div><div><span style="color: #af00db;">#ifndef</span><span style="color: #0000ff;">&nbsp;_UTIL_H_</span></div><div><span style="color: #af00db;">#define</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #0000ff;">_UTIL_H_</span></div><div><span style="color: #af00db;">#define</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #0000ff;">CONTENT_TYPE</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"Content-Type"</span></div><div><span style="color: #af00db;">#define</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #0000ff;">APPLICATION_JSON</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"application/json"</span></div><div><span style="color: #af00db;">#define</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #0000ff;">NO_ENCONTRADO</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"No&nbsp;encontrado."</span></div><div><span style="color: #af00db;">#endif</span></div></div></td>
          </tr>
        </table>
      </section>
      <section id=ResInt slot=diapositiva>
        <div class="cortina"></div>
        <header></header>
        <h2></h2>
        <div class="marco-lectura">
          <p>
            Se utiliza para devolver un valor o un error, pues no usaremos
            excepciones.
          </p>
        </div>
        <h3>ResInt.hpp</h3>
        <table>
          <tr>
            <td class=nums data-total="15"></td>
            <td class=cod><div><div><span style="color: #af00db;">#ifndef</span><span style="color: #0000ff;">&nbsp;_INFO_VALOR_H_</span></div><div><span style="color: #af00db;">#define</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #0000ff;">_INFO_VALOR_H_</span></div><br><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;Arduino.h&gt;</span></div><br><div><span style="color: #0000ff;">class</span>&nbsp;<span style="color: #267f99;">ResInt</span>&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #0000ff;">public:</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">int</span>&nbsp;<span style="color: #001080;">valor</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;String&nbsp;<span style="color: #001080;">error</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #795e26;">ResInt</span>(<span style="color: #0000ff;">int</span>&nbsp;<span style="color: #001080;">_valor</span>,&nbsp;<span style="color: #267f99;">String</span>&nbsp;<span style="color: #001080;">_error</span>&nbsp;);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #795e26;">ResInt</span>(<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #267f99;">ResInt</span><span style="color: #0000ff;">&amp;</span>&nbsp;<span style="color: #001080;">ref</span>&nbsp;);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #795e26;">valida</span>();</div><div>};</div><div><span style="color: #af00db;">#endif</span></div><br></div></td>
          </tr>
        </table>
        <h3>ResInt.cpp</h3>
        <table>
          <tr>
            <td class=nums data-total="11"></td>
            <td class=cod><div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"ResInt.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;Arduino.h&gt;</span></div><br><div><span style="color: #267f99;">ResInt</span>::<span style="color: #795e26;">ResInt</span>(<span style="color: #0000ff;">int</span>&nbsp;<span style="color: #001080;">_valor</span>,&nbsp;<span style="color: #267f99;">String</span>&nbsp;<span style="color: #001080;">_error</span>&nbsp;):</div><div>&nbsp;&nbsp;<span style="color: #001080;">valor</span>(<span style="color: #001080;">_valor</span>),</div><div>&nbsp;&nbsp;<span style="color: #001080;">error</span>(_error)&nbsp;{}</div><br><div><span style="color: #267f99;">ResInt</span>::<span style="color: #795e26;">ResInt</span>(<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #267f99;">ResInt</span><span style="color: #0000ff;">&amp;</span>&nbsp;<span style="color: #001080;">ref</span>&nbsp;):</div><div>&nbsp;&nbsp;<span style="color: #001080;">valor</span>(<span style="color: #001080;">ref</span>.<span style="color: #001080;">valor</span>),</div><div>&nbsp;&nbsp;<span style="color: #001080;">error</span>(<span style="color: #001080;">ref</span>.<span style="color: #001080;">error</span>)&nbsp;{}</div><br></div></td>
          </tr>
        </table>
      </section>
      <section id=utilIoT slot=diapositiva>
        <div class="cortina"></div>
        <header></header>
        <h2></h2>
        <h3>utilIoT.hpp</h3>
        <table>
          <tr>
            <td class=nums data-total="11"></td>
            <td class=cod><div><div><span style="color: #af00db;">#ifndef</span><span style="color: #0000ff;">&nbsp;_UTILIOT_H_</span></div><div><span style="color: #af00db;">#define</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #0000ff;">_UTILIOT_H_</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;Arduino.h&gt;</span></div><br><div><span style="color: #0000ff;">void</span>&nbsp;<span style="color: #795e26;">conectaWiFi</span>(<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #001080;">ssid</span>,&nbsp;<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #001080;">pass</span>);</div><div><span style="color: #0000ff;">void</span>&nbsp;<span style="color: #795e26;">iniciaTimestamp</span>();</div><div><span style="color: #0000ff;">void</span>&nbsp;<span style="color: #795e26;">getTimestamp</span>(<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #001080;">ts</span>);</div><div><span style="color: #267f99;">String</span>&nbsp;<span style="color: #795e26;">urlDeColeccion</span>(<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #001080;">proyecto</span>,&nbsp;<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #001080;">coleccion</span>);</div><div><span style="color: #267f99;">String</span>&nbsp;<span style="color: #795e26;">urlDeDocumento</span>(<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #001080;">proyecto</span>,&nbsp;<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #001080;">coleccion</span>,&nbsp;<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #001080;">id</span>);</div><div><span style="color: #af00db;">#endif</span></div><br></div></td>
          </tr>
        </table>
        <h3>utilIoT.cpp</h3>
        <table>
          <tr>
            <td class=nums data-total="47"></td>
            <td class=cod><div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"utilIoT.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;ESP8266WiFi.h&gt;</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;ESP8266WiFiMulti.h&gt;</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;TimeLib.h&gt;</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;NTPClient.h&gt;</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;WiFiUdp.h&gt;</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;Arduino.h&gt;</span></div><br><div>ESP8266WiFiMulti&nbsp;<span style="color: #001080;">WiFiMulti</span>;</div><div>WiFiUDP&nbsp;<span style="color: #001080;">ntpUDP</span>;</div><div><span style="color: #267f99;">NTPClient</span>&nbsp;<span style="color: #001080;">timeClient</span>(<span style="color: #267f99;">ntpUDP</span>);</div><br><div><span style="color: #0000ff;">void</span>&nbsp;<span style="color: #795e26;">conectaWiFi</span>(<span style="color: #0000ff;">char</span>&nbsp;<span style="color: #0000ff;">*</span><span style="color: #001080;">ssid</span>,&nbsp;<span style="color: #0000ff;">char</span>&nbsp;<span style="color: #0000ff;">*</span><span style="color: #001080;">pass</span>)&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #001080;">Serial</span>.<span style="color: #795e26;">println</span>(<span style="color: #a31515;">"Conectando&nbsp;a&nbsp;WiFi..."</span>);</div><div>&nbsp;&nbsp;<span style="color: #001080;">WiFi</span>.<span style="color: #795e26;">mode</span>(WIFI_STA);</div><div>&nbsp;&nbsp;<span style="color: #001080;">WiFiMulti</span>.<span style="color: #795e26;">addAP</span>(<span style="color: #001080;">ssid</span>,&nbsp;<span style="color: #001080;">pass</span>);</div><div>&nbsp;&nbsp;<span style="color: #af00db;">while</span>&nbsp;((<span style="color: #001080;">WiFiMulti</span>.<span style="color: #795e26;">run</span>()&nbsp;!=&nbsp;WL_CONNECTED))&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #795e26;">delay</span>&nbsp;(&nbsp;<span style="color: #098658;">500</span>&nbsp;);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">Serial</span>.<span style="color: #795e26;">print</span>&nbsp;(&nbsp;<span style="color: #a31515;">"."</span>&nbsp;);</div><div>&nbsp;&nbsp;}</div><div>&nbsp;&nbsp;<span style="color: #001080;">Serial</span>.<span style="color: #795e26;">println</span>(<span style="color: #a31515;">"WiFi&nbsp;connectado."</span>);</div><div>&nbsp;&nbsp;<span style="color: #001080;">timeClient</span>.<span style="color: #795e26;">begin</span>();</div><div>&nbsp;&nbsp;<span style="color: #795e26;">delay</span>&nbsp;(&nbsp;<span style="color: #098658;">500</span>&nbsp;);</div><div>}</div><br><div><span style="color: #0000ff;">void</span>&nbsp;<span style="color: #795e26;">iniciaTimestamp</span>()&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #001080;">timeClient</span>.<span style="color: #795e26;">begin</span>();</div><div>}</div><br><div><span style="color: #0000ff;">void</span>&nbsp;<span style="color: #795e26;">getTimestamp</span>(<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #001080;">ts</span>)&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #001080;">timeClient</span>.<span style="color: #795e26;">update</span>();</div><div>&nbsp;&nbsp;<span style="color: #0000ff;">unsigned</span>&nbsp;<span style="color: #0000ff;">long</span>&nbsp;<span style="color: #001080;">t</span>&nbsp;=&nbsp;<span style="color: #001080;">timeClient</span>.<span style="color: #795e26;">getEpochTime</span>();</div><div>&nbsp;&nbsp;<span style="color: #795e26;">sprintf</span>(<span style="color: #001080;">ts</span>,&nbsp;<span style="color: #a31515;">"%02d-%02d-%02dT%02d:%02d:%02d.00Z"</span>,&nbsp;<span style="color: #795e26;">year</span>(<span style="color: #001080;">t</span>),&nbsp;<span style="color: #795e26;">month</span>(<span style="color: #001080;">t</span>),&nbsp;<span style="color: #795e26;">day</span>(<span style="color: #001080;">t</span>),</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #795e26;">hour</span>(<span style="color: #001080;">t</span>),&nbsp;<span style="color: #795e26;">minute</span>(<span style="color: #001080;">t</span>),&nbsp;<span style="color: #795e26;">second</span>(<span style="color: #001080;">t</span>));</div><div>}</div><br><div><span style="color: #267f99;">String</span>&nbsp;<span style="color: #795e26;">urlDeColeccion</span>(<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #001080;">proyecto</span>,&nbsp;<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #001080;">coleccion</span>)&nbsp;{</div><div>&nbsp;&nbsp;String&nbsp;<span style="color: #001080;">url</span>(<span style="color: #a31515;">"https://firestore.googleapis.com/v1/projects/"</span>);</div><div>&nbsp;&nbsp;<span style="color: #001080;">url</span>&nbsp;+=&nbsp;<span style="color: #001080;">proyecto</span>;</div><div>&nbsp;&nbsp;<span style="color: #001080;">url</span>&nbsp;+=&nbsp;<span style="color: #a31515;">"/databases/(default)/documents/"</span>;</div><div>&nbsp;&nbsp;<span style="color: #001080;">url</span>&nbsp;+=&nbsp;<span style="color: #001080;">coleccion</span>;</div><div>&nbsp;&nbsp;<span style="color: #af00db;">return</span>&nbsp;<span style="color: #001080;">url</span>;</div><div>}</div><br><div><span style="color: #267f99;">String</span>&nbsp;<span style="color: #795e26;">urlDeDocumento</span>(<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #001080;">proyecto</span>,&nbsp;<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #001080;">coleccion</span>,&nbsp;<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #001080;">id</span>)&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #af00db;">return</span>&nbsp;<span style="color: #795e26;">urlDeColeccion</span>(<span style="color: #001080;">proyecto</span>,&nbsp;<span style="color: #001080;">coleccion</span>)&nbsp;+&nbsp;<span style="color: #a31515;">"/"</span>&nbsp;+&nbsp;<span style="color: #001080;">id</span>;</div><div>}</div></div></td>
          </tr>
        </table>
      </section>
      <section id=DaoEntradaDispositivo slot=diapositiva>
        <div class="cortina"></div>
        <header></header>
        <h2></h2>
        <h3>DaoEntradaDispositivo.hpp</h3>
        <table>
          <tr>
            <td class=nums data-total="15"></td>
            <td class=cod><div><div><span style="color: #af00db;">#ifndef</span><span style="color: #0000ff;">&nbsp;_DAO_ENTRADA_DISPOSITIVO_H_</span></div><div><span style="color: #af00db;">#define</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #0000ff;">_DAO_ENTRADA_DISPOSITIVO_H_</span></div><br><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;Arduino.h&gt;</span></div><br><div><span style="color: #0000ff;">class</span>&nbsp;<span style="color: #267f99;">DaoEntradaDispositivo</span>&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #0000ff;">private:</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">char</span>&nbsp;*&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #001080;">_huellaDigital</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;String&nbsp;<span style="color: #001080;">_url</span>;</div><div>&nbsp;&nbsp;<span style="color: #0000ff;">public:</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #795e26;">DaoEntradaDispositivo</span>(<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">char</span>&nbsp;<span style="color: #0000ff;">*</span>&nbsp;<span style="color: #001080;">huellaDigital</span>,&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #267f99;">String</span>&nbsp;<span style="color: #001080;">url</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #267f99;">String</span>&nbsp;<span style="color: #795e26;">modifica</span>(<span style="color: #0000ff;">int</span>&nbsp;<span style="color: #001080;">valor</span>);</div><div>};</div><div><span style="color: #af00db;">#endif</span></div><br></div></td>
          </tr>
        </table>
        <h3>DaoEntradaDispositivo.cpp</h3>
        <table>
          <tr>
            <td class=nums data-total="49"></td>
            <td class=cod><div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"DaoEntradaDispositivo.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;WiFiClientSecureBearSSL.h&gt;</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;ESP8266HTTPClient.h&gt;</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"util.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;ArduinoJson.h&gt;</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;Arduino.h&gt;</span></div><br><div><span style="color: #267f99;">DaoEntradaDispositivo</span>::<span style="color: #795e26;">DaoEntradaDispositivo</span>(<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #001080;">huellaDigital</span>,</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #267f99;">String</span>&nbsp;<span style="color: #001080;">url</span>):&nbsp;<span style="color: #001080;">_huellaDigital</span>(<span style="color: #001080;">huellaDigital</span>),&nbsp;<span style="color: #001080;">_url</span>(url)&nbsp;{&nbsp;}</div><br><div><span style="color: #267f99;">String</span>&nbsp;<span style="color: #267f99;">DaoEntradaDispositivo</span>::<span style="color: #795e26;">modifica</span>(<span style="color: #0000ff;">int</span>&nbsp;<span style="color: #001080;">valor</span>)&nbsp;{</div><div>&nbsp;&nbsp;String&nbsp;<span style="color: #001080;">error</span>;</div><div>&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #267f99;">size_t</span>&nbsp;<span style="color: #001080;">capacity</span>&nbsp;=&nbsp;<span style="color: #098658;">3</span>&nbsp;*&nbsp;<span style="color: #795e26;">JSON_OBJECT_SIZE</span>(<span style="color: #098658;">1</span>);</div><div>&nbsp;&nbsp;DynamicJsonDocument&nbsp;<span style="color: #001080;">doc</span>(<span style="color: #001080;">capacity</span>);</div><br><div>&nbsp;&nbsp;JsonObject&nbsp;<span style="color: #001080;">fields</span>&nbsp;=&nbsp;<span style="color: #001080;">doc</span>.<span style="color: #795e26;">createNestedObject</span>(<span style="color: #a31515;">"fields"</span>);</div><div>&nbsp;&nbsp;JsonObject&nbsp;<span style="color: #001080;">fields_VALOR</span>&nbsp;=&nbsp;<span style="color: #001080;">fields</span>.<span style="color: #795e26;">createNestedObject</span>(<span style="color: #a31515;">"VALOR"</span>);</div><div>&nbsp;&nbsp;<span style="color: #001080;">fields_VALOR</span>[<span style="color: #a31515;">"integerValue"</span>]&nbsp;=&nbsp;<span style="color: #001080;">valor</span>;</div><br><div>&nbsp;&nbsp;String&nbsp;<span style="color: #001080;">json</span>;</div><div>&nbsp;&nbsp;<span style="color: #795e26;">serializeJson</span>(<span style="color: #001080;">doc</span>,&nbsp;<span style="color: #001080;">json</span>);</div><br><div>&nbsp;&nbsp;<span style="color: #267f99;">std</span>::unique_ptr&lt;<span style="color: #267f99;">BearSSL</span>::WiFiClientSecure&gt;&nbsp;<span style="color: #795e26;">client</span>(</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #af00db;">new</span>&nbsp;<span style="color: #267f99;">BearSSL</span>::WiFiClientSecure);</div><div>&nbsp;&nbsp;<span style="color: #001080;">client</span>-&gt;<span style="color: #795e26;">setFingerprint</span>(<span style="color: #001080;">_huellaDigital</span>);</div><br><div>&nbsp;&nbsp;HTTPClient&nbsp;<span style="color: #001080;">https</span>;</div><div>&nbsp;&nbsp;<span style="color: #001080;">Serial</span>.<span style="color: #795e26;">println</span>(<span style="color: #a31515;">"Conectando&nbsp;al&nbsp;servidor..."</span>);</div><div>&nbsp;&nbsp;<span style="color: #af00db;">if</span>&nbsp;(<span style="color: #001080;">https</span>.<span style="color: #795e26;">begin</span>(*client,&nbsp;<span style="color: #001080;">_url</span>))&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">https</span>.<span style="color: #795e26;">addHeader</span>(<span style="color: #0000ff;">CONTENT_TYPE</span>,&nbsp;<span style="color: #0000ff;">APPLICATION_JSON</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">Serial</span>.<span style="color: #795e26;">print</span>(<span style="color: #a31515;">"Inicia&nbsp;PATCH...</span><span style="color: #ee0000;">\n</span><span style="color: #a31515;">"</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">int</span>&nbsp;<span style="color: #001080;">codigoHttps</span>&nbsp;=&nbsp;<span style="color: #001080;">https</span>.<span style="color: #795e26;">PATCH</span>(<span style="color: #001080;">json</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #af00db;">if</span>&nbsp;(<span style="color: #001080;">codigoHttps</span>&nbsp;&gt;&nbsp;<span style="color: #098658;">0</span>)&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;<span style="color: #001080;">texto</span>&nbsp;=&nbsp;<span style="color: #001080;">https</span>.<span style="color: #795e26;">getString</span>();</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">Serial</span>.<span style="color: #795e26;">printf</span>(<span style="color: #a31515;">"PATCH&nbsp;OK.&nbsp;codigoHttps:&nbsp;%d</span><span style="color: #ee0000;">\n</span><span style="color: #a31515;">"</span>,&nbsp;<span style="color: #001080;">codigoHttps</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">Serial</span>.<span style="color: #795e26;">println</span>(<span style="color: #001080;">texto</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #af00db;">if</span>&nbsp;(<span style="color: #001080;">codigoHttps</span>&nbsp;!=&nbsp;HTTP_CODE_OK</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;<span style="color: #001080;">codigoHttps</span>&nbsp;!=&nbsp;HTTP_CODE_MOVED_PERMANENTLY)&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">error</span>&nbsp;=&nbsp;<span style="color: #001080;">texto</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div><div>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #af00db;">else</span>&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">error</span>&nbsp;=&nbsp;<span style="color: #001080;">https</span>.<span style="color: #795e26;">errorToString</span>(<span style="color: #001080;">codigoHttps</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;}</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">https</span>.<span style="color: #795e26;">end</span>();</div><div>&nbsp;&nbsp;}&nbsp;<span style="color: #af00db;">else</span>&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">error</span>&nbsp;=&nbsp;<span style="color: #a31515;">"La&nbsp;conexión&nbsp;falló"</span>;</div><div>&nbsp;&nbsp;}</div><div>&nbsp;&nbsp;<span style="color: #af00db;">return</span>&nbsp;<span style="color: #001080;">error</span>;</div><div>}</div></div></td>
          </tr>
        </table>
      </section>
      <section id=DaoHistorialDispositivo slot=diapositiva>
        <div class="cortina"></div>
        <header></header>
        <h2></h2>
        <h3>DaoHistorialDispositivo.hpp</h3>
        <table>
          <tr>
            <td class=nums data-total="17"></td>
            <td class=cod><div><div><span style="color: #af00db;">#ifndef</span><span style="color: #0000ff;">&nbsp;_DAO_HISTORIAL_DISPOSITIVO_H_</span></div><div><span style="color: #af00db;">#define</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #0000ff;">_DAO_HISTORIAL_DISPOSITIVO_H_</span></div><br><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;Arduino.h&gt;</span></div><br><div><span style="color: #0000ff;">class</span>&nbsp;<span style="color: #267f99;">DaoHistorialDispositivo</span>&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #0000ff;">private:</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">char</span>&nbsp;*&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #001080;">_idDisp</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">char</span>&nbsp;*&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #001080;">_huellaDigital</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;String&nbsp;<span style="color: #001080;">_url</span>;</div><div>&nbsp;&nbsp;<span style="color: #0000ff;">public:</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #795e26;">DaoHistorialDispositivo</span>(<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">char</span>&nbsp;<span style="color: #0000ff;">*</span>&nbsp;<span style="color: #001080;">idDisp</span>,&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">char</span>&nbsp;<span style="color: #0000ff;">*</span>&nbsp;<span style="color: #001080;">huellaDigital</span>,</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #267f99;">String</span>&nbsp;<span style="color: #001080;">url</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #267f99;">String</span>&nbsp;<span style="color: #795e26;">agrega</span>(<span style="color: #0000ff;">int</span>&nbsp;<span style="color: #001080;">valor</span>);</div><div>};</div><div><span style="color: #af00db;">#endif</span></div><br></div></td>
          </tr>
        </table>
        <h3>DaoHistorialDispositivo.cpp</h3>
        <table>
          <tr>
            <td class=nums data-total="64"></td>
            <td class=cod><div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"DaoHistorialDispositivo.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;WiFiClientSecureBearSSL.h&gt;</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;ESP8266HTTPClient.h&gt;</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"util.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"utilIoT.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;ArduinoJson.h&gt;</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;Arduino.h&gt;</span></div><br><div><span style="color: #267f99;">DaoHistorialDispositivo</span>::<span style="color: #795e26;">DaoHistorialDispositivo</span>(<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">char</span>&nbsp;<span style="color: #0000ff;">*</span>&nbsp;<span style="color: #001080;">idDisp</span>,</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">char</span>&nbsp;<span style="color: #0000ff;">*</span>&nbsp;<span style="color: #001080;">huellaDigital</span>,&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #267f99;">String</span>&nbsp;<span style="color: #001080;">url</span>):</div><div>&nbsp;&nbsp;<span style="color: #001080;">_idDisp</span>(<span style="color: #001080;">idDisp</span>),&nbsp;<span style="color: #001080;">_huellaDigital</span>(<span style="color: #001080;">huellaDigital</span>),&nbsp;<span style="color: #001080;">_url</span>(url)&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #795e26;">iniciaTimestamp</span>();</div><div>}</div><br><div><span style="color: #267f99;">String</span>&nbsp;<span style="color: #267f99;">DaoHistorialDispositivo</span>::<span style="color: #795e26;">agrega</span>(<span style="color: #0000ff;">int</span>&nbsp;<span style="color: #001080;">valor</span>)&nbsp;{</div><div>&nbsp;&nbsp;String&nbsp;<span style="color: #001080;">error</span>;</div><br><div>&nbsp;&nbsp;<span style="color: #0000ff;">char</span>&nbsp;<span style="color: #001080;">ts</span>[<span style="color: #098658;">30</span>];</div><div>&nbsp;&nbsp;<span style="color: #795e26;">getTimestamp</span>(<span style="color: #001080;">ts</span>);</div><div>&nbsp;&nbsp;<span style="color: #001080;">Serial</span>.<span style="color: #795e26;">println</span>(<span style="color: #001080;">ts</span>);</div><br><div><span style="color: #008000;">&nbsp;&nbsp;/*&nbsp;Al&nbsp;cálculo&nbsp;del&nbsp;tamaño&nbsp;le&nbsp;añadimos&nbsp;30,&nbsp;que&nbsp;es&nbsp;el&nbsp;tamaño&nbsp;del&nbsp;buffer&nbsp;para</span></div><div><span style="color: #008000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;el&nbsp;timestap.&nbsp;*/</span></div><div>&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #267f99;">size_t</span>&nbsp;<span style="color: #001080;">capacity</span>&nbsp;=&nbsp;<span style="color: #098658;">4</span>&nbsp;*&nbsp;<span style="color: #795e26;">JSON_OBJECT_SIZE</span>(<span style="color: #098658;">1</span>)&nbsp;+&nbsp;<span style="color: #795e26;">JSON_OBJECT_SIZE</span>(<span style="color: #098658;">3</span>)&nbsp;+&nbsp;<span style="color: #098658;">30</span>;</div><div>&nbsp;&nbsp;DynamicJsonDocument&nbsp;<span style="color: #001080;">doc</span>(<span style="color: #001080;">capacity</span>);</div><br><div>&nbsp;&nbsp;JsonObject&nbsp;<span style="color: #001080;">fields</span>&nbsp;=&nbsp;<span style="color: #001080;">doc</span>.<span style="color: #795e26;">createNestedObject</span>(<span style="color: #a31515;">"fields"</span>);</div><div>&nbsp;&nbsp;JsonObject&nbsp;<span style="color: #001080;">fields_DISP_ID</span>&nbsp;=&nbsp;<span style="color: #001080;">fields</span>.<span style="color: #795e26;">createNestedObject</span>(<span style="color: #a31515;">"DISP_ID"</span>);</div><div>&nbsp;&nbsp;<span style="color: #001080;">fields_DISP_ID</span>[<span style="color: #a31515;">"stringValue"</span>]&nbsp;=&nbsp;<span style="color: #001080;">_idDisp</span>;</div><div>&nbsp;&nbsp;JsonObject&nbsp;<span style="color: #001080;">fields_VALOR</span>&nbsp;=&nbsp;<span style="color: #001080;">fields</span>.<span style="color: #795e26;">createNestedObject</span>(<span style="color: #a31515;">"VALOR"</span>);</div><div>&nbsp;&nbsp;<span style="color: #001080;">fields_VALOR</span>[<span style="color: #a31515;">"integerValue"</span>]&nbsp;=&nbsp;<span style="color: #001080;">valor</span>;</div><div>&nbsp;&nbsp;JsonObject&nbsp;<span style="color: #001080;">fields_HIST_TS</span>&nbsp;=&nbsp;<span style="color: #001080;">fields</span>.<span style="color: #795e26;">createNestedObject</span>(<span style="color: #a31515;">"HIST_TS"</span>);</div><div>&nbsp;&nbsp;<span style="color: #001080;">fields_HIST_TS</span>[<span style="color: #a31515;">"timestampValue"</span>]&nbsp;=&nbsp;<span style="color: #001080;">ts</span>;</div><br><div>&nbsp;&nbsp;String&nbsp;<span style="color: #001080;">json</span>;</div><div>&nbsp;&nbsp;<span style="color: #795e26;">serializeJson</span>(<span style="color: #001080;">doc</span>,&nbsp;<span style="color: #001080;">json</span>);</div><br><div>&nbsp;&nbsp;<span style="color: #267f99;">std</span>::unique_ptr&lt;<span style="color: #267f99;">BearSSL</span>::WiFiClientSecure&gt;&nbsp;<span style="color: #795e26;">client</span>(</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #af00db;">new</span>&nbsp;<span style="color: #267f99;">BearSSL</span>::WiFiClientSecure);</div><div>&nbsp;&nbsp;<span style="color: #001080;">client</span>-&gt;<span style="color: #795e26;">setFingerprint</span>(<span style="color: #001080;">_huellaDigital</span>);</div><br><div>&nbsp;&nbsp;HTTPClient&nbsp;<span style="color: #001080;">https</span>;</div><div>&nbsp;&nbsp;<span style="color: #001080;">Serial</span>.<span style="color: #795e26;">println</span>(<span style="color: #a31515;">"Conectando&nbsp;al&nbsp;servidor..."</span>);</div><div>&nbsp;&nbsp;<span style="color: #af00db;">if</span>&nbsp;(<span style="color: #001080;">https</span>.<span style="color: #795e26;">begin</span>(*client,&nbsp;<span style="color: #001080;">_url</span>))&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #001080;">https</span>.<span style="color: #795e26;">addHeader</span>(<span style="color: #0000ff;">CONTENT_TYPE</span>,&nbsp;<span style="color: #0000ff;">APPLICATION_JSON</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">Serial</span>.<span style="color: #795e26;">print</span>(<span style="color: #a31515;">"Inicia&nbsp;POST...</span><span style="color: #ee0000;">\n</span><span style="color: #a31515;">"</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">int</span>&nbsp;<span style="color: #001080;">codigoHttps</span>&nbsp;=&nbsp;<span style="color: #001080;">https</span>.<span style="color: #795e26;">POST</span>(<span style="color: #001080;">json</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #af00db;">if</span>&nbsp;(<span style="color: #001080;">codigoHttps</span>&nbsp;&gt;&nbsp;<span style="color: #098658;">0</span>)&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;<span style="color: #001080;">texto</span>&nbsp;=&nbsp;<span style="color: #001080;">https</span>.<span style="color: #795e26;">getString</span>();</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">Serial</span>.<span style="color: #795e26;">printf</span>(<span style="color: #a31515;">"POST&nbsp;OK.&nbsp;codigoHttps:&nbsp;%d</span><span style="color: #ee0000;">\n</span><span style="color: #a31515;">"</span>,&nbsp;<span style="color: #001080;">codigoHttps</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">Serial</span>.<span style="color: #795e26;">println</span>(<span style="color: #001080;">texto</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #af00db;">if</span>&nbsp;(<span style="color: #001080;">codigoHttps</span>&nbsp;!=&nbsp;HTTP_CODE_OK</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;<span style="color: #001080;">codigoHttps</span>&nbsp;!=&nbsp;HTTP_CODE_MOVED_PERMANENTLY)&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">error</span>&nbsp;=&nbsp;<span style="color: #001080;">texto</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div><div>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #af00db;">else</span>&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">error</span>&nbsp;=&nbsp;<span style="color: #001080;">https</span>.<span style="color: #795e26;">errorToString</span>(<span style="color: #001080;">codigoHttps</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;}</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">https</span>.<span style="color: #795e26;">end</span>();</div><div>&nbsp;&nbsp;}&nbsp;<span style="color: #af00db;">else</span>&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">error</span>&nbsp;=&nbsp;<span style="color: #a31515;">"La&nbsp;conexión&nbsp;falló"</span>;</div><div>&nbsp;&nbsp;}</div><div>&nbsp;&nbsp;<span style="color: #af00db;">return</span>&nbsp;<span style="color: #001080;">error</span>;</div><div>}</div></div></td>
          </tr>
        </table>
      </section>
      <section id=DaoSalidaDispositivo slot=diapositiva>
        <div class="cortina"></div>
        <header></header>
        <h2></h2>
        <h3>DaoSalidaDispositivo.hpp</h3>
        <table>
          <tr>
            <td class=nums data-total="16"></td>
            <td class=cod><div><div><span style="color: #af00db;">#ifndef</span><span style="color: #0000ff;">&nbsp;_DAO_SALIDA_DISPOSITIVO_H_</span></div><div><span style="color: #af00db;">#define</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #0000ff;">_DAO_SALIDA_DISPOSITIVO_H_</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"ResInt.hpp"</span></div><br><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;Arduino.h&gt;</span></div><br><div><span style="color: #0000ff;">class</span>&nbsp;<span style="color: #267f99;">DaoSalidaDispositivo</span>&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #0000ff;">private:</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">char</span>&nbsp;*&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #001080;">_huellaDigital</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;String&nbsp;<span style="color: #001080;">_url</span>;</div><div>&nbsp;&nbsp;<span style="color: #0000ff;">public:</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #795e26;">DaoSalidaDispositivo</span>(<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">char</span>&nbsp;<span style="color: #0000ff;">*</span>&nbsp;<span style="color: #001080;">huellaDigital</span>,&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #267f99;">String</span>&nbsp;<span style="color: #001080;">url</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #267f99;">ResInt</span>&nbsp;<span style="color: #795e26;">busca</span>();</div><div>};</div><div><span style="color: #af00db;">#endif</span></div><br></div></td>
          </tr>
        </table>
        <h3>DaoSalidaDispositivo.cpp</h3>
        <table>
          <tr>
            <td class=nums data-total="52"></td>
            <td class=cod><div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"DaoSalidaDispositivo.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;WiFiClientSecureBearSSL.h&gt;</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;ESP8266HTTPClient.h&gt;</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"ResInt.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"util.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;ArduinoJson.h&gt;</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;Arduino.h&gt;</span></div><br><div><span style="color: #267f99;">DaoSalidaDispositivo</span>::<span style="color: #795e26;">DaoSalidaDispositivo</span>(<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #001080;">huellaDigital</span>,</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #267f99;">String</span>&nbsp;<span style="color: #001080;">url</span>):&nbsp;<span style="color: #001080;">_huellaDigital</span>(<span style="color: #001080;">huellaDigital</span>),&nbsp;<span style="color: #001080;">_url</span>(url)&nbsp;{&nbsp;}</div><br><div><span style="color: #267f99;">ResInt</span>&nbsp;<span style="color: #267f99;">DaoSalidaDispositivo</span>::<span style="color: #795e26;">busca</span>()&nbsp;{</div><div>&nbsp;&nbsp;String&nbsp;<span style="color: #001080;">error</span>;</div><div>&nbsp;&nbsp;<span style="color: #0000ff;">int</span>&nbsp;<span style="color: #001080;">valor</span>&nbsp;=&nbsp;<span style="color: #098658;">0</span>;</div><br><div>&nbsp;&nbsp;<span style="color: #267f99;">std</span>::unique_ptr&lt;<span style="color: #267f99;">BearSSL</span>::WiFiClientSecure&gt;&nbsp;<span style="color: #795e26;">client</span>(</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #af00db;">new</span>&nbsp;<span style="color: #267f99;">BearSSL</span>::WiFiClientSecure);</div><div>&nbsp;&nbsp;<span style="color: #001080;">client</span>-&gt;<span style="color: #795e26;">setFingerprint</span>(<span style="color: #001080;">_huellaDigital</span>);</div><br><div>&nbsp;&nbsp;HTTPClient&nbsp;<span style="color: #001080;">https</span>;</div><div>&nbsp;&nbsp;<span style="color: #001080;">Serial</span>.<span style="color: #795e26;">println</span>(<span style="color: #a31515;">"Conectando&nbsp;al&nbsp;servidor..."</span>);</div><div>&nbsp;&nbsp;<span style="color: #af00db;">if</span>&nbsp;(<span style="color: #001080;">https</span>.<span style="color: #795e26;">begin</span>(*client,&nbsp;<span style="color: #001080;">_url</span>))&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">Serial</span>.<span style="color: #795e26;">println</span>(<span style="color: #a31515;">"Inicia&nbsp;GET..."</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">int</span>&nbsp;<span style="color: #001080;">codigoHttps</span>&nbsp;=&nbsp;<span style="color: #001080;">https</span>.<span style="color: #795e26;">GET</span>();</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #af00db;">if</span>&nbsp;(<span style="color: #001080;">codigoHttps</span>&nbsp;&gt;&nbsp;<span style="color: #098658;">0</span>)&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;<span style="color: #001080;">texto</span>&nbsp;=&nbsp;<span style="color: #001080;">https</span>.<span style="color: #795e26;">getString</span>();</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">Serial</span>.<span style="color: #795e26;">printf</span>(<span style="color: #a31515;">"Get&nbsp;OK.&nbsp;codigoHttps:&nbsp;%d</span><span style="color: #ee0000;">\n</span><span style="color: #a31515;">"</span>,&nbsp;<span style="color: #001080;">codigoHttps</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #af00db;">if</span>&nbsp;(<span style="color: #001080;">codigoHttps</span>&nbsp;==&nbsp;HTTP_CODE_NOT_FOUND)&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">error</span>&nbsp;=&nbsp;<span style="color: #0000ff;">NO_ENCONTRADO</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #af00db;">else</span>&nbsp;<span style="color: #af00db;">if</span>&nbsp;(<span style="color: #001080;">codigoHttps</span>&nbsp;==&nbsp;HTTP_CODE_OK</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;<span style="color: #001080;">codigoHttps</span>&nbsp;==&nbsp;HTTP_CODE_MOVED_PERMANENTLY)&nbsp;{</div><div><span style="color: #008000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Este&nbsp;valor&nbsp;debe&nbsp;obtenerse&nbsp;con&nbsp;ArduinoJson&nbsp;Assistant</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #267f99;">size_t</span>&nbsp;<span style="color: #001080;">capacity</span>&nbsp;=</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #098658;">2</span>&nbsp;*&nbsp;<span style="color: #795e26;">JSON_OBJECT_SIZE</span>(<span style="color: #098658;">1</span>)&nbsp;+&nbsp;<span style="color: #795e26;">JSON_OBJECT_SIZE</span>(<span style="color: #098658;">4</span>)&nbsp;+&nbsp;<span style="color: #098658;">200</span>;</div><div><span style="color: #008000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Crea&nbsp;la&nbsp;estructura&nbsp;de&nbsp;dator&nbsp;para&nbsp;procesar&nbsp;JSON.</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DynamicJsonDocument&nbsp;<span style="color: #001080;">doc</span>(<span style="color: #001080;">capacity</span>);</div><div><span style="color: #008000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;A&nbsp;partir&nbsp;del&nbsp;texto&nbsp;devuelto&nbsp;por&nbsp;Internet,&nbsp;se&nbsp;obtiene&nbsp;el&nbsp;árbol&nbsp;JSON.</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #795e26;">deserializeJson</span>(<span style="color: #001080;">doc</span>,&nbsp;<span style="color: #001080;">texto</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">valor</span>&nbsp;=&nbsp;<span style="color: #001080;">doc</span>[<span style="color: #a31515;">"fields"</span>][<span style="color: #a31515;">"VALOR"</span>][<span style="color: #a31515;">"integerValue"</span>].<span style="color: #001080;">as</span>&lt;<span style="color: #0000ff;">int</span>&gt;();</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #af00db;">else</span>&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">error</span>&nbsp;=&nbsp;<span style="color: #001080;">texto</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div><div>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #af00db;">else</span>&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">error</span>&nbsp;=&nbsp;<span style="color: #001080;">https</span>.<span style="color: #795e26;">errorToString</span>(<span style="color: #001080;">codigoHttps</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;}</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">https</span>.<span style="color: #795e26;">end</span>();</div><div>&nbsp;&nbsp;}&nbsp;<span style="color: #af00db;">else</span>&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">error</span>&nbsp;=&nbsp;<span style="color: #a31515;">"La&nbsp;conexión&nbsp;falló"</span>;</div><div>&nbsp;&nbsp;}</div><div>&nbsp;&nbsp;<span style="color: #001080;">Serial</span>.<span style="color: #795e26;">printf</span>(<span style="color: #a31515;">"valor:&nbsp;%d</span><span style="color: #ee0000;">\n</span><span style="color: #a31515;">"</span>,&nbsp;<span style="color: #001080;">valor</span>);</div><div>&nbsp;&nbsp;<span style="color: #af00db;">return</span>&nbsp;<span style="color: #267f99;">ResInt</span>(<span style="color: #001080;">valor</span>,&nbsp;<span style="color: #001080;">error</span>);</div><div>}</div></div></td>
          </tr>
        </table>
      </section>
      <section id=CtrlDispositivo slot=diapositiva>
        <div class="cortina"></div>
        <header></header>
        <h2></h2>
        <h3>CtrlDispositivo.hpp</h3>
        <table>
          <tr>
            <td class=nums data-total="29"></td>
            <td class=cod><div><div><span style="color: #af00db;">#ifndef</span><span style="color: #0000ff;">&nbsp;_CTRL_DISPOSITIVO_H_</span></div><div><span style="color: #af00db;">#define</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #0000ff;">_CTRL_DISPOSITIVO_H_</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"DaoEntradaDispositivo.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"DaoHistorialDispositivo.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"DaoSalidaDispositivo.hpp"</span></div><br><div><span style="color: #0000ff;">class</span>&nbsp;<span style="color: #267f99;">CtrlDispositivo</span>&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #0000ff;">private:</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">int</span>&nbsp;<span style="color: #001080;">_entrada</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">char</span>*&nbsp;<span style="color: #001080;">_idDisp</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">void</span>&nbsp;(*<span style="color: #001080;">_muestraSalida</span>)(<span style="color: #0000ff;">int</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">int</span>&nbsp;(*<span style="color: #001080;">_recuperaEntrada</span>)();</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">void</span>&nbsp;(*<span style="color: #001080;">_muestraError</span>)(<span style="color: #267f99;">String</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #267f99;">DaoHistorialDispositivo</span>&nbsp;<span style="color: #001080;">_daoHistorial</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #267f99;">DaoEntradaDispositivo</span>&nbsp;<span style="color: #001080;">_daoEntrada</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #267f99;">DaoSalidaDispositivo</span>&nbsp;<span style="color: #001080;">_daoSalida</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">void</span>&nbsp;<span style="color: #795e26;">_muestraLaSalidaDelServidor</span>();</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">void</span>&nbsp;<span style="color: #795e26;">_enviaLaEntrada</span>(<span style="color: #0000ff;">bool</span>&nbsp;<span style="color: #001080;">forzosa</span>);</div><div>&nbsp;&nbsp;<span style="color: #0000ff;">public:</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #795e26;">CtrlDispositivo</span>(<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #001080;">idDisp</span>,&nbsp;<span style="color: #0000ff;">void</span>&nbsp;(<span style="color: #0000ff;">*const</span>&nbsp;<span style="color: #001080;">muestraSalida</span>)(<span style="color: #0000ff;">int</span>),</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">int</span>&nbsp;(*<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #001080;">recuperaEntrada</span>)(),&nbsp;<span style="color: #0000ff;">void</span>&nbsp;(*<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #001080;">muestraError</span>)(<span style="color: #267f99;">String</span>),</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #267f99;">DaoHistorialDispositivo</span>&nbsp;<span style="color: #001080;">daoHistorial</span>,&nbsp;<span style="color: #267f99;">DaoEntradaDispositivo</span>&nbsp;<span style="color: #001080;">daoEntrada</span>,</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #267f99;">DaoSalidaDispositivo</span>&nbsp;<span style="color: #001080;">daoSalida</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">void</span>&nbsp;<span style="color: #795e26;">setup</span>();</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">void</span>&nbsp;<span style="color: #795e26;">loop</span>();</div><div>};</div><br><div><span style="color: #af00db;">#endif</span></div><br></div></td>
          </tr>
        </table>
        <h3>CtrlDispositivo.cpp</h3>
        <table>
          <tr>
            <td class=nums data-total="55"></td>
            <td class=cod><div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"CtrlDispositivo.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"DaoEntradaDispositivo.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"DaoHistorialDispositivo.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"DaoSalidaDispositivo.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">&lt;Arduino.h&gt;</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"ResInt.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"utilIoT.hpp"</span></div><br><div><span style="color: #267f99;">CtrlDispositivo</span>::<span style="color: #795e26;">CtrlDispositivo</span>(<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">char*</span>&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #001080;">idDisp</span>,</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">void</span>&nbsp;(<span style="color: #0000ff;">*const</span>&nbsp;<span style="color: #001080;">muestraSalida</span>)(<span style="color: #0000ff;">int</span>),</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">int</span>&nbsp;(*<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #001080;">recuperaEntrada</span>)(),</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">void</span>&nbsp;(*<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #001080;">muestraError</span>)(<span style="color: #267f99;">String</span>),</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #267f99;">DaoHistorialDispositivo</span>&nbsp;<span style="color: #001080;">daoHistorial</span>,</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #267f99;">DaoEntradaDispositivo</span>&nbsp;<span style="color: #001080;">daoEntrada</span>,</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #267f99;">DaoSalidaDispositivo</span>&nbsp;<span style="color: #001080;">daoSalida</span>)</div><div>&nbsp;&nbsp;:&nbsp;<span style="color: #001080;">_idDisp</span>(<span style="color: #001080;">idDisp</span>),</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">_muestraSalida</span>(<span style="color: #001080;">muestraSalida</span>),</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">_recuperaEntrada</span>(<span style="color: #001080;">recuperaEntrada</span>),</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">_muestraError</span>(<span style="color: #001080;">muestraError</span>),</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">_daoHistorial</span>(<span style="color: #001080;">daoHistorial</span>),</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">_daoEntrada</span>(<span style="color: #001080;">daoEntrada</span>),</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">_daoSalida</span>(<span style="color: #001080;">daoSalida</span>)&nbsp;&nbsp;{&nbsp;}</div><div><span style="color: #0000ff;">void</span>&nbsp;<span style="color: #267f99;">CtrlDispositivo</span>::<span style="color: #795e26;">setup</span>()&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #001080;">_entrada</span>&nbsp;=&nbsp;<span style="color: #098658;">0</span>;</div><div>&nbsp;&nbsp;<span style="color: #795e26;">_muestraLaSalidaDelServidor</span>();</div><div>&nbsp;&nbsp;<span style="color: #795e26;">_enviaLaEntrada</span>(<span style="color: #0000ff;">true</span>);</div><div>}</div><div><span style="color: #0000ff;">void</span>&nbsp;<span style="color: #267f99;">CtrlDispositivo</span>::<span style="color: #795e26;">loop</span>()&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #795e26;">_muestraLaSalidaDelServidor</span>();</div><div>&nbsp;&nbsp;<span style="color: #795e26;">_enviaLaEntrada</span>(<span style="color: #0000ff;">false</span>);</div><div>}</div><div><span style="color: #0000ff;">void</span>&nbsp;<span style="color: #267f99;">CtrlDispositivo</span>::<span style="color: #795e26;">_muestraLaSalidaDelServidor</span>()&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #267f99;">ResInt</span>&nbsp;<span style="color: #001080;">infoValor</span>&nbsp;=&nbsp;<span style="color: #001080;">_daoSalida</span>.<span style="color: #795e26;">busca</span>();</div><div>&nbsp;&nbsp;<span style="color: #af00db;">if</span>&nbsp;(<span style="color: #001080;">infoValor</span>.<span style="color: #001080;">error</span>.<span style="color: #795e26;">length</span>()&nbsp;&gt;&nbsp;<span style="color: #098658;">0</span>)&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;(*<span style="color: #001080;">_muestraError</span>)(<span style="color: #001080;">infoValor</span>.<span style="color: #001080;">error</span>);</div><div>&nbsp;&nbsp;}&nbsp;<span style="color: #af00db;">else</span>&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;(*<span style="color: #001080;">_muestraSalida</span>)(<span style="color: #001080;">infoValor</span>.<span style="color: #001080;">valor</span>);</div><div>&nbsp;&nbsp;}</div><div>}</div><div><span style="color: #0000ff;">void</span>&nbsp;<span style="color: #267f99;">CtrlDispositivo</span>::<span style="color: #795e26;">_enviaLaEntrada</span>(<span style="color: #0000ff;">bool</span>&nbsp;<span style="color: #001080;">forzosa</span>)&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">int</span>&nbsp;<span style="color: #001080;">nuevaEntrada</span>&nbsp;=&nbsp;(*<span style="color: #001080;">_recuperaEntrada</span>)();</div><div>&nbsp;&nbsp;<span style="color: #af00db;">if</span>&nbsp;(<span style="color: #001080;">forzosa</span>&nbsp;||&nbsp;<span style="color: #001080;">_entrada</span>&nbsp;!=&nbsp;<span style="color: #001080;">nuevaEntrada</span>)&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;<span style="color: #001080;">error</span>&nbsp;=&nbsp;<span style="color: #001080;">_daoEntrada</span>.<span style="color: #795e26;">modifica</span>(<span style="color: #001080;">nuevaEntrada</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #af00db;">if</span>&nbsp;(<span style="color: #001080;">error</span>.<span style="color: #795e26;">length</span>()&nbsp;&gt;&nbsp;<span style="color: #098658;">0</span>)&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(*<span style="color: #001080;">_muestraError</span>)(<span style="color: #001080;">error</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #af00db;">return</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;}</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">error</span>&nbsp;=&nbsp;<span style="color: #001080;">_daoHistorial</span>.<span style="color: #795e26;">agrega</span>(<span style="color: #001080;">nuevaEntrada</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #af00db;">if</span>&nbsp;(<span style="color: #001080;">error</span>.<span style="color: #795e26;">length</span>()&nbsp;&gt;&nbsp;<span style="color: #098658;">0</span>)&nbsp;{</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(*<span style="color: #001080;">_muestraError</span>)(<span style="color: #001080;">error</span>);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #af00db;">return</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;}</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #001080;">_entrada</span>&nbsp;=&nbsp;<span style="color: #001080;">nuevaEntrada</span>;</div><div>&nbsp;&nbsp;}</div><div>}</div></div></td>
          </tr>
        </table>
      </section>
      <section id=FabricaDispositivo slot=diapositiva>
        <div class="cortina"></div>
        <header></header>
        <h2></h2>
        <h3>FabricaDispositivo.hpp</h3>
        <table>
          <tr>
            <td class=nums data-total="13"></td>
            <td class=cod><div><div><span style="color: #af00db;">#ifndef</span><span style="color: #0000ff;">&nbsp;_FABRICA_H_</span></div><div><span style="color: #af00db;">#define</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #0000ff;">_FABRICA_H_</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"CtrlDispositivo.hpp"</span></div><div><span style="color: #0000ff;">class</span>&nbsp;<span style="color: #267f99;">FabricaDispositivo</span>&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #0000ff;">public:</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #267f99;">CtrlDispositivo</span>&nbsp;<span style="color: #001080;">ctrlDispositivo</span>;</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #795e26;">FabricaDispositivo</span>(<span style="color: #0000ff;">void</span>&nbsp;(<span style="color: #0000ff;">*const</span>&nbsp;<span style="color: #001080;">muestraSalida</span>)(<span style="color: #0000ff;">int</span>),</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">int</span>&nbsp;(*<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #001080;">recuperaEntrada</span>)(),</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">void</span>&nbsp;(*<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #001080;">muestraError</span>)(<span style="color: #267f99;">String</span>));</div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">void</span>&nbsp;<span style="color: #795e26;">iniciaWiFi</span>();</div><div>};</div><div><span style="color: #af00db;">#endif</span></div><br></div></td>
          </tr>
        </table>
        <h3>FabricaDispositivo.cpp</h3>
        <div class="marco-lectura">
          <p>Sustituye los * como en los ejercicios anteriores.</p>
        </div>
        <table>
          <tr>
            <td class=nums data-total="27"></td>
            <td class=cod><div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"FabricaDispositivo.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"CtrlDispositivo.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"DaoSalidaDispositivo.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"DaoEntradaDispositivo.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"DaoHistorialDispositivo.hpp"</span></div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"utilIoT.hpp"</span></div><div><span style="color: #af00db;">#define</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #0000ff;">SSID</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"******"</span></div><div><span style="color: #af00db;">#define</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #0000ff;">PASS</span><span style="color: #0000ff;">&nbsp;&nbsp;</span><span style="color: #a31515;">"*************"</span></div><div><span style="color: #af00db;">#define</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #0000ff;">HUELLA_DIGITAL</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"**********************"</span></div><div><span style="color: #af00db;">#define</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #0000ff;">ID_DISP</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"iot2"</span></div><div><span style="color: #af00db;">#define</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #0000ff;">ID_PROYECTO</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"************"</span></div><div><span style="color: #0000ff;">const</span>&nbsp;<span style="color: #267f99;">String</span>&nbsp;<span style="color: #001080;">URL_ENTRADA</span>(<span style="color: #795e26;">urlDeDocumento</span>(<span style="color: #0000ff;">ID_PROYECTO</span>,&nbsp;<span style="color: #a31515;">"ENTRADA"</span>,&nbsp;<span style="color: #0000ff;">ID_DISP</span>));</div><div><span style="color: #0000ff;">const</span>&nbsp;<span style="color: #267f99;">String</span>&nbsp;<span style="color: #001080;">URL_SALIDA</span>(<span style="color: #795e26;">urlDeDocumento</span>(<span style="color: #0000ff;">ID_PROYECTO</span>,&nbsp;<span style="color: #a31515;">"SALIDA"</span>,&nbsp;<span style="color: #0000ff;">ID_DISP</span>));</div><div><span style="color: #0000ff;">const</span>&nbsp;<span style="color: #267f99;">String</span>&nbsp;<span style="color: #001080;">URL_HISTORIAL</span>(<span style="color: #795e26;">urlDeColeccion</span>(<span style="color: #0000ff;">ID_PROYECTO</span>,&nbsp;<span style="color: #a31515;">"HISTORIAL"</span>));</div><br><div><span style="color: #267f99;">FabricaDispositivo</span>::<span style="color: #795e26;">FabricaDispositivo</span>(<span style="color: #0000ff;">void</span>&nbsp;(<span style="color: #0000ff;">*const</span>&nbsp;<span style="color: #001080;">muestraSalida</span>)(<span style="color: #0000ff;">int</span>),</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">int</span>&nbsp;(*<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #001080;">recuperaEntrada</span>)(),</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">void</span>&nbsp;(*<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #001080;">muestraError</span>)(<span style="color: #267f99;">String</span>)):</div><div>&nbsp;&nbsp;<span style="color: #001080;">ctrlDispositivo</span>(<span style="color: #0000ff;">ID_DISP</span>,&nbsp;<span style="color: #001080;">muestraSalida</span>,&nbsp;<span style="color: #001080;">recuperaEntrada</span>,&nbsp;<span style="color: #001080;">muestraError</span>,</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #267f99;">DaoHistorialDispositivo</span>(<span style="color: #0000ff;">ID_DISP</span>,&nbsp;<span style="color: #0000ff;">HUELLA_DIGITAL</span>,&nbsp;<span style="color: #001080;">URL_HISTORIAL</span>),</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #267f99;">DaoEntradaDispositivo</span>(<span style="color: #0000ff;">HUELLA_DIGITAL</span>,&nbsp;<span style="color: #001080;">URL_ENTRADA</span>),</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #267f99;">DaoSalidaDispositivo</span>(<span style="color: #0000ff;">HUELLA_DIGITAL</span>,&nbsp;<span style="color: #001080;">URL_SALIDA</span>))&nbsp;{}</div><br><div><span style="color: #0000ff;">void</span>&nbsp;<span style="color: #267f99;">FabricaDispositivo</span>::<span style="color: #795e26;">iniciaWiFi</span>()&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #795e26;">conectaWiFi</span>(<span style="color: #0000ff;">SSID</span>,&nbsp;<span style="color: #0000ff;">PASS</span>);</div><div>}</div><br></div></td>
          </tr>
        </table>
      </section>
      <section id=Dispositivo slot=diapositiva>
        <div class="cortina"></div>
        <header></header>
        <h2></h2>
        <table>
          <tr>
            <td class=nums data-total="30"></td>
            <td class=cod><div><div><span style="color: #af00db;">#include</span><span style="color: #0000ff;">&nbsp;</span><span style="color: #a31515;">"FabricaDispositivo.hpp"</span></div><div><span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">int</span>&nbsp;<span style="color: #001080;">BOTON_FLASH</span>&nbsp;=&nbsp;<span style="color: #098658;">0</span>;<span style="color: #008000;">&nbsp;//&nbsp;Pin&nbsp;que&nbsp;trae&nbsp;cableado&nbsp;el&nbsp;botón&nbsp;flash.</span></div><div><span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">int</span>&nbsp;<span style="color: #001080;">LED_INTEGRADO_2</span>&nbsp;=&nbsp;&nbsp;<span style="color: #098658;">2</span>;<span style="color: #008000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Pin&nbsp;que&nbsp;trae&nbsp;cableado&nbsp;un&nbsp;LED.</span></div><br><div><span style="color: #0000ff;">void</span>&nbsp;<span style="color: #795e26;">muestraSalida</span>(<span style="color: #0000ff;">int</span>&nbsp;<span style="color: #001080;">valor</span>)&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #795e26;">digitalWrite</span>(<span style="color: #001080;">LED_INTEGRADO_2</span>,&nbsp;<span style="color: #001080;">valor</span>&nbsp;&gt;&nbsp;<span style="color: #098658;">0</span>&nbsp;?&nbsp;LOW&nbsp;:&nbsp;HIGH);</div><div>}</div><div><span style="color: #0000ff;">int</span>&nbsp;<span style="color: #795e26;">recuperaEntrada</span>()&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #0000ff;">const</span>&nbsp;<span style="color: #0000ff;">int</span>&nbsp;<span style="color: #001080;">estadoDelBoton</span>&nbsp;=&nbsp;<span style="color: #795e26;">digitalRead</span>(<span style="color: #001080;">BOTON_FLASH</span>);</div><div>&nbsp;&nbsp;<span style="color: #af00db;">return</span>&nbsp;<span style="color: #001080;">estadoDelBoton</span>&nbsp;==&nbsp;HIGH&nbsp;?&nbsp;<span style="color: #098658;">10</span>&nbsp;:&nbsp;<span style="color: #098658;">2</span>;</div><div>}</div><div><span style="color: #0000ff;">void</span>&nbsp;<span style="color: #795e26;">muestraError</span>(<span style="color: #267f99;">String</span>&nbsp;<span style="color: #001080;">error</span>)&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #001080;">Serial</span>.<span style="color: #795e26;">println</span>(<span style="color: #001080;">error</span>.<span style="color: #795e26;">c_str</span>());</div><div>}</div><br><div><span style="color: #267f99;">FabricaDispositivo</span>&nbsp;<span style="color: #001080;">fabrica</span>(<span style="color: #795e26;">muestraSalida</span>,&nbsp;<span style="color: #795e26;">recuperaEntrada</span>,&nbsp;<span style="color: #795e26;">muestraError</span>);</div><div><span style="color: #0000ff;">void</span>&nbsp;<span style="color: #795e26;">setup</span>()&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #001080;">Serial</span>.<span style="color: #795e26;">begin</span>(<span style="color: #098658;">115200</span>);</div><div><span style="color: #008000;">&nbsp;&nbsp;//&nbsp;Initializa&nbsp;el&nbsp;pin&nbsp;para&nbsp;LED_INTEGRADO_2&nbsp;como&nbsp;salida.</span></div><div>&nbsp;&nbsp;<span style="color: #795e26;">pinMode</span>(<span style="color: #001080;">LED_INTEGRADO_2</span>,&nbsp;OUTPUT);</div><div><span style="color: #008000;">&nbsp;&nbsp;//&nbsp;Initializa&nbsp;el&nbsp;pin&nbsp;para&nbsp;BOTÓN_FLASH&nbsp;como&nbsp;entrada.</span></div><div>&nbsp;&nbsp;<span style="color: #795e26;">pinMode</span>(<span style="color: #001080;">BOTON_FLASH</span>,&nbsp;INPUT);</div><div>&nbsp;&nbsp;<span style="color: #001080;">fabrica</span>.<span style="color: #795e26;">iniciaWiFi</span>();</div><div>&nbsp;&nbsp;<span style="color: #001080;">fabrica</span>.<span style="color: #001080;">ctrlDispositivo</span>.<span style="color: #795e26;">setup</span>();</div><div>}</div><br><div><span style="color: #0000ff;">void</span>&nbsp;<span style="color: #795e26;">loop</span>()&nbsp;{</div><div>&nbsp;&nbsp;<span style="color: #001080;">fabrica</span>.<span style="color: #001080;">ctrlDispositivo</span>.<span style="color: #795e26;">loop</span>();</div><div>}</div><br></div></td>
          </tr>
        </table>
      </section>
    </mi-presentacion>
  </body>
  <script type="module" src="lib/comun.js"></script>
</html>