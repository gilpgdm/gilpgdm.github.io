<muestra-codigo>
 <div>
  <div><span
     style="color: #800000;">&lt;!DOCTYPE</span> <span
     style="color: #e50000;">html</span><span
     style="color: #800000;">&gt;</span></div>
  <div><span
     style="color: #800000;">&lt;html</span> <span
     style="color: #e50000;">lang</span>=<span
     style="color: #0000ff;">"es"</span><span
     style="color: #800000;">&gt;</span></div><br>
  <div><span
     style="color: #800000;">&lt;head&gt;</span></div><br>
  <div>&nbsp;<span
     style="color: #800000;">&lt;meta</span> <span
     style="color: #e50000;">charset</span>=<span
     style="color: #0000ff;">"UTF-8"</span><span
     style="color: #800000;">&gt;</span></div>
  <div>&nbsp;<span
     style="color: #800000;">&lt;meta</span> <span
     style="color: #e50000;">name</span>=<span
     style="color: #0000ff;">"viewport"</span> <span
     style="color: #e50000;">content</span>=<span
     style="color: #0000ff;">"width=device-width"</span><span
     style="color: #800000;">&gt;</span></div><br>
  <div>&nbsp;<span
     style="color: #800000;">&lt;title&gt;</span>Sincronizacion<span
     style="color: #800000;">&lt;/title&gt;</span></div><br>
  <div>&nbsp;<span
     style="color: #800000;">&lt;script</span> <span
     style="color: #e50000;">type</span>=<span
     style="color: #0000ff;">"module"</span> <span
     style="color: #e50000;">src</span>=<span
     style="color: #0000ff;">"js/configura.js"</span><span
     style="color: #800000;">&gt;&lt;/script&gt;</span></div><br>
  <div><span
     style="color: #800000;">&lt;/head&gt;</span></div><br>
  <div><span
     style="color: #800000;">&lt;body&gt;</span></div><br>
  <div>&nbsp;<span
     style="color: #800000;">&lt;h1&gt;</span>Sincronizacion<span
     style="color: #800000;">&lt;/h1&gt;</span></div><br>
  <div>&nbsp;<span
     style="color: #800000;">&lt;p&gt;&lt;a</span> <span
     style="color: #e50000;">href</span>=<span
     style="color: #0000ff;">"agrega.html"</span><span
     style="color: #800000;">&gt;</span>Agregar<span
     style="color: #800000;">&lt;/a&gt;&lt;/p&gt;</span></div><br>
  <div>&nbsp;<span
     style="color: #800000;">&lt;ul</span> <span
     style="color: #e50000;">id</span>=<span
     style="color: #0000ff;">"lista"</span><span
     style="color: #800000;">&gt;</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #800000;">&lt;li&gt;&lt;progress</span> <span
     style="color: #e50000;">max</span>=<span
     style="color: #0000ff;">"100"</span><span
     style="color: #800000;">&gt;</span>Cargando<span
     style="color: #0000ff;">&amp;hellip;</span><span
     style="color: #800000;">&lt;/progress&gt;&lt;/li&gt;</span></div>
  <div>&nbsp;<span
     style="color: #800000;">&lt;/ul&gt;</span></div><br>
  <div>&nbsp;<span
     style="color: #800000;">&lt;script</span> <span
     style="color: #e50000;">type</span>=<span
     style="color: #0000ff;">"module"</span><span
     style="color: #800000;">&gt;</span></div><br>
  <div>&nbsp;&nbsp;<span
     style="color: #af00db;">import</span>&nbsp;{ <span
     style="color: #001080;">muestraError</span> }&nbsp;<span
     style="color: #af00db;">from</span> <span
     style="color: #a31515;">"./lib/js/muestraError.js"</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #af00db;">import</span>&nbsp;{ <span
     style="color: #001080;">enviaJson</span> }&nbsp;<span
     style="color: #af00db;">from</span> <span
     style="color: #a31515;">"./lib/js/enviaJson.js"</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #af00db;">import</span>&nbsp;{ <span
     style="color: #001080;">Pasatiempo</span> }&nbsp;<span
     style="color: #af00db;">from</span> <span
     style="color: #a31515;">"./js/modelo/Pasatiempo.js"</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #af00db;">import</span>&nbsp;{</div>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #001080;">validaQueTengaLasPropiedadesDePasatiempo</span>
  </div>
  <div>&nbsp;&nbsp;}&nbsp;<span
     style="color: #af00db;">from</span> <span
     style="color: #a31515;">"./js/modelo/validaQueTengaLasPropiedadesDePasatiempo.js"</span>
  </div>
  <div>&nbsp;&nbsp;<span
     style="color: #af00db;">import</span>&nbsp;{</div>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #001080;">pasatiempoConsultaNoEliminados</span></div>
  <div>&nbsp;&nbsp;}&nbsp;<span
     style="color: #af00db;">from</span> <span
     style="color: #a31515;">"./js/dao/pasatiempoConsultaNoEliminados.js"</span>
  </div>
  <div>&nbsp;&nbsp;<span
     style="color: #af00db;">import</span>&nbsp;{ <span
     style="color: #001080;">pasatiempoConsultaTodos</span> }&nbsp;<span
     style="color: #af00db;">from</span> <span
     style="color: #a31515;">"./js/dao/pasatiempoConsultaTodos.js"</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #af00db;">import</span>&nbsp;{ <span
     style="color: #001080;">pasatiemposReemplaza</span> }&nbsp;<span
     style="color: #af00db;">from</span> <span
     style="color: #a31515;">"./js/dao/pasatiemposReemplaza.js"</span></div><br>
  <div>&nbsp;&nbsp;<span
     style="color: #008000;">/**</span></div>
  <div><span
     style="color: #008000;">&nbsp;&nbsp;&nbsp;*&nbsp;Cada 20 segundos (2000
    milisegundos) después de la última</span></div>
  <div><span
     style="color: #008000;">&nbsp;&nbsp;&nbsp;*&nbsp;sincronización, los datos
    se envían al servidor para volver a</span></div>
  <div><span
     style="color: #008000;">&nbsp;&nbsp;&nbsp;*&nbsp;sincronizarse con los
    datos del servidor.</span></div>
  <div><span
     style="color: #008000;">&nbsp;&nbsp;&nbsp;*/</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #0000ff;">const</span> <span
     style="color: #0070c1;">MILISEGUNDOS_PARA_VOLVER_A_SINCRONIZAR</span> =
   <span
     style="color: #098658;">20000</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #0000ff;">let</span> <span
     style="color: #001080;">noHaSincronizado</span> = <span
     style="color: #0000ff;">true</span></div><br>
  <div>&nbsp;&nbsp;<span
     style="color: #008000;">// Crea y pone en funcionamiento el worker del
    archivo "render.js".</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #0000ff;">const</span> <span
     style="color: #0070c1;">worker</span> = <span
     style="color: #0000ff;">new</span> <span
     style="color: #267f99;">Worker</span>(<span
     style="color: #a31515;">"render.js"</span>,&nbsp;{ <span
     style="color: #001080;">type</span><span
     style="color: #001080;">:</span> <span
     style="color: #a31515;">"module"</span> })</div><br>
  <div>&nbsp;&nbsp;<span
     style="color: #008000;">// Se invoca cuando el worker envía un mensaje a la
    página.</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #0070c1;">worker</span>.<span
     style="color: #795e26;">onmessage</span> = <span
     style="color: #0000ff;">async</span> <span
     style="color: #001080;">event</span> <span
     style="color: #0000ff;">=&gt;</span>&nbsp;{</div>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #001080;">lista</span>.<span
     style="color: #001080;">innerHTML</span> = <span
     style="color: #001080;">event</span>.<span
     style="color: #001080;">data</span></div>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #af00db;">if</span> (<span
     style="color: #001080;">noHaSincronizado</span>)&nbsp;{</div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #001080;">noHaSincronizado</span> = <span
     style="color: #0000ff;">false</span></div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #af00db;">await</span> <span
     style="color: #795e26;">sincroniza</span>()</div>
  <div>&nbsp;&nbsp;&nbsp;}&nbsp;<span
     style="color: #af00db;">else</span>&nbsp;{</div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #795e26;">esperaUnPocoYLanzaSincronizacion</span>()</div>
  <div>&nbsp;&nbsp;&nbsp;}</div>
  <div>&nbsp;&nbsp;}</div><br>
  <div>&nbsp;&nbsp;<span
     style="color: #795e26;">pasatiempoConsultaNoEliminados</span>()</div>
  <div>&nbsp;&nbsp;&nbsp;.<span
     style="color: #795e26;">then</span>(<span
     style="color: #795e26;">renderEnWebWorker</span>)</div>
  <div>&nbsp;&nbsp;&nbsp;.<span
     style="color: #795e26;">catch</span>(<span
     style="color: #001080;">muestraError</span>)</div><br>
  <div>&nbsp;&nbsp;<span
     style="color: #0000ff;">function</span> <span
     style="color: #795e26;">renderEnWebWorker</span>(<span
     style="color: #001080;">datos</span>)&nbsp;{</div>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #af00db;">if</span> (!<span
     style="color: #267f99;">Array</span>.<span
     style="color: #795e26;">isArray</span>(<span
     style="color: #001080;">datos</span>))</div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #af00db;">throw</span> <span
     style="color: #0000ff;">new</span> <span
     style="color: #267f99;">Error</span>(<span
     style="color: #a31515;">"Los datos no son un arreglo."</span>)</div>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #af00db;">for</span> (<span
     style="color: #0000ff;">const</span> <span
     style="color: #0070c1;">dato</span> <span
     style="color: #0000ff;">of</span> <span
     style="color: #001080;">datos</span>)&nbsp;{</div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #795e26;">validaQueTengaLasPropiedadesDePasatiempo</span>(<span
     style="color: #0070c1;">dato</span>)</div>
  <div>&nbsp;&nbsp;&nbsp;}</div>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #008000;">// Manda los datos al worker para
    renderizar.</span></div>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #0070c1;">worker</span>.<span
     style="color: #795e26;">postMessage</span>(<span
     style="color: #001080;">datos</span>)</div>
  <div>&nbsp;&nbsp;}</div><br>
  <div>&nbsp;&nbsp;<span
     style="color: #0000ff;">async</span> <span
     style="color: #0000ff;">function</span> <span
     style="color: #795e26;">sincroniza</span>()&nbsp;{</div>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #af00db;">try</span>&nbsp;{</div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #af00db;">if</span> (<span
     style="color: #001080;">navigator</span>.<span
     style="color: #001080;">onLine</span>)&nbsp;{</div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #0000ff;">const</span> <span
     style="color: #0070c1;">todos</span> = <span
     style="color: #af00db;">await</span> <span
     style="color: #795e26;">pasatiempoConsultaTodos</span>()</div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #0000ff;">const</span> <span
     style="color: #0070c1;">datosNuevos</span> = <span
     style="color: #af00db;">await</span> <span
     style="color: #795e26;">enviaJson</span>(<span
     style="color: #a31515;">"srv/srvSincro.php"</span>, <span
     style="color: #0070c1;">todos</span>)</div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #795e26;">renderEnWebWorker</span>(<span
     style="color: #0070c1;">datosNuevos</span>)</div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #af00db;">await</span> <span
     style="color: #795e26;">pasatiemposReemplaza</span>(<span
     style="color: #0070c1;">datosNuevos</span>)</div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span
     style="color: #af00db;">else</span>&nbsp;{</div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #795e26;">esperaUnPocoYLanzaSincronizacion</span>()</div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;}</div>
  <div>&nbsp;&nbsp;&nbsp;}&nbsp;<span
     style="color: #af00db;">catch</span> (<span
     style="color: #001080;">error</span>)&nbsp;{</div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #795e26;">muestraError</span>(<span
     style="color: #001080;">error</span>)</div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #795e26;">esperaUnPocoYLanzaSincronizacion</span>()</div>
  <div>&nbsp;&nbsp;&nbsp;}</div>
  <div>&nbsp;&nbsp;}</div><br>
  <div>&nbsp;&nbsp;<span
     style="color: #0000ff;">function</span> <span
     style="color: #795e26;">esperaUnPocoYLanzaSincronizacion</span>()&nbsp;{
  </div>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #795e26;">setTimeout</span>(<span
     style="color: #795e26;">sincroniza</span>, <span
     style="color: #0070c1;">MILISEGUNDOS_PARA_VOLVER_A_SINCRONIZAR</span>)
  </div>
  <div>&nbsp;&nbsp;}</div><br>
  <div>&nbsp;<span
     style="color: #800000;">&lt;/script&gt;</span></div><br>
  <div><span
     style="color: #800000;">&lt;/body&gt;</span></div><br>
  <div><span
     style="color: #800000;">&lt;/html&gt;</span></div>
 </div>
</muestra-codigo>