<muestra-codigo>
 <div>
  <div><span
     style="color: #800000;">&lt;!DOCTYPE</span> <span
     style="color: #e50000;">html</span><span
     style="color: #800000;">&gt;</span></div>
  <div><span
     style="color: #800000;">&lt;html</span> <span
     style="color: #e50000;">lang</span>=<span
     style="color: #0000ff;">"es"</span><span
     style="color: #800000;">&gt;</span></div><br>
  <div><span
     style="color: #800000;">&lt;head&gt;</span></div><br>
  <div>&nbsp;<span
     style="color: #800000;">&lt;meta</span> <span
     style="color: #e50000;">charset</span>=<span
     style="color: #0000ff;">"utf-8"</span><span
     style="color: #800000;">&gt;</span></div>
  <div>&nbsp;<span
     style="color: #800000;">&lt;meta</span> <span
     style="color: #e50000;">name</span>=<span
     style="color: #0000ff;">"viewport"</span> <span
     style="color: #e50000;">content</span>=<span
     style="color: #0000ff;">"width=device-width"</span><span
     style="color: #800000;">&gt;</span></div><br>
  <div>&nbsp;<span
     style="color: #800000;">&lt;title&gt;</span>IoT<span
     style="color: #800000;">&lt;/title&gt;</span></div><br>
  <div>&nbsp;<span
     style="color: #800000;">&lt;script</span> <span
     style="color: #e50000;">src</span>=<span
     style="color: #0000ff;">"paho.javascript-1.0.3/paho-mqtt-min.js"</span><span
     style="color: #800000;">&gt;&lt;/script&gt;</span></div><br>
  <div>&nbsp;<span
     style="color: #800000;">&lt;script&gt;</span></div><br>
  <div>&nbsp;&nbsp;<span
     style="color: #008000;">// A cada control le corresponde un t√≥pico
    diferente.</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #0000ff;">const</span> <span
     style="color: #0070c1;">TOPICO_FOCO</span> = <span
     style="color: #a31515;">"gilpgdm/IoT/foco"</span></div><br>
  <div>&nbsp;&nbsp;<span
     style="color: #0000ff;">let</span> <span
     style="color: #001080;">valor</span> = <span
     style="color: #a31515;">"0"</span></div><br>
  <div>&nbsp;<span
     style="color: #800000;">&lt;/script&gt;</span></div><br>
  <div><span
     style="color: #800000;">&lt;/head&gt;</span></div><br>
  <div><span
     style="color: #800000;">&lt;body&gt;</span></div><br>
  <div>&nbsp;<span
     style="color: #800000;">&lt;h1&gt;</span>IoT<span
     style="color: #800000;">&lt;/h1&gt;</span></div><br>
  <div>&nbsp;<span
     style="color: #800000;">&lt;p&gt;</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #800000;">&lt;output</span> <span
     style="color: #e50000;">id</span>=<span
     style="color: #0000ff;">"salida"</span><span
     style="color: #800000;">&gt;</span></div>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #800000;">&lt;progress</span> <span
     style="color: #e50000;">max</span>=<span
     style="color: #0000ff;">"100"</span><span
     style="color: #800000;">&gt;</span>Cargando<span
     style="color: #0000ff;">&amp;hellip;</span><span
     style="color: #800000;">&lt;/progress&gt;</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #800000;">&lt;/output&gt;</span></div>
  <div>&nbsp;<span
     style="color: #800000;">&lt;/p&gt;</span></div><br>
  <div>&nbsp;<span
     style="color: #800000;">&lt;p&gt;</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #800000;">&lt;button</span> <span
     style="color: #e50000;">type</span>=<span
     style="color: #0000ff;">"button"</span></div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #e50000;">onclick</span>=<span
     style="color: #0000ff;">"</span><span
     style="color: #795e26;">enviaMensajeMqtt</span><span
     style="color: #0000ff;">( </span><span
     style="color: #001080;">valor</span><span
     style="color: #0000ff;"> </span>===<span
     style="color: #0000ff;"> </span><span
     style="color: #a31515;">'1'</span><span
     style="color: #0000ff;"> </span>?<span
     style="color: #0000ff;"> </span><span
     style="color: #a31515;">'0'</span><span
     style="color: #0000ff;"> </span>:<span
     style="color: #0000ff;"> </span><span
     style="color: #a31515;">'1'</span><span
     style="color: #0000ff;">, </span><span
     style="color: #0070c1;">TOPICO_FOCO</span><span
     style="color: #0000ff;">)"</span><span
     style="color: #800000;">&gt;</span></div>
  <div>&nbsp;&nbsp;&nbsp;Enviar</div>
  <div>&nbsp;&nbsp;<span
     style="color: #800000;">&lt;/button&gt;</span></div>
  <div>&nbsp;<span
     style="color: #800000;">&lt;/p&gt;</span></div><br>
  <div>&nbsp;<span
     style="color: #800000;">&lt;script</span> <span
     style="color: #e50000;">type</span>=<span
     style="color: #0000ff;">"module"</span><span
     style="color: #800000;">&gt;</span></div><br>
  <div>&nbsp;&nbsp;<span
     style="color: #af00db;">import</span>&nbsp;{ <span
     style="color: #001080;">creaClientIdMqtt</span> }&nbsp;<span
     style="color: #af00db;">from</span> <span
     style="color: #a31515;">"./lib/js/creaClientIdMqtt.js"</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #af00db;">import</span>&nbsp;{ <span
     style="color: #001080;">falloEnLaConexionMqtt</span> }&nbsp;<span
     style="color: #af00db;">from</span> <span
     style="color: #a31515;">"./lib/js/falloEnLaConexionMqtt.js"</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #af00db;">import</span>&nbsp;{ <span
     style="color: #001080;">conexionMqttPerdida</span> }&nbsp;<span
     style="color: #af00db;">from</span> <span
     style="color: #a31515;">"./lib/js/conexionMqttPerdida.js"</span></div><br>
  <div>&nbsp;&nbsp;<span
     style="color: #008000;">// Cambia por una ra√≠z para tu proyecto.</span>
  </div>
  <div>&nbsp;&nbsp;<span
     style="color: #0000ff;">const</span> <span
     style="color: #0070c1;">clientId</span> = <span
     style="color: #795e26;">creaClientIdMqtt</span>(<span
     style="color: #a31515;">"gilpgdmIoT-"</span>)</div><br>
  <div>&nbsp;&nbsp;<span
     style="color: #008000;">// Si usas un servidor de MQTT diferente, necesitas
    cambiar los par√°metros.</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #0000ff;">const</span> <span
     style="color: #0070c1;">cliente</span> = <span
     style="color: #0000ff;">new</span> <span
     style="color: #001080;">Paho</span>.<span
     style="color: #0070c1;">MQTT</span>.<span
     style="color: #795e26;">Client</span>(<span
     style="color: #a31515;">"test.mosquitto.org"</span>, <span
     style="color: #098658;">8081</span>, <span
     style="color: #0070c1;">clientId</span>)</div><br>
  <div>&nbsp;&nbsp;<span
     style="color: #008000;">// Acciones al recibir un mensaje.</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #0070c1;">cliente</span>.<span
     style="color: #795e26;">onMessageArrived</span> = <span
     style="color: #001080;">mensaje</span> <span
     style="color: #0000ff;">=&gt;</span>&nbsp;{</div>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #af00db;">if</span> (<span
     style="color: #001080;">mensaje</span>.<span
     style="color: #001080;">destinationName</span> === <span
     style="color: #0070c1;">TOPICO_FOCO</span>)&nbsp;{</div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #001080;">valor</span> = <span
     style="color: #001080;">mensaje</span>.<span
     style="color: #001080;">payloadString</span></div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #001080;">salida</span>.<span
     style="color: #001080;">value</span> = <span
     style="color: #001080;">valor</span> === <span
     style="color: #a31515;">"1"</span> ? <span
     style="color: #a31515;">"üî¥"</span> : <span
     style="color: #a31515;">"‚ö™"</span></div>
  <div>&nbsp;&nbsp;&nbsp;}</div>
  <div>&nbsp;&nbsp;}</div><br>
  <div>&nbsp;&nbsp;<span
     style="color: #008000;">// Acciones al perder la conexi√≥n.</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #0070c1;">cliente</span>.<span
     style="color: #001080;">onConnectionLost</span> = <span
     style="color: #001080;">conexionMqttPerdida</span></div><br>
  <div>&nbsp;&nbsp;<span
     style="color: #008000;">// Configura el cliente.</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #0070c1;">cliente</span>.<span
     style="color: #795e26;">connect</span>({</div><br>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #001080;">keepAliveInterval</span><span
     style="color: #001080;">:</span> <span
     style="color: #098658;">10</span>,</div><br>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #001080;">useSSL</span><span
     style="color: #001080;">:</span> <span
     style="color: #0000ff;">true</span>,</div><br>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #008000;">// Acciones al fallar la conexi√≥n.</span></div>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #001080;">onFailure</span><span
     style="color: #001080;">:</span> <span
     style="color: #001080;">falloEnLaConexionMqtt</span>,</div><br>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #008000;">// Acciones al lograr la conexi√≥n.</span></div>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #795e26;">onSuccess</span><span
     style="color: #001080;">:</span> () <span
     style="color: #0000ff;">=&gt;</span>&nbsp;{</div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #001080;">console</span>.<span
     style="color: #795e26;">log</span>(<span
     style="color: #a31515;">"Conectado"</span>)</div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #008000;">// Se suscribe a uno o m√°s t√≥picos.</span></div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #0070c1;">cliente</span>.<span
     style="color: #795e26;">subscribe</span>(<span
     style="color: #0070c1;">TOPICO_FOCO</span>)</div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #008000;">// Env√≠a el valor inicial al t√≥pico.</span></div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span
     style="color: #795e26;">enviaMensajeMqtt</span>(<span
     style="color: #001080;">valor</span>, <span
     style="color: #0070c1;">TOPICO_FOCO</span>)</div>
  <div>&nbsp;&nbsp;&nbsp;},</div><br>
  <div>&nbsp;&nbsp;})</div><br>
  <div>&nbsp;&nbsp;<span
     style="color: #008000;">/**</span></div>
  <div><span
     style="color: #008000;">&nbsp;&nbsp;&nbsp;*&nbsp;Env√° un valor al servidor
    de MQTT y es reenviado a todos los dispositivos</span></div>
  <div><span
     style="color: #008000;">&nbsp;&nbsp;&nbsp;*&nbsp;suscritos al t√≥pico
    indicado</span></div>
  <div><span
     style="color: #008000;">&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;{string}&nbsp;mensaje</span>
  </div>
  <div><span
     style="color: #008000;">&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;{string}&nbsp;topico</span>
  </div>
  <div><span
     style="color: #008000;">&nbsp;&nbsp;&nbsp;*/</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #0000ff;">function</span> <span
     style="color: #795e26;">enviaMensajeMqtt</span>(<span
     style="color: #001080;">mensaje</span>, <span
     style="color: #001080;">topico</span>)&nbsp;{</div>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #0000ff;">const</span> <span
     style="color: #0070c1;">mensajeMqtt</span> = <span
     style="color: #0000ff;">new</span> <span
     style="color: #001080;">Paho</span>.<span
     style="color: #0070c1;">MQTT</span>.<span
     style="color: #795e26;">Message</span>(<span
     style="color: #001080;">mensaje</span>)</div>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #0070c1;">mensajeMqtt</span>.<span
     style="color: #001080;">destinationName</span> = <span
     style="color: #001080;">topico</span></div>
  <div>&nbsp;&nbsp;&nbsp;<span
     style="color: #0070c1;">cliente</span>.<span
     style="color: #795e26;">send</span>(<span
     style="color: #0070c1;">mensajeMqtt</span>)</div>
  <div>&nbsp;&nbsp;}</div><br>
  <div>&nbsp;&nbsp;<span
     style="color: #008000;">// Permite que los eventos de html usen la
    funci√≥n.</span></div>
  <div>&nbsp;&nbsp;<span
     style="color: #001080;">window</span>[<span
     style="color: #a31515;">"enviaMensajeMqtt"</span>] = <span
     style="color: #795e26;">enviaMensajeMqtt</span></div><br>
  <div>&nbsp;<span
     style="color: #800000;">&lt;/script&gt;</span></div><br>
  <div><span
     style="color: #800000;">&lt;/body&gt;</span></div><br>
  <div><span
     style="color: #800000;">&lt;/html&gt;</span></div>
 </div>
</muestra-codigo>